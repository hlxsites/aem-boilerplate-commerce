/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as f}from"@dropins/tools/preact-jsx-runtime.js";import{useState as h,useCallback as c,useEffect as v,useMemo as I}from"@dropins/tools/preact-hooks.js";import{Picker as w}from"@dropins/tools/components.js";import{events as u}from"@dropins/tools/event-bus.js";import{C as S,e as H,c as i,u as K,h as G}from"../chunks/customerCompanyContext.js";import"@dropins/tools/lib.js";import"@dropins/tools/fetch-graphql.js";const M=()=>{const[s,r]=h([]),[m,a]=h({text:"",value:""}),p=c(async()=>{var e,n;try{const o=await S.getInstance().getCustomerCompanyInfo();r(o.customerCompanies),(e=o.currentCompany)!=null&&e.name&&((n=o.currentCompany)!=null&&n.id)&&a({text:o.currentCompany.name,value:o.currentCompany.id})}catch(t){console.error("Failed to load company data:",t)}},[]),y=c(async e=>{const t=e.target.value,o=s.find(x=>x.value===t);o&&a(o),H().setCompanyHeaders(t),t?sessionStorage.setItem(i.getConfig().companySessionStorageKey,t):sessionStorage.removeItem(i.getConfig().companySessionStorageKey);const g=await K();G().setGroupHeaders(g),g?sessionStorage.setItem(i.getConfig().groupSessionStorageKey,g):sessionStorage.removeItem(i.getConfig().groupSessionStorageKey),u.emit("companyContext/changed",t)},[s]),C=c(()=>{S.getInstance().resetCache(),r([]),a({text:"",value:""})},[]),d=c(e=>{e?p():C()},[p,C]),l=c(e=>{if(!e){C();return}r(n=>{const t=n.find(o=>o.value===e);return t&&a(t),n})},[C,r,a]);return v(()=>{const e=u.on("authenticated",d,{eager:!0}),n=u.on("companyContext/changed",l,{eager:!0});return()=>{var t,o;(t=e==null?void 0:e.off)==null||t.call(e),(o=n==null?void 0:n.off)==null||o.call(n)}},[d,l]),{companies:s,currentCompany:m,handleCompanyChange:y}},q=({ariaLabel:s,...r})=>{const{companies:m,currentCompany:a,handleCompanyChange:p}=M(),y=I(()=>m,[m]);return m.length<2?null:f("div",{...r,children:f(w,{options:y,value:a.value,onChange:p,"aria-label":s||"Select company","aria-describedby":"company-switcher-description"})})};export{q as CompanySwitcher,q as default,M as useCompanyData};
//# sourceMappingURL=CompanySwitcher.js.map
