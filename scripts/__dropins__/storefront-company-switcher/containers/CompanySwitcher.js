/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as u}from"@dropins/tools/preact-jsx-runtime.js";import{useState as f,useCallback as C,useEffect as x,useMemo as v}from"@dropins/tools/preact-hooks.js";import{Picker as I}from"@dropins/tools/components.js";import{events as i}from"@dropins/tools/event-bus.js";import{C as g}from"../chunks/customerCompanyContext.js";import"@dropins/tools/fetch-graphql.js";const w=()=>{const[r,m]=f([]),[c,a]=f({text:"",value:""}),p=C(async()=>{var t,n;try{const e=await g.getInstance().getCustomerCompanyInfo();m(e.customerCompanies),(t=e.currentCompany)!=null&&t.name&&((n=e.currentCompany)!=null&&n.id)&&a({text:e.currentCompany.name,value:e.currentCompany.id})}catch(o){console.error("Failed to load company data:",o)}},[]),s=C(t=>{const o=t.target.value,e=r.find(h=>h.value===o);e&&a(e),i.emit("companyContext/changing",o)},[r]),y=C(()=>{g.getInstance().resetCache(),m([]),a({text:"",value:""})},[]),l=C(t=>{t?p():y()},[p,y]),d=C(t=>{m(n=>{const o=n.find(e=>e.value===t);return o&&a(o),n})},[]);return x(()=>{const t=i.on("authenticated",l,{eager:!0}),n=i.on("companyContext/restored",d,{eager:!0});return()=>{var o,e;(o=t==null?void 0:t.off)==null||o.call(t),(e=n==null?void 0:n.off)==null||e.call(n)}},[l,d]),{companies:r,currentCompany:c,handleCompanyChange:s}},F=({ariaLabel:r,...m})=>{const{companies:c,currentCompany:a,handleCompanyChange:p}=w(),s=v(()=>c,[c]);return c.length<2?null:u("div",{...m,children:u(I,{options:s,value:a.value,onChange:p,"aria-label":r||"Select company","aria-describedby":"company-switcher-description"})})};export{F as CompanySwitcher,F as default,w as useCompanyData};
//# sourceMappingURL=CompanySwitcher.js.map
