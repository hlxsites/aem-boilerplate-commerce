/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as S}from"@dropins/tools/preact-jsx-runtime.js";import{useState as x,useCallback as p,useEffect as I,useMemo as k}from"@dropins/tools/preact-hooks.js";import{Picker as H}from"@dropins/tools/components.js";import{events as C}from"@dropins/tools/event-bus.js";import{C as v,e as w,c as u,u as K,h as G}from"../chunks/customerCompanyContext.js";import"@dropins/tools/lib.js";import"@dropins/tools/fetch-graphql.js";const M=()=>{const[y,s]=x([]),[g,r]=x({text:"",value:""}),l=p(async()=>{var e,o;try{const n=await v.getInstance().getCustomerCompanyInfo();s(n.customerCompanies),(e=n.currentCompany)!=null&&e.name&&((o=n.currentCompany)!=null&&o.id)&&r({text:n.currentCompany.name,value:n.currentCompany.id})}catch(t){console.error("Failed to load company data:",t)}},[]),h=p(async e=>{const t=e.target.value,n=y.find(i=>i.value===t);n&&r(n),w().setCompanyHeaders(t),t?sessionStorage.setItem(u.getConfig().companySessionStorageKey,t):sessionStorage.removeItem(u.getConfig().companySessionStorageKey);const a=await K();G().setGroupHeaders(a),a?sessionStorage.setItem(u.getConfig().groupSessionStorageKey,a):sessionStorage.removeItem(u.getConfig().groupSessionStorageKey),C.emit("companyContext/changed",t)},[y]),c=p(()=>{v.getInstance().resetCache(),s([]),r({text:"",value:""})},[]),d=p(e=>{e?l():c()},[l,c]),f=p(e=>{if(!e){c();return}s(o=>{const t=o.find(n=>n.value===e);return t&&r(t),o})},[c,s,r]),m=p(e=>{const{company:o}=e;s(t=>{const n=t.findIndex(a=>a.value===o.id);return n===-1?t:t.map((a,i)=>i===n?{...a,text:o.name}:a)}),r({text:o.name,value:o.id})},[]);return I(()=>{const e=C.on("authenticated",d,{eager:!0}),o=C.on("companyContext/changed",f,{eager:!0}),t=C.on("company/updated",m);return()=>{var n,a,i;(n=e==null?void 0:e.off)==null||n.call(e),(a=o==null?void 0:o.off)==null||a.call(o),(i=t==null?void 0:t.off)==null||i.call(t)}},[d,f,m]),{companies:y,currentCompany:g,handleCompanyChange:h}},q=({ariaLabel:y,...s})=>{const{companies:g,currentCompany:r,handleCompanyChange:l}=M(),[h,c]=x(!0),d=k(()=>g,[g]);return I(()=>{const f=()=>{c(!1)},m=C.on("checkout/initialized",f),e=C.on("checkout/updated",f);return()=>{m==null||m.off(),e==null||e.off()}},[]),g.length<2||!h?null:S("div",{...s,children:S(H,{options:d,value:r.value,onChange:l,"aria-label":y||"Select company","aria-describedby":"company-switcher-description"})})};export{q as CompanySwitcher,q as default};
//# sourceMappingURL=CompanySwitcher.js.map
