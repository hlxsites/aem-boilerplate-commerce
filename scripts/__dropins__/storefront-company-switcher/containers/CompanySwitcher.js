/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as l}from"@dropins/tools/preact-jsx-runtime.js";import{useState as y,useCallback as o,useEffect as I}from"@dropins/tools/preact-hooks.js";import{Picker as v}from"@dropins/tools/components.js";import{events as d}from"@dropins/tools/event-bus.js";import{g as x}from"../chunks/customerCompanies.js";import{setFetchGraphQlHeader as f,removeFetchGraphQlHeader as E}from"@dropins/tools/fetch-graphql.js";const a="X-Adobe-Company",r="DROPIN__COMPANYSWITCHER__COMPANY__CONTEXT",H=({children:A,initialData:O,...h})=>{const[s,c]=y([]),[g,m]=y({text:"",value:""}),i=o(async()=>{var t,n;try{const e=await x();c(e.customerCompanies),(t=e.currentCompany)!=null&&t.name&&((n=e.currentCompany)!=null&&n.id)&&m({text:e.currentCompany.name,value:e.currentCompany.id})}catch(e){console.error("Failed to load company data:",e)}},[]),_=o(t=>{const e=t.target.value;d.emit("companyContext/changed",e),sessionStorage.setItem(r,e),f(a,e)},[]),p=o(()=>{const t=sessionStorage.getItem(r);t&&f(a,t)},[]),C=o(()=>{E(a),sessionStorage.removeItem(r),c([]),m({text:"",value:""})},[]),u=o(async t=>{t?(p(),await i()):C()},[i,p,C]);return I(()=>{const t=d.on("authenticated",u,{eager:!0});return()=>{t&&typeof t=="function"&&t()}},[u]),s.length<2?null:l("div",{...h,children:l(v,{options:s,defaultOption:g,onChange:_})})};export{H as CompanySwitcher,H as default};
//# sourceMappingURL=CompanySwitcher.js.map
