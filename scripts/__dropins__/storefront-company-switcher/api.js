/*! Copyright 2025 Adobe
All Rights Reserved. */
var f=Object.defineProperty;var l=(t,e,r)=>e in t?f(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var a=(t,e,r)=>l(t,typeof e!="symbol"?e+"":e,r);import{g as C,u as S}from"./chunks/customerCompanyContext.js";import{C as F,f as O,c as x,r as N,s as P,a as T,b as w}from"./chunks/customerCompanyContext.js";import{Initializer as G}from"@dropins/tools/lib.js";import{events as p}from"@dropins/tools/event-bus.js";import"@dropins/tools/fetch-graphql.js";class K{constructor(){a(this,"companyHeaderSet",!1);a(this,"companyHeaderAppliers",[]);a(this,"companyHeaderRemovers",[]);a(this,"headerKey");this.headerKey=m.getConfig().companyHeader,this.setFetchGraphQlModules(m.getConfig().fetchGraphQlModules)}setHeaderKey(e){this.headerKey=e}setFetchGraphQlModules(e){this.companyHeaderAppliers=[],this.companyHeaderRemovers=[],e.forEach(({setFetchGraphQlHeader:r,removeFetchGraphQlHeader:s})=>{this.companyHeaderAppliers.push(r),this.companyHeaderRemovers.push(s)})}setCompanyHeaders(e){if(e===null){this.removeCompanyHeaders();return}this.companyHeaderAppliers.forEach(r=>{r(this.headerKey,e)}),this.companyHeaderSet=!0}removeCompanyHeaders(){this.companyHeaderRemovers.forEach(e=>{e(this.headerKey)}),this.companyHeaderSet=!1}isCompanyHeaderSet(){return this.companyHeaderSet}}let u=null;const n=()=>(u||(u=new K),u);class I{constructor(){a(this,"groupHeaderSet",!1);a(this,"groupHeaderAppliers",[]);a(this,"groupHeaderRemovers",[]);a(this,"headerKey");this.headerKey=m.getConfig().customerGroupHeader,this.setFetchGraphQlModules(m.getConfig().groupGraphQlModules)}setHeaderKey(e){this.headerKey=e}setFetchGraphQlModules(e){e.forEach(({setFetchGraphQlHeader:r,removeFetchGraphQlHeader:s})=>{this.groupHeaderAppliers.push(r),this.groupHeaderRemovers.push(s)})}setGroupHeaders(e){this.removeGroupHeaders(),e!==null&&(this.groupHeaderAppliers.forEach(r=>{r(this.headerKey,e)}),this.groupHeaderSet=!0)}removeGroupHeaders(){this.groupHeaderRemovers.forEach(e=>{e(this.headerKey)}),this.groupHeaderSet=!1}isGroupHeaderSet(){return this.groupHeaderSet}}let y=null;const g=()=>(y||(y=new I),y),o=new G({init:async t=>{const e={fetchGraphQlModules:[],groupGraphQlModules:[],companyHeader:"X-Adobe-Company",customerGroupHeader:"Magento-Customer-Group",companySessionStorageKey:"DROPIN__COMPANYSWITCHER__COMPANY__CONTEXT",groupSessionStorageKey:"DROPIN__COMPANYSWITCHER__GROUP__CONTEXT"};o.config.setConfig({...e,...t});const r=sessionStorage.getItem(o.config.getConfig().groupSessionStorageKey),s=sessionStorage.getItem(o.config.getConfig().companySessionStorageKey);s&&!n().isCompanyHeaderSet()&&(n().setCompanyHeaders(s),p.emit("companyContext/restored",s)),r&&!g().isGroupHeaderSet()&&g().setGroupHeaders(r),p.on("authenticated",async i=>{if(!i)sessionStorage.removeItem(o.config.getConfig().companySessionStorageKey),sessionStorage.removeItem(o.config.getConfig().groupSessionStorageKey),n().removeCompanyHeaders(),g().removeGroupHeaders();else{if(sessionStorage.getItem(o.config.getConfig().companySessionStorageKey)||n().isCompanyHeaderSet())return;const c=await C();if(c.customerCompanies.length<2)return;const h=c.currentCompany.id,H=c.customerGroupId;n().setCompanyHeaders(h),g().setGroupHeaders(H),sessionStorage.setItem(o.config.getConfig().companySessionStorageKey,h),sessionStorage.setItem(o.config.getConfig().groupSessionStorageKey,H),p.emit("companyContext/restored",h)}},{eager:!0}),p.on("companyContext/changing",async i=>{n().setCompanyHeaders(i),sessionStorage.setItem(o.config.getConfig().companySessionStorageKey,i);const d=await S();d&&(g().setGroupHeaders(d),sessionStorage.setItem(o.config.getConfig().groupSessionStorageKey,d)),p.emit("companyContext/changed",i)},{eager:!0})},listeners:()=>[]}),m=o.config;export{F as CustomerCompanyContext,m as config,O as fetchGraphQl,n as getCompanyHeaderManager,x as getConfig,C as getCustomerCompanyInfo,g as getGroupHeaderManager,o as initialize,N as removeFetchGraphQlHeader,P as setEndpoint,T as setFetchGraphQlHeader,w as setFetchGraphQlHeaders,S as updateCustomerGroup};
//# sourceMappingURL=api.js.map
