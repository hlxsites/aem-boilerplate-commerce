/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsxs as L,jsx as a,Fragment as N}from"@dropins/tools/preact-jsx-runtime.js";import*as m from"@dropins/tools/preact-compat.js";import{useState as C,useEffect as j}from"@dropins/tools/preact-compat.js";import{classes as z,VComponent as E,Slot as y}from"@dropins/tools/lib.js";import{Button as R,Icon as b,PriceRange as A,Checkbox as P,RadioButton as T}from"@dropins/tools/components.js";/* empty css                 */import{useText as $}from"@dropins/tools/i18n.js";import{events as W}from"@dropins/tools/event-bus.js";import{d as H}from"../chunks/search.js";import"../fragments.js";import"../chunks/acdlEvents.js";import"@dropins/tools/fetch-graphql.js";const Y=t=>m.createElement("svg",{id:"Icon_Add_Base","data-name":"Icon \\u2013 Add \\u2013 Base",xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",...t},m.createElement("g",{id:"Large"},m.createElement("rect",{id:"Placement_area","data-name":"Placement area",width:24,height:24,fill:"#fff",opacity:0}),m.createElement("g",{id:"Add_icon","data-name":"Add icon",transform:"translate(9.734 9.737)"},m.createElement("line",{vectorEffect:"non-scaling-stroke",id:"Line_579","data-name":"Line 579",y2:12.7,transform:"translate(2.216 -4.087)",fill:"none",stroke:"currentColor"}),m.createElement("line",{vectorEffect:"non-scaling-stroke",id:"Line_580","data-name":"Line 580",x2:12.7,transform:"translate(-4.079 2.263)",fill:"none",stroke:"currentColor"})))),G=t=>m.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},m.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M18.3599 5.64001L5.62988 18.37",stroke:"currentColor"}),m.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M18.3599 18.37L5.62988 5.64001",stroke:"currentColor"})),J=t=>m.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},m.createElement("path",{d:"M17.3332 11.75H6.6665",strokeWidth:1.5,strokeLinecap:"square",strokeLinejoin:"round",vectorEffect:"non-scaling-stroke",fill:"none",stroke:"currentColor"})),K=({numberOfOptionsConfig:t=5,header:e,buckets:i,last:o})=>{const h=$({showMore:"Search.Facet.showMore",showLess:"Search.Facet.showLess"}),g=t,[p,f]=C(i.length<g),S=p?i.length:g;return L("div",{className:z(["product-discovery-facet",["product-discovery-facet--last",o]]),children:[a(E,{className:"product-discovery-facet__header",node:e}),i.slice(0,S).map((w,v)=>a(E,{className:"product-discovery-facet__bucket",node:w},v)),!p&&i.length>g&&a(R,{variant:"tertiary",icon:a(b,{source:Y,size:"24"}),onClick:()=>f(!p),children:h.showMore}),p&&i.length>g&&a(R,{variant:"tertiary",icon:a(b,{source:J,size:"24"}),onClick:()=>f(!p),children:h.showLess})]})},Q=({selectedFacets:t,facets:e})=>L(N,{children:[a(E,{className:"product-discovery-facet-list__selected-filters",node:t}),a(E,{className:"product-discovery-facet-list__facet-options",node:e})]}),X="no",Z="yes",I=t=>{const e=t.buckets.find(i=>i.selected);return e?{attribute:t.attribute,range:{from:e.from,to:e.to}}:null},ee=t=>{const e=t.buckets.reduce((i,o)=>(o.selected&&i.push(o.title),i),[]);return e.length===0?null:{attribute:t.attribute,in:e}},te=t=>{var e;switch((e=t.buckets[0])==null?void 0:e.__typename){case"RangeBucket":return I(t);case"ScalarBucket":case"CategoryView":return ee(t)}},ne=t=>{var i,o,h,g,p,f,S,w,v,k,x;const e=t[0];return(h=(o=(i=e==null?void 0:e.price)==null?void 0:i.regular)==null?void 0:o.amount)!=null&&h.currency?e.price.regular.amount.currency:(S=(f=(p=(g=e==null?void 0:e.priceRange)==null?void 0:g.minimum)==null?void 0:p.regular)==null?void 0:f.amount)!=null&&S.currency?(x=(k=(v=(w=e==null?void 0:e.priceRange)==null?void 0:w.minimum)==null?void 0:v.regular)==null?void 0:k.amount)==null?void 0:x.currency:"USD"},re=(t,e,i)=>(e==null?void 0:e.attribute)==="price"?t.from===0?L("div",{style:"display:flex",children:[a(A,{amount:t.from,currency:i||"USD"}),a("span",{style:"padding: 0 2px",children:"-"}),a(A,{amount:t.to,currency:i||"USD"})]}):a(A,{minimumAmount:t.from,maximumAmount:t.to,currency:i||"USD",display:"dash"}):t.title,ce=(t,e)=>t.title===X?`Not ${e.title}`:t.title===Z?e.title:t.title,O=(t,e,i)=>{switch(t.__typename){case"RangeBucket":return re(t,e,i);case"ScalarBucket":case"CategoryView":return ce(t,e)}},fe=({scope:t,slots:e})=>{const i=$({clearAll:"Search.Facet.clearAll"}),[o,h]=C([]),[g,p]=C(null),[f,S]=C(),w=n=>{H(n,{scope:t})},v=n=>{if(!n||!n.result.facets&&!n.result.items&&!n.request.filter){h([]);return}S(n.request);const{facets:s,items:u}=n.result;p(ne(u));const c=n.request.filter;if(s){const r=s.map(l=>{const B=l.buckets.map(F=>{F.selected=!1;const d=c==null?void 0:c.find(_=>_.attribute===l.attribute);if(d){const _=d.range;(_&&F.from===_.from&&F.to===_.to||d.in&&d.in.includes(F.title))&&(F.selected=!0)}return F});return l.buckets=B,l});h(r)}},k=n=>{const s=o.map(c=>{const r=n.find(l=>l.attribute===c.attribute);return r||c}),u=s.reduce((c,r)=>{const l=te(r);return l&&c.push(l),c},[]);h(s),f&&w({...f,filter:u})},x=(n,s)=>{const u=n.buckets.map(r=>(r.title===s&&(r.selected=!1),r)),c=n;c.buckets=u,k([c])},V=()=>{const n=o.map(s=>{const u=s.buckets.map(c=>(c.selected=!1,c));return s.buckets=u,s});h(n),f&&w({...f,filter:[]})},M=(n,s)=>{const u=s.buckets.map(r=>{var l;return((l=s.buckets[0])==null?void 0:l.__typename)==="RangeBucket"&&(r.selected=!1),r.title===n.target.value&&(r.selected=n.target.checked),r}),c=s;c.buckets=u,k([c])},q=(n,s)=>{const u=a("span",{children:n.title}),c=n.buckets.map(r=>{var F;const l=O(r,n,g),B=d=>L(y,{name:"FacetBucketLabel",slot:e==null?void 0:e.FacetBucketLabel,context:{data:r},children:[l," ",d?`(${d})`:""]});switch((F=n.buckets[0])==null?void 0:F.__typename){case"RangeBucket":return a(y,{name:"FacetBucket",slot:e==null?void 0:e.FacetBucket,context:{data:r},children:a(T,{"data-testid":`${r.title}-radio`,label:B(),name:n.attribute,value:r.title,checked:r.selected,onChange:d=>{M(d,n)}})});case"ScalarBucket":case"CategoryView":return a(y,{name:"FacetBucket",slot:e==null?void 0:e.FacetBucket,context:{data:r},children:a(P,{"data-testid":`${r.title}-checkbox`,label:B(r.count),name:n.attribute,value:r.title,checked:r.selected,onChange:d=>{M(d,n)}})});default:return null}}).filter(r=>r!==null);return a(K,{header:u,buckets:c,last:s===o.length-1})},D=()=>a(y,{name:"Facets",slot:e==null?void 0:e.Facets,context:{data:o},children:o.map((n,s)=>n.buckets.length>0?a(N,{children:a(y,{name:"Facet",slot:e==null?void 0:e.Facet,context:{data:n},children:q(n,s)})}):null)}),U=()=>{const n=o.reduce((c,r)=>(r.buckets.filter(B=>B.selected).length>0&&c.push(r),c),[]),s=n.map(c=>c.buckets.map(r=>{if(r.selected){const l=O(r,c,g);return a(R,{"data-testid":`${r.title}-selected-btn`,"aria-label":`Remove ${c.title} filter: ${r.title}`,variant:"secondary",children:L(N,{children:[a("span",{children:l}),a(b,{source:G,size:"16"})]}),onClick:()=>{x(c,r.title)}})}return null})),u=s.length>0?a(R,{variant:"secondary",onClick:()=>{V()},children:a("span",{children:i.clearAll})}):null;return L(y,{name:"SelectedFacets",slot:e==null?void 0:e.SelectedFacets,context:{data:n},children:[s,u]})};return j(()=>{const n=W.on("search/result",v,{eager:!0,scope:t});return()=>{n==null||n.off()}},[]),a(Q,{selectedFacets:U(),facets:D()})};export{fe as Facets,fe as default};
//# sourceMappingURL=Facets.js.map
