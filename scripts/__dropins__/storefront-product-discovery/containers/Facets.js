/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsxs as L,jsx as s,Fragment as N}from"@dropins/tools/preact-jsx-runtime.js";import*as g from"@dropins/tools/preact-compat.js";import{useState as C,useEffect as z}from"@dropins/tools/preact-compat.js";import{classes as T,VComponent as E,Slot as y}from"@dropins/tools/lib.js";import{Button as R,Icon as b,PriceRange as A,Checkbox as W,RadioButton as H}from"@dropins/tools/components.js";/* empty css                 */import{useText as q}from"@dropins/tools/i18n.js";import{events as Y}from"@dropins/tools/event-bus.js";import{d as O}from"../chunks/search.js";import"../fragments.js";import"../chunks/acdlEvents.js";import"@dropins/tools/fetch-graphql.js";const G=t=>g.createElement("svg",{id:"Icon_Add_Base","data-name":"Icon \\u2013 Add \\u2013 Base",xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",...t},g.createElement("g",{id:"Large"},g.createElement("rect",{id:"Placement_area","data-name":"Placement area",width:24,height:24,fill:"#fff",opacity:0}),g.createElement("g",{id:"Add_icon","data-name":"Add icon",transform:"translate(9.734 9.737)"},g.createElement("line",{vectorEffect:"non-scaling-stroke",id:"Line_579","data-name":"Line 579",y2:12.7,transform:"translate(2.216 -4.087)",fill:"none",stroke:"currentColor"}),g.createElement("line",{vectorEffect:"non-scaling-stroke",id:"Line_580","data-name":"Line 580",x2:12.7,transform:"translate(-4.079 2.263)",fill:"none",stroke:"currentColor"})))),J=t=>g.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},g.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M18.3599 5.64001L5.62988 18.37",stroke:"currentColor"}),g.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M18.3599 18.37L5.62988 5.64001",stroke:"currentColor"})),K=t=>g.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},g.createElement("path",{d:"M17.3332 11.75H6.6665",strokeWidth:1.5,strokeLinecap:"square",strokeLinejoin:"round",vectorEffect:"non-scaling-stroke",fill:"none",stroke:"currentColor"})),Q=({numberOfOptionsConfig:t=5,header:n,buckets:r,last:p})=>{const u=q({showMore:"Search.Facet.showMore",showLess:"Search.Facet.showLess"}),d=t,[m,w]=C(r.length<d),F=m?r.length:d;return L("div",{className:T(["product-discovery-facet",["product-discovery-facet--last",p]]),children:[s(E,{className:"product-discovery-facet__header",node:n}),r.slice(0,F).map((v,S)=>s(E,{className:"product-discovery-facet__bucket",node:v},S)),!m&&r.length>d&&s(R,{variant:"tertiary",icon:s(b,{source:G,size:"24"}),onClick:()=>w(!m),children:u.showMore}),m&&r.length>d&&s(R,{variant:"tertiary",icon:s(b,{source:K,size:"24"}),onClick:()=>w(!m),children:u.showLess})]})},X=({selectedFacets:t,facets:n})=>L(N,{children:[s(E,{className:"product-discovery-facet-list__selected-filters",node:t}),s(E,{className:"product-discovery-facet-list__facet-options",node:n})]}),Z="no",I="yes",ee=t=>{const n=t.buckets.find(r=>r.selected);return n?{attribute:t.attribute,range:{from:n.from,to:n.to}}:null},te=t=>{const n=t.buckets.reduce((r,p)=>(p.selected&&r.push(p.title),r),[]);return n.length===0?null:{attribute:t.attribute,in:n}},ne=t=>{var n;switch((n=t.buckets[0])==null?void 0:n.__typename){case"RangeBucket":return ee(t);case"ScalarBucket":case"CategoryView":return te(t)}},re=t=>{var r,p,u,d,m,w,F,v,S,x,k;const n=t[0];return(u=(p=(r=n==null?void 0:n.price)==null?void 0:r.regular)==null?void 0:p.amount)!=null&&u.currency?n.price.regular.amount.currency:(F=(w=(m=(d=n==null?void 0:n.priceRange)==null?void 0:d.minimum)==null?void 0:m.regular)==null?void 0:w.amount)!=null&&F.currency?(k=(x=(S=(v=n==null?void 0:n.priceRange)==null?void 0:v.minimum)==null?void 0:S.regular)==null?void 0:x.amount)==null?void 0:k.currency:"USD"},ce=(t,n,r)=>(n==null?void 0:n.attribute)==="price"?t.from===0?L("div",{style:"display:flex",children:[s(A,{amount:t.from,currency:r||"USD"}),s("span",{style:"padding: 0 2px",children:"-"}),s(A,{amount:t.to,currency:r||"USD"})]}):s(A,{minimumAmount:t.from,maximumAmount:t.to,currency:r||"USD",display:"dash"}):t.title,ae=(t,n)=>t.title===Z?`Not ${n.title}`:t.title===I?n.title:t.title,$=(t,n,r)=>{switch(t.__typename){case"RangeBucket":return ce(t,n,r);case"ScalarBucket":case"CategoryView":return ae(t,n)}},Fe=({rootCategory:t,scope:n,slots:r})=>{const p=q({clearAll:"Search.Facet.clearAll"}),[u,d]=C([]),[m,w]=C(null),[F,v]=C(),S=e=>{t?O({...e,filter:[{attribute:"categoryPath",eq:t},...e.filter||[]]},{scope:n}):O(e,{scope:n})},x=e=>{if(!e||!e.result.facets&&!e.result.items&&!e.request.filter){d([]);return}v(e.request);const{facets:i,items:o}=e.result;w(re(o));const a=e.request.filter;if(i){const c=i.map(l=>{const B=l.buckets.map(f=>{f.selected=!1;const h=a==null?void 0:a.find(_=>_.attribute===l.attribute);if(h){const _=h.range;(_&&f.from===_.from&&f.to===_.to||h.in&&h.in.includes(f.title))&&(f.selected=!0)}return f});return l.buckets=B,l});d(c)}},k=e=>{const i=u.map(a=>{const c=e.find(l=>l.attribute===a.attribute);return c||a}),o=i.reduce((a,c)=>{const l=ne(c);return l&&a.push(l),a},[]);d(i),F&&S({...F,filter:o})},D=(e,i)=>{const o=e.buckets.map(c=>(c.title===i&&(c.selected=!1),c)),a=e;a.buckets=o,k([a])},P=()=>{const e=u.map(i=>{const o=i.buckets.map(a=>(a.selected=!1,a));return i.buckets=o,i});d(e),F&&S({...F,filter:[]})},M=(e,i)=>{const o=i.buckets.map(c=>{var l;return((l=i.buckets[0])==null?void 0:l.__typename)==="RangeBucket"&&(c.selected=!1),c.title===e.target.value&&(c.selected=e.target.checked),c}),a=i;a.buckets=o,k([a])},U=(e,i)=>{const o=s("span",{children:e.title}),a=e.buckets.map(c=>{var f;const l=$(c,e,m),B=h=>L(y,{name:"FacetBucketLabel",slot:r==null?void 0:r.FacetBucketLabel,context:{data:c},children:[l," ",h?`(${h})`:""]});switch((f=e.buckets[0])==null?void 0:f.__typename){case"RangeBucket":return s(y,{name:"FacetBucket",slot:r==null?void 0:r.FacetBucket,context:{data:c},children:s(H,{"data-testid":`${c.title}-radio`,label:B(),name:e.attribute,value:c.title,checked:c.selected,onChange:h=>{M(h,e)}})});case"ScalarBucket":case"CategoryView":return s(y,{name:"FacetBucket",slot:r==null?void 0:r.FacetBucket,context:{data:c},children:s(W,{"data-testid":`${c.title}-checkbox`,label:B(c.count),name:e.attribute,value:c.title,checked:c.selected,onChange:h=>{M(h,e)}})});default:return null}}).filter(c=>c!==null);return s(Q,{header:o,buckets:a,last:i===u.length-1})},V=()=>s(y,{name:"Facets",slot:r==null?void 0:r.Facets,context:{data:u},children:u.map((e,i)=>e.buckets.length>0?s(N,{children:s(y,{name:"Facet",slot:r==null?void 0:r.Facet,context:{data:e},children:U(e,i)})}):null)}),j=()=>{const e=u.reduce((a,c)=>(c.buckets.filter(B=>B.selected).length>0&&a.push(c),a),[]),i=e.map(a=>a.buckets.map(c=>{if(c.selected){const l=$(c,a,m);return s(R,{"data-testid":`${c.title}-selected-btn`,"aria-label":`Remove ${a.title} filter: ${c.title}`,variant:"secondary",children:L(N,{children:[s("span",{children:l}),s(b,{source:J,size:"16"})]}),onClick:()=>{D(a,c.title)}})}return null})),o=i.length>0?s(R,{variant:"secondary",onClick:()=>{P()},children:s("span",{children:p.clearAll})}):null;return L(y,{name:"SelectedFacets",slot:r==null?void 0:r.SelectedFacets,context:{data:e},children:[i,o]})};return z(()=>{const e=Y.on("search/result",x,{eager:!0,scope:n});return()=>{e==null||e.off()}},[]),s(X,{selectedFacets:j(),facets:V()})};export{Fe as Facets,Fe as default};
//# sourceMappingURL=Facets.js.map
