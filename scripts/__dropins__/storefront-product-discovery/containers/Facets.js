/*! Copyright 2026 Adobe
All Rights Reserved. */
import{jsxs as x,jsx as c,Fragment as $}from"@dropins/tools/preact-jsx-runtime.js";import*as F from"@dropins/tools/preact-compat.js";import{useState as C,useRef as G,useEffect as q}from"@dropins/tools/preact-compat.js";import{classes as J,VComponent as A,Slot as k}from"@dropins/tools/lib.js";import{Button as b,Icon as M,PriceRange as N,Checkbox as K,RadioButton as Q}from"@dropins/tools/components.js";/* empty css                 */import{useText as D}from"@dropins/tools/i18n.js";import{events as X}from"@dropins/tools/event-bus.js";import{d as I}from"../chunks/search.js";import"../chunks/initialize.js";import"../fragments.js";import"../chunks/acdlEvents.js";import"@dropins/tools/fetch-graphql.js";const ee=n=>F.createElement("svg",{id:"Icon_Add_Base","data-name":"Icon \\u2013 Add \\u2013 Base",xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",...n},F.createElement("g",{id:"Large"},F.createElement("rect",{id:"Placement_area","data-name":"Placement area",width:24,height:24,fill:"#fff",opacity:0}),F.createElement("g",{id:"Add_icon","data-name":"Add icon",transform:"translate(9.734 9.737)"},F.createElement("line",{vectorEffect:"non-scaling-stroke",id:"Line_579","data-name":"Line 579",y2:12.7,transform:"translate(2.216 -4.087)",fill:"none",stroke:"currentColor"}),F.createElement("line",{vectorEffect:"non-scaling-stroke",id:"Line_580","data-name":"Line 580",x2:12.7,transform:"translate(-4.079 2.263)",fill:"none",stroke:"currentColor"})))),te=n=>F.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...n},F.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M18.3599 5.64001L5.62988 18.37",stroke:"currentColor"}),F.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M18.3599 18.37L5.62988 5.64001",stroke:"currentColor"})),re=n=>F.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...n},F.createElement("path",{d:"M17.3332 11.75H6.6665",strokeWidth:1,strokeLinecap:"square",strokeLinejoin:"round",vectorEffect:"non-scaling-stroke",fill:"none",stroke:"currentColor"})),ne=({numberOfOptionsConfig:n=5,header:e,buckets:i,last:u})=>{const f=D({showMore:"Search.Facet.showMore",showLess:"Search.Facet.showLess"}),w=n,[v,g]=C(i.length<w),_=v?i.length:w;return x("div",{className:J(["product-discovery-facet",["product-discovery-facet--last",u]]),children:[c(A,{className:"product-discovery-facet__header",node:e}),i.slice(0,_).map((S,B)=>c(A,{className:"product-discovery-facet__bucket",node:S},B)),!v&&i.length>w&&c(b,{variant:"tertiary",icon:c(M,{source:ee,size:"24"}),onClick:()=>g(!v),children:f.showMore}),v&&i.length>w&&c(b,{variant:"tertiary",icon:c(M,{source:re,size:"24"}),onClick:()=>g(!v),children:f.showLess})]})},ce=({selectedFacets:n,facets:e})=>x($,{children:[c(A,{className:"product-discovery-facet-list__selected-filters",node:n}),c(A,{className:"product-discovery-facet-list__facet-options",node:e})]}),ae="no",ie="yes",se=n=>{const e=n.buckets.find(i=>i.selected);return e?{attribute:n.attribute,range:{from:e.from,to:e.to}}:null},le=n=>{const e=n.buckets.reduce((i,u)=>(u.selected&&i.push(u.title),i),[]);return e.length===0?null:{attribute:n.attribute,in:e}},z=n=>{var e;switch((e=n.buckets[0])==null?void 0:e.__typename){case"RangeBucket":return se(n);case"ScalarBucket":case"CategoryView":return le(n)}},oe=n=>{var i,u,f,w,v,g,_,S,B,y,E;const e=n[0];return(f=(u=(i=e==null?void 0:e.price)==null?void 0:i.regular)==null?void 0:u.amount)!=null&&f.currency?e.price.regular.amount.currency:(_=(g=(v=(w=e==null?void 0:e.priceRange)==null?void 0:w.minimum)==null?void 0:v.regular)==null?void 0:g.amount)!=null&&_.currency?(E=(y=(B=(S=e==null?void 0:e.priceRange)==null?void 0:S.minimum)==null?void 0:B.regular)==null?void 0:y.amount)==null?void 0:E.currency:"USD"},ue=(n,e,i)=>(e==null?void 0:e.attribute)==="price"?n.from===0?x("div",{style:"display:flex",children:[c(N,{amount:n.from,currency:i||"USD"}),c("span",{style:"padding: 0 2px",children:"-"}),c(N,{amount:n.to,currency:i||"USD"})]}):c(N,{minimumAmount:n.from,maximumAmount:n.to,currency:i||"USD",display:"dash"}):n.title,de=(n,e)=>n.title===ae?`Not ${e.title}`:n.title===ie?e.title:n.title,P=(n,e,i)=>{switch(n.__typename){case"RangeBucket":return ue(n,e,i);case"ScalarBucket":case"CategoryView":return de(n,e)}},_e=({scope:n,slots:e})=>{const i=D({clearAll:"Search.Facet.clearAll"}),[u,f]=C([]),[w,v]=C(null),[g,_]=C(),[S,B]=C(null),y=G(null),E=r=>{const s=new Set(u.map(t=>t.attribute)),a=[...((g==null?void 0:g.filter)||[]).filter(t=>!s.has(t.attribute)),...r.filter||[]];I({...r,filter:a},{scope:n})},U=r=>{if(!r||!r.result.facets&&!r.result.items&&!r.request.filter){f([]);return}_(r.request);const{facets:s,items:o}=r.result;v(oe(o));const a=r.request.filter;if(s){const t=s.map(l=>{const h=l.buckets.map(p=>{const d=a==null?void 0:a.find(L=>L.attribute===l.attribute);if(d){const L=d.range;if(L&&p.from===L.from&&p.to===L.to)return{...p,selected:!0};if(d.in&&d.in.includes(p.title))return{...p,selected:!0}}return{...p,selected:!1}});return{...l,buckets:h}});f(t)}},V=r=>{f(s=>{const o=s.map(t=>{const l=r.find(h=>h.attribute===t.attribute);return l||t}),a=o.reduce((t,l)=>{const h=z(l);return h&&t.push(h),t},[]);return B(a),o})},j=(r,s)=>{const o=r.buckets.map(t=>t.title===s?{...t,selected:!1}:t),a={...r,buckets:o};V([a])},W=()=>{const r=u.map(s=>{const o=s.buckets.map(a=>({...a,selected:!1}));return{...s,buckets:o}});f(r),B([])},O=(r,s)=>{const o=r.target.value,a=r.target.checked;f(t=>{const l=t.find(m=>m.attribute===s);if(!l)return t;const h=l.buckets.map(m=>{var R;return((R=l.buckets[0])==null?void 0:R.__typename)==="RangeBucket"?m.title===o?{...m,selected:a}:{...m,selected:!1}:m.title===o?{...m,selected:a}:{...m}}),p={...l,buckets:h},d=t.map(m=>m.attribute===s?p:m),L=d.reduce((m,R)=>{const T=z(R);return T&&m.push(T),m},[]);return B(L),d})},Z=(r,s)=>{const o=c("span",{children:r.title}),a=r.buckets.map(t=>{var p;const l=P(t,r,w),h=d=>x(k,{name:"FacetBucketLabel",slot:e==null?void 0:e.FacetBucketLabel,context:{data:t},children:[l," ",d?`(${d})`:""]});switch((p=r.buckets[0])==null?void 0:p.__typename){case"RangeBucket":return c(k,{name:"FacetBucket",slot:e==null?void 0:e.FacetBucket,context:{data:t},children:c(Q,{"data-testid":`${t.title}-radio`,label:h(),name:r.attribute,value:t.title,checked:t.selected,onChange:d=>{O(d,r.attribute)}})});case"ScalarBucket":case"CategoryView":return c(k,{name:"FacetBucket",slot:e==null?void 0:e.FacetBucket,context:{data:t},children:c(K,{id:`${r.attribute}-${t.title.replace(/[^a-zA-Z0-9_-]/g,"")}`,"data-testid":`${t.title}-checkbox`,label:h(t.count),name:`${r.attribute}-${t.title.replace(/[^a-zA-Z0-9_-]/g,"")}`,value:t.title,checked:t.selected,onChange:d=>{O(d,r.attribute)}})});default:return null}}).filter(t=>t!==null);return c(ne,{header:o,buckets:a,last:s===u.length-1})},H=()=>c(k,{name:"Facets",slot:e==null?void 0:e.Facets,context:{data:u},children:u.map((r,s)=>r.buckets.length>0?c($,{children:c(k,{name:"Facet",slot:e==null?void 0:e.Facet,context:{data:r},children:Z(r,s)})}):null)}),Y=()=>{const r=u.reduce((a,t)=>(t.buckets.filter(h=>h.selected).length>0&&a.push(t),a),[]),s=r.map(a=>a.buckets.map(t=>{if(t.selected){const l=P(t,a,w);return c(b,{"data-testid":`${t.title}-selected-btn`,"aria-label":`Remove ${a.title} filter: ${t.title}`,variant:"secondary",children:x($,{children:[c("span",{children:l}),c(M,{source:te,size:"16"})]}),onClick:()=>{j(a,t.title)}})}return null})),o=s.length>0?c(b,{variant:"secondary",onClick:()=>{W()},children:c("span",{children:i.clearAll})}):null;return x(k,{name:"SelectedFacets",slot:e==null?void 0:e.SelectedFacets,context:{data:r},children:[s,o]})};return q(()=>{const r=X.on("search/result",U,{eager:!0,scope:n});return()=>{r==null||r.off()}},[]),q(()=>{if(S!==null)return y.current&&clearTimeout(y.current),y.current=setTimeout(()=>{g&&E({...g,filter:S,currentPage:1}),B(null)},150),()=>{y.current&&clearTimeout(y.current)}},[S,g]),c(ce,{selectedFacets:Y(),facets:H()})};export{_e as Facets,_e as default};
//# sourceMappingURL=Facets.js.map
