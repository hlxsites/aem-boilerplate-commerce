/*! Copyright 2026 Adobe
All Rights Reserved. */
import{jsxs as b,jsx as i,Fragment as P}from"@dropins/tools/preact-jsx-runtime.js";import*as S from"@dropins/tools/preact-compat.js";import{useState as A,useRef as $,useEffect as D}from"@dropins/tools/preact-compat.js";import{classes as ee,VComponent as N,Slot as E}from"@dropins/tools/lib.js";import{Button as M,Icon as q,PriceRange as T,Checkbox as te,RadioButton as ne}from"@dropins/tools/components.js";/* empty css                 */import{useText as J}from"@dropins/tools/i18n.js";import{events as re}from"@dropins/tools/event-bus.js";import{d as ce}from"../chunks/search.js";import"../chunks/initialize.js";import"../fragments.js";import"../chunks/acdlEvents.js";import"@dropins/tools/fetch-graphql.js";const ie=r=>S.createElement("svg",{id:"Icon_Add_Base","data-name":"Icon \\u2013 Add \\u2013 Base",xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",...r},S.createElement("g",{id:"Large"},S.createElement("rect",{id:"Placement_area","data-name":"Placement area",width:24,height:24,fill:"#fff",opacity:0}),S.createElement("g",{id:"Add_icon","data-name":"Add icon",transform:"translate(9.734 9.737)"},S.createElement("line",{vectorEffect:"non-scaling-stroke",id:"Line_579","data-name":"Line 579",y2:12.7,transform:"translate(2.216 -4.087)",fill:"none",stroke:"currentColor"}),S.createElement("line",{vectorEffect:"non-scaling-stroke",id:"Line_580","data-name":"Line 580",x2:12.7,transform:"translate(-4.079 2.263)",fill:"none",stroke:"currentColor"})))),ae=r=>S.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...r},S.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M18.3599 5.64001L5.62988 18.37",stroke:"currentColor"}),S.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M18.3599 18.37L5.62988 5.64001",stroke:"currentColor"})),se=r=>S.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...r},S.createElement("path",{d:"M17.3332 11.75H6.6665",strokeWidth:1,strokeLinecap:"square",strokeLinejoin:"round",vectorEffect:"non-scaling-stroke",fill:"none",stroke:"currentColor"})),le=({numberOfOptionsConfig:r=5,header:e,buckets:u,last:h})=>{const p=J({showMore:"Search.Facet.showMore",showLess:"Search.Facet.showLess"}),y=r,[k,B]=A(u.length<y),R=k?u.length:y;return b("div",{className:ee(["product-discovery-facet",["product-discovery-facet--last",h]]),children:[i(N,{className:"product-discovery-facet__header",node:e}),u.slice(0,R).map((_,C)=>i(N,{className:"product-discovery-facet__bucket",node:_},C)),!k&&u.length>y&&i(M,{variant:"tertiary",icon:i(q,{source:ie,size:"24"}),onClick:()=>B(!k),children:p.showMore}),k&&u.length>y&&i(M,{variant:"tertiary",icon:i(q,{source:se,size:"24"}),onClick:()=>B(!k),children:p.showLess})]})},oe=({selectedFacets:r,facets:e})=>b(P,{children:[i(N,{className:"product-discovery-facet-list__selected-filters",node:r}),i(N,{className:"product-discovery-facet-list__facet-options",node:e})]}),ue="no",de="yes",me=r=>{const e=r.buckets.find(u=>u.selected);return e?{attribute:r.attribute,range:{from:e.from,to:e.to}}:null},he=r=>{const e=r.buckets.reduce((u,h)=>(h.selected&&u.push(h.title),u),[]);return e.length===0?null:{attribute:r.attribute,in:e}},U=r=>{var e;switch((e=r.buckets[0])==null?void 0:e.__typename){case"RangeBucket":return me(r);case"ScalarBucket":case"CategoryView":return he(r)}},ge=r=>{var u,h,p,y,k,B,R,_,C,L,x;const e=r[0];return(p=(h=(u=e==null?void 0:e.price)==null?void 0:u.regular)==null?void 0:h.amount)!=null&&p.currency?e.price.regular.amount.currency:(R=(B=(k=(y=e==null?void 0:e.priceRange)==null?void 0:y.minimum)==null?void 0:k.regular)==null?void 0:B.amount)!=null&&R.currency?(x=(L=(C=(_=e==null?void 0:e.priceRange)==null?void 0:_.minimum)==null?void 0:C.regular)==null?void 0:L.amount)==null?void 0:x.currency:"USD"},fe=(r,e,u)=>(e==null?void 0:e.attribute)==="price"?r.from===0?b("div",{style:"display:flex",children:[i(T,{amount:r.from,currency:u||"USD"}),i("span",{style:"padding: 0 2px",children:"-"}),i(T,{amount:r.to,currency:u||"USD"})]}):i(T,{minimumAmount:r.from,maximumAmount:r.to,currency:u||"USD",display:"dash"}):r.title,pe=(r,e)=>r.title===ue?`Not ${e.title}`:r.title===de?e.title:r.name||r.title,j=(r,e,u)=>{switch(r.__typename){case"RangeBucket":return fe(r,e,u);case"ScalarBucket":case"CategoryView":return pe(r,e)}},Ee=({scope:r,slots:e})=>{const u=J({clearAll:"Search.Facet.clearAll"}),[h,p]=A([]),[y,k]=A(null),[B,R]=A(),[_,C]=A(null),L=$(null),x=$(null),O=$(new Map),W=n=>{var c;const m=[...((c=B==null?void 0:B.filter)==null?void 0:c.filter(t=>t.attribute==="categoryPath"))||[],...n.filter||[]];x.current=m,ce({...n,filter:m},{scope:r,replaceFilters:!0})},Z=n=>{if(!n||!n.result.facets&&!n.result.items&&!n.request.filter){p([]);return}if(_!==null&&x.current!==null){if(!(JSON.stringify(n.request.filter)===JSON.stringify(x.current)))return;C(null),x.current=null}R(n.request);const{facets:d,items:m}=n.result;k(ge(m));const c=n.request.filter;if(d){const t=d.map(a=>{const s=h.find(l=>l.attribute===a.attribute),v=a.buckets.map(l=>{l.name&&l.title&&O.current.set(l.title,l.name);const o=s==null?void 0:s.buckets.find(w=>w.title===l.title),f=l.name?l:{...l,name:(o==null?void 0:o.name)||O.current.get(l.title)},F=c==null?void 0:c.find(w=>w.attribute===a.attribute);if(F){const w=F.range;if(w&&f.from===w.from&&f.to===w.to)return{...f,selected:!0};if(F.in&&F.in.includes(f.title))return{...f,selected:!0}}return{...f,selected:!1}});let g=v;if(a.attribute==="categories"){const l=c==null?void 0:c.find(o=>o.attribute==="categories");if(l!=null&&l.in&&l.in.length>0){const o=new Set(v.map(F=>F.title)),f=l.in.filter(F=>!o.has(F));f.length>0&&(g=[...f.map(w=>{const V=s==null?void 0:s.buckets.find(I=>I.title===w);return V?{...V,selected:!0,count:0}:{title:w,__typename:"CategoryView",name:O.current.get(w),count:0,path:w,selected:!0}}),...v])}}return{...a,buckets:g}});p(t)}else{const t=c==null?void 0:c.find(a=>a.attribute==="categories");if(t!=null&&t.in&&t.in.length>0&&h.length>0){const a=h.map(s=>{if(s.attribute==="categories"){const v=s.buckets.map(g=>{var l;return{...g,selected:((l=t.in)==null?void 0:l.includes(g.title))||!1}});return{...s,buckets:v}}return s});p(a)}}},H=n=>{p(d=>{const m=d.map(t=>{const a=n.find(s=>s.attribute===t.attribute);return a||t}),c=m.reduce((t,a)=>{const s=U(a);return s&&t.push(s),t},[]);return C(c),m})},Y=(n,d)=>{const m=n.buckets.map(t=>t.title===d?{...t,selected:!1}:t),c={...n,buckets:m};H([c])},G=()=>{const n=h.map(d=>{const m=d.buckets.map(c=>({...c,selected:!1}));return{...d,buckets:m}});p(n),C([])},z=(n,d)=>{const m=n.target.value,c=n.target.checked;p(t=>{const a=t.find(o=>o.attribute===d);if(!a)return t;const s=a.buckets.map(o=>{var f;return((f=a.buckets[0])==null?void 0:f.__typename)==="RangeBucket"?o.title===m?{...o,selected:c}:{...o,selected:!1}:o.title===m?{...o,selected:c}:{...o}}),v={...a,buckets:s},g=t.map(o=>o.attribute===d?v:o),l=g.reduce((o,f)=>{const F=U(f);return F&&o.push(F),o},[]);return C(l),g})},K=(n,d)=>{const m=i("span",{children:n.title}),c=n.buckets.map(t=>{var v;const a=j(t,n,y),s=g=>b(E,{name:"FacetBucketLabel",slot:e==null?void 0:e.FacetBucketLabel,context:{data:t},children:[a," ",g?`(${g})`:""]});switch((v=n.buckets[0])==null?void 0:v.__typename){case"RangeBucket":return i(E,{name:"FacetBucket",slot:e==null?void 0:e.FacetBucket,context:{data:t},children:i(ne,{"data-testid":`${t.title}-radio`,label:s(),name:n.attribute,value:t.title,checked:t.selected,onChange:g=>{z(g,n.attribute)}})});case"ScalarBucket":case"CategoryView":return i(E,{name:"FacetBucket",slot:e==null?void 0:e.FacetBucket,context:{data:t},children:i(te,{id:`${n.attribute}-${t.title.replace(/[^a-zA-Z0-9_-]/g,"")}`,"data-testid":`${t.title}-checkbox`,label:s(t.selected?void 0:t.count),name:`${n.attribute}-${t.title.replace(/[^a-zA-Z0-9_-]/g,"")}`,value:t.title,checked:t.selected,onChange:g=>{z(g,n.attribute)}})});default:return null}}).filter(t=>t!==null);return i(le,{header:m,buckets:c,last:d===h.length-1})},Q=()=>i(E,{name:"Facets",slot:e==null?void 0:e.Facets,context:{data:h},children:h.map((n,d)=>n.buckets.length>0?i(P,{children:i(E,{name:"Facet",slot:e==null?void 0:e.Facet,context:{data:n},children:K(n,d)})}):null)}),X=()=>{const n=h.reduce((c,t)=>(t.buckets.filter(s=>s.selected).length>0&&c.push(t),c),[]),d=n.map(c=>c.buckets.map(t=>{if(t.selected){const a=j(t,c,y);return i(M,{"data-testid":`${t.title}-selected-btn`,"aria-label":`Remove ${c.title} filter: ${a}`,variant:"secondary",children:b(P,{children:[i("span",{children:a}),i(q,{source:ae,size:"16"})]}),onClick:()=>{Y(c,t.title)}})}return null})),m=d.length>0?i(M,{variant:"secondary",onClick:()=>{G()},children:i("span",{children:u.clearAll})}):null;return b(E,{name:"SelectedFacets",slot:e==null?void 0:e.SelectedFacets,context:{data:n},children:[d,m]})};return D(()=>{const n=re.on("search/result",Z,{eager:!0,scope:r});return()=>{n==null||n.off()}},[r]),D(()=>{if(_!==null)return L.current&&clearTimeout(L.current),L.current=setTimeout(()=>{B&&W({...B,filter:_})},150),()=>{L.current&&clearTimeout(L.current)}},[_]),i(oe,{selectedFacets:X(),facets:Q()})};export{Ee as Facets,Ee as default};
//# sourceMappingURL=Facets.js.map
