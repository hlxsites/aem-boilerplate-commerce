/*! Copyright 2026 Adobe
All Rights Reserved. */
import{jsxs as _,jsx as i,Fragment as A}from"@dropins/tools/preact-jsx-runtime.js";import*as h from"@dropins/tools/preact-compat.js";import{useState as C,useEffect as D}from"@dropins/tools/preact-compat.js";import{classes as T,VComponent as E,Slot as L}from"@dropins/tools/lib.js";import{Button as $,Icon as N,PriceRange as R,Checkbox as V,RadioButton as W}from"@dropins/tools/components.js";/* empty css                 */import{useText as O}from"@dropins/tools/i18n.js";import{events as Z}from"@dropins/tools/event-bus.js";import{d as H}from"../chunks/search.js";import"../chunks/initialize.js";import"../fragments.js";import"../chunks/acdlEvents.js";import"@dropins/tools/fetch-graphql.js";const Y=n=>h.createElement("svg",{id:"Icon_Add_Base","data-name":"Icon \\u2013 Add \\u2013 Base",xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",...n},h.createElement("g",{id:"Large"},h.createElement("rect",{id:"Placement_area","data-name":"Placement area",width:24,height:24,fill:"#fff",opacity:0}),h.createElement("g",{id:"Add_icon","data-name":"Add icon",transform:"translate(9.734 9.737)"},h.createElement("line",{vectorEffect:"non-scaling-stroke",id:"Line_579","data-name":"Line 579",y2:12.7,transform:"translate(2.216 -4.087)",fill:"none",stroke:"currentColor"}),h.createElement("line",{vectorEffect:"non-scaling-stroke",id:"Line_580","data-name":"Line 580",x2:12.7,transform:"translate(-4.079 2.263)",fill:"none",stroke:"currentColor"})))),G=n=>h.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...n},h.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M18.3599 5.64001L5.62988 18.37",stroke:"currentColor"}),h.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M18.3599 18.37L5.62988 5.64001",stroke:"currentColor"})),J=n=>h.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...n},h.createElement("path",{d:"M17.3332 11.75H6.6665",strokeWidth:1.5,strokeLinecap:"square",strokeLinejoin:"round",vectorEffect:"non-scaling-stroke",fill:"none",stroke:"currentColor"})),K=({numberOfOptionsConfig:n=5,header:e,buckets:s,last:u})=>{const f=O({showMore:"Search.Facet.showMore",showLess:"Search.Facet.showLess"}),g=n,[p,d]=C(s.length<g),S=p?s.length:g;return _("div",{className:T(["product-discovery-facet",["product-discovery-facet--last",u]]),children:[i(E,{className:"product-discovery-facet__header",node:e}),s.slice(0,S).map((F,B)=>i(E,{className:"product-discovery-facet__bucket",node:F},B)),!p&&s.length>g&&i($,{variant:"tertiary",icon:i(N,{source:Y,size:"24"}),onClick:()=>d(!p),children:f.showMore}),p&&s.length>g&&i($,{variant:"tertiary",icon:i(N,{source:J,size:"24"}),onClick:()=>d(!p),children:f.showLess})]})},Q=({selectedFacets:n,facets:e})=>_(A,{children:[i(E,{className:"product-discovery-facet-list__selected-filters",node:n}),i(E,{className:"product-discovery-facet-list__facet-options",node:e})]}),X="no",I="yes",ee=n=>{const e=n.buckets.find(s=>s.selected);return e?{attribute:n.attribute,range:{from:e.from,to:e.to}}:null},te=n=>{const e=n.buckets.reduce((s,u)=>(u.selected&&s.push(u.title),s),[]);return e.length===0?null:{attribute:n.attribute,in:e}},re=n=>{var e;switch((e=n.buckets[0])==null?void 0:e.__typename){case"RangeBucket":return ee(n);case"ScalarBucket":case"CategoryView":return te(n)}},ne=n=>{var s,u,f,g,p,d,S,F,B,x,v;const e=n[0];return(f=(u=(s=e==null?void 0:e.price)==null?void 0:s.regular)==null?void 0:u.amount)!=null&&f.currency?e.price.regular.amount.currency:(S=(d=(p=(g=e==null?void 0:e.priceRange)==null?void 0:g.minimum)==null?void 0:p.regular)==null?void 0:d.amount)!=null&&S.currency?(v=(x=(B=(F=e==null?void 0:e.priceRange)==null?void 0:F.minimum)==null?void 0:B.regular)==null?void 0:x.amount)==null?void 0:v.currency:"USD"},ae=(n,e,s)=>(e==null?void 0:e.attribute)==="price"?n.from===0?_("div",{style:"display:flex",children:[i(R,{amount:n.from,currency:s||"USD"}),i("span",{style:"padding: 0 2px",children:"-"}),i(R,{amount:n.to,currency:s||"USD"})]}):i(R,{minimumAmount:n.from,maximumAmount:n.to,currency:s||"USD",display:"dash"}):n.title,ce=(n,e)=>n.title===X?`Not ${e.title}`:n.title===I?e.title:n.title,M=(n,e,s)=>{switch(n.__typename){case"RangeBucket":return ae(n,e,s);case"ScalarBucket":case"CategoryView":return ce(n,e)}},Fe=({scope:n,slots:e})=>{const s=O({clearAll:"Search.Facet.clearAll"}),[u,f]=C([]),[g,p]=C(null),[d,S]=C(),F=t=>{var l;const c=((l=d==null?void 0:d.filter)==null?void 0:l.filter(a=>a.attribute==="categoryPath"))||[];H({...t,filter:[...c,...t.filter||[]]},{scope:n})},B=t=>{const c=new URLSearchParams(window.location.search);if(!t.length)c.delete("filter");else{const l=t.map(a=>{var r;return a.range?`${a.attribute}:${a.range.from}-${a.range.to}`:(r=a.in)!=null&&r.length?`${a.attribute}:${a.in.join(",")}`:null}).filter(Boolean).join(";");c.set("filter",l)}c.set("page","1"),window.history.replaceState({},"",`${window.location.pathname}?${c.toString()}`)},x=t=>{if(!t||!t.result.facets&&!t.result.items&&!t.request.filter){f([]);return}S(t.request);const{facets:c,items:l}=t.result;p(ne(l));const a=t.request.filter;if(c){const r=c.map(o=>{const y=o.buckets.map(w=>{const m=a==null?void 0:a.find(k=>k.attribute===o.attribute);if(m){const k=m.range;if(k&&w.from===k.from&&w.to===k.to)return{...w,selected:!0};if(m.in&&m.in.includes(w.title))return{...w,selected:!0}}return{...w,selected:!1}});return{...o,buckets:y}});f(r)}},v=t=>{const c=u.map(a=>{const r=t.find(o=>o.attribute===a.attribute);return r||a}),l=c.reduce((a,r)=>{const o=re(r);return o&&a.push(o),a},[]);f(c),d&&(B(l),F({...d,filter:l}))},P=(t,c)=>{const l=t.buckets.map(r=>r.title===c?{...r,selected:!1}:r),a={...t,buckets:l};v([a])},U=()=>{const t=u.map(c=>{const l=c.buckets.map(a=>({...a,selected:!1}));return{...c,buckets:l}});v(t),d&&F({...d,filter:[]})},b=(t,c)=>{const l=c.buckets.map(r=>{var o;return((o=c.buckets[0])==null?void 0:o.__typename)==="RangeBucket"?r.title===t.target.value?{...r,selected:t.target.checked}:{...r,selected:!1}:r.title===t.target.value?{...r,selected:t.target.checked}:r}),a={...c,buckets:l};v([a])},j=(t,c)=>{const l=i("span",{children:t.title}),a=t.buckets.map(r=>{var w;const o=M(r,t,g),y=m=>_(L,{name:"FacetBucketLabel",slot:e==null?void 0:e.FacetBucketLabel,context:{data:r},children:[o," ",m?`(${m})`:""]});switch((w=t.buckets[0])==null?void 0:w.__typename){case"RangeBucket":return i(L,{name:"FacetBucket",slot:e==null?void 0:e.FacetBucket,context:{data:r},children:i(W,{"data-testid":`${r.title}-radio`,label:y(),name:t.attribute,value:r.title,checked:r.selected,onChange:m=>{b(m,t)}})});case"ScalarBucket":case"CategoryView":return i(L,{name:"FacetBucket",slot:e==null?void 0:e.FacetBucket,context:{data:r},children:i(V,{id:`${t.attribute}-${r.title.replace(/[^a-zA-Z0-9_-]/g,"")}`,"data-testid":`${r.title}-checkbox`,label:y(r.count),name:`${t.attribute}-${r.title.replace(/[^a-zA-Z0-9_-]/g,"")}`,value:r.title,checked:r.selected,onChange:m=>{b(m,t)}})});default:return null}}).filter(r=>r!==null);return i(K,{header:l,buckets:a,last:c===u.length-1})},q=()=>i(L,{name:"Facets",slot:e==null?void 0:e.Facets,context:{data:u},children:u.map((t,c)=>t.buckets.length>0?i(A,{children:i(L,{name:"Facet",slot:e==null?void 0:e.Facet,context:{data:t},children:j(t,c)})}):null)}),z=()=>{const t=u.reduce((a,r)=>(r.buckets.filter(y=>y.selected).length>0&&a.push(r),a),[]),c=t.map(a=>a.buckets.map(r=>{if(r.selected){const o=M(r,a,g);return i($,{"data-testid":`${r.title}-selected-btn`,"aria-label":`Remove ${a.title} filter: ${r.title}`,variant:"secondary",children:_(A,{children:[i("span",{children:o}),i(N,{source:G,size:"16"})]}),onClick:()=>{P(a,r.title)}})}return null})),l=c.length>0?i($,{variant:"secondary",onClick:()=>{U()},children:i("span",{children:s.clearAll})}):null;return _(L,{name:"SelectedFacets",slot:e==null?void 0:e.SelectedFacets,context:{data:t},children:[c,l]})};return D(()=>{const t=Z.on("search/result",x,{eager:!0,scope:n});return()=>{t==null||t.off()}},[]),i(Q,{selectedFacets:z(),facets:q()})};export{Fe as Facets,Fe as default};
//# sourceMappingURL=Facets.js.map
