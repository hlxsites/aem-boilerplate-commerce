/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as d}from"@dropins/tools/preact-jsx-runtime.js";import{useState as h,useEffect as z,useCallback as j}from"@dropins/tools/preact-compat.js";import{Slot as C}from"@dropins/tools/lib.js";import{events as S}from"@dropins/tools/event-bus.js";import"@dropins/tools/components.js";/* empty css             */import{S as A}from"../chunks/Swatches.js";import"@dropins/tools/preact.js";import{c as v,o as G,k as O,j as b,h as H,l as y,p as J}from"../chunks/isProductConfigurationValid.js";import{g as K}from"../chunks/getFetchedProductData.js";import"@dropins/tools/i18n.js";import"../fragments.js";import"@dropins/tools/fetch-graphql.js";const Q=({initialData:r={data:null,optionsUIDs:[]},scope:i,hideSelectedValue:p=!1,slots:n,onValues:u,onErrors:l,children:V,...B})=>{var I;const[t,T]=h(r.data),[m,F]=h(r.optionsUIDs),[M,L]=h();z(()=>{const a=S.on("pdp/data",T,{scope:i}),c=S.on("pdp/values",({optionsUIDs:s})=>{s&&F(s)},{scope:i});return()=>{a==null||a.off(),c==null||c.off()}},[]);const N=j(async a=>{var P,U,w,D;if(!(t!=null&&t.sku))return;const{persistURLParams:c,anchors:s,acdl:q}=v.getConfig()??{};let o=Object.keys(a).map(e=>a[e].value).filter(e=>e!==void 0);if(c&&!(t!=null&&t.isBundle)&&G({optionsUIDs:o.join(",")}),((U=(P=O({scope:i}))==null?void 0:P.optionsUIDs)==null?void 0:U.join("|"))!==(o==null?void 0:o.join("|"))){b(f=>({...f,optionsUIDs:o}),{scope:i}),u==null||u(o);const e=await H(t.sku,{optionsUIDs:o??[],isBundle:t==null?void 0:t.isBundle,anchors:s});S.emit("pdp/data",e,{scope:i});let k=(o==null?void 0:o.length)===((w=e==null?void 0:e.options)==null?void 0:w.length);if(s!=null&&s.length){const f=(e==null?void 0:e.optionUIDs)??[];o.every(g=>f.includes(g))||(L(e==null?void 0:e.options),b(g=>({...g,optionsUIDs:f}),{scope:i}),k=(f==null?void 0:f.length)===((D=e==null?void 0:e.options)==null?void 0:D.length))}y(()=>k,{scope:i}),q&&e&&(e==null?void 0:e.variantSku)!==t.sku&&J(e)}},[t==null?void 0:t.isBundle,t==null?void 0:t.sku,u,i]),R=j(a=>{Object.keys(a).length!==0&&(y(()=>!1,{scope:i}),l==null||l(a))},[l,i]);return!t||!t.options?null:d(C,{name:"Swatches",slot:n==null?void 0:n.Swatches,context:{data:t,optionsUIDs:m},children:d(A,{...B,options:t.options,selectedUIDs:m,defaultOptions:m,selectionsToUpdate:M,hideSelectedValue:p,disablePreselections:!((I=v.getConfig())!=null&&I.preselectFirstOption),onValues:N,onErrors:R,imageSwatchNode:n!=null&&n.SwatchImage?({imageSwatchContext:a,...c})=>d(C,{name:"SwatchImage",slot:n==null?void 0:n.SwatchImage,slotTag:"span",contentTag:"span",context:{data:t,optionsUIDs:m,defaultImageProps:c,imageSwatchContext:a}}):void 0})})};Q.getInitialData=async function(r){var n;const i=await K({scope:r==null?void 0:r.scope}),p=((n=O({scope:r==null?void 0:r.scope}))==null?void 0:n.optionsUIDs)??[];return{data:i,optionsUIDs:p}};export{Q as ProductOptions,Q as default};
//# sourceMappingURL=ProductOptions.js.map
