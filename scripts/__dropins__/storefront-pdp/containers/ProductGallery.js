/*! Copyright 2026 Adobe
All Rights Reserved. */
import{jsx as d,jsxs as x}from"@dropins/tools/preact-jsx-runtime.js";import{useState as D,useEffect as G,useMemo as C}from"@dropins/tools/preact-compat.js";import{Slot as M}from"@dropins/tools/lib.js";import{Image as N}from"@dropins/tools/components.js";import{events as W}from"@dropins/tools/event-bus.js";import{g as H}from"../chunks/getFetchedProductData.js";import{Z as Q,C as s,O as Y}from"../chunks/Zoom.js";/* empty css                  */import"@dropins/tools/preact-hooks.js";/* empty css                       *//* empty css                           */import{useText as q}from"@dropins/tools/i18n.js";import"@dropins/tools/preact.js";const k=[".mp4",".webm",".ogg",".mov",".avi",".mkv"],L={".mp4":"video/mp4",".webm":"video/webm",".ogg":"video/ogg",".mov":"video/quicktime",".avi":"video/x-msvideo",".mkv":"video/x-matroska"};function X(l){if(!l)return"video/mp4";const p=l.toLowerCase(),i=k.find(v=>p.endsWith(v));return i?L[i]:"video/mp4"}function J(l){if(!l)return!1;const p=l.toLowerCase();return k.some(i=>p.endsWith(i))}function O(l,p){if(p)return p;if(l!=null&&l.includes("adobeaemcloud.com")&&l.endsWith("/play"))return l.replace(/\/play$/,"/as/thumbnail.png")}function K(l){if(!l)return"";const p=l.match(/(?:youtube\.com\/(?:watch\?v=|embed\/)|youtu\.be\/)([a-zA-Z0-9_-]+)/);if(p)return`https://www.youtube.com/embed/${p[1]}?rel=0`;const i=l.match(/vimeo\.com\/(?:video\/)?(\d+)/);return i?`https://player.vimeo.com/video/${i[1]}`:l}const U=({initialData:l=null,scope:p,controls:i="dots",loop:v=!0,peak:V=!1,gap:Z=null,arrows:j=!0,arrowsOnMainImage:R=!1,zoom:g=!1,videos:_=!1,imageParams:o,thumbnailParams:t,children:b,slots:n,...$})=>{const h=q("PDP.Product.Image.label").label,[r,z]=D(l),[T,E]=D(null);G(()=>{const e=W.on("pdp/data",z,{scope:p});return()=>{e==null||e.off()}},[p]);const I=C(()=>({data:r}),[r]),c=C(()=>{var f,y;const e=((f=r==null?void 0:r.images)==null?void 0:f.map(u=>({type:"image",url:u.url,label:u.label})))??[];if(!_)return e;const A=((y=r==null?void 0:r.videos)==null?void 0:y.map(u=>({type:"video",url:u.url,label:u.title??"",preview:u.preview})))??[];return(typeof _=="object"?_.position:"last")==="first"?[...A,...e]:[...e,...A]},[r==null?void 0:r.images,r==null?void 0:r.videos,_]),S=C(()=>c.length>0?c.map((e,A)=>{const w=({...f})=>{var B;const y={title:e.label,src:e.url,alt:h==null?void 0:h.replace("{product}",e.label).replace("{key}",String(A+1)).replace("{total}",String(c.length)),width:(o==null?void 0:o.width)??960,height:(o==null?void 0:o.height)??1191,params:o??{width:960},loading:A===0?"eager":"lazy",...f},u=e.type==="video"?O(e.url,(B=e.preview)==null?void 0:B.url):void 0;return d(M,{name:"CarouselMainImage",slot:n==null?void 0:n.CarouselMainImage,context:{...I,defaultImageProps:y,mediaType:e.type,previewUrl:u},children:e.type==="video"?J(e.url)?x("video",{className:"pdp-product-gallery__video",controls:!0,preload:"metadata",poster:u,width:(o==null?void 0:o.width)??960,height:(o==null?void 0:o.height)??1191,children:[d("source",{src:e.url,type:X(e.url)}),"Your browser does not support the video tag."]}):d("iframe",{className:"pdp-product-gallery__video-iframe",src:K(e.url),title:e.label||"Product video",width:(o==null?void 0:o.width)??960,height:(o==null?void 0:o.height)??1191,loading:"lazy",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0}):d(N,{...y})})};return g&&e.type==="image"?d(Q,{closeButton:typeof g=="object"?g.closeButton:!1,children:d(w,{})},e.url):d(w,{onClick:()=>E(A)},e.url)}):d("img",{src:"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",className:"pdp-product-gallery__images__placeholder",width:(o==null?void 0:o.width)??960,height:(o==null?void 0:o.height)??1191,"aria-hidden":!0},"pleaceholder"),[h,c,o,g,I,n==null?void 0:n.CarouselMainImage]),F=C(()=>c.length>0?c.map((e,A)=>{var y;const w={title:e.label,src:e.url,alt:h==null?void 0:h.replace("{product}",e.label).replace("{key}",String(A+1)).replace("{total}",String(c.length)),width:(t==null?void 0:t.width)??200,height:(t==null?void 0:t.height)??248,params:t??{width:200},loading:"lazy"},f=e.type==="video"?O(e.url,(y=e.preview)==null?void 0:y.url):void 0;return d(M,{name:"CarouselThumbnail",slotTag:"span",contentTag:"span",slot:n==null?void 0:n.CarouselThumbnail,context:{...I,defaultImageProps:w,mediaType:e.type,previewUrl:f},children:e.type==="video"?x("span",{className:"pdp-product-gallery__video-thumbnail",role:"img","aria-label":`Play video: ${e.label||"Product video"}`,children:[f?d("img",{src:f,alt:"",width:(t==null?void 0:t.width)??200,height:(t==null?void 0:t.height)??248,loading:"lazy","aria-hidden":"true"}):d("span",{className:"pdp-product-gallery__video-thumbnail-placeholder",style:{width:(t==null?void 0:t.width)??200,height:(t==null?void 0:t.height)??248},"aria-hidden":"true"}),d("span",{className:"pdp-product-gallery__video-icon","aria-hidden":"true",children:"â–¶"})]}):d(N,{...w})},e.url)}):d("img",{src:"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",className:"pdp-product-gallery__thumbnail__placeholder",width:(t==null?void 0:t.width)??200,height:(t==null?void 0:t.height)??248,"aria-hidden":!0},"pleaceholder"),[h,c,t,I,n==null?void 0:n.CarouselThumbnail]);return r?x("div",{...$,children:[d(s,{arrows:!!c.length&&j,arrowsOnMainImage:R,controls:c.length?i:void 0,loop:v&&!!c.length,peak:!!c.length&&V,gap:Z,defaultIndex:T||0,thumbnails:F,children:S}),T===null?null:d(Y,{onClose:()=>E(null),centered:!0,children:d(s,{arrows:!!c.length,width:"100%",height:"100%",defaultIndex:T,loop:v&&!!c.length,controls:"dots",isZoomed:!0,children:S})})]}):null};U.getInitialData=H;export{U as ProductGallery,U as default};
//# sourceMappingURL=ProductGallery.js.map
