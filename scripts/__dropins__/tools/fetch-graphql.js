/*! Copyright 2025 Adobe
All Rights Reserved. */
var m=Object.defineProperty;var b=(r,t,e)=>t in r?m(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var s=(r,t,e)=>b(r,typeof t!="symbol"?t+"":t,e);const F={"Content-Type":"application/json",Accept:"application/json"};class f{constructor(){s(this,"_endpoint");s(this,"_fetchGraphQlHeaders",{});s(this,"_beforeHooks",[]);s(this,"_afterHooks",[])}get endpoint(){return this._endpoint}get fetchGraphQlHeaders(){return this._fetchGraphQlHeaders}setEndpoint(t){this._endpoint=t}setFetchGraphQlHeader(t,e){this._fetchGraphQlHeaders={...this._fetchGraphQlHeaders,[t]:e}}removeFetchGraphQlHeader(t){delete this._fetchGraphQlHeaders[t]}getFetchGraphQlHeader(t){return this._fetchGraphQlHeaders[t]}setFetchGraphQlHeaders(t){typeof t=="function"?this._fetchGraphQlHeaders={...this._fetchGraphQlHeaders,...t(this._fetchGraphQlHeaders)}:this._fetchGraphQlHeaders={...t}}addBeforeHook(t){this._beforeHooks.push(t)}addAfterHook(t){this._afterHooks.push(t)}_collectBeforeHooks(){return this._beforeHooks}_collectAfterHooks(){return this._afterHooks}async fetchGraphQl(t,e){const h=this.endpoint,p=this.fetchGraphQlHeaders;if(!h)throw Error('Missing "url"');const i=(e==null?void 0:e.method)??"POST",_=e==null?void 0:e.cache,G=e==null?void 0:e.signal;let l;const o=new URL(h),Q={...F,...p};i==="POST"&&(l=JSON.stringify({query:t,variables:e==null?void 0:e.variables})),i==="GET"&&(o.searchParams.append("query",v(t)),e!=null&&e.variables&&o.searchParams.append("variables",JSON.stringify(e.variables)));let a={method:i,headers:Q,body:l,cache:_,signal:G};a=await this._collectBeforeHooks().reduce(async(c,d)=>d(await c),Promise.resolve(a));const u=this._collectAfterHooks();return await fetch(o,a).then(c=>c.json().then(d=>u.reduce(async(k,g)=>g(a,await k),Promise.resolve(d))))}getConfig(){return{endpoint:this.endpoint,fetchGraphQlHeaders:this.fetchGraphQlHeaders}}getMethods(){return{setEndpoint:this.setEndpoint.bind(this),setFetchGraphQlHeader:this.setFetchGraphQlHeader.bind(this),getFetchGraphQlHeader:this.getFetchGraphQlHeader.bind(this),removeFetchGraphQlHeader:this.removeFetchGraphQlHeader.bind(this),setFetchGraphQlHeaders:this.setFetchGraphQlHeaders.bind(this),fetchGraphQl:this.fetchGraphQl.bind(this),getConfig:this.getConfig.bind(this),addBeforeHook:this.addBeforeHook.bind(this),addAfterHook:this.addAfterHook.bind(this)}}}const n=new f;class H extends f{constructor(){super(...arguments);s(this,"_mode","default");s(this,"_source")}get endpoint(){var e;switch(this._mode){case"standalone":return this._source;case"inheriting":return(e=this._source)==null?void 0:e.endpoint;case"default":return n.endpoint}}get fetchGraphQlHeaders(){var h;const e=this._fetchGraphQlHeaders;switch(this._mode){case"standalone":return e;case"inheriting":return{...(h=this._source)==null?void 0:h.fetchGraphQlHeaders,...e};case"default":return{...n.fetchGraphQlHeaders,...e}}}setEndpoint(e){e instanceof H?(this._mode="inheriting",this._source=e):(this._mode="standalone",this._source=e)}_collectBeforeHooks(){return this._mode==="inheriting"?[...this._source._collectBeforeHooks(),...this._beforeHooks]:this._beforeHooks}_collectAfterHooks(){if(this._mode==="inheriting"){const e=this._source._collectAfterHooks();return[...this._afterHooks,...e]}return this._afterHooks}}function v(r){return r=r.replace(/#.*/g,""),r=r.replace(/\s+/g," "),r.trim()}const{setEndpoint:B,setFetchGraphQlHeaders:E,setFetchGraphQlHeader:P,getFetchGraphQlHeader:y,removeFetchGraphQlHeader:C,fetchGraphQl:M,getConfig:O,addBeforeHook:S,addAfterHook:T}=n.getMethods();export{H as FetchGraphQL,T as addAfterHook,S as addBeforeHook,M as fetchGraphQl,O as getConfig,y as getFetchGraphQlHeader,C as removeFetchGraphQlHeader,B as setEndpoint,P as setFetchGraphQlHeader,E as setFetchGraphQlHeaders};
//# sourceMappingURL=fetch-graphql.js.map
