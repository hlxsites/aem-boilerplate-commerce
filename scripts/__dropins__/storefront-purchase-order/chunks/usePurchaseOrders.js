/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as a,jsxs as g}from"@dropins/tools/preact-jsx-runtime.js";import{useState as o,useEffect as X,useCallback as d,useMemo as U}from"@dropins/tools/preact-hooks.js";import"@dropins/tools/event-bus.js";import{i as pe,g as ge}from"./pageSize.config.js";import{f as ee}from"./formatDate.js";import{Tag as fe,Price as Pe,ActionButton as re}from"@dropins/tools/components.js";import{r as me,a as be}from"./rejectPurchaseOrders.js";import{g as Re}from"./getPurchaseOrders.js";import{d as Oe,a as Ae}from"./PurchaseOrderHistoryLogContent.js";import{Text as f}from"@dropins/tools/i18n.js";var V=(i=>(i.CUSTOMER_PURCHASE_ORDERS="customerPurchaseOrders",i.COMPANY_PURCHASE_ORDERS="companyPurchaseOrders",i.CUSTOMER_APPROVAL_PURCHASE_ORDERS="customerApprovalPurchaseOrders",i))(V||{});const Ce=20,De=({view:i,initialPageSize:te,routePurchaseOrderDetails:C,setColumns:E,setRowsData:k,t:n,permissions:v,loadingPermissions:H})=>{const S=i===V.COMPANY_PURCHASE_ORDERS,c=i===V.CUSTOMER_APPROVAL_PURCHASE_ORDERS,[M,P]=o(!0),[l,y]=o([]),[h,j]=o([]),[m,se]=o(te),[ae,p]=o(!0),[ne,$]=o({currentPage:1,totalPages:1,totalCount:0}),[b,R]=o({heading:"",description:"",type:"success"}),[x,N]=o(new Set);X(()=>{if(b.heading||b.description){const r=setTimeout(()=>{R({heading:"",description:"",type:"success"})},7e3);return()=>clearTimeout(r)}},[b.heading,b.description]);const{currentPage:D,totalPages:ce,totalCount:oe}=ne,I=d(r=>{$(s=>({...s,currentPage:r})),N(new Set),P(!0)},[]),de=d(r=>{const s=r.target.value;se(e=>e.map(t=>({...t,selected:t.value===s}))),I(1),N(new Set),P(!0)},[I]),O=(v==null?void 0:v.isAdmin)??!1,z=U(()=>{let r={};return S&&(r={companyPurchaseOrders:!0}),c&&(r={myApprovals:!0}),r},[S,c]);X(()=>{var e;if(!M||H)return;p(!0);const r=(e=m==null?void 0:m.find(t=>t.selected))==null?void 0:e.value,s=parseInt(r??Ce.toString(),10);Re(z,s,D).then(t=>{var w,T;const u=(t==null?void 0:t.purchaseOrderItems)??[],_=(w=t==null?void 0:t.pageInfo)==null?void 0:w.currentPage,A=(T=t==null?void 0:t.pageInfo)==null?void 0:T.totalPages,L=t==null?void 0:t.totalCount;$({currentPage:_>A?A||1:_,totalPages:A,totalCount:L}),j(u)}).catch(t=>{console.error("Failed to fetch purchase orders:",t),j([])}).finally(()=>{p(!1),P(!1)})},[M,D,m,z,H]);const B=d(r=>{const s=C==null?void 0:C(r);return pe(s??"")?s:"#"},[C]),G=d(r=>{N(s=>{const e=new Set(s);return e.has(r)?e.delete(r):e.add(r),e})},[]),q=d(r=>{const s=r.target.value,e=r.target.checked;y(t=>e?[...t,s]:t.filter(u=>u!==s))},[]),Q=d(r=>{const s=r.target.checked;y(()=>s?h.filter(e=>["PENDING","APPROVAL_REQUIRED"].includes(e.status)).map(e=>e.uid??""):[])},[h]),ie=d(()=>{p(!0),me(l).then(()=>{R({heading:n.alertHeaderReject,description:n.alertDescriptionReject,type:"success"}),y([]),P(!0)}).catch(r=>{R({heading:n.alertHeaderError,description:n.alertDescriptionError,type:"error"}),console.error(r)}).finally(()=>{p(!1)})},[l,n]),le=d(()=>{p(!0),be(l).then(()=>{R({heading:n.alertHeaderApprove,description:n.alertDescriptionApprove,type:"success"}),y([]),P(!0)}).catch(r=>{R({heading:n.alertHeaderError,description:n.alertDescriptionError,type:"error"}),console.error(r)}).finally(()=>{p(!1)})},[l,n]),ue=U(()=>{const r=S||c?Oe:Ae;return(E==null?void 0:E(r))??r.map(s=>s.key==="checkboxView"&&(O||c)?{key:s.key,label:a("input",{type:"checkbox",name:"selectAll",disabled:h.every(e=>!["PENDING","APPROVAL_REQUIRED"].includes(e.status)),onChange:Q}),ariaLabel:n.selectAllAriaLabel}:{...s,label:n[s.key]||s.label})},[n,O,S,c,E,h,Q]),he=U(()=>{const r=h.map((e,t)=>{var F,Y,Z,J,K,W;const u=e.number??"",_=x.has(t),A=`${((F=e.createdBy)==null?void 0:F.firstname)??""} ${((Y=e.createdBy)==null?void 0:Y.lastname)??""}`.trim(),L=a(re,{type:"button",onClick:()=>G(t),children:a(f,{id:`PurchaseOrders.purchaseOrdersTable.buttons.${_?"expandedHidden":"expandedShow"}`})}),w=a(fe,{className:`b2b-purchase-order-purchase-orders-table__status b2b-purchase-order-purchase-orders-table__status--${ge(e.status)}`,children:a(f,{id:`PurchaseOrders.purchaseOrdersTable.statusOrder.${e.status.toLowerCase()}`})}),T=g("div",{className:"b2b-purchase-order-purchase-orders-table__row-details",children:[g("div",{className:"b2b-purchase-order-purchase-orders-table__row-details-content",children:[g("p",{children:[a("span",{children:a(f,{id:"PurchaseOrders.purchaseOrdersTable.expandedRowLabels.orderNumber"})})," ",e.order.orderNumber]}),g("p",{children:[a("span",{children:a(f,{id:"PurchaseOrders.purchaseOrdersTable.expandedRowLabels.createdDate"})})," ",ee(e.createdAt)]}),g("p",{children:[a("span",{children:a(f,{id:"PurchaseOrders.purchaseOrdersTable.expandedRowLabels.updatedDate"})})," ",ee(e.updatedAt)]}),g("p",{children:[a("span",{children:a(f,{id:"PurchaseOrders.purchaseOrdersTable.expandedRowLabels.total"})})," ",a(Pe,{amount:(J=(Z=e==null?void 0:e.quote)==null?void 0:Z.grandTotal)==null?void 0:J.value,currency:(W=(K=e==null?void 0:e.quote)==null?void 0:K.grandTotal)==null?void 0:W.currency,weight:"normal"})]})]}),a("div",{className:"b2b-purchase-order-purchase-orders-table__row-details-action",children:a(re,{onClick:()=>{window.location.href=B(e.uid??"")},"aria-label":`View purchase order ${u}`,children:n.actionView})})]});return{...O||c?{checkboxView:a("input",{type:"checkbox",name:u,value:e.uid,checked:l.includes(e.uid),onChange:q,disabled:!["PENDING","APPROVAL_REQUIRED"].includes(e.status)})}:{},poNumber:u,status:w,createdBy:A,action:L,_rowDetails:T}});let s=r;if(k){const e=k(r);e!==void 0&&Array.isArray(e)&&(s=e)}return s},[h,k,O,c,l,q,B,n.actionView,x,G]);return{tableConfig:{columns:ue,rows:he,expandedRows:x},paginationConfig:{currentPage:D,totalPages:ce,handlePageChange:I},pageSizeConfig:{pageSizeOptionsList:m,onChange:de},totalCount:oe,loading:ae,selectedOrderIds:l,handleRejectSelected:ie,handleApproveSelected:le,isAdmin:O,isRequireApprovalPOsView:c,alertMessageConfig:b}};export{V as E,De as u};
//# sourceMappingURL=usePurchaseOrders.js.map
