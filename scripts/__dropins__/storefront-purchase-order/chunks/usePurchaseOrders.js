/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as _}from"@dropins/tools/preact-jsx-runtime.js";import{useState as g,useEffect as $,useCallback as l,useMemo as N}from"@dropins/tools/preact-hooks.js";import"@dropins/tools/event-bus.js";import{i as X}from"./pageSize.config.js";import{r as ee,a as re}from"./rejectPurchaseOrders.js";import{g as te}from"./getPurchaseOrders.js";import{d as ne,a as se}from"./FormLoader.js";import{Text as ce}from"@dropins/tools/i18n.js";const j=(c,I="en-US")=>{try{const a=new Date(c);return isNaN(a.getTime())?c:a.toLocaleString(I,{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit",second:"2-digit",hour12:!0})}catch{return c}};var T=(c=>(c.CUSTOMER_PURCHASE_ORDERS="customerPurchaseOrders",c.COMPANY_PURCHASE_ORDERS="companyPurchaseOrders",c.CUSTOMER_APPROVAL_PURCHASE_ORDERS="customerApprovalPurchaseOrders",c))(T||{});const ae=20,fe=({view:c,initialPageSize:I,routePurchaseOrderDetails:a,setColumns:y,setRowsData:k,t:s,permissions:D,loadingPermissions:L})=>{const C=c===T.COMPANY_PURCHASE_ORDERS,o=c===T.CUSTOMER_APPROVAL_PURCHASE_ORDERS,[d,E]=g([]),[h,U]=g([]),[p,z]=g(I),[q,f]=g(!0),[G,V]=g({currentPage:1,totalPages:1,totalCount:0}),[P,m]=g({heading:"",description:"",type:"success"});$(()=>{if(P.heading||P.description){const r=setTimeout(()=>{m({heading:"",description:"",type:"success"})},7e3);return()=>clearTimeout(r)}},[P.heading,P.description]);const{currentPage:v,totalPages:B,totalCount:Q}=G,F=l(r=>{const n=r.target.value;z(e=>e.map(t=>({...t,selected:t.value===n})))},[]),A=(D==null?void 0:D.isAdmin)??!1,H=N(()=>{let r={};return C&&(r={companyPurchaseOrders:!0}),o&&(r={requireMyApproval:!0}),r},[C,o]);$(()=>{var e;if(L)return;f(!0);const r=(e=p==null?void 0:p.find(t=>t.selected))==null?void 0:e.value,n=parseInt(r??ae.toString(),10);te(H,n,v).then(t=>{var O,R;const i=(t==null?void 0:t.purchaseOrderItems)??[],u=(O=t==null?void 0:t.pageInfo)==null?void 0:O.currentPage,S=(R=t==null?void 0:t.pageInfo)==null?void 0:R.totalPages,b=t==null?void 0:t.totalCount;V({currentPage:u,totalPages:S,totalCount:b}),U(i)}).catch(t=>{console.error("Failed to fetch purchase orders:",t)}).finally(()=>{f(!1)})},[v,p,H,L]);const M=l(r=>{const n=a==null?void 0:a(r);return X(n??"")?n:"#"},[a]),Y=l(r=>{V(n=>({...n,currentPage:r}))},[]),w=l(r=>{const n=r.target.value,e=r.target.checked;E(t=>e?[...t,n]:t.filter(i=>i!==n))},[]),x=l(r=>{const n=r.target.checked;E(()=>n?h.filter(e=>["PENDING","APPROVAL_REQUIRED"].includes(e.status)).map(e=>e.uid??""):[])},[h]),Z=l(()=>{ee(d).then(r=>{const n=(r==null?void 0:r.purchaseOrders)??[];U(e=>e.map(t=>n.find(u=>u.uid===t.uid)??t)),m({heading:s.alertHeaderReject,description:s.alertDescriptionReject,type:"success"}),E([])}).catch(r=>{m({heading:s.alertHeaderError,description:s.alertDescriptionError,type:"error"}),console.error(r)}).finally(()=>{f(!1)})},[d,s]),J=l(()=>{f(!0),re(d).then(r=>{const n=(r==null?void 0:r.purchaseOrders)??[];U(e=>e.map(t=>n.find(u=>u.uid===t.uid)??t)),m({heading:s.alertHeaderApprove,description:s.alertDescriptionApprove,type:"success"}),E([])}).catch(r=>{m({heading:s.alertHeaderError,description:s.alertDescriptionError,type:"error"}),console.error(r)}).finally(()=>{f(!1)})},[d,s]),K=N(()=>{const r=C||o?ne:se;return(y==null?void 0:y(r))??r.map(n=>n.key==="checkboxView"&&(A||o)?{key:n.key,label:_("input",{type:"checkbox",name:"selectAll",disabled:h.every(e=>!["PENDING","APPROVAL_REQUIRED"].includes(e.status)),onChange:x}),ariaLabel:s.selectAllAriaLabel}:{...n,label:s[n.key]||n.label})},[s,A,C,o,y,h,x]),W=N(()=>{const r=h.map(e=>{var i,u,S,b,O,R;const t=e.number??"";return{...A||o?{checkboxView:_("input",{type:"checkbox",name:t,value:e.uid,checked:d.includes(e.uid),onChange:w,disabled:!["PENDING","APPROVAL_REQUIRED"].includes(e.status)})}:{},poNumber:t,orderNumber:e.order.orderNumber,createdDate:j(e.createdAt),updatedDate:j(e.updatedAt),createdBy:`${((i=e.createdBy)==null?void 0:i.firstname)??""} ${((u=e.createdBy)==null?void 0:u.lastname)??""}`.trim(),status:_(ce,{id:`PurchaseOrders.purchaseOrdersTable.statusOrder.${e.status.toLowerCase()}`}),total:`${(b=(S=e==null?void 0:e.quote)==null?void 0:S.grandTotal)==null?void 0:b.value} ${(R=(O=e==null?void 0:e.quote)==null?void 0:O.grandTotal)==null?void 0:R.currency}`,action:_("a",{href:M(e.uid??""),"aria-label":`View purchase order ${t}`,children:s.actionView})}});let n=r;if(k){const e=k(r);e!==void 0&&Array.isArray(e)&&(n=e)}return n},[h,k,A,o,d,w,M,s.actionView]);return{tableConfig:{columns:K,rows:W},paginationConfig:{currentPage:v,totalPages:B,handlePageChange:Y},pageSizeConfig:{pageSizeOptionsList:p,onChange:F},totalCount:Q,loading:q,selectedOrderIds:d,handleRejectSelected:Z,handleApproveSelected:J,isAdmin:A,isRequireApprovalPOsView:o,alertMessageConfig:P}};export{T as E,fe as u};
//# sourceMappingURL=usePurchaseOrders.js.map
