/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as y}from"@dropins/tools/preact-jsx-runtime.js";import{useState as g,useEffect as j,useCallback as l,useMemo as N}from"@dropins/tools/preact-hooks.js";import"@dropins/tools/event-bus.js";import{i as X}from"./pageSize.config.js";import{r as ee,a as re}from"./rejectPurchaseOrders.js";import{g as te}from"./getPurchaseOrders.js";import{d as ne,a as se}from"./FormLoader.js";import{Price as ce}from"@dropins/tools/components.js";import{Text as oe}from"@dropins/tools/i18n.js";const z=(c,I="en-US")=>{try{const o=new Date(c);return isNaN(o.getTime())?c:o.toLocaleString(I,{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit",second:"2-digit",hour12:!0})}catch{return c}};var T=(c=>(c.CUSTOMER_PURCHASE_ORDERS="customerPurchaseOrders",c.COMPANY_PURCHASE_ORDERS="companyPurchaseOrders",c.CUSTOMER_APPROVAL_PURCHASE_ORDERS="customerApprovalPurchaseOrders",c))(T||{});const ae=20,Pe=({view:c,initialPageSize:I,routePurchaseOrderDetails:o,setColumns:C,setRowsData:k,t:s,permissions:D,loadingPermissions:L})=>{const E=c===T.COMPANY_PURCHASE_ORDERS,a=c===T.CUSTOMER_APPROVAL_PURCHASE_ORDERS,[d,S]=g([]),[h,U]=g([]),[p,G]=g(I),[$,f]=g(!0),[q,V]=g({currentPage:1,totalPages:1,totalCount:0}),[m,P]=g({heading:"",description:"",type:"success"});j(()=>{if(m.heading||m.description){const r=setTimeout(()=>{P({heading:"",description:"",type:"success"})},7e3);return()=>clearTimeout(r)}},[m.heading,m.description]);const{currentPage:v,totalPages:B,totalCount:Q}=q,F=l(r=>{const n=r.target.value;G(e=>e.map(t=>({...t,selected:t.value===n})))},[]),A=(D==null?void 0:D.isAdmin)??!1,H=N(()=>{let r={};return E&&(r={companyPurchaseOrders:!0}),a&&(r={myApprovals:!0}),r},[E,a]);j(()=>{var e;if(L)return;f(!0);const r=(e=p==null?void 0:p.find(t=>t.selected))==null?void 0:e.value,n=parseInt(r??ae.toString(),10);te(H,n,v).then(t=>{var O,R;const i=(t==null?void 0:t.purchaseOrderItems)??[],u=(O=t==null?void 0:t.pageInfo)==null?void 0:O.currentPage,b=(R=t==null?void 0:t.pageInfo)==null?void 0:R.totalPages,_=t==null?void 0:t.totalCount;V({currentPage:u,totalPages:b,totalCount:_}),U(i)}).catch(t=>{console.error("Failed to fetch purchase orders:",t)}).finally(()=>{f(!1)})},[v,p,H,L]);const w=l(r=>{const n=o==null?void 0:o(r);return X(n??"")?n:"#"},[o]),Y=l(r=>{V(n=>({...n,currentPage:r}))},[]),M=l(r=>{const n=r.target.value,e=r.target.checked;S(t=>e?[...t,n]:t.filter(i=>i!==n))},[]),x=l(r=>{const n=r.target.checked;S(()=>n?h.filter(e=>["PENDING","APPROVAL_REQUIRED"].includes(e.status)).map(e=>e.uid??""):[])},[h]),Z=l(()=>{ee(d).then(r=>{const n=(r==null?void 0:r.purchaseOrders)??[];U(e=>e.map(t=>n.find(u=>u.uid===t.uid)??t)),P({heading:s.alertHeaderReject,description:s.alertDescriptionReject,type:"success"}),S([])}).catch(r=>{P({heading:s.alertHeaderError,description:s.alertDescriptionError,type:"error"}),console.error(r)}).finally(()=>{f(!1)})},[d,s]),J=l(()=>{f(!0),re(d).then(r=>{const n=(r==null?void 0:r.purchaseOrders)??[];U(e=>e.map(t=>n.find(u=>u.uid===t.uid)??t)),P({heading:s.alertHeaderApprove,description:s.alertDescriptionApprove,type:"success"}),S([])}).catch(r=>{P({heading:s.alertHeaderError,description:s.alertDescriptionError,type:"error"}),console.error(r)}).finally(()=>{f(!1)})},[d,s]),K=N(()=>{const r=E||a?ne:se;return(C==null?void 0:C(r))??r.map(n=>n.key==="checkboxView"&&(A||a)?{key:n.key,label:y("input",{type:"checkbox",name:"selectAll",disabled:h.every(e=>!["PENDING","APPROVAL_REQUIRED"].includes(e.status)),onChange:x}),ariaLabel:s.selectAllAriaLabel}:{...n,label:s[n.key]||n.label})},[s,A,E,a,C,h,x]),W=N(()=>{const r=h.map(e=>{var i,u,b,_,O,R;const t=e.number??"";return{...A||a?{checkboxView:y("input",{type:"checkbox",name:t,value:e.uid,checked:d.includes(e.uid),onChange:M,disabled:!["PENDING","APPROVAL_REQUIRED"].includes(e.status)})}:{},poNumber:t,orderNumber:e.order.orderNumber,createdDate:z(e.createdAt),updatedDate:z(e.updatedAt),createdBy:`${((i=e.createdBy)==null?void 0:i.firstname)??""} ${((u=e.createdBy)==null?void 0:u.lastname)??""}`.trim(),status:y(oe,{id:`PurchaseOrders.purchaseOrdersTable.statusOrder.${e.status.toLowerCase()}`}),total:y(ce,{amount:(_=(b=e==null?void 0:e.quote)==null?void 0:b.grandTotal)==null?void 0:_.value,currency:(R=(O=e==null?void 0:e.quote)==null?void 0:O.grandTotal)==null?void 0:R.currency,weight:"normal"}),action:y("a",{href:w(e.uid??""),"aria-label":`View purchase order ${t}`,children:s.actionView})}});let n=r;if(k){const e=k(r);e!==void 0&&Array.isArray(e)&&(n=e)}return n},[h,k,A,a,d,M,w,s.actionView]);return{tableConfig:{columns:K,rows:W},paginationConfig:{currentPage:v,totalPages:B,handlePageChange:Y},pageSizeConfig:{pageSizeOptionsList:p,onChange:F},totalCount:Q,loading:$,selectedOrderIds:d,handleRejectSelected:Z,handleApproveSelected:J,isAdmin:A,isRequireApprovalPOsView:a,alertMessageConfig:m}};export{T as E,Pe as u};
//# sourceMappingURL=usePurchaseOrders.js.map
