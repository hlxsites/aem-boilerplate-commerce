/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as _}from"@dropins/tools/preact-jsx-runtime.js";import{useState as p,useEffect as z,useCallback as l,useMemo as N}from"@dropins/tools/preact-hooks.js";import"@dropins/tools/event-bus.js";import{i as re}from"./pageSize.config.js";import{r as te,a as se}from"./rejectPurchaseOrders.js";import{g as ne}from"./getPurchaseOrders.js";import{d as ce,a as oe}from"./FormLoader.js";import{Text as ae}from"@dropins/tools/i18n.js";const q=(c,I="en-US")=>{try{const o=new Date(c);return isNaN(o.getTime())?c:o.toLocaleString(I,{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit",second:"2-digit",hour12:!0})}catch{return c}};var T=(c=>(c.CUSTOMER_PURCHASE_ORDERS="customerPurchaseOrders",c.COMPANY_PURCHASE_ORDERS="companyPurchaseOrders",c.CUSTOMER_APPROVAL_PURCHASE_ORDERS="customerApprovalPurchaseOrders",c))(T||{});const ie=20,me=({view:c,initialPageSize:I,routePurchaseOrderDetails:o,setColumns:y,setRowsData:k,t:n,permissions:D,loadingPermissions:L})=>{const C=c===T.COMPANY_PURCHASE_ORDERS,a=c===T.CUSTOMER_APPROVAL_PURCHASE_ORDERS,[d,E]=p([]),[h,U]=p([]),[g,G]=p(I),[B,f]=p(!0),[Q,V]=p({currentPage:1,totalPages:1,totalCount:0}),[P,m]=p({heading:"",description:"",type:"success"});z(()=>{if(P.heading||P.description){const r=setTimeout(()=>{m({heading:"",description:"",type:"success"})},7e3);return()=>clearTimeout(r)}},[P.heading,P.description]);const{currentPage:v,totalPages:F,totalCount:Y}=Q,Z=l(r=>{const s=r.target.value;G(e=>e.map(t=>({...t,selected:t.value===s})))},[]),A=(D==null?void 0:D.isAdmin)??!1,H=N(()=>{let r={};return C&&(r={companyPurchaseOrders:!0}),a&&(r={requireMyApproval:!0}),r},[C,a]);z(()=>{var e;if(L)return;f(!0);const r=(e=g==null?void 0:g.find(t=>t.selected))==null?void 0:e.value,s=parseInt(r??ie.toString(),10);ne(H,s,v).then(t=>{var O,R;const i=(t==null?void 0:t.purchaseOrderItems)??[],u=(O=t==null?void 0:t.pageInfo)==null?void 0:O.currentPage,S=(R=t==null?void 0:t.pageInfo)==null?void 0:R.totalPages,b=t==null?void 0:t.totalCount;V({currentPage:u,totalPages:S,totalCount:b}),U(i)}).catch(t=>{console.error("Failed to fetch purchase orders:",t)}).finally(()=>{f(!1)})},[v,g,H,L]);const M=l(r=>{const s=o==null?void 0:o(r);return re(s??"")?s:"#"},[o]),J=l(r=>{V(s=>({...s,currentPage:r}))},[]),w=l(r=>{const s=r.target.value,e=r.target.checked;E(t=>e?[...t,s]:t.filter(i=>i!==s))},[]),x=l(r=>{const s=r.target.checked;E(()=>s?h.filter(e=>["PENDING","APPROVAL_REQUIRED"].includes(e.status)).map(e=>e.uid??""):[])},[h]),K=l(()=>{te(d).then(r=>{const s=(r==null?void 0:r.purchaseOrders)??[];U(e=>e.map(t=>s.find(u=>u.uid===t.uid)??t)),m({heading:n.alertHeaderReject,description:n.alertDescriptionReject,type:"success"}),E([])}).catch(r=>{m({heading:n.alertHeaderError,description:n.alertDescriptionError,type:"error"}),console.error(r)}).finally(()=>{f(!1)})},[d,n]),W=l(()=>{f(!0),se(d).then(r=>{const s=(r==null?void 0:r.purchaseOrders)??[];U(e=>e.map(t=>s.find(u=>u.uid===t.uid)??t)),m({heading:n.alertHeaderApprove,description:n.alertDescriptionApprove,type:"success"}),E([])}).catch(r=>{m({heading:n.alertHeaderError,description:n.alertDescriptionError,type:"error"}),console.error(r)}).finally(()=>{f(!1)})},[d,n]),X=N(()=>{const r=C||a?ce:oe;return(y==null?void 0:y(r))??r.map(s=>s.key==="checkboxView"&&(A||a)?{key:s.key,label:_("input",{type:"checkbox",name:"selectAll",disabled:h.every(e=>!["PENDING","APPROVAL_REQUIRED"].includes(e.status)),onChange:x}),ariaLabel:n.selectAllAriaLabel}:{...s,label:n[s.key]||s.label})},[n,A,C,a,y,h,x]),ee=N(()=>{const r=h.map(e=>{var i,u,S,b,O,R,$,j;const t=e.number??"";return{...A||a?{checkboxView:_("input",{type:"checkbox",name:t,value:e.uid,checked:d.includes(e.uid),onChange:w,disabled:!["PENDING","APPROVAL_REQUIRED"].includes(e.status)})}:{},poNumber:t,orderNumber:e.order.orderNumber,createdDate:q(e.createdAt),updatedDate:q(e.updatedAt),createdBy:`${((i=e.createdBy)==null?void 0:i.firstname)??""} ${((u=e.createdBy)==null?void 0:u.lastname)??""}`.trim(),status:_(ae,{id:`PurchaseOrders.purchaseOrdersTable.statusOrder.${e.status.toLowerCase()}`}),total:`${(O=(b=(S=e==null?void 0:e.quote)==null?void 0:S.prices)==null?void 0:b.grandTotal)==null?void 0:O.value} ${(j=($=(R=e==null?void 0:e.quote)==null?void 0:R.prices)==null?void 0:$.grandTotal)==null?void 0:j.currency}`,action:_("a",{href:M(t),"aria-label":`View purchase order ${t}`,children:n.actionView})}});let s=r;if(k){const e=k(r);e!==void 0&&Array.isArray(e)&&(s=e)}return s},[h,k,A,a,d,w,M,n.actionView]);return{tableConfig:{columns:X,rows:ee},paginationConfig:{currentPage:v,totalPages:F,handlePageChange:J},pageSizeConfig:{pageSizeOptionsList:g,onChange:Z},totalCount:Y,loading:B,selectedOrderIds:d,handleRejectSelected:K,handleApproveSelected:W,isAdmin:A,isRequireApprovalPOsView:a,alertMessageConfig:P}};export{T as E,me as u};
//# sourceMappingURL=usePurchaseOrders.js.map
