/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as l,Fragment as U,jsxs as D}from"@dropins/tools/preact-jsx-runtime.js";import{classes as M}from"@dropins/tools/lib.js";import{i as Z,u as q,P as J,a as K,d as Q}from"../chunks/useCustomerRolePermissions.js";/* empty css                                        */import{Button as W,Skeleton as X,SkeletonRow as Y}from"@dropins/tools/components.js";import{useState as L,useCallback as C,useEffect as ee,useMemo as j}from"@dropins/tools/preact-hooks.js";import"@dropins/tools/event-bus.js";import{g as ae,d as re}from"../chunks/getPurchaseOrderApprovalRules.js";import{Text as F,useText as se}from"@dropins/tools/i18n.js";import"../chunks/fetch-graphql.js";import"@dropins/tools/fetch-graphql.js";const _=[{key:"action",label:"Action"},{key:"ruleName",label:"Rule Name"},{key:"status",label:"Status"},{key:"ruleType",label:"Rule Type"},{key:"createdBy",label:"Created By"},{key:"appliesTo",label:"Applies To"},{key:"approver",label:"Approver"}],le=20,te=({routeApprovalRuleDetails:c,routeCreateApprovalRule:u,routeEditApprovalRule:d,setColumns:p,setRowsData:g,initialPageSize:k,permissions:O,t})=>{const[h,P]=L([]),[m,n]=L(!0),[i,y]=L(k),[f,v]=L({currentPage:1,totalPages:1,totalCount:0}),{currentPage:T,totalPages:w,totalCount:R}=f,S=C(r=>{const e=r.target.value;y(s=>s.map(a=>({...a,selected:a.value===e})))},[]),N=C(r=>{v(e=>({...e,currentPage:r}))},[]);ee(()=>{var s;const r=(s=i==null?void 0:i.find(a=>a.selected))==null?void 0:s.value,e=parseInt(r??le.toString(),10);n(!0),ae(T,e).then(a=>{a!=null&&a.pageInfo&&v({currentPage:a.pageInfo.currentPage,totalPages:a.pageInfo.totalPages,totalCount:a.totalCount}),P(a==null?void 0:a.items)}).catch(a=>{console.error("Error fetching approval rules:",a),P([])}).finally(()=>{n(!1)})},[T,i,f.totalPages,w]);const b=C((r,e)=>{let s="";switch(e){case"new":{s=u==null?void 0:u(r);break}case"edit":{s=d==null?void 0:d(r);break}case"view":{s=c==null?void 0:c(r);break}}return Z(s??"")?s:"#"},[u,d,c]),x=j(()=>(p==null?void 0:p(_))??_.map(r=>({...r,label:t[r.key]||r.label})),[p,t]),z=C((r,e)=>{r.preventDefault(),n(!0),re(e).then(()=>{P(s=>s.filter(a=>a.uid!==e))}).finally(()=>{n(!1)})},[]),G=j(()=>{const r=h==null?void 0:h.map(e=>{var B,V,E,I,$,A;const{isAdmin:s,permissions:{manageApprovalRules:a}}=O;return{ruleName:e.name,createdBy:e.createdBy,ruleType:l(F,{id:`PurchaseOrders.purchaseOrdersTable.ruleTypes.${(V=(B=e.condition)==null?void 0:B.attribute)==null?void 0:V.toLocaleLowerCase()}`}),status:l(F,{id:`PurchaseOrders.purchaseOrdersTable.rulesStatus.${(E=e.status)==null?void 0:E.toLocaleLowerCase()}`}),appliesTo:((I=e==null?void 0:e.appliesToRoles)==null?void 0:I.length)<=0?t.appliesToAll:($=e==null?void 0:e.appliesToRoles)==null?void 0:$.map(o=>o.name).join(", "),approver:l(U,{children:(A=e==null?void 0:e.approverRoles)==null?void 0:A.map((o,H)=>l("div",{children:o==null?void 0:o.name},H))}),action:s||a?l(U,{children:D("div",{style:{display:"flex",gap:"8px"},children:[l("a",{href:b(e.uid,"edit"),"aria-label":t.ariaLabelEditRule.replace("{{ruleName}}",e.name),"data-testid":`edit-approval-rule-${e.uid}`,children:t.actionEdit}),l("a",{"data-testid":`delete-approval-rule-${e.uid}`,href:"#","aria-label":t.ariaLabelDeleteRule.replace("{{ruleName}}",e.name),onClick:o=>z(o,e.uid),children:t.actionDelete})]})}):l("a",{"data-testid":`view-approval-rule-${e.uid}`,href:b(e.uid,"view"),"aria-label":t.ariaLabelViewRule.replace("{{ruleName}}",e.name),children:t.actionView})}});return g?g(r):r},[h,g,O,t,b,z]);return{tableConfig:{columns:x,rows:G},paginationConfig:{currentPage:T,totalPages:w,handlePageChange:N},pageSizeConfig:{pageSizeOptionsList:i,onChange:S},totalCount:R,loading:m,handleCreateUrl:b}},Pe=({routeCreateApprovalRule:c,routeEditApprovalRule:u,routeApprovalRuleDetails:d,setColumns:p,setRowsData:g,className:k="",withHeader:O=!0,withWrapper:t=!0,skeletonRowCount:h=5,initialPageSize:P=Q})=>{const m=se({headerText:"PurchaseOrders.approvalRulesList.containerTitle",ruleName:"PurchaseOrders.purchaseOrdersTable.tableColumns.ruleName",ruleType:"PurchaseOrders.purchaseOrdersTable.tableColumns.ruleType",appliesTo:"PurchaseOrders.purchaseOrdersTable.tableColumns.appliesTo",approver:"PurchaseOrders.purchaseOrdersTable.tableColumns.approver",createdBy:"PurchaseOrders.purchaseOrdersTable.tableColumns.createdBy",status:"PurchaseOrders.purchaseOrdersTable.tableColumns.status",actionEdit:"PurchaseOrders.purchaseOrdersTable.actionEdit",actionDelete:"PurchaseOrders.purchaseOrdersTable.actionDelete",addNewRule:"PurchaseOrders.approvalRulesList.buttons.newRule",actionView:"PurchaseOrders.purchaseOrdersTable.actionView",appliesToAll:"PurchaseOrders.purchaseOrdersTable.appliesToAll",emptyTitle:"PurchaseOrders.approvalRulesList.emptyTitle",ariaLabelEditRule:"PurchaseOrders.approvalRulesList.ariaLabel.editRule",ariaLabelDeleteRule:"PurchaseOrders.approvalRulesList.ariaLabel.deleteRule",ariaLabelViewRule:"PurchaseOrders.approvalRulesList.ariaLabel.viewRule"}),{permissions:n,loadingPermissions:i}=q(),{loading:y,tableConfig:f,paginationConfig:v,totalCount:T,pageSizeConfig:w,handleCreateUrl:R}=te({routeCreateApprovalRule:c,routeEditApprovalRule:u,routeApprovalRuleDetails:d,setColumns:p,setRowsData:g,permissions:n,initialPageSize:P,t:m}),{isAdmin:S,permissions:{manageApprovalRules:N}}=n,b=S||N?l(W,{variant:"primary",onClick:()=>{window.location.href=R("","new")},"data-testid":"add-new-rule-button",children:m.addNewRule}):null,x=y||i?l(X,{"data-testid":"approval-rules-skeleton",children:l(Y,{variant:"row",size:"small"})}):b;return D("div",{className:M(["purchase-orders",k]),"data-testid":"purchase-orders-container",children:[O?l(J,{headerText:m.headerText}):null,l(K,{totalCount:T,columns:f.columns,rows:f.rows,paginationConfig:v,loading:y||i,skeletonRowCount:h,pageSizeConfig:w,emptyTitle:m.emptyTitle,withWrapper:t,footer:x})]})};export{Pe as PurchaseOrderApprovalRulesList,Pe as default};
//# sourceMappingURL=PurchaseOrderApprovalRulesList.js.map
