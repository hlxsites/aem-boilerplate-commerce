/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as s,Fragment as j,jsxs as G}from"@dropins/tools/preact-jsx-runtime.js";import{classes as q}from"@dropins/tools/lib.js";import{i as J,P as K,d as Q}from"../chunks/pageSize.config.js";import{P as W}from"../chunks/PurchaseOrdersHeader.js";import"../chunks/FormLoader.js";import{Button as X,Skeleton as Y,SkeletonRow as ee}from"@dropins/tools/components.js";import{useState as P,useCallback as R,useEffect as ae,useMemo as F}from"@dropins/tools/preact-hooks.js";import"@dropins/tools/event-bus.js";import{u as re}from"../chunks/useCustomerRolePermissions.js";import{g as se,d as le}from"../chunks/getPurchaseOrderApprovalRules.js";import{Text as _,useText as te}from"@dropins/tools/i18n.js";import"../chunks/fetch-graphql.js";import"@dropins/tools/fetch-graphql.js";import"../chunks/fetch-error.js";import"../chunks/transform-purchase-order-approval-rule.js";const D=[{key:"action",label:"Action"},{key:"ruleName",label:"Rule Name"},{key:"status",label:"Status"},{key:"ruleType",label:"Rule Type"},{key:"createdBy",label:"Created By"},{key:"appliesTo",label:"Applies To"},{key:"approver",label:"Approver"}],ie=20,ne=({routeApprovalRuleDetails:c,routeCreateApprovalRule:u,routeEditApprovalRule:d,setColumns:p,setRowsData:b,initialPageSize:k,permissions:T,t:l})=>{const[h,O]=P([]),[m,g]=P(!1),[y,n]=P(!0),[i,S]=P(k),[v,w]=P({currentPage:1,totalPages:1,totalCount:0}),{currentPage:f,totalPages:L,totalCount:N}=v,x=R(a=>{const e=a.target.value;S(t=>t.map(r=>({...r,selected:r.value===e})))},[]),z=R(a=>{w(e=>({...e,currentPage:a}))},[]);ae(()=>{var t;const a=(t=i==null?void 0:i.find(r=>r.selected))==null?void 0:t.value,e=parseInt(a??ie.toString(),10);n(!0),se(f,e).then(r=>{r!=null&&r.pageInfo&&w({currentPage:r.pageInfo.currentPage,totalPages:r.pageInfo.totalPages,totalCount:r.totalCount}),O(r==null?void 0:r.items)}).catch(r=>{console.error("Error fetching approval rules:",r),O([])}).finally(()=>{n(!1),g(!1)})},[m,f,i,v.totalPages,L]);const C=R((a,e)=>{let t="";switch(e){case"new":{t=u==null?void 0:u(a);break}case"edit":{t=d==null?void 0:d(a);break}case"view":{t=c==null?void 0:c(a);break}}return J(t??"")?t:"#"},[u,d,c]),H=F(()=>(p==null?void 0:p(D))??D.map(a=>({...a,label:l[a.key]||a.label})),[p,l]),B=R((a,e)=>{a.preventDefault(),n(!0),le(e).then(()=>{g(!0)}).finally(()=>{n(!1)})},[]),M=F(()=>{const a=h==null?void 0:h.map(e=>{var V,E,I,$,A,U;const{isAdmin:t,permissions:{manageApprovalRules:r}}=T;return{ruleName:e.name,createdBy:e.createdBy,ruleType:s(_,{id:`PurchaseOrders.purchaseOrdersTable.ruleTypes.${(E=(V=e.condition)==null?void 0:V.attribute)==null?void 0:E.toLocaleLowerCase()}`}),status:s(_,{id:`PurchaseOrders.purchaseOrdersTable.rulesStatus.${(I=e.status)==null?void 0:I.toLocaleLowerCase()}`}),appliesTo:(($=e==null?void 0:e.appliesToRoles)==null?void 0:$.length)<=0?l.appliesToAll:(A=e==null?void 0:e.appliesToRoles)==null?void 0:A.map(o=>o.name).join(", "),approver:s(j,{children:(U=e==null?void 0:e.approverRoles)==null?void 0:U.map((o,Z)=>s("div",{children:o==null?void 0:o.name},Z))}),action:t||r?s(j,{children:G("div",{style:{display:"flex",gap:"8px"},children:[s("a",{href:C(e.uid,"edit"),"aria-label":l.ariaLabelEditRule.replace("{{ruleName}}",e.name),"data-testid":`edit-approval-rule-${e.uid}`,children:l.actionEdit}),s("a",{"data-testid":`delete-approval-rule-${e.uid}`,href:"#","aria-label":l.ariaLabelDeleteRule.replace("{{ruleName}}",e.name),onClick:o=>B(o,e.uid),children:l.actionDelete})]})}):s("a",{"data-testid":`view-approval-rule-${e.uid}`,href:C(e.uid,"view"),"aria-label":l.ariaLabelViewRule.replace("{{ruleName}}",e.name),children:l.actionView})}});return b?b(a):a},[h,b,T,l,C,B]);return{tableConfig:{columns:H,rows:M},paginationConfig:{currentPage:f,totalPages:L,handlePageChange:z},pageSizeConfig:{pageSizeOptionsList:i,onChange:x},totalCount:N,loading:y,handleCreateUrl:C}},we=({routeCreateApprovalRule:c,routeEditApprovalRule:u,routeApprovalRuleDetails:d,setColumns:p,setRowsData:b,className:k="",withHeader:T=!0,withWrapper:l=!0,skeletonRowCount:h=5,initialPageSize:O=Q})=>{const m=te({headerText:"PurchaseOrders.approvalRulesList.containerTitle",ruleName:"PurchaseOrders.purchaseOrdersTable.tableColumns.ruleName",ruleType:"PurchaseOrders.purchaseOrdersTable.tableColumns.ruleType",appliesTo:"PurchaseOrders.purchaseOrdersTable.tableColumns.appliesTo",approver:"PurchaseOrders.purchaseOrdersTable.tableColumns.approver",createdBy:"PurchaseOrders.purchaseOrdersTable.tableColumns.createdBy",status:"PurchaseOrders.purchaseOrdersTable.tableColumns.status",actionEdit:"PurchaseOrders.purchaseOrdersTable.actionEdit",actionDelete:"PurchaseOrders.purchaseOrdersTable.actionDelete",addNewRule:"PurchaseOrders.approvalRulesList.buttons.newRule",actionView:"PurchaseOrders.purchaseOrdersTable.actionView",appliesToAll:"PurchaseOrders.purchaseOrdersTable.appliesToAll",emptyTitle:"PurchaseOrders.approvalRulesList.emptyTitle",ariaLabelEditRule:"PurchaseOrders.approvalRulesList.ariaLabel.editRule",ariaLabelDeleteRule:"PurchaseOrders.approvalRulesList.ariaLabel.deleteRule",ariaLabelViewRule:"PurchaseOrders.approvalRulesList.ariaLabel.viewRule"}),{permissions:g,loadingPermissions:y}=re(),{loading:n,tableConfig:i,paginationConfig:S,totalCount:v,pageSizeConfig:w,handleCreateUrl:f}=ne({routeCreateApprovalRule:c,routeEditApprovalRule:u,routeApprovalRuleDetails:d,setColumns:p,setRowsData:b,permissions:g,initialPageSize:O,t:m}),{isAdmin:L,permissions:{manageApprovalRules:N}}=g,x=L||N?s(X,{variant:"primary",onClick:()=>{window.location.href=f("","new")},"data-testid":"add-new-rule-button",children:m.addNewRule}):null,z=n||y?s(Y,{"data-testid":"approval-rules-skeleton",children:s(ee,{variant:"row",size:"small"})}):x;return G("div",{className:q(["purchase-orders",k]),"data-testid":"purchase-orders-container",children:[T?s(W,{headerText:m.headerText}):null,s(K,{totalCount:v,columns:i.columns,rows:i.rows,paginationConfig:S,loading:n||y,skeletonRowCount:h,pageSizeConfig:w,emptyTitle:m.emptyTitle,withWrapper:l,footer:z})]})};export{we as ApprovalRulesList,we as default};
//# sourceMappingURL=ApprovalRulesList.js.map
