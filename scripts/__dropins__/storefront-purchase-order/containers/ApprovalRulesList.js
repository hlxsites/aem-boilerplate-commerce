/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsxs as L,jsx as r}from"@dropins/tools/preact-jsx-runtime.js";import{classes as ae}from"@dropins/tools/lib.js";import{i as te,g as le,P as ne,d as oe}from"../chunks/pageSize.config.js";import{P as ie}from"../chunks/PurchaseOrdersHeader.js";import"../chunks/PurchaseOrderHistoryLogContent.js";import{ActionButton as F,Tag as ce,Button as de,Skeleton as ue,SkeletonRow as pe}from"@dropins/tools/components.js";import{useState as g,useCallback as C,useEffect as he,useMemo as W}from"@dropins/tools/preact-hooks.js";import"@dropins/tools/event-bus.js";import{u as me}from"../chunks/useCustomerRolePermissions.js";import{g as be,d as ge}from"../chunks/getPurchaseOrderApprovalRules.js";import{Text as P,useText as Pe}from"@dropins/tools/i18n.js";import"@dropins/tools/preact.js";import"../chunks/permissions.js";import"../chunks/fetch-graphql.js";import"@dropins/tools/fetch-graphql.js";import"../chunks/fetch-error.js";import"../chunks/transform-purchase-order-approval-rule.js";const X=[{key:"ruleName",label:"Rule Name"},{key:"status",label:"Status"},{key:"createdBy",label:"Created By"},{key:"action",label:"Actions"}],fe=20,Te=({routeApprovalRuleDetails:u,routeCreateApprovalRule:p,routeEditApprovalRule:h,setColumns:m,setRowsData:f,initialPageSize:E,permissions:v,loadingPermissions:S,t:l})=>{const[b,c]=g([]),[T,o]=g(!0),[x,i]=g(!0),[d,A]=g(E),[$,k]=g({currentPage:1,totalPages:1,totalCount:0}),[O,w]=g(new Set),{currentPage:R,totalPages:N,totalCount:Y}=$,V=C(s=>{k(t=>({...t,currentPage:s})),w(new Set),o(!0)},[]),ee=C(s=>{const t=s.target.value;A(e=>e.map(a=>({...a,selected:a.value===t}))),V(1),w(new Set),o(!0)},[V]),H=C(s=>{w(t=>{const e=new Set(t);return e.has(s)?e.delete(s):e.add(s),e})},[]);he(()=>{var e;if(!T||S)return;i(!0);const s=(e=d==null?void 0:d.find(a=>a.selected))==null?void 0:e.value,t=parseInt(s??fe.toString(),10);be(R,t).then(a=>{var B,z;const I=(a==null?void 0:a.items)??[],_=(B=a==null?void 0:a.pageInfo)==null?void 0:B.currentPage,y=(z=a==null?void 0:a.pageInfo)==null?void 0:z.totalPages,j=a==null?void 0:a.totalCount;k({currentPage:_>y?y||1:_,totalPages:y,totalCount:j}),c(I)}).catch(a=>{console.error("Error fetching approval rules:",a),c([])}).finally(()=>{i(!1),o(!1)})},[T,R,d,N,S]);const U=C((s,t)=>{let e="";switch(t){case"new":{e=p==null?void 0:p(s);break}case"edit":{e=h==null?void 0:h(s);break}case"view":{e=u==null?void 0:u(s);break}}return te(e??"")?e:"#"},[p,h,u]),re=W(()=>(m==null?void 0:m(X))??X.map(s=>({...s,label:l[s.key]||s.label})),[m,l]),M=C((s,t)=>{s.preventDefault(),i(!0),ge(t).then(()=>{o(!0)}).finally(()=>{i(!1)})},[]),se=W(()=>{const s=b==null?void 0:b.map((e,a)=>{var G,Z,q,J,K,Q;const{isAdmin:I,permissions:{manageApprovalRules:_}}=v,y=O.has(a),j=I||_,B=r(F,{onClick:()=>H(a),children:r(P,{id:`PurchaseOrders.purchaseOrdersTable.buttons.${y?"expandedHidden":"expandedShow"}`})}),z=L("div",{className:"b2b-purchase-order-purchase-orders-table__row-details",children:[L("div",{className:"b2b-purchase-order-purchase-orders-table__row-details-content",children:[L("p",{children:[r("span",{children:r(P,{id:"PurchaseOrders.purchaseOrdersTable.expandedRowLabels.ruleType"})})," ",r(P,{id:`PurchaseOrders.purchaseOrdersTable.ruleTypes.${(Z=(G=e.condition)==null?void 0:G.attribute)==null?void 0:Z.toLocaleLowerCase()}`})]}),r("p",{children:r("span",{children:r(P,{id:"PurchaseOrders.purchaseOrdersTable.expandedRowLabels.appliesTo"})})}),r("ul",{children:((q=e==null?void 0:e.appliesToRoles)==null?void 0:q.length)<=0?r("li",{children:l.appliesToAll}):(J=e==null?void 0:e.appliesToRoles)==null?void 0:J.map((n,D)=>r("li",{children:n.name},D))}),r("p",{children:r("span",{children:r(P,{id:"PurchaseOrders.purchaseOrdersTable.expandedRowLabels.approver"})})}),r("ul",{children:(K=e==null?void 0:e.approverRoles)==null?void 0:K.map((n,D)=>r("li",{children:n==null?void 0:n.name},D))})]}),j&&r("div",{className:"b2b-purchase-order-purchase-orders-table__row-details-action",children:L("div",{style:{display:"flex",gap:"8px"},children:[r(F,{onClick:()=>{const n=U(e.uid,"edit");window.location.href=n},"aria-label":l.ariaLabelEditRule.replace("{{ruleName}}",e.name),"data-testid":`edit-approval-rule-${e.uid}`,children:l.actionEdit}),r(F,{onClick:n=>M(n,e.uid),"aria-label":l.ariaLabelDeleteRule.replace("{{ruleName}}",e.name),"data-testid":`delete-approval-rule-${e.uid}`,children:l.actionDelete})]})})]});return{ruleName:e.name,status:r(ce,{className:`b2b-purchase-order-purchase-orders-table__status b2b-purchase-order-purchase-orders-table__status--${le(e.status)}`,children:r(P,{id:`PurchaseOrders.purchaseOrdersTable.rulesStatus.${(Q=e.status)==null?void 0:Q.toLocaleLowerCase()}`})}),createdBy:e.createdBy,action:B,_rowDetails:z}});let t=s;if(f){const e=f(s);e!==void 0&&Array.isArray(e)&&(t=e)}return t},[b,O,v,f,l,U,M,H]);return{tableConfig:{columns:re,rows:se,expandedRows:O},paginationConfig:{currentPage:R,totalPages:N,handlePageChange:V},pageSizeConfig:{pageSizeOptionsList:d,onChange:ee},totalCount:Y,loading:x,handleCreateUrl:U}},Ve=({routeCreateApprovalRule:u,routeEditApprovalRule:p,routeApprovalRuleDetails:h,setColumns:m,setRowsData:f,className:E="",withHeader:v=!0,withWrapper:S=!0,skeletonRowCount:l=5,initialPageSize:b=oe})=>{const c=Pe({headerText:"PurchaseOrders.approvalRulesList.containerTitle",ruleName:"PurchaseOrders.purchaseOrdersTable.tableColumns.ruleName",ruleType:"PurchaseOrders.purchaseOrdersTable.tableColumns.ruleType",appliesTo:"PurchaseOrders.purchaseOrdersTable.tableColumns.appliesTo",approver:"PurchaseOrders.purchaseOrdersTable.tableColumns.approver",createdBy:"PurchaseOrders.purchaseOrdersTable.tableColumns.createdBy",status:"PurchaseOrders.purchaseOrdersTable.tableColumns.status",actionEdit:"PurchaseOrders.purchaseOrdersTable.actionEdit",actionDelete:"PurchaseOrders.purchaseOrdersTable.actionDelete",addNewRule:"PurchaseOrders.approvalRulesList.buttons.newRule",actionView:"PurchaseOrders.purchaseOrdersTable.actionView",appliesToAll:"PurchaseOrders.purchaseOrdersTable.appliesToAll",emptyTitle:"PurchaseOrders.approvalRulesList.emptyTitle",ariaLabelEditRule:"PurchaseOrders.approvalRulesList.ariaLabel.editRule",ariaLabelDeleteRule:"PurchaseOrders.approvalRulesList.ariaLabel.deleteRule",ariaLabelViewRule:"PurchaseOrders.approvalRulesList.ariaLabel.viewRule"}),{permissions:T,loadingPermissions:o}=me(),{loading:x,tableConfig:i,paginationConfig:d,totalCount:A,pageSizeConfig:$,handleCreateUrl:k}=Te({routeCreateApprovalRule:u,routeEditApprovalRule:p,routeApprovalRuleDetails:h,setColumns:m,setRowsData:f,permissions:T,initialPageSize:b,loadingPermissions:o,t:c}),{isAdmin:O,permissions:{manageApprovalRules:w}}=T,R=O||w?r(de,{variant:"primary",onClick:()=>{window.location.href=k("","new")},"data-testid":"add-new-rule-button",children:c.addNewRule}):null,N=x||o?r(ue,{"data-testid":"approval-rules-skeleton",children:r(pe,{variant:"row",size:"small"})}):R;return L("div",{className:ae(["purchase-orders",E]),"data-testid":"purchase-orders-container",children:[v?r(ie,{headerText:c.headerText}):null,r(ne,{totalCount:A,columns:i.columns,rows:i.rows,expandedRows:i.expandedRows,paginationConfig:d,loading:x||o,skeletonRowCount:l,pageSizeConfig:$,emptyTitle:c.emptyTitle,withWrapper:S,footer:N})]})};export{Ve as ApprovalRulesList,Ve as default};
//# sourceMappingURL=ApprovalRulesList.js.map
