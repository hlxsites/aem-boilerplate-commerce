/*! Copyright 2026 Adobe
All Rights Reserved. */
import{jsxs as y,jsx as n,Fragment as qt}from"@dropins/tools/preact-jsx-runtime.js";import*as f from"@dropins/tools/preact-compat.js";import{useState as N,useEffect as rt,useCallback as x}from"@dropins/tools/preact-compat.js";import{a as Rt,d as Ct,u as It,g as ct,i as St}from"../chunks/addRequisitionListItemsToCart.js";import{Button as pt,Icon as st,Price as bt,Field as At,Input as Nt,Image as Tt,Checkbox as Et,Table as xt,ProgressSpinner as Vt,InLineAlert as Mt,Pagination as Pt}from"@dropins/tools/components.js";import{events as j}from"@dropins/tools/event-bus.js";import{useState as ot,useCallback as ut}from"@dropins/tools/preact-hooks.js";import{VComponent as Dt,classes as Ht}from"@dropins/tools/lib.js";import{D as dt}from"../chunks/RequisitionListForm.js";import{a as $t,u as Ft,E as Bt}from"../chunks/RequisitionListView.js";import{h as zt}from"@dropins/tools/preact.js";import{useText as gt}from"@dropins/tools/i18n.js";import{R as Wt}from"../chunks/RequisitionListHeader.js";import"../chunks/state.js";import{R as Ot}from"../chunks/RequisitionListModal.js";import{N as wt,P as Qt,a as jt}from"../chunks/PaginationItemsCounter.js";import"../chunks/updateRequisitionList.js";import"@dropins/tools/fetch-graphql.js";import"../chunks/deleteRequisitionList.js";const Zt=c=>f.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...c},f.createElement("g",{clipPath:"url(#clip0_102_196)"},f.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M18.3601 18.16H6.5601L4.8801 3H2.3501M19.6701 19.59C19.6701 20.3687 19.0388 21 18.2601 21C17.4814 21 16.8501 20.3687 16.8501 19.59C16.8501 18.8113 17.4814 18.18 18.2601 18.18C19.0388 18.18 19.6701 18.8113 19.6701 19.59ZM7.42986 19.59C7.42986 20.3687 6.79858 21 6.01986 21C5.24114 21 4.60986 20.3687 4.60986 19.59C4.60986 18.8113 5.24114 18.18 6.01986 18.18C6.79858 18.18 7.42986 18.8113 7.42986 19.59Z",stroke:"currentColor",strokeLinejoin:"round"}),f.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M5.25 6.37L20.89 8.06L20.14 14.8H6.19",stroke:"currentColor",strokeLinejoin:"round"})),f.createElement("defs",null,f.createElement("clipPath",{id:"clip0_102_196"},f.createElement("rect",{vectorEffect:"non-scaling-stroke",width:19.29,height:19.5,fill:"white",transform:"translate(2.3501 2.25)"})))),Kt=c=>f.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...c},f.createElement("path",{d:"M17.3332 11.75H6.6665",strokeWidth:1,strokeLinecap:"square",strokeLinejoin:"round",vectorEffect:"non-scaling-stroke",fill:"none",stroke:"currentColor"})),kt=c=>f.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",...c},f.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M1 5H23",stroke:"currentColor",strokeWidth:1,strokeMiterlimit:10}),f.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M17.3674 22H6.63446C5.67952 22 4.88992 21.2688 4.8379 20.3338L4 5H20L19.1621 20.3338C19.1119 21.2688 18.3223 22 17.3655 22H17.3674Z",stroke:"currentColor",strokeWidth:1,strokeMiterlimit:10}),f.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M9.87189 2H14.1281C14.6085 2 15 2.39766 15 2.88889V5H9V2.88889C9 2.39912 9.39006 2 9.87189 2Z",stroke:"currentColor",strokeWidth:1,strokeMiterlimit:10}),f.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M8.87402 8.58057L9.39348 17.682",stroke:"currentColor",strokeWidth:1,strokeMiterlimit:10}),f.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M14.6673 8.58057L14.146 17.682",stroke:"currentColor",strokeWidth:1,strokeMiterlimit:10}));function Xt(){const[c,V]=ot(null),[v,_]=ot(new Set),P=ut((R,C)=>{_(m=>{const L=new Set(m);return C?L.add(R):L.delete(R),L})},[]),T=ut(()=>{var C;const R=(C=c==null?void 0:c.items)==null?void 0:C.map(m=>m.uid);_(new Set(R))},[c]),d=ut(()=>{_(new Set)},[]);return{currentRequisitionList:c,setCurrentRequisitionList:V,selectedItems:v,setSelectedItems:_,handleItemSelection:P,handleSelectAll:T,handleSelectNone:d}}const Jt=({className:c,items:V,selectedItems:v,currentPage:_,pageSize:P,canEdit:T=!0,handleItemSelection:d,handleUpdateQuantity:R,onAddToCart:C,onDeleteItem:m,...L})=>{const[E,F]=ot({}),[at,B]=ot({}),w=gt({productNameHeader:"RequisitionList.RequisitionListView.productListTable.headers.productName",skuHeader:"RequisitionList.RequisitionListView.productListTable.headers.sku",priceHeader:"RequisitionList.RequisitionListView.productListTable.headers.price",quantityHeader:"RequisitionList.RequisitionListView.productListTable.headers.quantity",subtotalHeader:"RequisitionList.RequisitionListView.productListTable.headers.subtotal",actionsHeader:"RequisitionList.RequisitionListView.productListTable.headers.actions",actionAddToCart:"RequisitionList.RequisitionListView.actionAddToCart",actionDelete:"RequisitionList.RequisitionListView.actionDelete",actionSelect:"RequisitionList.RequisitionListView.actionSelect",itemQuantity:"RequisitionList.RequisitionListView.productListTable.itemQuantity",outOfStock:"RequisitionList.RequisitionListView.productListTable.outOfStock",onlyXLeftInStock:"RequisitionList.RequisitionListView.productListTable.onlyXLeftInStock"}),z=[{label:"#",key:"index"},{label:"item",key:"item"},{label:w.priceHeader,key:"price"},{label:w.quantityHeader,key:"quantity"},{label:w.subtotalHeader,key:"subtotal"}];T&&(z.unshift({label:w.actionSelect,key:"selector"}),z.push({label:w.actionsHeader,key:"actions"}));const J=(t,a)=>{const e=t.target.checked;d(a.uid,e)},W=t=>(_-1)*P+t+1,M=t=>{var a,e;return((a=t.configured_product)==null?void 0:a.name)||((e=t.product)==null?void 0:e.name)||t.sku},Y=t=>{var a,e,u,I,l,S;return(e=(a=t.configured_product)==null?void 0:a.images)!=null&&e.length?((u=t.configured_product.images[0])==null?void 0:u.url)||"":(l=(I=t.product)==null?void 0:I.images)!=null&&l.length&&((S=t.product.images[0])==null?void 0:S.url)||""},D=t=>{var a;return((a=t.product)==null?void 0:a.name)||t.sku},Z=t=>{var a;return(a=t.configured_product)==null?void 0:a.name},G=t=>t.bundle_options?t.bundle_options.map((e,u)=>y("span",{className:"requisition-list-view-product-list-table__product-configurable-name",children:[e.values[0].label," x ",e.values[0].quantity]},e.values[0].label||u)):void 0,K=t=>{var a;return((a=t.configured_product)==null?void 0:a.sku)||t.sku},H=t=>{var a,e,u,I,l,S,A,p;return Array.isArray(t.bundle_options)&&t.bundle_options.length>0?t.bundle_options.reduce((tt,X)=>{var et,it,nt;return tt+(((it=(et=X.values[0])==null?void 0:et.priceV2)==null?void 0:it.value)||0)*(((nt=X.values[0])==null?void 0:nt.quantity)||0)},0):((I=(u=(e=(a=t.configured_product)==null?void 0:a.price)==null?void 0:e.final)==null?void 0:u.amount)==null?void 0:I.value)||((p=(A=(S=(l=t.product)==null?void 0:l.price)==null?void 0:S.final)==null?void 0:A.amount)==null?void 0:p.value)||0},O=t=>{var a,e,u,I,l,S,A,p;return((I=(u=(e=(a=t.configured_product)==null?void 0:a.price)==null?void 0:e.final)==null?void 0:u.amount)==null?void 0:I.currency)||((p=(A=(S=(l=t.product)==null?void 0:l.price)==null?void 0:S.final)==null?void 0:A.amount)==null?void 0:p.currency)},o=t=>H(t)*t.quantity,g=(t,a)=>{const e=+t.target.value;e>0&&!Number.isNaN(t.target.value)&&B(u=>({...u,[a.uid]:e}))},Q=async(t,a)=>{let e=+t.target.value;if(!(e>0&&e!==a.quantity)){B(u=>({...u,[a.uid]:a.quantity}));return}F(u=>({...u,[a.uid]:!0}));try{await R(a.uid,e)}finally{F(u=>({...u,[a.uid]:!1}))}},U=V.map((t,a)=>({selector:n("label",{id:`item-selector-${t.sku}-label`,children:n(Et,{className:"requisition-list-view-product-list-table__checkbox",name:`item-selector-${t.sku}`,"aria-label":`${w.actionSelect} ${D(t)}`,"data-testid":`item-checkbox-${t.sku}`,onChange:e=>J(e,t),value:t.sku,checked:v.has(t.uid)})}),index:n("div",{className:"requisition-list-view-product-list-table__index-container",children:W(a)}),item:y("div",{className:"requisition-list-view-product-list-table__item-container",children:[n(Tt,{className:"requisition-list-view-product-list-table__thumbnail",alt:M(t),src:Y(t)}),y("div",{className:"requisition-list-view-product-list-table__item-details",children:[n("div",{className:"requisition-list-view-product-list-table__product-name",children:D(t)}),t.stock_status==="OUT_OF_STOCK"&&n("div",{className:"requisition-list-view-product-list-table__out-of-stock",children:w.outOfStock}),t.stock_status!=="OUT_OF_STOCK"&&t.only_x_left_in_stock!==null&&t.only_x_left_in_stock<t.quantity&&n("div",{className:"requisition-list-view-product-list-table__low-stock",children:w.onlyXLeftInStock.replace("{count}",String(t.only_x_left_in_stock))}),n("span",{className:"requisition-list-view-product-list-table__product-configurable-name",children:Z(t)}),n("div",{className:"requisition-list-view-product-list-table__sku",children:K(t)}),G(t)]})]}),price:n(bt,{className:"requisition-list-view-product-list-table__price",amount:H(t),currency:O(t)}),quantity:n("span",{className:"requisition-list-view-product-list-table__quantity",children:n(At,{disabled:!!E[t.uid],children:n(Nt,{id:`requisition-list-item-quantity-${t.sku}`,"data-testid":`requisition-list-item-quantity-${t.sku}`,name:"quantity",type:"text","aria-label":`${w.itemQuantity} - ${D(t)}`,value:at[t.uid]??t.quantity,onChange:e=>g(e,t),onBlur:e=>Q(e,t)})})}),subtotal:n(bt,{className:"requisition-list-view-product-list-table__price",amount:o(t),currency:O(t)}),actions:y("div",{className:"requisition-list-view__bulk-actions",children:[n(pt,{type:"button",onClick:()=>C([t.uid]),icon:n(st,{source:Zt}),"aria-label":`${w.actionAddToCart} - ${D(t)}`,"data-testid":"product-list-table-add-to-cart-button"}),n(pt,{type:"button",variant:"secondary",icon:n(st,{source:kt}),onClick:()=>m([t.uid]),"aria-label":`${w.actionDelete} - ${D(t)}`,"data-testid":"product-list-table-delete-button"})]})})),lt=n(xt,{columns:z,rowData:U,"data-testid":"product-list-table",mobileLayout:"stacked"});return n(Dt,{node:zt("div",{}),className:Ht(["requisition-list-view-product-list-table-container",c]),"data-testid":"product-list-table-container",...L,children:lt})},Yt=({selectedItems:c,deletingItemId:V,addingToCartItemId:v,bulkAddingToCart:_,updatingQuantityItemId:P,onSelectAll:T,onSelectNone:d,onBulkAddToCart:R,onBulkDelete:C})=>{const m=gt({statusDeleting:"RequisitionList.RequisitionListView.statusDeleting",actionSelectAll:"RequisitionList.RequisitionListView.actionSelectAll",actionSelectNone:"RequisitionList.RequisitionListView.actionSelectNone",actionAddToCart:"RequisitionList.RequisitionListView.actionAddToCart",actionDeleteSelectedItems:"RequisitionList.RequisitionListView.actionDeleteSelectedItems",statusBulkAddingToCart:"RequisitionList.RequisitionListView.statusBulkAddingToCart"}),L=V!==null||v!==null||_||P!==null,E=c.size>0;return y("div",{className:"requisition-list-view__batch-actions",children:[y("div",{className:"requisition-list-view__batch-actions-left",children:[n("button",{"data-testid":"bulk-actions-select-toggle-btn",type:"button",className:`requisition-list-view__batch-actions-select-toggle ${E?"requisition-list-view__batch-actions-select-toggle--active":""}`,onClick:E?d:T,disabled:L,"aria-label":E?m.actionSelectNone:m.actionSelectAll,children:n(st,{source:Kt})}),n("button",{type:"button",className:"requisition-list-view__batch-actions-select-label",onClick:E?d:T,disabled:L,children:m.actionSelectAll})]}),E&&y("div",{className:"requisition-list-view__batch-actions-buttons",children:[n("span",{className:"requisition-list-view__batch-actions-count-badge","aria-label":`${c.size} items selected`,children:c.size}),n(pt,{"data-testid":"bulk-actions-add-to-cart-btn",type:"button",variant:"secondary",onClick:R,disabled:L,children:_?m.statusBulkAddingToCart:m.actionAddToCart}),n("button",{"data-testid":"bulk-actions-delete-btn",type:"button",className:"requisition-list-view__batch-actions-delete-icon",onClick:C,disabled:L,"aria-label":m.actionDeleteSelectedItems,children:n(st,{source:kt})})]})]})},fe=({requisitionListUid:c,skipProductLoading:V=!1,pageSize:v=dt,routeRequisitionListGrid:_,fallbackRoute:P="/customer/account",getProductData:T,enrichConfigurableProducts:d})=>{var mt,ht,ft,_t,Lt;const[R,C]=N(!1),[m,L]=N(null),[E,F]=N(null),[at,B]=N(!1),[w,z]=N(null),[J,W]=N(!1),[M,Y]=N(v),[D,Z]=N(!0),[G,K]=N(!1),[H,O]=N([]),{currentRequisitionList:o,setCurrentRequisitionList:g,selectedItems:Q,setSelectedItems:U,handleItemSelection:lt,handleSelectAll:t,handleSelectNone:a}=Xt(),e=gt({emptyRequisitionList:"RequisitionList.RequisitionListView.emptyRequisitionList",errorLoadingProducts:"RequisitionList.RequisitionListView.errorLoadingProducts",errorLoadPage:"RequisitionList.RequisitionListView.errorLoadPage",notFoundTitle:"RequisitionList.RequisitionListView.notFoundTitle",notFoundMessage:"RequisitionList.RequisitionListView.notFoundMessage",notFoundActionLabel:"RequisitionList.RequisitionListView.notFoundActionLabel",notEnabledTitle:"RequisitionList.RequisitionListsNotEnabled.title",notEnabledMessage:"RequisitionList.RequisitionListsNotEnabled.message",partialMoveSuccess:"RequisitionList.RequisitionListAlert.partialMoveSuccess",notEnabledActionLabel:"RequisitionList.RequisitionListsNotEnabled.actionLabel",show:"RequisitionList.PageSizePicker.show",deleteItemsTitle:"RequisitionList.RequisitionListView.deleteItemsTitle",deleteItemsMessage:"RequisitionList.RequisitionListView.deleteItemsMessage",confirmAction:"RequisitionList.RequisitionListView.confirmAction",cancelAction:"RequisitionList.RequisitionListView.cancelAction"}),{alert:u,setAlert:I,handleRequisitionListAlert:l}=$t(),{isEnabled:S}=Ft();rt(()=>{const i=j.on("requisitionList/data",r=>{(r==null?void 0:r.uid)===c&&(g(r),U(new Set))}),s=j.on("requisitionList/alert",l);return()=>{i==null||i.off(),s==null||s.off()}},[l,c,g,U]),rt(()=>{Y(v)},[v]);const A=x(async i=>{var r;if(!((r=i.items)!=null&&r.length))return i;const s=await d(i.items);return{...i,items:s}},[d]),p=x(async i=>{var r,h;const s=((r=i.items)==null?void 0:r.map(k=>k.sku))||[];if(s.length===0)return i;C(!0);try{const k=await T(s);if(k){const q=new Map;return k.forEach(b=>{q.set(b.sku,b)}),{...i,items:(h=i.items)==null?void 0:h.map(b=>{const $=q.get(b.sku);return{...b,product:$||b.product,stock_status:b.stock_status||($==null?void 0:$.stock_status)||"IN_STOCK",only_x_left_in_stock:b.only_x_left_in_stock??($==null?void 0:$.only_x_left_in_stock)??null}})}}return console.warn("No products found"),i}catch(k){return console.warn(k instanceof Error?k.message:e.errorLoadingProducts),i}finally{C(!1)}},[T,e.errorLoadingProducts]);rt(()=>{if(!c){Z(!1);return}if(o&&o.uid===c)return;Z(!0),(async()=>{try{const s=await ct(c,1,v,d);if(s)if(V)g(s);else{const r=await p(s);g(r)}}catch(s){console.error("Failed to initialize requisition list from UID:",s)}finally{Z(!1)}})()},[c,v,V,d,p,g,o]);const tt=x(async i=>{i&&i.length===1?(B(!1),F(i)):(B(!0),F(null));try{const s=await Rt(o.uid,i),r=(i==null?void 0:i.length)||0,h=(s==null?void 0:s.length)||0,k=r-h;if(s&&s.length>0&&k>0){const q={action:"move",type:"error",context:"product",message:[e.partialMoveSuccess.replace("{successCount}",String(k)).replace("{failedCount}",String(h))]};l(q),j.emit("requisitionList/alert",q)}else if(s&&s.length>0){const q={action:"move",type:"error",context:"product",message:s.map(b=>b.message)};l(q),j.emit("requisitionList/alert",q)}else{const q={action:"move",type:"success",context:"product"};l(q),j.emit("requisitionList/alert",q)}}catch{const r={action:"move",type:"error",context:"product"};l(r),j.emit("requisitionList/alert",r)}finally{F(null),B(!1)}},[o,l,e]),X=x(i=>{i&&i.length>0&&(O(i),K(!0))},[]),et=x(async()=>{H.length===1?L(H[0]):L("bulk");try{const i=await Ct(o.uid,H,M,o.page_info.current_page,d);if(i){const s=await A(i),r=await p(s);g(r),l({action:"delete",type:"success",context:"product"})}else l({action:"delete",type:"error",context:"product"})}catch{l({action:"delete",type:"error",context:"product"})}finally{L(null),K(!1),O([])}},[H,o,M,p,g,l,A,d]),it=x(async(i,s)=>{var r;z(i);try{const h=(r=o.items)==null?void 0:r.find(b=>b.uid===i);if(!h){l({action:"update",type:"error",context:"product"});return}const k={item_id:h.uid,entered_options:h.entered_options,selected_options:h.selected_options,quantity:s},q=await It(o.uid,[k],M,o.page_info.current_page,d);if(q){const b=await p(q);g(b),l({action:"update",type:"success",context:"product"})}else l({action:"update",type:"error",context:"product"})}catch{l({action:"update",type:"error",context:"product"})}finally{z(null)}},[o,p,g,M,l,d]),nt=x(async i=>{W(!0);try{const s=await ct(o.uid,i,M,d);if(s){const h=await p(s);g(h)}else console.warn(e.errorLoadPage)}catch(s){console.warn(s instanceof Error?s.message:e.errorLoadPage)}finally{W(!1)}},[o==null?void 0:o.uid,p,M,e,g,d]),yt=x(async i=>{Y(i),W(!0);try{const s=await ct(o.uid,1,i,d);if(s){const h=await p(s);g(h)}else console.warn(e.errorLoadPage)}catch{console.warn(e.errorLoadPage)}finally{W(!1)}},[o==null?void 0:o.uid,p,e,g,d]),vt=x(async i=>{const s=await A(i),r=await p(s);g(r)},[g,p,A]);return y("div",{className:"requisition-list-view__container",children:[D?n("div",{className:"requisition-list-view__loading",children:n(Vt,{stroke:"4",size:"large"})}):S===!1?n(wt,{title:e.notEnabledTitle,message:e.notEnabledMessage,actionLabel:e.notEnabledActionLabel,onAction:()=>{window.location.href=P}}):!o||!St(o==null?void 0:o.uid)?n(wt,{title:e.notFoundTitle,message:e.notFoundMessage,actionLabel:_?e.notFoundActionLabel:void 0,onAction:_?()=>{const i=_();i&&typeof i=="string"&&(window.location.href=i)}:void 0}):y(qt,{children:[n(Wt,{requisitionList:o,routeRequisitionListGrid:_,onUpdate:vt,onAlert:l,enrichConfigurableProducts:d}),u&&n("div",{className:"requisition-list__alert-wrapper",children:n(Mt,{heading:u.description,type:u.type,variant:"primary",onDismiss:()=>I(null)})}),o.items_count===0?n(Bt,{textContent:`${o.name} ${e.emptyRequisitionList}`}):y(qt,{children:[n(Yt,{selectedItems:Q,deletingItemId:m,addingToCartItemId:E,bulkAddingToCart:at,updatingQuantityItemId:w,onSelectAll:t,onSelectNone:a,onBulkAddToCart:()=>tt(Array.from(Q)),onBulkDelete:()=>X(Array.from(Q))}),n(Jt,{items:o.items,selectedItems:Q,currentPage:((mt=o.page_info)==null?void 0:mt.current_page)||1,pageSize:((ht=o.page_info)==null?void 0:ht.page_size)||dt,handleItemSelection:lt,handleUpdateQuantity:it,onAddToCart:tt,onDeleteItem:X}),o.page_info&&y("div",{className:"requisition-list-view__pagination",children:[n(Qt,{pageInfo:o.page_info,totalCount:o.items_count}),(((ft=o.page_info)==null?void 0:ft.total_pages)||0)>1&&n(Pt,{totalPages:o.page_info.total_pages,currentPage:((_t=o.page_info)==null?void 0:_t.current_page)||1,onChange:nt,disabled:J||R}),y("div",{className:"requisition-list-view__pagination-picker",children:[n("span",{children:e.show}),n(jt,{currentPageSize:((Lt=o.page_info)==null?void 0:Lt.page_size)||dt,onPageSizeChange:yt,disabled:J||R})]})]})]})]}),G&&n(Ot,{isOpen:G,isLoading:m!==null,title:e.deleteItemsTitle,modalContent:e.deleteItemsMessage,confirmBtnCaption:e.confirmAction,closeBtnCaption:e.cancelAction,handleModalOnClose:()=>{K(!1),O([])},handleModalOnConfirm:et})]})};export{fe as RequisitionListView,fe as default};
//# sourceMappingURL=RequisitionListView.js.map
