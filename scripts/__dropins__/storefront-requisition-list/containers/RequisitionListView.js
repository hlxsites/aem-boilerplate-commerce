/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsxs as L,jsx as i,Fragment as de}from"@dropins/tools/preact-jsx-runtime.js";import*as d from"@dropins/tools/preact-compat.js";import{useState as A,useEffect as te,useCallback as T}from"@dropins/tools/preact-compat.js";import{b as be,a as ke,d as ve,u as ye,g as ie,i as Ce}from"../chunks/addRequisitionListItemsToCart.js";import{Icon as Q,Button as U,Price as pe,Field as Re,Input as Se,Image as Ie,Checkbox as Pe,Table as Ae,ProgressSpinner as Ee,InLineAlert as Ne,Pagination as xe}from"@dropins/tools/components.js";import{events as me}from"@dropins/tools/event-bus.js";import{useState as ge,useCallback as ne}from"@dropins/tools/preact-hooks.js";import{classes as he,VComponent as Te}from"@dropins/tools/lib.js";import{D as G}from"../chunks/RequisitionListForm.js";import"../chunks/state.js";import{u as Ve,E as Me}from"../chunks/RequisitionListView.js";import{h as De}from"@dropins/tools/preact.js";import{useText as oe}from"@dropins/tools/i18n.js";import{R as He}from"../chunks/RequisitionListHeader.js";import{R as Be}from"../chunks/RequisitionListModal.js";import{P as ze}from"../chunks/PageSizePicker.js";import"../chunks/updateRequisitionList.js";import"@dropins/tools/fetch-graphql.js";import"../chunks/deleteRequisitionList.js";function Fe(){const[s,S]=ge(null),[h,p]=ge(new Set),y=ne((b,I)=>{p(g=>{const k=new Set(g);return I?k.add(b):k.delete(b),k})},[]),C=ne(()=>{var I;const b=(I=s==null?void 0:s.items)==null?void 0:I.map(g=>g.uid);p(new Set(b))},[s]),E=ne(()=>{p(new Set)},[]);return{currentRequisitionList:s,setCurrentRequisitionList:S,selectedItems:h,setSelectedItems:p,handleItemSelection:y,handleSelectAll:C,handleSelectNone:E}}const $e=s=>d.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...s},d.createElement("g",{clipPath:"url(#clip0_102_196)"},d.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M18.3601 18.16H6.5601L4.8801 3H2.3501M19.6701 19.59C19.6701 20.3687 19.0388 21 18.2601 21C17.4814 21 16.8501 20.3687 16.8501 19.59C16.8501 18.8113 17.4814 18.18 18.2601 18.18C19.0388 18.18 19.6701 18.8113 19.6701 19.59ZM7.42986 19.59C7.42986 20.3687 6.79858 21 6.01986 21C5.24114 21 4.60986 20.3687 4.60986 19.59C4.60986 18.8113 5.24114 18.18 6.01986 18.18C6.79858 18.18 7.42986 18.8113 7.42986 19.59Z",stroke:"currentColor",strokeLinejoin:"round"}),d.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M5.25 6.37L20.89 8.06L20.14 14.8H6.19",stroke:"currentColor",strokeLinejoin:"round"})),d.createElement("defs",null,d.createElement("clipPath",{id:"clip0_102_196"},d.createElement("rect",{vectorEffect:"non-scaling-stroke",width:19.29,height:19.5,fill:"white",transform:"translate(2.3501 2.25)"})))),We=s=>d.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...s},d.createElement("path",{d:"M17.3332 11.75H6.6665",strokeWidth:1,strokeLinecap:"square",strokeLinejoin:"round",vectorEffect:"non-scaling-stroke",fill:"none",stroke:"currentColor"})),je=s=>d.createElement("svg",{id:"Icon_Search_Base","data-name":"Icon \\u2013 Search \\u2013 Base",xmlns:"http://www.w3.org/2000/svg",width:24,height:24,fill:"none",viewBox:"0 0 24 24",...s},d.createElement("g",{id:"Large"},d.createElement("rect",{id:"Placement_area","data-name":"Placement area",width:24,height:24,fill:"#fff",opacity:0}),d.createElement("g",{id:"Search_icon","data-name":"Search icon",transform:"translate(3.75 3.75)"},d.createElement("circle",{vectorEffect:"non-scaling-stroke",id:"Ellipse_186","data-name":"Ellipse 186",cx:6,cy:6,r:6,fill:"none",stroke:"currentColor"}),d.createElement("line",{vectorEffect:"non-scaling-stroke",id:"Line_556","data-name":"Line 556",x2:6,y2:6,transform:"translate(10.5 10.5)",fill:"none",stroke:"currentColor"})))),fe=s=>d.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",...s},d.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M1 5H23",stroke:"currentColor",strokeWidth:1,strokeMiterlimit:10}),d.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M17.3674 22H6.63446C5.67952 22 4.88992 21.2688 4.8379 20.3338L4 5H20L19.1621 20.3338C19.1119 21.2688 18.3223 22 17.3655 22H17.3674Z",stroke:"currentColor",strokeWidth:1,strokeMiterlimit:10}),d.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M9.87189 2H14.1281C14.6085 2 15 2.39766 15 2.88889V5H9V2.88889C9 2.39912 9.39006 2 9.87189 2Z",stroke:"currentColor",strokeWidth:1,strokeMiterlimit:10}),d.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M8.87402 8.58057L9.39348 17.682",stroke:"currentColor",strokeWidth:1,strokeMiterlimit:10}),d.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M14.6673 8.58057L14.146 17.682",stroke:"currentColor",strokeWidth:1,strokeMiterlimit:10})),Qe=({className:s,title:S="404 - Not Found",message:h="The requisition list you are looking for does not exist.",actionLabel:p,onAction:y,...C})=>L("div",{className:he(["not-found",s]),"data-testid":"not-found",...C,children:[i(Q,{source:je,size:"64",stroke:"2"}),i("h2",{children:S}),h&&i("p",{children:h}),p&&y&&i(U,{variant:"primary",onClick:y,children:p})]}),Ze=({className:s,items:S,selectedItems:h,currentPage:p,pageSize:y,canEdit:C=!0,handleItemSelection:E,handleUpdateQuantity:b,onAddToCart:I,onDeleteItem:g,...k})=>{const f=oe({productNameHeader:"RequisitionList.RequisitionListView.productListTable.headers.productName",skuHeader:"RequisitionList.RequisitionListView.productListTable.headers.sku",priceHeader:"RequisitionList.RequisitionListView.productListTable.headers.price",quantityHeader:"RequisitionList.RequisitionListView.productListTable.headers.quantity",subtotalHeader:"RequisitionList.RequisitionListView.productListTable.headers.subtotal",actionsHeader:"RequisitionList.RequisitionListView.productListTable.headers.actions",actionAddToCart:"RequisitionList.RequisitionListView.actionAddToCart",actionDelete:"RequisitionList.RequisitionListView.actionDelete",itemQuantity:"RequisitionList.RequisitionListView.productListTable.itemQuantity"}),z=[{label:"#",key:"index"},{label:"item",key:"item"},{label:f.priceHeader,key:"price"},{label:f.quantityHeader,key:"quantity"},{label:f.subtotalHeader,key:"subtotal"}];C&&(z.unshift({label:"",key:"selector"}),z.push({label:f.actionsHeader,key:"actions"}));const Z=(e,a)=>{const c=e.target.checked;E(a.uid,c)},O=e=>(p-1)*y+e+1,H=e=>{var a,c;return((a=e.configured_product)==null?void 0:a.name)||((c=e.product)==null?void 0:c.name)||e.sku},x=e=>{var a,c,w,P;return(a=e.configured_product)!=null&&a.images?(c=e.configured_product.images[0])==null?void 0:c.url:(w=e.product)!=null&&w.images?(P=e.product.images[0])==null?void 0:P.url:""},J=e=>{var a;return((a=e.product)==null?void 0:a.name)||e.sku},ee=e=>{var a;return(a=e.configured_product)==null?void 0:a.name},F=e=>e.bundle_options?e.bundle_options.map((c,w)=>L("span",{className:"requisition-list-view-product-list-table__product-configurable-name",children:[c.values[0].label," x ",c.values[0].quantity]},c.values[0].label||w)):void 0,K=e=>{var a;return((a=e.configured_product)==null?void 0:a.sku)||e.sku},B=e=>{var a,c,w,P,r,N,M,l;return Array.isArray(e.bundle_options)&&e.bundle_options.length>0?e.bundle_options.reduce((_,W)=>{var j,X,Y;return _+(((X=(j=W.values[0])==null?void 0:j.priceV2)==null?void 0:X.value)||0)*(((Y=W.values[0])==null?void 0:Y.quantity)||0)},0):((P=(w=(c=(a=e.configured_product)==null?void 0:a.price)==null?void 0:c.final)==null?void 0:w.amount)==null?void 0:P.value)||((l=(M=(N=(r=e.product)==null?void 0:r.price)==null?void 0:N.final)==null?void 0:M.amount)==null?void 0:l.value)||0},V=e=>{var a,c,w,P,r,N,M,l;return((P=(w=(c=(a=e.configured_product)==null?void 0:a.price)==null?void 0:c.final)==null?void 0:w.amount)==null?void 0:P.currency)||((l=(M=(N=(r=e.product)==null?void 0:r.price)==null?void 0:N.final)==null?void 0:M.amount)==null?void 0:l.currency)},$=e=>B(e)*e.quantity,t=S.map((e,a)=>({selector:i(Pe,{className:"requisition-list-view-product-list-table__checkbox",name:"itemSelected","data-testid":`item-checkbox-${e.sku}`,onChange:c=>Z(c,e),value:e.sku,checked:h.has(e.uid)}),index:i("div",{className:"requisition-list-view-product-list-table__index-container",children:O(a)}),item:L("div",{className:"requisition-list-view-product-list-table__item-container",children:[i(Ie,{className:"requisition-list-view-product-list-table__thumbnail",alt:H(e),src:x(e)}),L("div",{className:"requisition-list-view-product-list-table__item-details",children:[i("div",{className:"requisition-list-view-product-list-table__product-name",children:J(e)}),i("span",{className:"requisition-list-view-product-list-table__product-configurable-name",children:ee(e)}),i("div",{className:"requisition-list-view-product-list-table__sku",children:K(e)}),F(e)]})]}),price:i(pe,{className:"requisition-list-view-product-list-table__price",amount:B(e),currency:V(e)}),quantity:i("span",{className:"requisition-list-view-product-list-table__quantity",children:i(Re,{disabled:!1,children:i(Se,{id:`requisition-list-item-quantity-${e.sku}`,"data-testid":`requisition-list-item-quantity-${e.sku}`,name:"quantity",type:"text",value:e.quantity,onBlur:c=>{const w=Number.parseInt(c.target.value,10);b(e.uid,w)}})})}),subtotal:i(pe,{className:"requisition-list-view-product-list-table__price",amount:$(e),currency:V(e)}),actions:L("div",{className:"requisition-list-view__bulk-actions",children:[i(U,{type:"button",onClick:()=>I([e.uid]),icon:i(Q,{source:$e}),"data-testid":"product-list-table-add-to-cart-button"}),i(U,{type:"button",variant:"secondary",icon:i(Q,{source:fe}),onClick:()=>g([e.uid]),"data-testid":"product-list-table-delete-button"})]})})),m=i(Ae,{columns:z,rowData:t,"data-testid":"product-list-table",mobileLayout:"stacked"});return i(Te,{node:De("div",{}),className:he(["requisition-list-view-product-list-table-container",s]),"data-testid":"product-list-table-container",...k,children:m})},Oe=({selectedItems:s,deletingItemId:S,addingToCartItemId:h,bulkAddingToCart:p,updatingQuantityItemId:y,onSelectAll:C,onSelectNone:E,onBulkAddToCart:b,onBulkDelete:I})=>{const g=oe({statusDeleting:"RequisitionList.RequisitionListView.statusDeleting",actionSelectAll:"RequisitionList.RequisitionListView.actionSelectAll",actionSelectNone:"RequisitionList.RequisitionListView.actionSelectNone",actionAddToCart:"RequisitionList.RequisitionListView.actionAddToCart",actionDeleteSelectedItems:"RequisitionList.RequisitionListView.actionDeleteSelectedItems",statusBulkAddingToCart:"RequisitionList.RequisitionListView.statusBulkAddingToCart"}),k=S!==null||h!==null||p||y!==null,f=s.size>0;return L("div",{className:"requisition-list-view__batch-actions",children:[L("div",{className:"requisition-list-view__batch-actions-left",children:[i("button",{"data-testid":"bulk-actions-select-toggle-btn",type:"button",className:`requisition-list-view__batch-actions-select-toggle ${f?"requisition-list-view__batch-actions-select-toggle--active":""}`,onClick:f?E:C,disabled:k,"aria-label":f?g.actionSelectNone:g.actionSelectAll,children:i(Q,{source:We})}),i("button",{type:"button",className:"requisition-list-view__batch-actions-select-label",onClick:f?E:C,disabled:k,children:g.actionSelectAll})]}),f&&L("div",{className:"requisition-list-view__batch-actions-buttons",children:[i("span",{className:"requisition-list-view__batch-actions-count-badge","aria-label":`${s.size} items selected`,children:s.size}),i(U,{"data-testid":"bulk-actions-add-to-cart-btn",type:"button",variant:"secondary",onClick:b,disabled:k,children:p?g.statusBulkAddingToCart:g.actionAddToCart}),i("button",{"data-testid":"bulk-actions-delete-btn",type:"button",className:"requisition-list-view__batch-actions-delete-icon",onClick:I,disabled:k,"aria-label":g.actionDeleteSelectedItems,children:i(Q,{source:fe})})]})]})},pt=({requisitionListUid:s,skipProductLoading:S=!1,pageSize:h=G,routeRequisitionListGrid:p})=>{var se,ae,re,ce,le;const[y,C]=A(!1),[E,b]=A(null),[I,g]=A(null),[k,f]=A(!1),[z,Z]=A(null),[O,H]=A(!1),[x,J]=A(h),[ee,F]=A(!0),[K,B]=A(!1),[V,$]=A([]),{currentRequisitionList:t,setCurrentRequisitionList:m,selectedItems:e,setSelectedItems:a,handleItemSelection:c,handleSelectAll:w,handleSelectNone:P}=Fe(),r=oe({emptyRequisitionList:"RequisitionList.RequisitionListView.emptyRequisitionList",errorLoadingProducts:"RequisitionList.RequisitionListView.errorLoadingProducts",errorLoadPage:"RequisitionList.RequisitionListView.errorLoadPage",notFoundTitle:"RequisitionList.RequisitionListView.notFoundTitle",notFoundMessage:"RequisitionList.RequisitionListView.notFoundMessage",notFoundActionLabel:"RequisitionList.RequisitionListView.notFoundActionLabel",show:"RequisitionList.RequisitionListView.show",itemsCounter:"RequisitionList.RequisitionListView.itemsCounter",deleteItemsTitle:"RequisitionList.RequisitionListView.deleteItemsTitle",deleteItemsMessage:"RequisitionList.RequisitionListView.deleteItemsMessage",confirmAction:"RequisitionList.RequisitionListView.confirmAction",cancelAction:"RequisitionList.RequisitionListView.cancelAction"}),{alert:N,setAlert:M,handleRequisitionListAlert:l}=Ve();te(()=>{const n=me.on("requisitionList/data",u=>{(u==null?void 0:u.uid)===s&&(m(u),a(new Set))}),o=me.on("requisitionList/alert",l);return()=>{n==null||n.off(),o==null||o.off()}},[l,s,m,a]),te(()=>{J(h)},[h]);const _=T(async n=>{var u,v;const o=((u=n.items)==null?void 0:u.map(R=>R.sku))||[];if(o.length===0)return n;C(!0);try{const R=await be(o);if(R){const D=new Map;return R.forEach(q=>{D.set(q.sku,q)}),{...n,items:(v=n.items)==null?void 0:v.map(q=>({...q,product:D.get(q.sku)||q.product}))}}return console.warn("No products found"),n}catch(R){return console.warn(R instanceof Error?R.message:r.errorLoadingProducts),n}finally{C(!1)}},[r.errorLoadingProducts]);te(()=>{if(!s){F(!1);return}if(t&&t.uid===s)return;F(!0),(async()=>{try{const o=await ie(s,1,h);if(o)if(S)m(o);else{const u=await _(o);m(u)}}catch(o){console.error("Failed to initialize requisition list from UID:",o)}finally{F(!1)}})()},[s,h,S,_,m,t]);const W=T(async n=>{n&&n.length===1?(f(!1),g(n)):(f(!0),g(null));try{const o=await ke(t.uid,n);o&&o.length>0?l({action:"move",type:"error",context:"product",message:o.map(u=>u.message)}):l({action:"move",type:"success",context:"product"})}catch{l({action:"move",type:"error",context:"product"})}finally{g(null),f(!1)}},[t,l]),j=T(n=>{n&&n.length>0&&($(n),B(!0))},[]),X=T(async()=>{V.length===1?b(V[0]):b("bulk");try{const n=await ve(t.uid,V,x,t.page_info.current_page);if(n){const o=await _(n);m(o),l({action:"delete",type:"success",context:"product"})}else l({action:"delete",type:"error",context:"product"})}catch{l({action:"delete",type:"error",context:"product"})}finally{b(null),B(!1),$([])}},[V,t,x,_,m,l]),Y=T(async(n,o)=>{var u;Z(n);try{const v=(u=t.items)==null?void 0:u.find(q=>q.uid===n);if(!v){l({action:"update",type:"error",context:"product"});return}const R={item_id:v.uid,entered_options:v.entered_options,selected_options:v.selected_options,quantity:o},D=await ye(t.uid,[R],x,t.page_info.current_page);if(D){const q=await _(D);m(q),l({action:"update",type:"success",context:"product"})}else l({action:"update",type:"error",context:"product"})}catch{l({action:"update",type:"error",context:"product"})}finally{Z(null)}},[t,_,m,x,l]),we=T(async n=>{H(!0);try{const o=await ie(t.uid,n,x);if(o){const u=await _(o);m(u)}else console.warn(r.errorLoadPage)}catch(o){console.warn(o instanceof Error?o.message:r.errorLoadPage)}finally{H(!1)}},[t==null?void 0:t.uid,_,x,r,m]),_e=T(async n=>{J(n),H(!0);try{const o=await ie(t.uid,1,n);if(o){const u=await _(o);m(u)}else console.warn(r.errorLoadPage)}catch{console.warn(r.errorLoadPage)}finally{H(!1)}},[t==null?void 0:t.uid,_,r,m]),qe=T(async n=>{const o=await _(n);m(o)},[m,_]),Le=()=>{var q,ue;const n=((q=t.page_info)==null?void 0:q.page_size)??G,o=((ue=t.page_info)==null?void 0:ue.current_page)??1,u=n*o,v=(t==null?void 0:t.items_count)??0,R=u-n+1,D=u>v?v:u;return i("span",{className:"requisition-list-view__pagination-items",children:r.itemsCounter.replace("{from}",R.toString()).replace("{to}",D.toString()).replace("{total}",v.toString())})};return L("div",{className:"requisition-list-view__container",children:[ee?i("div",{className:"requisition-list-view__loading",children:i(Ee,{stroke:"4",size:"large"})}):!t||!Ce(t==null?void 0:t.uid)?i(Qe,{title:r.notFoundTitle,message:r.notFoundMessage,actionLabel:p?r.notFoundActionLabel:void 0,onAction:p?()=>{const n=p();n&&typeof n=="string"&&(window.location.href=n)}:void 0}):L(de,{children:[i(He,{requisitionList:t,routeRequisitionListGrid:p,onUpdate:qe,onAlert:l}),N&&i("div",{className:"requisition-list__alert-wrapper",children:i(Ne,{heading:N.description,type:N.type,variant:"primary",onDismiss:()=>M(null)})}),t.items_count===0?i(Me,{textContent:`${t.name} ${r.emptyRequisitionList}`}):L(de,{children:[i(Oe,{selectedItems:e,deletingItemId:E,addingToCartItemId:I,bulkAddingToCart:k,updatingQuantityItemId:z,onSelectAll:w,onSelectNone:P,onBulkAddToCart:()=>W(Array.from(e)),onBulkDelete:()=>j(Array.from(e))}),i(Ze,{items:t.items,selectedItems:e,currentPage:((se=t.page_info)==null?void 0:se.current_page)||1,pageSize:((ae=t.page_info)==null?void 0:ae.page_size)||G,handleItemSelection:c,handleUpdateQuantity:Y,onAddToCart:W,onDeleteItem:j}),t.page_info&&L("div",{className:"requisition-list-view__pagination",children:[Le(),(((re=t.page_info)==null?void 0:re.total_pages)||0)>1&&i(xe,{totalPages:t.page_info.total_pages,currentPage:((ce=t.page_info)==null?void 0:ce.current_page)||1,onChange:we,disabled:O||y}),L("div",{className:"requisition-list-view__pagination-picker",children:[i("span",{children:r.show}),i(ze,{currentPageSize:((le=t.page_info)==null?void 0:le.page_size)||G,onPageSizeChange:_e,disabled:O||y})]})]})]})]}),K&&i(Be,{isOpen:K,isLoading:E!==null,title:r.deleteItemsTitle,modalContent:r.deleteItemsMessage,confirmBtnCaption:r.confirmAction,closeBtnCaption:r.cancelAction,handleModalOnClose:()=>{B(!1),$([])},handleModalOnConfirm:X})]})};export{pt as RequisitionListView,pt as default};
//# sourceMappingURL=RequisitionListView.js.map
