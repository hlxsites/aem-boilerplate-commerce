/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsxs as N,jsx as i,Fragment as nt}from"@dropins/tools/preact-jsx-runtime.js";import*as p from"@dropins/tools/preact-compat.js";import{useState as P,useEffect as K,useCallback as T}from"@dropins/tools/preact-compat.js";import{b as st,a as ot,d as at,u as rt,g as Y}from"../chunks/addRequisitionListItemsToCart.js";import{Button as E,Icon as J,Field as lt,Input as ct,Price as U,Checkbox as ut,Table as dt,Header as pt,InLineAlert as mt,Pagination as ht}from"@dropins/tools/components.js";import{events as f}from"@dropins/tools/event-bus.js";import{useState as tt,useCallback as O}from"@dropins/tools/preact-hooks.js";import{VComponent as Lt,classes as qt}from"@dropins/tools/lib.js";/* empty css                            */import{u as ft}from"../chunks/PageSizePicker2.js";import{h as gt}from"@dropins/tools/preact.js";import{useText as X}from"@dropins/tools/i18n.js";import{E as yt,P as wt}from"../chunks/PageSizePicker.js";import"../chunks/transform-requisition-list.js";import"@dropins/tools/fetch-graphql.js";import"../chunks/RequisitionListItemsFragment.graphql.js";function kt(o){const[c,m]=tt(o),[h,u]=tt(new Set),_=O((L,r)=>{u(k=>{const g=new Set(k);return r?g.add(L):g.delete(L),g})},[]),w=O(()=>{var r;const L=(r=c.items)==null?void 0:r.map(k=>k.uid);u(new Set(L))},[c]),v=O(()=>{u(new Set)},[]);return{currentRequisitionList:c,setCurrentRequisitionList:m,selectedItems:h,setSelectedItems:u,handleItemSelection:_,handleSelectAll:w,handleSelectNone:v}}const et=o=>p.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...o},p.createElement("g",{clipPath:"url(#clip0_102_196)"},p.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M18.3601 18.16H6.5601L4.8801 3H2.3501M19.6701 19.59C19.6701 20.3687 19.0388 21 18.2601 21C17.4814 21 16.8501 20.3687 16.8501 19.59C16.8501 18.8113 17.4814 18.18 18.2601 18.18C19.0388 18.18 19.6701 18.8113 19.6701 19.59ZM7.42986 19.59C7.42986 20.3687 6.79858 21 6.01986 21C5.24114 21 4.60986 20.3687 4.60986 19.59C4.60986 18.8113 5.24114 18.18 6.01986 18.18C6.79858 18.18 7.42986 18.8113 7.42986 19.59Z",stroke:"currentColor",strokeLinejoin:"round"}),p.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M5.25 6.37L20.89 8.06L20.14 14.8H6.19",stroke:"currentColor",strokeLinejoin:"round"})),p.createElement("defs",null,p.createElement("clipPath",{id:"clip0_102_196"},p.createElement("rect",{vectorEffect:"non-scaling-stroke",width:19.29,height:19.5,fill:"white",transform:"translate(2.3501 2.25)"})))),it=o=>p.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",...o},p.createElement("path",{d:"M1 5H23",stroke:"currentColor",strokeWidth:1.5,strokeMiterlimit:10}),p.createElement("path",{d:"M17.3674 22H6.63446C5.67952 22 4.88992 21.2688 4.8379 20.3338L4 5H20L19.1621 20.3338C19.1119 21.2688 18.3223 22 17.3655 22H17.3674Z",stroke:"currentColor",strokeWidth:1.5,strokeMiterlimit:10}),p.createElement("path",{d:"M9.87189 2H14.1281C14.6085 2 15 2.39766 15 2.88889V5H9V2.88889C9 2.39912 9.39006 2 9.87189 2Z",stroke:"currentColor",strokeWidth:1.5,strokeMiterlimit:10}),p.createElement("path",{d:"M8.87402 8.58057L9.39348 17.682",stroke:"currentColor",strokeWidth:1.5,strokeMiterlimit:10}),p.createElement("path",{d:"M14.6673 8.58057L14.146 17.682",stroke:"currentColor",strokeWidth:1.5,strokeMiterlimit:10})),bt=({className:o,items:c,selectedItems:m,currentPage:h,pageSize:u,canEdit:_=!0,handleItemSelection:w,handleUpdateQuantity:v,onAddToCart:L,onDeleteItem:r,...k})=>{const g=X({productNameHeader:"RequisitionList.RequisitionListView.productListTable.headers.productName",skuHeader:"RequisitionList.RequisitionListView.productListTable.headers.sku",priceHeader:"RequisitionList.RequisitionListView.productListTable.headers.price",quantityHeader:"RequisitionList.RequisitionListView.productListTable.headers.quantity",subtotalHeader:"RequisitionList.RequisitionListView.productListTable.headers.subtotal",actionsHeader:"RequisitionList.RequisitionListView.productListTable.headers.actions",actionAddToCart:"RequisitionList.RequisitionListView.actionAddToCart",actionDelete:"RequisitionList.RequisitionListView.actionDelete",itemQuantity:"RequisitionList.RequisitionListView.productListTable.itemQuantity"}),x=[{label:"#",key:"index"},{label:"item",key:"item"},{label:g.priceHeader,key:"price"},{label:g.quantityHeader,key:"quantity"},{label:g.subtotalHeader,key:"subtotal"}];_&&(x.unshift({label:"",key:"checkbox"}),x.push({label:g.actionsHeader,key:"actions"}));const I=(s,n)=>{const a=s.target.checked;w(n.uid,a)},A=c.map((s,n)=>{var a,S,H,$,W,j,q,V,Z,M,d,D,z,F,Q,G,t;return{index:i("span",{children:(h-1)*u+n+1}),item:N("div",{style:"display: inline-block",children:[i("div",{style:"float: left;",children:i(ut,{className:"requisition-list-view-product-list-table__checkbox",name:"itemSelected","data-testid":`item-checkbox-${s.sku}`,onChange:e=>I(e,s),value:s.sku,checked:m.has(s.uid)})}),i("div",{className:"requisition-list-view-product-list-table__product-name",children:((a=s.product)==null?void 0:a.name)||s.sku}),i("div",{className:"requisition-list-view-product-list-table__sku",children:s.sku})]}),price:i(U,{className:"requisition-list-view-product-list-table__price",amount:(W=($=(H=(S=s.product)==null?void 0:S.price)==null?void 0:H.final)==null?void 0:$.amount)==null?void 0:W.value,currency:(Z=(V=(q=(j=s.product)==null?void 0:j.price)==null?void 0:q.final)==null?void 0:V.amount)==null?void 0:Z.currency}),subtotal:i(U,{className:"requisition-list-view-product-list-table__price",amount:((z=(D=(d=(M=s.product)==null?void 0:M.price)==null?void 0:d.final)==null?void 0:D.amount)==null?void 0:z.value)*s.quantity,currency:(t=(G=(Q=(F=s.product)==null?void 0:F.price)==null?void 0:Q.final)==null?void 0:G.amount)==null?void 0:t.currency}),quantity:i("span",{className:"requisition-list-view-product-list-table__quantity",children:i(lt,{disabled:!1,children:i(ct,{id:"requisition-list-item-quantity",name:"quantity",type:"text",value:s.quantity,onBlur:e=>{const l=Number.parseInt(e.target.value,10);v(s.uid,l)}})})}),actions:N("div",{className:"requisition-list-view__bulk-actions",children:[i(E,{type:"button",onClick:()=>L([s.uid]),icon:i(J,{source:et}),"data-testid":"product-list-table-add-to-cart-button"}),i(E,{type:"button",variant:"secondary",icon:i(J,{source:it}),onClick:()=>r([s.uid]),"data-testid":"product-list-table-delete-button"})]})}}),R=i(dt,{columns:x,rowData:A,"data-testid":"product-list-table",mobileLayout:"stacked"});return i(Lt,{node:gt("div",{}),className:qt(["requisition-list-view-product-list-table-container",o]),"data-testid":"product-list-table-container",...k,children:R})},Rt=({selectedItems:o,deletingItemId:c,addingToCartItemId:m,bulkAddingToCart:h,updatingQuantityItemId:u,onSelectAll:_,onSelectNone:w,onBulkAddToCart:v,onBulkDelete:L})=>{const r=X({statusDeleting:"RequisitionList.RequisitionListView.statusDeleting",actionDeleteSelected:"RequisitionList.RequisitionListView.actionDeleteSelected",actionSelectAll:"RequisitionList.RequisitionListView.actionSelectAll",actionSelectNone:"RequisitionList.RequisitionListView.actionSelectNone",actionAddToCart:"RequisitionList.RequisitionListView.actionAddToCart",actionAddSelectedToCart:"RequisitionList.RequisitionListView.actionAddSelectedToCart",statusBulkAddingToCart:"RequisitionList.RequisitionListView.statusBulkAddingToCart"});return N("div",{class:"requisition-list-view__bulk-actions",children:[i(E,{"data-testid":"bulk-actions-select-all-btn",type:"button",variant:"secondary",onClick:_,disabled:c!==null||m!==null||h||u!==null,children:r.actionSelectAll}),i(E,{"data-testid":"bulk-actions-select-none-btn",type:"button",variant:"secondary",onClick:w,disabled:c!==null||m!==null||h||u!==null||o.size===0,children:r.actionSelectNone}),o.size>0&&i(E,{"data-testid":"bulk-actions-add-to-cart-btn",type:"button",variant:"primary",onClick:v,icon:i(J,{source:et}),disabled:c!==null||m!==null||h||u!==null,children:h?r.statusBulkAddingToCart:`${r.actionAddSelectedToCart} (${o.size})`}),o.size>0&&i(E,{"data-testid":"bulk-actions-delete-all-btn",type:"button",variant:"secondary",onClick:L,icon:i(J,{source:it}),disabled:c!==null||m!==null||h||u!==null,children:c==="bulk"?r.statusDeleting:`${r.actionDeleteSelected} (${o.size})`})]})},Bt=({requisitionList:o,skipProductLoading:c=!1,pageSize:m=10})=>{const[h,u]=P(!1),[_,w]=P(null),[v,L]=P(null),[r,k]=P(!1),[g,x]=P(null),[I,A]=P(!1),[R,s]=P(m),{currentRequisitionList:n,setCurrentRequisitionList:a,selectedItems:S,setSelectedItems:H,handleItemSelection:$,handleSelectAll:W,handleSelectNone:j}=kt(o),q=X({emptyRequisitionList:"RequisitionList.RequisitionListView.emptyRequisitionList",errorLoadingProducts:"RequisitionList.RequisitionListView.errorLoadingProducts",errorLoadPage:"RequisitionList.RequisitionListView.errorLoadPage"}),{alert:V,setAlert:Z,handleRequisitionListAlert:M}=ft();K(()=>{const t=f.on("requisitionList/data",e=>{a(e),H(new Set)});return f.on("requisitionList/alert",M),()=>{t==null||t.off()}},[M,a,H]),K(()=>{s(m)},[m]);const d=T(async t=>{var l,C;const e=((l=t.items)==null?void 0:l.map(b=>b.sku))||[];if(e.length===0)return t;u(!0);try{const b=await st(e);if(b){const B=new Map;return b.forEach(y=>{B.set(y.sku,y)}),{...t,items:(C=t.items)==null?void 0:C.map(y=>({...y,product:B.get(y.sku)||y.product}))}}return console.warn("No products found"),t}catch(b){return console.warn(b instanceof Error?b.message:q.errorLoadingProducts),t}finally{u(!1)}},[q.errorLoadingProducts]);K(()=>{if(c)return;(async()=>{const e=await d(o);a(e)})()},[o,d,c,a]);const D=T(async t=>{t&&t.length===1?(k(!1),L(t)):(k(!0),L(null));try{const e=await ot(n.uid,t);e&&e.length>0?f.emit("requisitionList/alert",{action:"move",type:"error",context:"product",message:e.map(l=>l.message)}):f.emit("requisitionList/alert",{action:"move",type:"success",context:"product"})}catch{f.emit("requisitionList/alert",{action:"move",type:"error",context:"product"})}finally{L(null),k(!1)}},[n]),z=T(async t=>{t&&t.length===1?w(t[0]):w("bulk");try{const e=await at(n.uid,t,R,n.page_info.current_page);if(e){const l=await d(e);a(l),f.emit("requisitionList/alert",{action:"delete",type:"success",context:"product"})}else f.emit("requisitionList/alert",{action:"delete",type:"error",context:"product"})}catch{f.emit("requisitionList/alert",{action:"delete",type:"error",context:"product"})}finally{w(null)}},[n,R,d,a]),F=T(async(t,e)=>{var l;x(t);try{const C=(l=n.items)==null?void 0:l.find(y=>y.uid===t);if(!C){f.emit("requisitionList/alert",{action:"update",type:"error",context:"product"});return}const b={item_id:C.uid,entered_options:C.entered_options,selected_options:C.selected_options,quantity:e},B=await rt(n.uid,[b],R,n.page_info.current_page);if(B){const y=await d(B);a(y),f.emit("requisitionList/alert",{action:"update",type:"success",context:"product"})}else f.emit("requisitionList/alert",{action:"update",type:"error",context:"product"})}catch{f.emit("requisitionList/alert",{action:"update",type:"error",context:"product"})}finally{x(null)}},[n,d,a,R]),Q=T(async t=>{A(!0);try{const e=await Y(n.uid,t,R);if(e){const l=await d(e);a(l)}else console.warn(q.errorLoadPage)}catch(e){console.warn(e instanceof Error?e.message:q.errorLoadPage)}finally{A(!1)}},[n.uid,d,R,q,a]),G=T(async t=>{s(t),A(!0);try{const e=await Y(n.uid,1,t);if(e){const l=await d(e);a(l)}else console.warn(q.errorLoadPage)}catch{console.warn(q.errorLoadPage)}finally{A(!1)}},[n.uid,d,q,a]);return N("div",{className:"requisition-list-view__container",children:[i(pt,{"aria-label":n.name,role:"region",title:n.name}),n.items_count===0?i(yt,{textContent:`${n.name} ${q.emptyRequisitionList}`}):N(nt,{children:[V&&i(mt,{heading:V.description,type:V.type,variant:"primary",onDismiss:()=>Z(null)}),i(Rt,{selectedItems:S,deletingItemId:_,addingToCartItemId:v,bulkAddingToCart:r,updatingQuantityItemId:g,onSelectAll:W,onSelectNone:j,onBulkAddToCart:()=>D(Array.from(S)),onBulkDelete:()=>z(Array.from(S))}),i(bt,{items:n.items,selectedItems:S,currentPage:n.page_info.current_page,pageSize:n.page_info.page_size,handleItemSelection:$,handleUpdateQuantity:F,onAddToCart:D,onDeleteItem:z}),n.page_info&&i("div",{className:"requisition-list-view__pagination",children:N("div",{className:"requisition-list-view__pagination-controls",children:[i(wt,{currentPageSize:n.page_info.page_size,onPageSizeChange:G,disabled:I||h}),n.page_info.total_pages>1&&i(ht,{totalPages:n.page_info.total_pages,currentPage:n.page_info.current_page,onChange:Q,disabled:I||h})]})})]})]})};export{Bt as RequisitionListView,Bt as default};
//# sourceMappingURL=RequisitionListView.js.map
