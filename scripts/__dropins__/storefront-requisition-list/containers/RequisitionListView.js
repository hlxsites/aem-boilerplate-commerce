/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsxs as E,jsx as e,Fragment as st}from"@dropins/tools/preact-jsx-runtime.js";import*as d from"@dropins/tools/preact-compat.js";import{useState as S,useEffect as K,useCallback as V}from"@dropins/tools/preact-compat.js";import{b as nt,a as ot,d as at,u as rt,g as Y}from"../chunks/addRequisitionListItemsToCart.js";import{Button as T,Icon as J,Field as lt,Input as ct,Price as U,Checkbox as ut,Table as dt,Header as pt,InLineAlert as mt,Pagination as ht}from"@dropins/tools/components.js";import{events as q}from"@dropins/tools/event-bus.js";import{useState as tt,useCallback as O}from"@dropins/tools/preact-hooks.js";import{VComponent as Lt,classes as qt}from"@dropins/tools/lib.js";/* empty css                            */import{u as ft,E as gt,P as yt}from"../chunks/PageSizePicker2.js";import{h as wt}from"@dropins/tools/preact.js";/* empty css                      */import{useText as X}from"@dropins/tools/i18n.js";import"../chunks/transform-requisition-list.js";import"@dropins/tools/fetch-graphql.js";import"../chunks/RequisitionListItemsFragment.graphql.js";function kt(o){const[l,p]=tt(o),[m,c]=tt(new Set),C=O((h,a)=>{c(k=>{const g=new Set(k);return a?g.add(h):g.delete(h),g})},[]),w=O(()=>{var a;const h=(a=l.items)==null?void 0:a.map(k=>k.uid);c(new Set(h))},[l]),v=O(()=>{c(new Set)},[]);return{currentRequisitionList:l,setCurrentRequisitionList:p,selectedItems:m,setSelectedItems:c,handleItemSelection:C,handleSelectAll:w,handleSelectNone:v}}const et=o=>d.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...o},d.createElement("g",{clipPath:"url(#clip0_102_196)"},d.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M18.3601 18.16H6.5601L4.8801 3H2.3501M19.6701 19.59C19.6701 20.3687 19.0388 21 18.2601 21C17.4814 21 16.8501 20.3687 16.8501 19.59C16.8501 18.8113 17.4814 18.18 18.2601 18.18C19.0388 18.18 19.6701 18.8113 19.6701 19.59ZM7.42986 19.59C7.42986 20.3687 6.79858 21 6.01986 21C5.24114 21 4.60986 20.3687 4.60986 19.59C4.60986 18.8113 5.24114 18.18 6.01986 18.18C6.79858 18.18 7.42986 18.8113 7.42986 19.59Z",stroke:"currentColor",strokeLinejoin:"round"}),d.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M5.25 6.37L20.89 8.06L20.14 14.8H6.19",stroke:"currentColor",strokeLinejoin:"round"})),d.createElement("defs",null,d.createElement("clipPath",{id:"clip0_102_196"},d.createElement("rect",{vectorEffect:"non-scaling-stroke",width:19.29,height:19.5,fill:"white",transform:"translate(2.3501 2.25)"})))),it=o=>d.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",...o},d.createElement("path",{d:"M1 5H23",stroke:"currentColor",strokeWidth:1.5,strokeMiterlimit:10}),d.createElement("path",{d:"M17.3674 22H6.63446C5.67952 22 4.88992 21.2688 4.8379 20.3338L4 5H20L19.1621 20.3338C19.1119 21.2688 18.3223 22 17.3655 22H17.3674Z",stroke:"currentColor",strokeWidth:1.5,strokeMiterlimit:10}),d.createElement("path",{d:"M9.87189 2H14.1281C14.6085 2 15 2.39766 15 2.88889V5H9V2.88889C9 2.39912 9.39006 2 9.87189 2Z",stroke:"currentColor",strokeWidth:1.5,strokeMiterlimit:10}),d.createElement("path",{d:"M8.87402 8.58057L9.39348 17.682",stroke:"currentColor",strokeWidth:1.5,strokeMiterlimit:10}),d.createElement("path",{d:"M14.6673 8.58057L14.146 17.682",stroke:"currentColor",strokeWidth:1.5,strokeMiterlimit:10})),bt=({className:o,items:l,selectedItems:p,currentPage:m,pageSize:c,canEdit:C=!0,handleItemSelection:w,handleUpdateQuantity:v,onAddToCart:h,onDeleteItem:a,...k})=>{const g=X({productNameHeader:"RequisitionList.RequisitionListView.productListTable.headers.productName",skuHeader:"RequisitionList.RequisitionListView.productListTable.headers.sku",priceHeader:"RequisitionList.RequisitionListView.productListTable.headers.price",quantityHeader:"RequisitionList.RequisitionListView.productListTable.headers.quantity",subtotalHeader:"RequisitionList.RequisitionListView.productListTable.headers.subtotal",actionsHeader:"RequisitionList.RequisitionListView.productListTable.headers.actions",actionAddToCart:"RequisitionList.RequisitionListView.actionAddToCart",actionDelete:"RequisitionList.RequisitionListView.actionDelete",itemQuantity:"RequisitionList.RequisitionListView.productListTable.itemQuantity"}),P=[{label:"#",key:"index"},{label:"item",key:"item"},{label:g.priceHeader,key:"price"},{label:g.quantityHeader,key:"quantity"},{label:g.subtotalHeader,key:"subtotal"}];C&&(P.unshift({label:"",key:"checkbox"}),P.push({label:g.actionsHeader,key:"actions"}));const B=(n,s)=>{const r=n.target.checked;w(s.uid,r)},x=l.map((n,s)=>{var r,_,N,$,W,j,L,A,Z,H,f,M,D,F,Q,G,t;return{index:e("span",{children:(m-1)*c+s+1}),item:E("div",{style:"display: inline-block",children:[e("div",{style:"float: left;",children:e(ut,{className:"requisition-list-view-product-list-table__checkbox",name:"itemSelected","data-testid":`item-checkbox-${n.sku}`,onChange:i=>B(i,n),value:n.sku,checked:p.has(n.uid)})}),e("div",{className:"requisition-list-view-product-list-table__product-name",children:((r=n.product)==null?void 0:r.name)||n.sku}),e("div",{className:"requisition-list-view-product-list-table__sku",children:n.sku})]}),price:e(U,{className:"requisition-list-view-product-list-table__price",amount:(W=($=(N=(_=n.product)==null?void 0:_.price)==null?void 0:N.final)==null?void 0:$.amount)==null?void 0:W.value,currency:(Z=(A=(L=(j=n.product)==null?void 0:j.price)==null?void 0:L.final)==null?void 0:A.amount)==null?void 0:Z.currency}),subtotal:e(U,{className:"requisition-list-view-product-list-table__price",amount:((D=(M=(f=(H=n.product)==null?void 0:H.price)==null?void 0:f.final)==null?void 0:M.amount)==null?void 0:D.value)*n.quantity,currency:(t=(G=(Q=(F=n.product)==null?void 0:F.price)==null?void 0:Q.final)==null?void 0:G.amount)==null?void 0:t.currency}),quantity:e("span",{className:"requisition-list-view-product-list-table__quantity",children:e(lt,{disabled:!1,children:e(ct,{id:"requisition-list-item-quantity",name:"quantity",type:"text",value:n.quantity,onBlur:i=>{const u=Number.parseInt(i.target.value,10);v(n.uid,u)}})})}),actions:E("div",{className:"requisition-list-view__bulk-actions",children:[e(T,{type:"button",onClick:()=>h([n.uid]),icon:e(J,{source:et}),"data-testid":"product-list-table-add-to-cart-button"}),e(T,{type:"button",variant:"secondary",icon:e(J,{source:it}),onClick:()=>a([n.uid]),"data-testid":"product-list-table-delete-button"})]})}}),I=e(dt,{columns:P,rowData:x,"data-testid":"product-list-table",mobileLayout:"stacked"});return e(Lt,{node:wt("div",{}),className:qt(["requisition-list-view-product-list-table-container",o]),"data-testid":"product-list-table-container",...k,children:I})},Rt=({selectedItems:o,deletingItemId:l,addingToCartItemId:p,bulkAddingToCart:m,updatingQuantityItemId:c,onSelectAll:C,onSelectNone:w,onBulkAddToCart:v,onBulkDelete:h})=>{const a=X({statusDeleting:"RequisitionList.RequisitionListView.statusDeleting",actionDeleteSelected:"RequisitionList.RequisitionListView.actionDeleteSelected",actionSelectAll:"RequisitionList.RequisitionListView.actionSelectAll",actionSelectNone:"RequisitionList.RequisitionListView.actionSelectNone",actionAddToCart:"RequisitionList.RequisitionListView.actionAddToCart",actionAddSelectedToCart:"RequisitionList.RequisitionListView.actionAddSelectedToCart",statusBulkAddingToCart:"RequisitionList.RequisitionListView.statusBulkAddingToCart"});return E("div",{class:"requisition-list-view__bulk-actions",children:[e(T,{"data-testid":"bulk-actions-select-all-btn",type:"button",variant:"secondary",onClick:C,disabled:l!==null||p!==null||m||c!==null,children:a.actionSelectAll}),e(T,{"data-testid":"bulk-actions-select-none-btn",type:"button",variant:"secondary",onClick:w,disabled:l!==null||p!==null||m||c!==null||o.size===0,children:a.actionSelectNone}),o.size>0&&e(T,{"data-testid":"bulk-actions-add-to-cart-btn",type:"button",variant:"primary",onClick:v,icon:e(J,{source:et}),disabled:l!==null||p!==null||m||c!==null,children:m?a.statusBulkAddingToCart:`${a.actionAddSelectedToCart} (${o.size})`}),o.size>0&&e(T,{"data-testid":"bulk-actions-delete-all-btn",type:"button",variant:"secondary",onClick:h,icon:e(J,{source:it}),disabled:l!==null||p!==null||m||c!==null,children:l==="bulk"?a.statusDeleting:`${a.actionDeleteSelected} (${o.size})`})]})},Bt=({requisitionList:o,skipProductLoading:l=!1,pageSize:p=10})=>{const[m,c]=S(!1),[C,w]=S(null),[v,h]=S(null),[a,k]=S(!1),[g,P]=S(null),[B,x]=S(!1),[I,n]=S(p),{currentRequisitionList:s,setCurrentRequisitionList:r,selectedItems:_,setSelectedItems:N,handleItemSelection:$,handleSelectAll:W,handleSelectNone:j}=kt(o),L=X({emptyRequisitionList:"RequisitionList.RequisitionListView.emptyRequisitionList",errorLoadingProducts:"RequisitionList.RequisitionListView.errorLoadingProducts",errorLoadPage:"RequisitionList.RequisitionListView.errorLoadPage"}),{alert:A,setAlert:Z,handleRequisitionListAlert:H}=ft();K(()=>{const t=q.on("requisitionList/data",i=>{r(i),N(new Set)});return q.on("requisitionList/alert",H),()=>{t==null||t.off()}},[H,r,N]),K(()=>{n(p)},[p]);const f=V(async t=>{var u,R;const i=((u=t.items)==null?void 0:u.map(b=>b.sku))||[];if(i.length===0)return t;c(!0);try{const b=await nt(i);if(b){const z=new Map;return b.forEach(y=>{z.set(y.sku,y)}),{...t,items:(R=t.items)==null?void 0:R.map(y=>({...y,product:z.get(y.sku)||y.product}))}}return console.warn("No products found"),t}catch(b){return console.warn(b instanceof Error?b.message:L.errorLoadingProducts),t}finally{c(!1)}},[L.errorLoadingProducts]);K(()=>{if(l)return;(async()=>{const i=await f(o);r(i)})()},[o,f,l,r]);const M=V(async t=>{t&&t.length===1?(k(!1),h(t)):(k(!0),h(null));try{const i=await ot(s.uid,t);i&&i.length>0?q.emit("requisitionList/alert",{action:"move",type:"error",context:"product",message:i.map(u=>u.message)}):q.emit("requisitionList/alert",{action:"move",type:"success",context:"product"})}catch{q.emit("requisitionList/alert",{action:"move",type:"error",context:"product"})}finally{h(null),k(!1)}},[s]),D=V(async t=>{t&&t.length===1?w(t[0]):w("bulk");try{await at(s.uid,t)?q.emit("requisitionList/alert",{action:"delete",type:"success",context:"product"}):q.emit("requisitionList/alert",{action:"delete",type:"error",context:"product"})}catch{q.emit("requisitionList/alert",{action:"delete",type:"error",context:"product"})}finally{w(null)}},[s.uid]),F=V(async(t,i)=>{var u;P(t);try{const R=(u=s.items)==null?void 0:u.find(y=>y.uid===t);if(!R){q.emit("requisitionList/alert",{action:"update",type:"error",context:"product"});return}const b={item_id:R.uid,entered_options:R.entered_options,selected_options:R.selected_options,quantity:i},z=await rt(s.uid,[b]);if(z){const y=await f(z);r(y),q.emit("requisitionList/alert",{action:"update",type:"success",context:"product"})}else q.emit("requisitionList/alert",{action:"update",type:"error",context:"product"})}catch{q.emit("requisitionList/alert",{action:"update",type:"error",context:"product"})}finally{P(null)}},[s.uid,s.items,f,r]),Q=V(async t=>{x(!0);try{const i=await Y(s.uid,t,I);if(i){const u=await f(i);r(u)}else console.warn(L.errorLoadPage)}catch(i){console.warn(i instanceof Error?i.message:L.errorLoadPage)}finally{x(!1)}},[s.uid,f,I,L,r]),G=V(async t=>{n(t),x(!0);try{const i=await Y(s.uid,1,t);if(i){const u=await f(i);r(u)}else console.warn(L.errorLoadPage)}catch{console.warn(L.errorLoadPage)}finally{x(!1)}},[s.uid,f,L,r]);return E("div",{className:"requisition-list-view__container",children:[e(pt,{"aria-label":s.name,role:"region",title:s.name}),s.items_count===0?e(gt,{textContent:`${s.name} ${L.emptyRequisitionList}`}):E(st,{children:[A&&e(mt,{heading:A.description,type:A.type,variant:"primary",onDismiss:()=>Z(null)}),e(Rt,{selectedItems:_,deletingItemId:C,addingToCartItemId:v,bulkAddingToCart:a,updatingQuantityItemId:g,onSelectAll:W,onSelectNone:j,onBulkAddToCart:()=>M(Array.from(_)),onBulkDelete:()=>D(Array.from(_))}),e(bt,{items:s.items,selectedItems:_,currentPage:s.page_info.current_page,pageSize:s.page_info.page_size,handleItemSelection:$,handleUpdateQuantity:F,onAddToCart:M,onDeleteItem:D}),s.page_info&&e("div",{className:"requisition-list-view__pagination",children:E("div",{className:"requisition-list-view__pagination-controls",children:[e(yt,{currentPageSize:s.page_info.page_size,onPageSizeChange:G,disabled:B||m}),s.page_info.total_pages>1&&e(ht,{totalPages:s.page_info.total_pages,currentPage:s.page_info.current_page,onChange:Q,disabled:B||m})]})})]})]})};export{Bt as RequisitionListView,Bt as default};
//# sourceMappingURL=RequisitionListView.js.map
