/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as i,jsxs as g,Fragment as U}from"@dropins/tools/preact-jsx-runtime.js";import*as v from"@dropins/tools/preact-compat.js";import{useState as P,useCallback as h,useEffect as H,useMemo as W}from"@dropins/tools/preact-compat.js";import{Card as F,Button as E,Header as Q,InLineAlert as X,Table as Y,Pagination as Z,Icon as $,Modal as I,ProgressSpinner as ii}from"@dropins/tools/components.js";import{Slot as ei,classes as x,VComponent as ti}from"@dropins/tools/lib.js";import"@dropins/tools/preact-hooks.js";/* empty css                            */import{R as G}from"../chunks/RequisitionListForm.js";import{u as ni,E as si,P as ai}from"../chunks/PageSizePicker2.js";import{events as _}from"@dropins/tools/event-bus.js";import"@dropins/tools/preact.js";/* empty css                      */import{useText as T}from"@dropins/tools/i18n.js";import{d as oi}from"../chunks/deleteRequisitionList.js";import{g as O}from"../chunks/getRequisitionLists.js";import"../chunks/transform-requisition-list.js";import"@dropins/tools/fetch-graphql.js";function ri(l,r,s){const a=T({actionDelete:"RequisitionList.RequisitionListItem.actionDelete",actionUpdate:"RequisitionList.RequisitionListItem.actionUpdate"}),[e,q]=P(l),[n,d]=P(null),[C,f]=P(!1),[b,R]=P(!1),L=h(t=>{d(t),f(!1)},[]),w=h(()=>d(null),[]),m=h(()=>{f(!0),d(null)},[]),A=h(()=>f(!1),[]),c=h(async(t=(S=>(S=e==null?void 0:e.page_info)==null?void 0:S.current_page)()??1,y=(k=>(k=e==null?void 0:e.page_info)==null?void 0:k.page_size)()??10)=>{var z,B,M;R(!0);try{const p=await O(t,y),D=((z=p==null?void 0:p.page_info)==null?void 0:z.current_page)??1,V=((B=p==null?void 0:p.page_info)==null?void 0:B.total_pages)??0;if(!((((M=p==null?void 0:p.items)==null?void 0:M.length)??0)>0)&&D>1&&V>=D-1){const J=D-1,K=await O(J,y);q(K)}else q(p)}finally{R(!1)}},[e]);H(()=>{e||c(1)},[e,c]);const o=h(t=>c(t),[c]),N=h(async t=>{await c(1,t)},[c]),u=W(()=>((e==null?void 0:e.items)??[]).map(t=>{const y=n===t.uid;return{name:g("div",{className:"requisition-list-grid-wrapper__name",children:[i("div",{className:"requisition-list-grid-wrapper__name__title",children:i("a",{href:"#",onClick:S=>{if(S.preventDefault(),s){const k=s(t.uid);typeof k=="string"&&(window.location.href=k)}},children:t.name})}),t.description&&i("div",{className:"requisition-list-grid-wrapper__name__description",children:t.description})]}),items_count:t.items_count,last_updated:new Date(t.updated_at).toLocaleString(),actions:g("div",{className:"requisition-list-grid-wrapper__actions",children:[i(E,{variant:"tertiary",type:"button","data-testid":"update-button",onClick:()=>L(t.uid),children:a.actionUpdate}),i(E,{variant:"tertiary",type:"button","data-testid":"delete-button",onClick:()=>r==null?void 0:r.handleOpenModal(t),children:a.actionDelete})]}),_rowDetails:y?i(F,{variant:"secondary",className:"requisition-list-grid-wrapper__form-row",children:i(G,{mode:"update",requisitionListUid:t.uid,defaultValues:{name:t.name,description:t.description},onSuccess:async()=>{await o(),_.emit("requisitionList/alert",{action:"update",type:"success",context:"requisitionList"}),d(null)},onError:()=>{_.emit("requisitionList/alert",{action:"update",type:"error",context:"requisitionList"})},onCancel:w})}):void 0}}),[e==null?void 0:e.items,n,L,w,a.actionUpdate,a.actionDelete,r,o,s]),j=W(()=>new Set(u.map((t,y)=>t._rowDetails?y:-1).filter(t=>t>=0)),[u]);return{rows:u,expandedRows:j,isLoading:b||!e,pageInfo:e==null?void 0:e.page_info,handlePageChange:o,handlePageSizeChange:N,isAdding:C,handleAddNew:m,handleCancelCreate:A}}const xi=({requisitionLists:l,routeRequisitionListDetails:r,slots:s})=>{const[a,e]=P({isOpen:!1,isLoading:!1,rl:null}),q=u=>e({isOpen:!0,isLoading:!1,rl:u}),n=()=>e({isOpen:!1,isLoading:!1,rl:null}),d=async()=>{a.rl&&(e(u=>({...u,isLoading:!0})),await oi(a.rl.uid).then(async()=>{_.emit("requisitionList/alert",{type:"success",action:"delete",context:"requisitionList"})}).catch(()=>{_.emit("requisitionList/alert",{type:"error",action:"delete",context:"requisitionList"})}).finally(async()=>{await L(),n()}))},{rows:C,expandedRows:f,isLoading:b,pageInfo:R,handlePageChange:L,handlePageSizeChange:w,isAdding:m,handleAddNew:A,handleCancelCreate:c}=ri(l,{handleOpenModal:q},r),o=T({containerTitle:"RequisitionList.containerTitle",deleteRequisitionListTitle:"RequisitionList.RequisitionListWrapper.deleteRequisitionListTitle",deleteRequisitionListMessage:"RequisitionList.RequisitionListWrapper.deleteRequisitionListMessage",cancelAction:"RequisitionList.RequisitionListWrapper.cancelAction",confirmAction:"RequisitionList.RequisitionListWrapper.confirmAction"}),N=h(()=>s!=null&&s.Header?i(ei,{name:"Header","aria-label":o.containerTitle,title:o.containerTitle,slot:s.Header}):i(Q,{"aria-label":o.containerTitle,role:"region",title:o.containerTitle}),[s,o.containerTitle]);return g(U,{children:[i(di,{header:N(),rows:C,expandedRows:f,skeletonRowCount:10,isLoading:b,pageInfo:R,handlePageChange:L,handlePageSizeChange:w,defaultPageSize:10,isAdding:m,handleAddNew:A,handleCancelCreate:c}),a.isOpen&&i(ui,{isOpen:!0,isLoading:a.isLoading,title:o.deleteRequisitionListTitle,modalContent:o.deleteRequisitionListMessage,confirmBtnCaption:o.confirmAction,closeBtnCaption:o.cancelAction,handleModalOnClose:n,handleModalOnConfirm:d})]})},li=l=>v.createElement("svg",{id:"Icon_Add_Base","data-name":"Icon \\u2013 Add \\u2013 Base",xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",...l},v.createElement("g",{id:"Large"},v.createElement("rect",{id:"Placement_area","data-name":"Placement area",width:24,height:24,fill:"#fff",opacity:0}),v.createElement("g",{id:"Add_icon","data-name":"Add icon",transform:"translate(9.734 9.737)"},v.createElement("line",{vectorEffect:"non-scaling-stroke",id:"Line_579","data-name":"Line 579",y2:12.7,transform:"translate(2.216 -4.087)",fill:"none",stroke:"currentColor"}),v.createElement("line",{vectorEffect:"non-scaling-stroke",id:"Line_580","data-name":"Line 580",x2:12.7,transform:"translate(-4.079 2.263)",fill:"none",stroke:"currentColor"})))),di=({className:l,isLoading:r=!1,header:s,rows:a=[],expandedRows:e,skeletonRowCount:q=10,pageInfo:n,handlePageChange:d,handlePageSizeChange:C,defaultPageSize:f=10,isAdding:b,handleAddNew:R,handleCancelCreate:L,...w})=>{const m=T({name:"RequisitionList.RequisitionListWrapper.name",itemsCount:"RequisitionList.RequisitionListWrapper.itemsCount",lastUpdated:"RequisitionList.RequisitionListWrapper.lastUpdated",actions:"RequisitionList.RequisitionListWrapper.actions",emptyList:"RequisitionList.RequisitionListWrapper.emptyList"}),A=((n==null?void 0:n.total_pages)??0)>0,c=!r&&a.length===0&&!A,{alert:o,setAlert:N,handleRequisitionListAlert:u}=ni();return H(()=>{_.on("requisitionList/alert",u)},[u]),g("div",{...w,className:x(["requisition-list-grid-wrapper",l]),"data-testid":"requisition-list-grid-wrapper",children:[s&&i("div",{className:x(["requisition-list-grid-wrapper__header",l]),"data-testid":"requisition-list-grid-wrapper-header",children:i(ti,{node:s})}),o&&i(U,{children:i(X,{heading:o.description,type:o.type,variant:"primary",onDismiss:()=>N(null)})}),c?i(si,{textContent:m.emptyList}):g(U,{children:[i(Y,{columns:[{key:"name",label:m.name},{key:"items_count",label:m.itemsCount},{key:"last_updated",label:m.lastUpdated},{key:"actions",label:m.actions}],rowData:a,expandedRows:e,loading:r,skeletonRowCount:q}),i("div",{className:x(["requisition-list-grid-wrapper__pagination",l]),children:g("div",{className:"requisition-list-grid-wrapper__pagination-controls",children:[i(ai,{currentPageSize:(n==null?void 0:n.page_size)||f,onPageSizeChange:C||(()=>Promise.resolve()),disabled:r}),n&&n.total_pages>1&&i(Z,{totalPages:n.total_pages,currentPage:n.current_page,onChange:d})]})})]}),i("div",{className:x(["requisition-list-grid-wrapper__add-new",l]),children:b?i(F,{variant:"secondary",children:i(G,{mode:"create",onSuccess:async()=>{await d(),L(),_.emit("requisitionList/alert",{type:"success",action:"create",context:"requisitionList"})},onError:()=>{_.emit("requisitionList/alert",{type:"error",action:"create",context:"requisitionList"})},onCancel:L})}):i(ci,{onAddNew:R})})]})},ci=({selectable:l,className:r,onAddNew:s})=>{const a=T({addNewReqListBtn:"RequisitionList.AddNewReqList.addNewReqListBtn"});return g("button",{type:"button","aria-label":a.addNewReqListBtn,role:"button",className:x(["requisition-list-actions",["requisition-list-actions--selectable",l],r]),"data-testid":"requisition-list-actions-button",onClick:s,children:[i("span",{className:"requisition-list-actions__title","data-testid":"requisition-list-actions-button-text",children:a.addNewReqListBtn}),i($,{source:li,size:"32"})]})},ui=({isOpen:l,isLoading:r,title:s,modalContent:a,closeBtnCaption:e,confirmBtnCaption:q,handleModalOnClose:n,handleModalOnConfirm:d})=>l?i(I,{className:"requisition-list-modal--overlay","data-testid":"requisition-list-modal",size:"medium",centered:!1,title:s,onClose:n,backgroundDim:!0,clickToDismiss:!0,escapeToDismiss:!0,role:"dialog","aria-label":s,children:g("div",{className:"requisition-list-modal",children:[r?i("div",{className:"requisition-list-modal__spinner","data-testid":"progress-spinner",children:i(ii,{stroke:"4",size:"large"})}):null,i("p",{children:a}),g("div",{className:"requisition-list-modal__buttons",children:[n&&i(E,{"data-testid":"rl-modal-close-button",type:"button",onClick:n,variant:"secondary",disabled:r,children:e}),d&&i(E,{"data-testid":"rl-modal-confirm-button",type:"button",onClick:d,disabled:r,children:q})]})]})}):null;export{xi as RequisitionListGrid,xi as default};
//# sourceMappingURL=RequisitionListGrid.js.map
