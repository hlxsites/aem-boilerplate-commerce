/*! Copyright 2026 Adobe
All Rights Reserved. */
import{jsxs as E,jsx as a,Fragment as z}from"@dropins/tools/preact-jsx-runtime.js";import{memo as K,useCallback as D,useMemo as B,useState as M,useRef as R,useEffect as G}from"@dropins/tools/preact-compat.js";import{InputFile as C,CartList as U,Divider as ee,Button as re,CartItem as J,AccordionSection as te,Input as ae}from"@dropins/tools/components.js";import{Slot as F}from"@dropins/tools/lib.js";import{useState as Q,useRef as se,useEffect as X,useMemo as ce,useCallback as W}from"@dropins/tools/preact-hooks.js";import{events as ne}from"@dropins/tools/event-bus.js";const j=e=>e.reduce((r,s)=>{if(!s)return r;if(typeof s=="string"&&(r+=` ${s}`),Array.isArray(s)){const[b,f]=s;b&&f&&(r+=` ${b}`)}return r},"").trim(),ue=({t:e,onFileUpload:t,error:r,fileName:s,onDownloadSample:b,showSampleDownload:f,disabled:n})=>{const h=D(i=>{var _;const q=(_=i.target.files)==null?void 0:_[0];q&&t(q)},[t]);return E("div",{className:"b2b-quick-order-csv-file-input",children:[a("div",{className:"b2b-quick-order-csv-file-input__title",children:e.title}),E("div",{className:"b2b-quick-order-csv-file-input__helper",children:[e.helperText,f&&a(z,{children:a("button",{type:"button",className:"b2b-quick-order-csv-file-input__download-link",onClick:b,"data-testid":"download-sample",disabled:n,children:e.downloadSample})})]}),a("div",{className:`b2b-quick-order-csv-file-input__input-wrapper ${n?"b2b-quick-order-csv-file-input__input-wrapper--disabled":""}`,children:a(C,{id:"quick-order-csv-file-input",label:e.inputLabel,className:"b2b-quick-order-csv-file-input__input",onChange:h,accept:".csv",disabled:n})}),s&&E("div",{className:"b2b-quick-order-csv-file-input__file-name","data-testid":"file-name",children:[e.selectedFile,": ",s]}),r&&a("div",{className:"b2b-quick-order-csv-file-input__error","data-testid":"error-message",role:"alert",children:r})]})},Oe=K(ue),le=(e,t)=>{let r;return function(...s){clearTimeout(r),r=setTimeout(()=>e.apply(this,s),t)}},ie=[{attribute:"visibility",in:["Search","Catalog, Search"]}],oe=e=>{const{containerRef:t,itemSelected:r,initialValue:s,currentValue:b,onValueRestore:f,onClose:n}=e,h=document.activeElement;(t==null?void 0:t.contains(h))||(n(),!r&&s!==b&&f(s))},de=(e,t=150)=>window.setTimeout(()=>{oe(e)},t),H=e=>{e&&clearTimeout(e)},pe=(e,t,r)=>{const s=e<t-1?e+1:e;return{nextIndex:s,shouldFocusElement:r[s]||null,shouldPreventDefault:!0}},be=(e,t,r)=>{const s=e>0?e-1:-1;return{nextIndex:s,shouldFocusElement:s===-1?t:r[s],shouldPreventDefault:!0}},fe=(e,t,r)=>e>=0&&t[e]?(r(t[e]),!0):!1,he=(e,t,r,s)=>{r(e),s(),t&&"blur"in t&&typeof t.blur=="function"&&t.blur()},$=e=>{e&&"focus"in e&&typeof e.focus=="function"&&e.focus()},Y=({productsSearch:e,initialSku:t,replaceItemSku:r,searchFilter:s=ie})=>{const[b,f]=Q(t),[n,h]=Q([]),[u,i]=Q(!1),l=se(!0);X(()=>()=>{l.current=!1},[]),X(()=>{u||f(t)},[t,u]);const q=ce(()=>le(async o=>{if(!o||!e){l.current&&h([]);return}try{const d=await e({phrase:o,filter:s});l.current&&h(d.items||[])}catch(d){console.error("Error searching products:",d),l.current&&h([])}},300),[e,s]),_=W(o=>{const N=o.target.value;f(N),i(!0),q(N)},[q]),v=W(()=>{f(""),h([]),i(!1)},[]),O=W(o=>{const d={sku:o.sku,...o.variantSku&&{variantSku:o.variantSku},quantity:1,...r&&{replaceItemSku:r}};ne.emit("quick-order/add-items",[d]),v()},[r,v]);return{searchValue:b,searchResults:n,handleSearchChange:_,shouldShowResults:u,resetSearch:v,handleItemClick:O}},me=({t:e,items:t,onRemove:r,onUpdateQuantity:s,slots:b,handleAddToCart:f,isItemUpdating:n,loading:h,isDisabledButton:u,productsSearch:i,searchFilter:l})=>{const{searchValue:q,searchResults:_,handleSearchChange:v,shouldShowResults:O,handleItemClick:o}=Y({productsSearch:i,initialSku:"",searchFilter:l});return E("div",{className:j(["b2b-quick-order-form-quick-order-items-list"]),role:"region","aria-label":e.title,children:[a("div",{className:"b2b-quick-order-form-quick-order-items-list__title",children:e.title}),t.length>0&&E(z,{children:[a(U,{role:"list",className:"b2b-quick-order-form-quick-order-items-list__list",children:t.map(d=>a(ve,{item:d,t:e,onRemove:r,onUpdateQuantity:s,isUpdating:n==null?void 0:n(d.sku),loading:h,productsSearch:i,searchFilter:l,slots:b},d.sku))}),a(ee,{variant:"secondary"})]}),a("div",{className:"b2b-quick-order-form-quick-order-items-list__global-search",children:a(Z,{t:e,onChange:v,items:_,value:q,shouldShowResults:O,onItemClick:o,className:"b2b-quick-order-form-quick-order-items-list__search",slots:b})}),t.length===0&&a("div",{className:"b2b-quick-order-form-quick-order-items-list__empty","data-testid":"empty-items",children:e.emptyList}),a(F,{slot:b==null?void 0:b.AddAllToCartButton,name:"AddAllToCartButton",context:{handleAddToCart:f,loading:h,isDisabledButton:u},"data-testid":"addAllToCart",children:a("div",{className:"b2b-quick-order-form-quick-order-items-list__actions",children:a(re,{variant:"primary",onClick:f,"data-testid":"add-all-to-cart-button",disabled:h||u,children:e.addAllToCart})})})]})},$e=K(me),ke=({item:e,t,onRemove:r,onUpdateQuantity:s,isUpdating:b,loading:f,productsSearch:n,searchFilter:h,slots:u})=>{var I,x;const i=`quick-order-item-${e.id||e.variantSku||e.sku}`,l=(e==null?void 0:e.variantSku)??(e==null?void 0:e.sku),{searchValue:q,searchResults:_,handleSearchChange:v,shouldShowResults:O,handleItemClick:o}=Y({productsSearch:n,initialSku:l,replaceItemSku:e.sku,searchFilter:h}),d=`form-${e.id||l}`,N=e.inStock&&e.addToCartAllowed,y=e.options&&e.options.length>0,g=B(()=>y&&e.options.some(p=>p.required),[y,e.options]),w=B(()=>y&&e.options.some(p=>p.items&&p.items.some(A=>A.selected)),[y,e.options]),T=B(()=>g?e.options.every(p=>p.required?p.items&&p.items.some(A=>A.selected):!0):w,[g,w,e.options]),S=B(()=>{var p;return(p=e.images)==null?void 0:p.find(A=>{var c;return(c=A.roles)==null?void 0:c.includes("image")})},[e.images]),L=D(()=>{r==null||r(e.id||e.sku)},[r,e.id,e.sku]),V=D(p=>{s==null||s(e.sku,p);const A=document.forms[d];if(A){const c=A.querySelector('input[name="quantity"]');c&&(c.value=String(p))}},[s,e.sku,d]),P=a(F,{name:"QuickOrderItemSearch",slot:u==null?void 0:u.QuickOrderItemSearch,context:{item:e,scope:i,handleSearchChange:v,searchResults:_,searchValue:q,shouldShowResults:O,handleItemClick:o},children:a(Z,{t,onChange:v,items:_,value:q,shouldShowResults:O,className:"b2b-quick-order-form-quick-order-items__item-search",onItemClick:o,slots:u})});return!e.name&&!((I=e.images)!=null&&I.length)?E("form",{name:d,className:"b2b-quick-order-form-quick-order-items__item-form",onSubmit:p=>p.preventDefault(),"data-sku":e.sku,children:[a("input",{type:"hidden",name:"sku",value:e.sku}),a("input",{type:"hidden",name:"quantity",value:e.quantity}),a("input",{type:"hidden",name:"valid",value:"false"}),a("input",{type:"hidden",name:"productType",value:""}),P,a(J,{sku:a("span",{children:e.sku}),title:a("span",{children:t.productNotFound}),quantity:e.quantity,alert:a("div",{className:"b2b-quick-order-items__error",children:(x=t.productNotFoundDescription)==null?void 0:x.replace("{sku}",e.sku)}),disabled:f,onRemove:L,ariaLabel:`${t.productNotFound} - ${e.sku}`})]},e.sku):E("form",{name:d,className:"b2b-quick-order-form-quick-order-items__item-form",onSubmit:p=>p.preventDefault(),"data-sku":l,children:[a("input",{type:"hidden",name:"sku",value:l}),a("input",{type:"hidden",name:"quantity",value:e.quantity}),a("input",{type:"hidden",name:"valid",value:N?"true":"false"}),a("input",{type:"hidden",name:"productType",value:e.productType||""}),P,a(J,{title:a("span",{children:e.name}),sku:a("span",{children:l}),image:S?a("img",{src:S.url,alt:S.label||e.name}):void 0,price:a(F,{name:"ProductPrice",slot:u==null?void 0:u.ProductPrice,context:{item:e,scope:i}}),quantity:e.quantity,alert:e.inStock===!1?a("div",{className:"b2b-quick-order-items__alert",children:t.outOfStock}):void 0,warning:y&&!T?a("div",{className:"b2b-quick-order-items__warning",children:t.configurableOptionsWarning}):void 0,footer:y?a(te,{title:t.productOptions,ariaLabelTitle:t.productOptions,defaultOpen:!T,className:"b2b-quick-order-list-item__accordion",actionIconPosition:"left",children:a(F,{name:"ProductOptions",slot:u==null?void 0:u.ProductOptions,context:{item:e,scope:i},children:a("div",{className:"b2b-quick-order-items__configurable-error",children:t.configurableProductErrorDescription})})}):void 0,updating:b,disabled:f,loading:f,onRemove:L,onQuantity:V,ariaLabel:`${e.name} - ${e.sku}`})]},l)},ve=K(ke),qe={cursor:"pointer"},_e={cursor:"default"},ye=({t:e,value:t,onChange:r,items:s,shouldShowResults:b=!0,className:f,onItemClick:n,slots:h})=>{const[u,i]=M(-1),[l,q]=M(""),[_,v]=M(!1),[O,o]=M(!1),d=R(`search-results-${Math.random().toString(36).substr(2,9)}`),N=R(null),y=R([]),g=R(null),w=R(null),T=!!t&&!O,S=b&&T&&s.length>0,L=b&&T&&s.length===0;G(()=>{i(-1)},[s]),G(()=>()=>{H(w.current)},[]);const V=D(c=>()=>{v(!0),o(!0),n==null||n(c),i(-1)},[n]),P=D(()=>{H(w.current),w.current=null,q(t||""),v(!1),o(!1)},[t]),I=D(()=>{w.current=de({containerRef:g.current,itemSelected:_,initialValue:l,currentValue:t||"",onValueRestore:c=>{r==null||r({target:{value:c}})},onClose:()=>{o(!0)}})},[_,l,t,r]),x=D(c=>{if(S)switch(c.key){case"ArrowDown":c.preventDefault(),i(k=>{const m=pe(k,s.length,y.current);return m.shouldFocusElement&&$(m.shouldFocusElement),m.nextIndex});break;case"ArrowUp":c.preventDefault(),i(k=>{const m=be(k,N.current,y.current);return m.shouldFocusElement&&$(m.shouldFocusElement),m.nextIndex});break;case"Tab":H(w.current),w.current=null,o(!0),r==null||r({target:{value:l}});break;case"Enter":{fe(u,s,m=>{v(!0),n==null||n(m),i(-1)})&&c.preventDefault();break}case"Escape":c.preventDefault(),he(l,N.current,k=>{r==null||r({target:{value:k}}),i(-1),o(!0)},()=>{o(!0)});break}},[S,s,u,n,r,l]),p=D(()=>{if(u>=0&&S)return`${d.current}-item-${u}`},[u,S]),A=D((c,k)=>m=>{switch(m.key){case"Enter":case" ":m.preventDefault(),v(!0),o(!0),n==null||n(k),i(-1),$(N.current);break;case"Escape":m.preventDefault(),i(-1),o(!0),r==null||r({target:{value:l}}),$(N.current);break;case"ArrowDown":m.preventDefault(),c<s.length-1&&(i(c+1),$(y.current[c+1]));break;case"ArrowUp":m.preventDefault(),c>0?(i(c-1),$(y.current[c-1])):(i(-1),$(N.current));break;case"Tab":H(w.current),w.current=null,o(!0),r==null||r({target:{value:l}});break}},[s,n,r,l]);return E("div",{ref:g,className:j(["b2b-quick-order-search",f]),children:[a(ae,{ref:N,className:"b2b-quick-order-search__input",value:t,onChange:r,onFocus:P,onBlur:I,placeholder:e.searchPlaceholder,"aria-label":e.searchAriaLabel,role:"combobox","aria-autocomplete":"list","aria-expanded":S?!0:void 0,"aria-controls":S?d.current:void 0,"aria-activedescendant":p(),onKeyDown:x}),S&&a("div",{id:d.current,role:"listbox",className:"b2b-quick-order-search__results","aria-label":e.searchAriaLabel,children:s.map((c,k)=>a(F,{slot:h==null?void 0:h.QuickOrderSearchAutocompleteItem,name:"QuickOrderSearchAutocompleteItem",context:{item:c,index:k,createItemClickHandler:V,createResultItemKeyDownHandler:A},children:a("div",{id:`${d.current}-item-${k}`,ref:m=>y.current[k]=m,role:"option",tabIndex:0,"aria-selected":k===u,className:j(["b2b-quick-order-search__result-item",k===u&&"b2b-quick-order-search__result-item--active"]),onClick:V(c),onKeyDown:A(k,c),style:n?qe:_e,children:`${c.sku} ${c.name}`})},c.sku))}),L&&a("div",{className:"b2b-quick-order-search__empty-state",role:"status","aria-live":"polite",children:e.searchEmptyState}),S&&E("div",{className:"sr-only",role:"status","aria-live":"polite","aria-atomic":"true",children:[s.length," ",s.length===1?e.resultAvailable:e.resultsAvailable,"."," ",e.srInstructions]})]})},Z=K(ye),ge=({isDisabled:e,message:t,children:r})=>E("div",{className:"b2b-quick-order-disabled-overlay",children:[a("div",{className:"b2b-quick-order-disabled-overlay__content",style:{pointerEvents:e?"none":"auto"},children:r}),e&&E(z,{children:[a("div",{className:"b2b-quick-order-disabled-overlay__blur"}),a("div",{className:"b2b-quick-order-disabled-overlay__message",children:t})]})]});export{Oe as C,ge as Q,$e as a,j as c,le as d};
//# sourceMappingURL=QuickOrderDisabledOverlay.js.map
