/*! Copyright 2026 Adobe
All Rights Reserved. */
import{jsxs as S,jsx as t,Fragment as Q}from"@dropins/tools/preact-jsx-runtime.js";import{memo as P,useCallback as A,useMemo as F,useState as I,useRef as E,useEffect as W}from"@dropins/tools/preact-compat.js";import{InputFile as X,CartList as Y,Divider as Z,Button as U,CartItem as j,AccordionSection as ee,Input as re}from"@dropins/tools/components.js";import{Slot as T}from"@dropins/tools/lib.js";import{useState as M,useRef as te,useEffect as z,useMemo as ae,useCallback as H}from"@dropins/tools/preact-hooks.js";import{events as se}from"@dropins/tools/event-bus.js";const K=e=>e.reduce((a,s)=>{if(!s)return a;if(typeof s=="string"&&(a+=` ${s}`),Array.isArray(s)){const[m,o]=s;m&&o&&(a+=` ${m}`)}return a},"").trim(),ce=({t:e,onFileUpload:r,error:a,fileName:s,onDownloadSample:m,showSampleDownload:o,disabled:i})=>{const p=A(d=>{var q;const k=(q=d.target.files)==null?void 0:q[0];k&&r(k)},[r]);return S("div",{className:"b2b-quick-order-csv-file-input",children:[t("div",{className:"b2b-quick-order-csv-file-input__title",children:e.title}),S("div",{className:"b2b-quick-order-csv-file-input__helper",children:[e.helperText,o&&t(Q,{children:t("button",{type:"button",className:"b2b-quick-order-csv-file-input__download-link",onClick:m,"data-testid":"download-sample",disabled:i,children:e.downloadSample})})]}),t("div",{className:`b2b-quick-order-csv-file-input__input-wrapper ${i?"b2b-quick-order-csv-file-input__input-wrapper--disabled":""}`,children:t(X,{id:"quick-order-csv-file-input",label:e.inputLabel,className:"b2b-quick-order-csv-file-input__input",onChange:p,accept:".csv",disabled:i})}),s&&S("div",{className:"b2b-quick-order-csv-file-input__file-name","data-testid":"file-name",children:[e.selectedFile,": ",s]}),a&&t("div",{className:"b2b-quick-order-csv-file-input__error","data-testid":"error-message",role:"alert",children:a})]})},$e=P(ce),ne=(e,r)=>{let a;return function(...s){clearTimeout(a),a=setTimeout(()=>e.apply(this,s),r)}},ie=[{attribute:"visibility",in:["Search","Catalog, Search"]}],le=e=>{const{containerRef:r,itemSelected:a,initialValue:s,currentValue:m,onValueRestore:o,onClose:i}=e,p=document.activeElement;(r==null?void 0:r.contains(p))||(i(),!a&&s!==m&&o(s))},ue=(e,r=150)=>window.setTimeout(()=>{le(e)},r),x=e=>{e&&clearTimeout(e)},oe=(e,r)=>r===0?-1:e<r-1?e+1:e,de=e=>e>0?e-1:-1,he=()=>0,pe=e=>Math.max(0,e-1),be=(e,r,a)=>e>=0&&r[e]?(a(r[e]),!0):!1,fe=(e,r,a,s)=>{a(e),s(),r&&"blur"in r&&typeof r.blur=="function"&&r.blur()},G=({productsSearch:e,initialSku:r,replaceItemSku:a,searchFilter:s=ie})=>{const[m,o]=M(r),[i,p]=M([]),[c,d]=M(!1),l=te(!0);z(()=>()=>{l.current=!1},[]),z(()=>{c||o(r)},[r,c]);const k=ae(()=>ne(async u=>{if(!u||!e){l.current&&p([]);return}try{const b=await e({phrase:u,filter:s});l.current&&p(b.items||[])}catch(b){console.error("Error searching products:",b),l.current&&p([])}},300),[e,s]),q=H(u=>{const y=u.target.value;o(y),d(!0),k(y)},[k]),_=H(()=>{o(""),p([]),d(!1)},[]),g=H(u=>{const b={sku:u.sku,...u.variantSku&&{variantSku:u.variantSku},quantity:1,...a&&{replaceItemSku:a}};se.emit("quick-order/add-items",[b]),_()},[a,_]);return{searchValue:m,searchResults:i,handleSearchChange:q,shouldShowResults:c,resetSearch:_,handleItemClick:g}},me=({t:e,items:r,onRemove:a,clearItems:s,onUpdateQuantity:m,slots:o,handleAddToCart:i,isItemUpdating:p,loading:c,isDisabledButton:d,productsSearch:l,searchFilter:k})=>{const{searchValue:q,searchResults:_,handleSearchChange:g,shouldShowResults:u,handleItemClick:b}=G({productsSearch:l,initialSku:"",searchFilter:k});return S("div",{className:K(["b2b-quick-order-form-quick-order-items-list"]),role:"region","aria-label":e.title,children:[t("div",{className:"b2b-quick-order-form-quick-order-items-list__title",children:e.title}),r.length>0&&S(Q,{children:[t(Y,{role:"list",className:"b2b-quick-order-form-quick-order-items-list__list",children:r.map(y=>t(ve,{item:y,t:e,onRemove:a,onUpdateQuantity:m,isUpdating:p==null?void 0:p(y.sku),loading:c,productsSearch:l,searchFilter:k,slots:o},y.sku))}),t(Z,{variant:"secondary"})]}),t("div",{className:"b2b-quick-order-form-quick-order-items-list__global-search",children:t(J,{t:e,onChange:g,items:_,value:q,shouldShowResults:u,onItemClick:b,className:"b2b-quick-order-form-quick-order-items-list__search"})}),r.length===0&&t("div",{className:"b2b-quick-order-form-quick-order-items-list__empty","data-testid":"empty-items",children:e.emptyList}),t(T,{slot:o==null?void 0:o.AddAllToCartButton,name:"AddAllToCartButton",context:{handleAddToCart:i,clearItems:s,loading:c,isDisabledButton:d},"data-testid":"addAllToCart",children:t("div",{className:"b2b-quick-order-form-quick-order-items-list__actions",children:t(U,{variant:"primary",onClick:i,"data-testid":"add-all-to-cart-button",disabled:c||d,children:e.addAllToCart})})})]})},Ee=P(me),ke=({item:e,t:r,onRemove:a,onUpdateQuantity:s,isUpdating:m,loading:o,productsSearch:i,searchFilter:p,slots:c})=>{var L,V;const d=`quick-order-item-${e.id||e.variantSku||e.sku}`,l=(e==null?void 0:e.variantSku)??(e==null?void 0:e.sku),{searchValue:k,searchResults:q,handleSearchChange:_,shouldShowResults:g,handleItemClick:u}=G({productsSearch:i,initialSku:l,replaceItemSku:e.sku,searchFilter:p}),b=`form-${e.id||l}`,y=e.inStock&&e.addToCartAllowed,w=e.options&&e.options.length>0,O=F(()=>w&&e.options.some(h=>h.required),[w,e.options]),N=F(()=>w&&e.options.some(h=>h.items&&h.items.some(n=>n.selected)),[w,e.options]),$=F(()=>O?e.options.every(h=>h.required?h.items&&h.items.some(n=>n.selected):!0):N,[O,N,e.options]),v=F(()=>{var h;return(h=e.images)==null?void 0:h.find(n=>{var f;return(f=n.roles)==null?void 0:f.includes("image")})},[e.images]),D=A(()=>{a==null||a(e.id||e.sku)},[a,e.id,e.sku]),C=A(h=>{s==null||s(e.sku,h);const n=document.forms[b];if(n){const f=n.querySelector('input[name="quantity"]');f&&(f.value=String(h))}},[s,e.sku,b]),R=t(T,{name:"QuickOrderItemSearch",slot:c==null?void 0:c.QuickOrderItemSearch,context:{item:e,scope:d,handleSearchChange:_,searchResults:q,searchValue:k,shouldShowResults:g,handleItemClick:u},children:t(J,{t:r,onChange:_,items:q,value:k,shouldShowResults:g,className:"b2b-quick-order-form-quick-order-items__item-search",onItemClick:u,slots:c})});return!e.name&&!((L=e.images)!=null&&L.length)?S("form",{name:b,className:"b2b-quick-order-form-quick-order-items__item-form",onSubmit:h=>h.preventDefault(),"data-sku":e.sku,children:[t("input",{type:"hidden",name:"sku",value:e.sku}),t("input",{type:"hidden",name:"quantity",value:e.quantity}),t("input",{type:"hidden",name:"valid",value:"false"}),t("input",{type:"hidden",name:"productType",value:""}),R,t(j,{sku:t("span",{children:e.sku}),title:t("span",{children:r.productNotFound}),quantity:e.quantity,alert:t("div",{className:"b2b-quick-order-items__error",children:(V=r.productNotFoundDescription)==null?void 0:V.replace("{sku}",e.sku)}),disabled:o,onRemove:D,ariaLabel:`${r.productNotFound} - ${e.sku}`})]},e.sku):S("form",{name:b,className:"b2b-quick-order-form-quick-order-items__item-form",onSubmit:h=>h.preventDefault(),"data-sku":l,children:[t("input",{type:"hidden",name:"sku",value:l}),t("input",{type:"hidden",name:"quantity",value:e.quantity}),t("input",{type:"hidden",name:"valid",value:y?"true":"false"}),t("input",{type:"hidden",name:"productType",value:e.productType||""}),R,t(j,{title:t("span",{children:e.name}),sku:t("span",{children:l}),image:v?t("img",{src:v.url,alt:v.label||e.name}):void 0,price:t(T,{name:"ProductPrice",slot:c==null?void 0:c.ProductPrice,context:{item:e,scope:d}}),quantity:e.quantity,alert:e.inStock===!1?t("div",{className:"b2b-quick-order-items__alert",children:r.outOfStock}):void 0,warning:w&&!$?t("div",{className:"b2b-quick-order-items__warning",children:r.configurableOptionsWarning}):void 0,footer:w?t(ee,{title:r.productOptions,ariaLabelTitle:r.productOptions,defaultOpen:!$,className:"b2b-quick-order-list-item__accordion",actionIconPosition:"left",children:t(T,{name:"ProductOptions",slot:c==null?void 0:c.ProductOptions,context:{item:e,scope:d},children:t("div",{className:"b2b-quick-order-items__configurable-error",children:r.configurableProductErrorDescription})})}):void 0,updating:m,disabled:o,loading:o,onRemove:D,onQuantity:C,ariaLabel:`${e.name} - ${e.sku}`})]},l)},ve=P(ke),qe={cursor:"pointer"},_e={cursor:"default"},ye=({t:e,value:r,onChange:a,items:s,shouldShowResults:m=!0,className:o,onItemClick:i,slots:p})=>{const[c,d]=I(-1),[l,k]=I(""),[q,_]=I(!1),[g,u]=I(!1),b=E(`search-results-${Math.random().toString(36).substr(2,9)}`),y=E(null),w=E([]),O=E(null),N=E(null),$=!!r&&!g,v=m&&$&&s.length>0,D=m&&$&&s.length===0;W(()=>{d(-1)},[s]),W(()=>()=>{x(N.current)},[]);const C=A(n=>()=>{_(!0),u(!0),i==null||i(n),d(-1)},[i]),R=A(()=>{x(N.current),N.current=null,k(r||""),_(!1),u(!1)},[r]),L=A(()=>{N.current=ue({containerRef:O.current,itemSelected:q,initialValue:l,currentValue:r||"",onValueRestore:n=>{a==null||a({target:{value:n}})},onClose:()=>{u(!0)}})},[q,l,r,a]),V=A(n=>{if(v)switch(n.key){case"ArrowDown":n.preventDefault(),d(f=>oe(f,s.length));break;case"ArrowUp":n.preventDefault(),d(f=>de(f));break;case"Home":v&&s.length>0&&(n.preventDefault(),d(he()));break;case"End":v&&s.length>0&&(n.preventDefault(),d(pe(s.length)));break;case"Tab":x(N.current),N.current=null,u(!0),a==null||a({target:{value:l}});break;case"Enter":{be(c,s,B=>{_(!0),u(!0),i==null||i(B),d(-1)})&&n.preventDefault();break}case"Escape":n.preventDefault(),fe(l,y.current,f=>{a==null||a({target:{value:f}}),d(-1),u(!0)},()=>{u(!0)});break}},[v,s,c,i,a,l]),h=A(()=>{if(c>=0&&v)return`${b.current}-item-${c}`},[c,v]);return S("div",{ref:O,className:K(["b2b-quick-order-search",o]),children:[t(re,{ref:y,className:"b2b-quick-order-search__input",value:r,onChange:a,onFocus:R,onBlur:L,placeholder:e.searchPlaceholder,"aria-label":e.searchAriaLabel,role:"combobox","aria-autocomplete":"list","aria-expanded":v,"aria-controls":b.current,"aria-activedescendant":h(),onKeyDown:V}),v&&t("div",{id:b.current,role:"listbox",className:"b2b-quick-order-search__results","aria-label":e.searchAriaLabel,children:s.map((n,f)=>t(T,{slot:p==null?void 0:p.QuickOrderSearchAutocompleteItem,name:"QuickOrderSearchAutocompleteItem",context:{item:n,index:f,createItemClickHandler:C,activeIndex:c},children:t("div",{id:`${b.current}-item-${f}`,ref:B=>w.current[f]=B,role:"option","aria-selected":f===c,className:K(["b2b-quick-order-search__result-item",f===c&&"b2b-quick-order-search__result-item--active"]),onClick:C(n),style:i?qe:_e,children:`${n.sku} ${n.name}`})},n.sku))}),D&&t("div",{className:"b2b-quick-order-search__empty-state",role:"status","aria-live":"polite",children:e.searchEmptyState}),v&&S("div",{className:"sr-only",role:"status","aria-live":"polite","aria-atomic":"true",children:[s.length," ",s.length===1?e.resultAvailable:e.resultsAvailable,"."," ",e.srInstructions]})]})},J=P(ye),Te=({isDisabled:e,message:r,children:a})=>S("div",{className:"b2b-quick-order-disabled-overlay",children:[t("div",{className:"b2b-quick-order-disabled-overlay__content",style:{pointerEvents:e?"none":"auto"},children:a}),e&&S(Q,{children:[t("div",{className:"b2b-quick-order-disabled-overlay__blur"}),t("div",{className:"b2b-quick-order-disabled-overlay__message",children:r})]})]});export{$e as C,Te as Q,Ee as a,K as c,ne as d};
//# sourceMappingURL=QuickOrderDisabledOverlay.js.map
