/*! Copyright 2026 Adobe
All Rights Reserved. */
import{jsxs as w,jsx as t,Fragment as Q}from"@dropins/tools/preact-jsx-runtime.js";import{memo as F,useCallback as O,useState as V,useRef as D,useEffect as P,useMemo as L}from"@dropins/tools/preact-compat.js";import{InputFile as J,CartList as X,Divider as Y,Button as Z,CartItem as W,AccordionSection as U,Input as ee}from"@dropins/tools/components.js";import{Slot as T}from"@dropins/tools/lib.js";import{useState as H,useRef as re,useEffect as j,useMemo as te,useCallback as M}from"@dropins/tools/preact-hooks.js";import{events as ae}from"@dropins/tools/event-bus.js";const K=e=>e.reduce((a,s)=>{if(!s)return a;if(typeof s=="string"&&(a+=` ${s}`),Array.isArray(s)){const[o,n]=s;o&&n&&(a+=` ${o}`)}return a},"").trim(),se=({t:e,onFileUpload:r,error:a,fileName:s,onDownloadSample:o,showSampleDownload:n,disabled:l})=>{const u=O(m=>{var h;const b=(h=m.target.files)==null?void 0:h[0];b&&r(b)},[r]);return w("div",{className:"b2b-quick-order-csv-file-input",children:[t("div",{className:"b2b-quick-order-csv-file-input__title",children:e.title}),w("div",{className:"b2b-quick-order-csv-file-input__helper",children:[e.helperText,n&&t(Q,{children:t("button",{type:"button",className:"b2b-quick-order-csv-file-input__download-link",onClick:o,"data-testid":"download-sample",disabled:l,children:e.downloadSample})})]}),t("div",{className:`b2b-quick-order-csv-file-input__input-wrapper ${l?"b2b-quick-order-csv-file-input__input-wrapper--disabled":""}`,children:t(J,{id:"quick-order-csv-file-input",label:e.inputLabel,className:"b2b-quick-order-csv-file-input__input",onChange:u,accept:".csv",disabled:l})}),s&&w("div",{className:"b2b-quick-order-csv-file-input__file-name","data-testid":"file-name",children:[e.selectedFile,": ",s]}),a&&t("div",{className:"b2b-quick-order-csv-file-input__error","data-testid":"error-message",role:"alert",children:a})]})},$e=F(se),ne=(e,r)=>{let a;return function(...s){clearTimeout(a),a=setTimeout(()=>e.apply(this,s),r)}},ce=[{attribute:"visibility",in:["Search","Catalog, Search"]}],ie=e=>{const{containerRef:r,itemSelected:a,initialValue:s,currentValue:o,onValueRestore:n,onClose:l}=e,u=document.activeElement;(r==null?void 0:r.contains(u))||(l(),!a&&s!==o&&n(s))},le=(e,r=150)=>window.setTimeout(()=>{ie(e)},r),x=e=>{e&&clearTimeout(e)},ue=(e,r)=>r===0?-1:e<r-1?e+1:e,oe=e=>e>0?e-1:-1,de=()=>0,he=e=>Math.max(0,e-1),pe=(e,r,a)=>e>=0&&r[e]?(a(r[e]),!0):!1,be=(e,r,a,s)=>{a(e),s(),r&&"blur"in r&&typeof r.blur=="function"&&r.blur()},z=({productsSearch:e,initialSku:r,replaceItemSku:a,searchFilter:s=ce})=>{const[o,n]=H(r),[l,u]=H([]),[c,m]=H(!1),d=re(!0);j(()=>()=>{d.current=!1},[]),j(()=>{c||n(r)},[r,c]);const b=te(()=>ne(async f=>{if(!f||!e){d.current&&u([]);return}try{const k=await e({phrase:f,filter:s});d.current&&u(k.items||[])}catch(k){console.error("Error searching products:",k),d.current&&u([])}},300),[e,s]),h=M(f=>{const v=f.target.value;n(v),m(!0),b(v)},[b]),q=M(()=>{n(""),u([]),m(!1)},[]),y=M(f=>{const k={sku:f.sku,...f.variantSku&&{variantSku:f.variantSku},quantity:1,...a&&{replaceItemSku:a}};ae.emit("quick-order/add-items",[k]),q()},[a,q]);return{searchValue:o,searchResults:l,handleSearchChange:h,shouldShowResults:c,resetSearch:q,handleItemClick:y}},fe=({value:e,onChange:r,items:a,shouldShowResults:s=!0,onItemClick:o})=>{const[n,l]=V(-1),[u,c]=V(""),[m,d]=V(!1),[b,h]=V(!1),q=D(`search-results-${Math.random().toString(36).substr(2,9)}`),y=D(null),f=D([]),k=D(null),v=D(null),S=!!e&&!b,_=s&&S&&a.length>0,$=s&&S&&a.length===0;P(()=>{l(-1)},[a]),P(()=>()=>{x(v.current)},[]),P(()=>{if(n>=0&&f.current[n]){const p=f.current[n];p&&typeof p.scrollIntoView=="function"&&p.scrollIntoView({behavior:"smooth",block:"nearest"})}},[n]);const g=O(p=>{b&&h(!1),r==null||r(p)},[r,b]),N=O(p=>()=>{d(!0),h(!0),o==null||o(p),l(-1)},[o]),E=O(()=>{x(v.current),v.current=null,c(e||""),d(!1),h(!1)},[e]),B=O(()=>{v.current=le({containerRef:k.current,itemSelected:m,initialValue:u,currentValue:e||"",onValueRestore:p=>{r==null||r({target:{value:p}})},onClose:()=>{h(!0)}})},[m,u,e,r]),C=O(p=>{if(_)switch(p.key){case"ArrowDown":p.preventDefault(),l(i=>ue(i,a.length));break;case"ArrowUp":p.preventDefault(),l(i=>oe(i));break;case"Home":_&&a.length>0&&(p.preventDefault(),l(de()));break;case"End":_&&a.length>0&&(p.preventDefault(),l(he(a.length)));break;case"Tab":x(v.current),v.current=null,h(!0),r==null||r({target:{value:u}});break;case"Enter":{pe(n,a,A=>{d(!0),h(!0),o==null||o(A),l(-1)})&&p.preventDefault();break}case"Escape":p.preventDefault(),be(u,y.current,i=>{r==null||r({target:{value:i}}),l(-1),h(!0)},()=>{h(!0)});break}},[_,a,n,o,r,u]),I=O(()=>{if(n>=0&&_)return`${q.current}-item-${n}`},[n,_]);return{activeIndex:n,showResults:_,showEmptyState:$,resultsId:q,inputRef:y,itemRefs:f,containerRef:k,handleChange:g,handleFocus:E,handleBlur:B,handleKeyDown:C,createItemClickHandler:N,getActiveDescendant:I}},me=({t:e,items:r,onRemove:a,clearItems:s,onUpdateQuantity:o,slots:n,handleAddToCart:l,isItemUpdating:u,loading:c,isDisabledButton:m,productsSearch:d,searchFilter:b})=>{const{searchValue:h,searchResults:q,handleSearchChange:y,shouldShowResults:f,handleItemClick:k}=z({productsSearch:d,initialSku:"",searchFilter:b});return w("div",{className:K(["b2b-quick-order-form-quick-order-items-list"]),role:"region","aria-label":e.title,children:[t("div",{className:"b2b-quick-order-form-quick-order-items-list__title",children:e.title}),r.length>0&&w(Q,{children:[t(X,{role:"list",className:"b2b-quick-order-form-quick-order-items-list__list",children:r.map(v=>t(ve,{item:v,t:e,onRemove:a,onUpdateQuantity:o,isUpdating:u==null?void 0:u(v.sku),loading:c,productsSearch:d,searchFilter:b,slots:n},v.sku))}),t(Y,{variant:"secondary"})]}),t("div",{className:"b2b-quick-order-form-quick-order-items-list__global-search",children:t(G,{t:e,onChange:y,items:q,value:h,shouldShowResults:f,onItemClick:k,className:"b2b-quick-order-form-quick-order-items-list__search"})}),r.length===0&&t("div",{className:"b2b-quick-order-form-quick-order-items-list__empty","data-testid":"empty-items",children:e.emptyList}),t(T,{slot:n==null?void 0:n.AddAllToCartButton,name:"AddAllToCartButton",context:{handleAddToCart:l,clearItems:s,loading:c,isDisabledButton:m},"data-testid":"addAllToCart",children:t("div",{className:"b2b-quick-order-form-quick-order-items-list__actions",children:t(Z,{variant:"primary",onClick:l,"data-testid":"add-all-to-cart-button",disabled:c||m,children:e.addAllToCart})})})]})},Ee=F(me),ke=({item:e,t:r,onRemove:a,onUpdateQuantity:s,isUpdating:o,loading:n,productsSearch:l,searchFilter:u,slots:c})=>{var I,p;const m=`quick-order-item-${e.id||e.variantSku||e.sku}`,d=(e==null?void 0:e.variantSku)??(e==null?void 0:e.sku),{searchValue:b,searchResults:h,handleSearchChange:q,shouldShowResults:y,handleItemClick:f}=z({productsSearch:l,initialSku:d,replaceItemSku:e.sku,searchFilter:u}),k=`form-${e.id||d}`,v=e.inStock&&e.addToCartAllowed,S=e.options&&e.options.length>0,_=L(()=>S&&e.options.some(i=>i.required),[S,e.options]),$=L(()=>S&&e.options.some(i=>i.items&&i.items.some(A=>A.selected)),[S,e.options]),g=L(()=>_?e.options.every(i=>i.required?i.items&&i.items.some(A=>A.selected):!0):$,[_,$,e.options]),N=L(()=>{var i;return(i=e.images)==null?void 0:i.find(A=>{var R;return(R=A.roles)==null?void 0:R.includes("image")})},[e.images]),E=O(()=>{a==null||a(e.id||e.sku)},[a,e.id,e.sku]),B=O(i=>{s==null||s(e.sku,i);const A=document.forms[k];if(A){const R=A.querySelector('input[name="quantity"]');R&&(R.value=String(i))}},[s,e.sku,k]),C=t(T,{name:"QuickOrderItemSearch",slot:c==null?void 0:c.QuickOrderItemSearch,context:{item:e,scope:m,handleSearchChange:q,searchResults:h,searchValue:b,shouldShowResults:y,handleItemClick:f},children:t(G,{t:r,onChange:q,items:h,value:b,shouldShowResults:y,className:"b2b-quick-order-form-quick-order-items__item-search",onItemClick:f,slots:c})});return!e.name&&!((I=e.images)!=null&&I.length)?w("form",{name:k,className:"b2b-quick-order-form-quick-order-items__item-form",onSubmit:i=>i.preventDefault(),"data-sku":e.sku,children:[t("input",{type:"hidden",name:"sku",value:e.sku}),t("input",{type:"hidden",name:"quantity",value:e.quantity}),t("input",{type:"hidden",name:"valid",value:"false"}),t("input",{type:"hidden",name:"productType",value:""}),C,t(W,{sku:t("span",{children:e.sku}),title:t("span",{children:r.productNotFound}),quantity:e.quantity,alert:t("div",{className:"b2b-quick-order-items__error",children:(p=r.productNotFoundDescription)==null?void 0:p.replace("{sku}",e.sku)}),disabled:n,onRemove:E,ariaLabel:`${r.productNotFound} - ${e.sku}`})]},e.sku):w("form",{name:k,className:"b2b-quick-order-form-quick-order-items__item-form",onSubmit:i=>i.preventDefault(),"data-sku":d,children:[t("input",{type:"hidden",name:"sku",value:d}),t("input",{type:"hidden",name:"quantity",value:e.quantity}),t("input",{type:"hidden",name:"valid",value:v?"true":"false"}),t("input",{type:"hidden",name:"productType",value:e.productType||""}),C,t(W,{title:t("span",{children:e.name}),sku:t("span",{children:d}),image:N?t("img",{src:N.url,alt:N.label||e.name}):void 0,price:t(T,{name:"ProductPrice",slot:c==null?void 0:c.ProductPrice,context:{item:e,scope:m}}),quantity:e.quantity,alert:e.inStock===!1?t("div",{className:"b2b-quick-order-items__alert",children:r.outOfStock}):void 0,warning:S&&!g?t("div",{className:"b2b-quick-order-items__warning",children:r.configurableOptionsWarning}):void 0,footer:S?t(U,{title:r.productOptions,ariaLabelTitle:r.productOptions,defaultOpen:!g,className:"b2b-quick-order-list-item__accordion",actionIconPosition:"left",children:t(T,{name:"ProductOptions",slot:c==null?void 0:c.ProductOptions,context:{item:e,scope:m},children:t("div",{className:"b2b-quick-order-items__configurable-error",children:r.configurableProductErrorDescription})})}):void 0,updating:o,disabled:n,loading:n,onRemove:E,onQuantity:B,ariaLabel:`${e.name} - ${e.sku}`})]},d)},ve=F(ke),qe={cursor:"pointer"},_e={cursor:"default"},ye=({t:e,value:r,onChange:a,items:s,shouldShowResults:o=!0,className:n,onItemClick:l,slots:u})=>{const{activeIndex:c,showResults:m,showEmptyState:d,resultsId:b,inputRef:h,itemRefs:q,containerRef:y,handleChange:f,handleFocus:k,handleBlur:v,handleKeyDown:S,createItemClickHandler:_,getActiveDescendant:$}=fe({value:r,onChange:a,items:s,shouldShowResults:o,onItemClick:l});return w("div",{ref:y,className:K(["b2b-quick-order-search",n]),children:[t(ee,{ref:h,className:"b2b-quick-order-search__input",value:r,onChange:f,onFocus:k,onBlur:v,placeholder:e.searchPlaceholder,"aria-label":e.searchAriaLabel,role:"combobox","aria-autocomplete":"list","aria-expanded":m,"aria-controls":b.current,"aria-activedescendant":$(),onKeyDown:S}),m&&t("div",{id:b.current,role:"listbox",className:"b2b-quick-order-search__results","aria-label":e.searchAriaLabel,children:s.map((g,N)=>t(T,{slot:u==null?void 0:u.QuickOrderSearchAutocompleteItem,name:"QuickOrderSearchAutocompleteItem",context:{item:g,index:N,createItemClickHandler:_,activeIndex:c},children:t("div",{id:`${b.current}-item-${N}`,ref:E=>q.current[N]=E,role:"option","aria-selected":N===c,className:K(["b2b-quick-order-search__result-item",N===c&&"b2b-quick-order-search__result-item--active"]),onClick:_(g),style:l?qe:_e,children:`${g.sku} ${g.name}`})},g.sku))}),d&&t("div",{className:"b2b-quick-order-search__empty-state",role:"status","aria-live":"polite",children:e.searchEmptyState}),m&&w("div",{className:"sr-only",role:"status","aria-live":"polite","aria-atomic":"true",children:[s.length," ",s.length===1?e.resultAvailable:e.resultsAvailable,"."," ",e.srInstructions]})]})},G=F(ye),Re=({isDisabled:e,message:r,children:a})=>w("div",{className:"b2b-quick-order-disabled-overlay",children:[t("div",{className:"b2b-quick-order-disabled-overlay__content",style:{pointerEvents:e?"none":"auto"},children:a}),e&&w(Q,{children:[t("div",{className:"b2b-quick-order-disabled-overlay__blur"}),t("div",{className:"b2b-quick-order-disabled-overlay__message",children:r})]})]});export{$e as C,Re as Q,Ee as a,K as c,ne as d};
//# sourceMappingURL=QuickOrderDisabledOverlay.js.map
