/*! Copyright 2026 Adobe
All Rights Reserved. */
import{jsx as v}from"@dropins/tools/preact-jsx-runtime.js";import{Q as V,C as S}from"../chunks/QuickOrderDisabledOverlay.js";import"@dropins/tools/components.js";import{useState as k,useCallback as f}from"@dropins/tools/preact-hooks.js";import{events as w}from"@dropins/tools/event-bus.js";import{useText as Q}from"@dropins/tools/i18n.js";import{c as h}from"../chunks/initialize.js";import{classes as y}from"@dropins/tools/lib.js";import"@dropins/tools/preact-compat.js";import"@dropins/tools/fetch-graphql.js";const F=n=>n.trim().replace(/^["']|["']$/g,""),O=200,I=(n,t)=>{const i=n.replace(/^\uFEFF/,"").trim().split(/\r?\n|\r/);if(!i.some(e=>e.trim()))return{isValid:!1,error:t.emptyFile};const a=i[0].split(",").map(e=>F(e).toLowerCase()),r=a.indexOf("sku"),c=a.indexOf("qty");if(r===-1||c===-1)return{isValid:!1,error:t.missingColumns};if(a.length!==2)return{isValid:!1,error:t.extraColumns};if(i.length-1>O)return{isValid:!1,error:t.maxRowsExceeded.replace("{maxRows}",O.toString())};const d=[];for(let e=1;e<i.length;e++){const s=i[e].trim();if(!s)continue;const u=s.split(",").map(x=>F(x)),l=u[r],C=u[c];if(!l)return{isValid:!1,error:t.skuRequired.replace("{rowNumber}",e.toString())};const o=parseInt(C,10);if(isNaN(o)||o<=0||!Number.isInteger(o))return{isValid:!1,error:t.invalidQuantity.replace("{rowNumber}",e.toString())};d.push({sku:l,quantity:o})}return d.length===0?{isValid:!1,error:t.noValidData}:{isValid:!0,data:d}},b=({routeSampleCSV:n,onFileUpload:t})=>{const[m,i]=k(null),[p,a]=k(null),r=Q({invalidFile:"QuickOrder.CsvFileInput.uploadCSVErrors.invalidFile",emptyFile:"QuickOrder.CsvFileInput.uploadCSVErrors.emptyFile",missingColumns:"QuickOrder.CsvFileInput.uploadCSVErrors.missingColumns",extraColumns:"QuickOrder.CsvFileInput.uploadCSVErrors.extraColumns",maxRowsExceeded:"QuickOrder.CsvFileInput.uploadCSVErrors.maxRowsExceeded",skuRequired:"QuickOrder.CsvFileInput.uploadCSVErrors.skuRequired",invalidQuantity:"QuickOrder.CsvFileInput.uploadCSVErrors.invalidQuantity",noValidData:"QuickOrder.CsvFileInput.uploadCSVErrors.noValidData",onlyCSV:"QuickOrder.CsvFileInput.uploadCSVErrors.onlyCSV",failedToRead:"QuickOrder.CsvFileInput.uploadCSVErrors.failedToRead",failedToParse:"QuickOrder.CsvFileInput.uploadCSVErrors.failedToParse"}),c=f(e=>{if(i(null),a(e.name),!e.name.toLowerCase().endsWith(".csv")){i(r.onlyCSV);return}const s=new FileReader;s.onload=u=>{var l;try{const C=(l=u.target)==null?void 0:l.result,o=I(C,{emptyFile:r.emptyFile,missingColumns:r.missingColumns,extraColumns:r.extraColumns,maxRowsExceeded:r.maxRowsExceeded,skuRequired:r.skuRequired,invalidQuantity:r.invalidQuantity,noValidData:r.noValidData});if(!o.isValid){i(o.error);return}t?t(o.data):w.emit("quick-order/add-items",o.data),a(null),i(null)}catch{i(r.failedToParse)}},s.onerror=()=>{i(r.failedToRead)},s.readAsText(e)},[t,r]),d=f(()=>{if(n)window.open(n,"_blank");else{const e=`SKU,QTY
SKU123,1
SKU456,2
SKU789,3`,s=new Blob([e],{type:"text/csv"}),u=URL.createObjectURL(s),l=document.createElement("a");l.href=u,l.download="sample-quick-order.csv",document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(u)}},[n]);return{handleFileUpload:c,error:m,fileName:p,handleDownloadSample:d,showSampleDownload:!0}},K=({className:n,routeSampleCSV:t,onFileUpload:m})=>{const i=h.getConfig().quickOrderActive,p=Q({title:"QuickOrder.CsvFileInput.title",helperText:"QuickOrder.CsvFileInput.helperText",downloadSample:"QuickOrder.CsvFileInput.downloadSample",inputLabel:"QuickOrder.CsvFileInput.inputLabel",selectedFile:"QuickOrder.CsvFileInput.selectedFile",disabledMessage:"QuickOrder.QuickOrderItem.disabledMessage"}),{handleFileUpload:a,error:r,fileName:c,handleDownloadSample:d,showSampleDownload:e}=b({routeSampleCSV:t,onFileUpload:m});return v("div",{className:y(["b2b-quick-order-quick-order-upload-csv",n]),"data-testid":"quick-order-upload-csv",children:v(V,{isDisabled:!i,message:p.disabledMessage,children:v(S,{t:p,onFileUpload:a,error:r,fileName:c,onDownloadSample:d,showSampleDownload:e})})})};export{K as QuickOrderCsvUpload,K as default};
//# sourceMappingURL=QuickOrderCsvUpload.js.map
