/*! Copyright 2026 Adobe
All Rights Reserved. */
import{jsx as o,jsxs as I}from"@dropins/tools/preact-jsx-runtime.js";import{Slot as E,classes as $}from"@dropins/tools/lib.js";import{Header as Z,InLineAlert as S,InputPassword as k}from"@dropins/tools/components.js";import"@dropins/tools/event-bus.js";import"@dropins/tools/recaptcha.js";import{useState as w,useEffect as z,useCallback as J}from"@dropins/tools/preact-hooks.js";import{u as W,F as O}from"../chunks/Button.js";import{v as g,u as R,a as C}from"../chunks/usePasswordValidationMessage.js";import{a as tt}from"../chunks/getCustomerToken.js";import{r as et}from"../chunks/resetPassword.js";import{c as j,g as at,u as rt,B as st}from"../chunks/Button2.js";import{useText as it}from"@dropins/tools/i18n.js";import"@dropins/tools/preact-compat.js";import"../chunks/getAdobeCommerceOptimizerData.js";import"../chunks/network-error.js";import"@dropins/tools/fetch-graphql.js";import"../fragments.js";import"../chunks/acdl.js";import"../chunks/setReCaptchaToken.js";const K=(d,p)=>d.split("&").filter(s=>s.includes(p)).map(s=>s.split("=")[1])[0],ot=({isEmailConfirmationRequired:d,signInOnSuccess:p,passwordConfigs:e,routeRedirectOnSignIn:s,routeWrongUrlRedirect:N,onErrorCallback:t,onSuccessCallback:i,handleSetInLineAlertProps:m,routeRedirectOnPasswordUpdate:P,routeSignInPage:u})=>{const r=it({errorNotification:"Auth.Notification.errorNotification",updatePasswordMessage:"Auth.Notification.updatePasswordMessage",updatePasswordActionMessage:"Auth.Notification.updatePasswordActionMessage",customerTokenErrorMessage:"Auth.Api.customerTokenErrorMessage"}),[q,n]=w({userName:"",status:!1}),[T,v]=w(""),[_,x]=w(!1),[A,U]=w(""),[y,L]=w(""),[M,c]=w(!1),[F,f]=w(!1),[b,D]=w([]);z(()=>{_&&!b.length&&(T.length?f(!1):f(!0))},[_,T,b]),z(()=>{const{search:h}=window.location;!h.includes("token=")&&!h.includes("email=")&&j(N)&&(window.location.href=N());const a=decodeURIComponent(h),V=K(a,"token"),B=K(a,"email");U(B),L(V)},[N]);const Q=J(async h=>{h.preventDefault(),c(!0),D([]);const a=at(h.target),V=(a==null?void 0:a.password)&&A&&y;a!=null&&a.password||(f(!0),c(!1));const B=(e==null?void 0:e.requiredCharacterClasses)??0,Y=(e==null?void 0:e.minLength)??0;if(!g(a==null?void 0:a.password,B)||a.password.length<+Y){x(!0),c(!1);return}if(!V){m({type:"error",text:r.errorNotification}),c(!1);return}const{message:G,success:H}=await et(A,y,a.password);if(H){if(d||!d&&!p){i==null||i(),j(P)&&(window.location.href=P()),x(!0),c(!1),f(!1),v(""),D([{label:r.updatePasswordActionMessage,onClick:()=>{window.location.href=u==null?void 0:u()}}]),m({type:"success",text:r.updatePasswordMessage});return}const l=await tt({email:A,password:a.password,handleSetInLineAlertProps:m,onErrorCallback:t,translations:r});l!=null&&l.userName&&(i==null||i(l==null?void 0:l.userName),j(s)?window.location.href=s():n({userName:l==null?void 0:l.userName,status:!0}))}else m({type:"error",text:G}),t==null||t({message:G,success:H});c(!1)},[A,y,e==null?void 0:e.requiredCharacterClasses,e==null?void 0:e.minLength,r,d,p,u,t,i,s,m,P]),X=J(h=>{v(h)},[]);return{additionalActionsAlert:b,passwordError:F,isSuccessful:q,updatePasswordValue:T,isClickSubmit:_,isLoading:M,submitUpdatePassword:Q,handleSetUpdatePasswordValue:X,setIsClickSubmit:x}},ut=({signInOnSuccess:d=!0,formSize:p="default",routeRedirectOnSignIn:e,routeWrongUrlRedirect:s,routeSignInPage:N,slots:t,onErrorCallback:i,onSuccessCallback:m,routeRedirectOnPasswordUpdate:P})=>{const u=W({title:"Auth.UpdatePasswordForm.title",buttonPrimary:"Auth.UpdatePasswordForm.buttonPrimary",placeholder:"Auth.InputPassword.placeholder",floatingLabel:"Auth.InputPassword.floatingLabel",requiredFieldError:"Auth.FormText.requiredFieldError.default"}),{passwordConfigs:r,isEmailConfirmationRequired:q}=R(),{inLineAlertProps:n,handleSetInLineAlertProps:T}=rt(),{additionalActionsAlert:v,passwordError:_,isSuccessful:x,updatePasswordValue:A,isClickSubmit:U,isLoading:y,submitUpdatePassword:L,handleSetUpdatePasswordValue:M}=ot({isEmailConfirmationRequired:q,signInOnSuccess:d,passwordConfigs:r,routeRedirectOnSignIn:e,routeWrongUrlRedirect:s,onErrorCallback:i,onSuccessCallback:m,handleSetInLineAlertProps:T,routeRedirectOnPasswordUpdate:P,routeSignInPage:N}),{isValidUniqueSymbols:c,defaultLengthMessage:F}=C({password:A,isClickSubmit:U,passwordConfigs:r});if(x.status&&(t!=null&&t.SuccessNotification))return o(E,{"data-testid":"successNotificationTestId",name:"SuccessNotification",slot:t==null?void 0:t.SuccessNotification,context:{isSuccessful:x}});const f={isLoading:y,passwordError:_,isSuccessful:x};return I("div",{className:$(["auth-update-password-form",`auth-update-password-form--${p}`]),children:[o(E,{name:"Title","data-testid":"title",slot:t==null?void 0:t.Title,context:{...f},children:o(Z,{title:u.title,divider:!1,className:"auth-update-password-form__title"})}),o(S,{className:$(["auth-update-password-form__notification",["auth-update-password-form__notification--show",!!(n!=null&&n.text)]]),variant:"secondary",heading:n==null?void 0:n.text,icon:n.icon,additionalActions:v}),I(O,{name:"updatePassword_form",className:"auth-update-password-form__form",onSubmit:L,loading:y,fieldsConfig:[],formSlot:{name:"Form",slot:t==null?void 0:t.Form,context:f,dataTestId:"form"},children:[o("div",{style:"display: none;",children:o("input",{type:"text",id:"username",name:"username",autoComplete:"username"})}),o(k,{defaultValue:A,onValue:M,className:"auth-update-password-form__form__item",autoComplete:"new-password",name:"password",errorMessage:_||c==="error"||(F==null?void 0:F.status)==="error"?u.requiredFieldError:void 0,minLength:r==null?void 0:r.minLength,uniqueSymbolsStatus:c,validateLengthConfig:F,requiredCharacterClasses:r==null?void 0:r.requiredCharacterClasses,placeholder:u.placeholder,floatingLabel:u.floatingLabel}),o(E,{name:"Buttons",className:"auth-update-password-form__button","data-testid":"buttons",slot:t==null?void 0:t.Buttons,context:{...f},children:o(st,{type:"submit",buttonText:u.buttonPrimary,variant:"primary",enableLoader:y})})]})]})},Ut=({slots:d,formSize:p,signInOnSuccess:e,routeRedirectOnPasswordUpdate:s,routeRedirectOnSignIn:N,routeSignInPage:t,routeWrongUrlRedirect:i,onErrorCallback:m,onSuccessCallback:P})=>o("div",{className:"auth-update-password",children:o(ut,{formSize:p,signInOnSuccess:e,routeSignInPage:t,routeRedirectOnSignIn:N,routeWrongUrlRedirect:i,onErrorCallback:m,onSuccessCallback:P,slots:d,routeRedirectOnPasswordUpdate:s})});export{Ut as UpdatePassword,Ut as default};
//# sourceMappingURL=UpdatePassword.js.map
