/*! Copyright 2026 Adobe
All Rights Reserved. */
import{jsx as o,jsxs as A}from"@dropins/tools/preact-jsx-runtime.js";import{Slot as se,classes as he}from"@dropins/tools/lib.js";import"@dropins/tools/event-bus.js";import"@dropins/tools/recaptcha.js";import{g as _e,c as Ce,a as Pe}from"./createCustomerAddress.js";import{useState as f,useEffect as fe,useCallback as T,useMemo as Ne,useRef as Ee}from"@dropins/tools/preact-hooks.js";import{s as me,b as Le}from"./simplifyTransformAttributesForm.js";import{v as Ae,u as Se,a as ye}from"./usePasswordValidationMessage.js";import{p as Me,E as Ue,d as Te,e as xe}from"./getAdobeCommerceOptimizerData.js";import{c as V,g as ve,u as qe,B as ue}from"./Button.js";import{c as Be}from"./transform-attributes-form.js";import{f as ce,E as ke}from"./focusOnEmptyPasswordField.js";import{Header as Ke,InLineAlert as Ie,InputPassword as le,Field as je,Checkbox as Ge}from"@dropins/tools/components.js";import{u as $e,F as He}from"./RemoteShoppingAssistance.js";import{S as Oe}from"./SkeletonLoader.js";const de=(u,s)=>s!=null&&s.length?u.map(e=>{var r;const g=(r=s.find(({code:i})=>i===e.code))==null?void 0:r.defaultValue;return g?{...e,defaultValue:g}:e}):u,Ve=({inputsDefaultValueSet:u,fieldsConfigForApiVersion1:s,apiVersion2:e})=>{const[g,r]=f([]);return fe(()=>{(async()=>{if(e){const c=await _e("customer_account_create");if(c!=null&&c.length)if(u!=null&&u.length){const n=de(c,u);r(n)}else r(c)}else{const c=me(Le),n=me(s),C=de(c,u);r(s&&s.length?n:C)}})()},[e,s,u]),{fieldsListConfigs:g.map(i=>({...i,...i.code==="email"?{autocomplete:"username"}:{}}))}},We=(u,s)=>{const e=["dob","email","firstname","gender","lastname","middlename","password","prefix","suffix","taxvat"],g=["allow_remote_shopping_assistance"],r=Be(u,"snakeCase",{firstName:"firstname",lastName:"lastname"});if(!s)return{...r,...r!=null&&r.gender?{gender:Number(r==null?void 0:r.gender)}:{}};const i={},c=[];return Object.keys(r).forEach(n=>{g.includes(n)||(e.includes(n)?i[n]=n.includes("gender")?Number(r[n]):r[n]:c.push({attribute_code:n,value:r[n]}))}),c.length>0&&(i.custom_attributes=c),i},Je=({requireRetypePassword:u,addressesData:s,translations:e,isEmailConfirmationRequired:g,apiVersion2:r=!0,passwordConfigs:i,isAutoSignInEnabled:c,routeRedirectOnSignIn:n,routeSignIn:C,onErrorCallback:N,onSuccessCallback:p,setActiveComponent:h,handleSetInLineAlertProps:b,routeRedirectOnEmailConfirmationClose:S})=>{const[a,l]=f(!1),[t,j]=f(""),[v,d]=f(""),[G,q]=f(""),[W,$]=f(!1),[J,B]=f({userName:"",status:!1}),[w,x]=f(""),[Q,H]=f(!1),[O,y]=f(!1),[X,Y]=f(!0),Z=T(m=>{const _=m.target.value;l(!_.length),_.length&&t.length&&_!==t&&d(e.passwordMismatch)},[t,e.passwordMismatch]),z=T(m=>{const _=m.target.value;d(_.length?"":e.requiredFieldError),_.length&&w.length&&_!==w&&d(e.passwordMismatch)},[w,e.passwordMismatch,e.requiredFieldError]),R=T(m=>{j(m),d(m?w===m?"":e.passwordMismatch:e.requiredFieldError)},[e,w]),D=T(({target:m})=>{Y(m.checked)},[]),ee=T(()=>{if(V(h)){h("signInForm");return}V(C)&&(window.location.href=C())},[h,C]),k=T(m=>{x(m),l(!m.length),m===t&&d("")},[t]),P=T(()=>{b(),x(""),V(S)?window.location.href=S():($(!1),h==null||h("signInForm"))},[b,S,h]),K=()=>{H(!0),y(!1)},re=(m,_)=>{const te=w.length&&t.length,I=w!==t,E=()=>{l(!w.length),t||d(e.requiredFieldError),te&&I&&d(e.passwordMismatch)},M=()=>{d(t.length?e.passwordMismatch:e.requiredFieldError),ce(m,w,t)};return _?u&&(v.length||I)?(K(),M(),!0):(ce(m,w,""),E(),!1):(K(),E(),!0)};return{showPasswordErrorMessage:a,confirmPassword:t,confirmPasswordMessage:v,isKeepMeLogged:X,userEmail:G,showEmailConfirmationForm:W,isSuccessful:J,isClickSubmit:Q,signUpPasswordValue:w,isLoading:O,onSubmitSignUp:async(m,_)=>{var oe,ie,ae;if(b(),d(""),y(!0),re(m,_))return;const{confirmPasswordField:te,...I}=ve(m.target),{email:E,password:M}=I,pe=(i==null?void 0:i.requiredCharacterClasses)||0,we=(i==null?void 0:i.minLength)||1;if(!Ae(M,pe)||we>(M==null?void 0:M.length)){K();return}const Fe=We({...I},r),L=await Ce(Fe,r);if((oe=L==null?void 0:L.errors)!=null&&oe.length){const{errors:U}=L;b==null||b({type:"error",text:(ie=U[0])==null?void 0:ie.message}),N==null||N(U),q(E)}else{const U=L==null?void 0:L.firstName;if(Me(Ue.CREATE_ACCOUNT_EVENT,{...L}),g||!c){if(p==null||p({userName:U,userEmail:E,status:!0}),g){(ae=m.target)==null||ae.reset(),x(""),$(!0),q(E),y(!1);return}if(!c){y(!1),B({userName:U,status:!0});return}}const F=await Te({email:E,password:M,translations:e,handleSetInLineAlertProps:b,onErrorCallback:N});if(F!=null&&F.userName){if(s!=null&&s.length)for(const ne of s)try{await Pe(ne)}catch(be){console.error(e.failedCreateCustomerAddress,ne,be)}p==null||p({userName:F==null?void 0:F.userName,userEmail:F==null?void 0:F.userEmail,status:!0}),V(n)?window.location.href=n():B({userName:F==null?void 0:F.userName,status:!0})}else p==null||p({userName:U,userEmail:E,status:!0}),B({userName:U,status:!0})}y(!1)},signInButton:ee,handleSetSignUpPasswordValue:k,onKeepMeLoggedChange:D,handleHideEmailConfirmationForm:P,handleConfirmPasswordChange:R,onBlurPassword:Z,onBlurConfirmPassword:z}},cr=({requireRetypePassword:u=!1,addressesData:s,formSize:e="default",inputsDefaultValueSet:g,fieldsConfigForApiVersion1:r,apiVersion2:i=!0,isAutoSignInEnabled:c=!0,hideCloseBtnOnEmailConfirmation:n=!1,routeRedirectOnEmailConfirmationClose:C,routeRedirectOnSignIn:N,routeSignIn:p,onErrorCallback:h,onSuccessCallback:b,setActiveComponent:S,slots:a})=>{const l=$e({title:"Auth.SignUpForm.title",buttonPrimary:"Auth.SignUpForm.buttonPrimary",buttonSecondary:"Auth.SignUpForm.buttonSecondary",keepMeLoggedText:"Auth.SignUpForm.keepMeLoggedText",customerTokenErrorMessage:"Auth.Api.customerTokenErrorMessage",failedCreateCustomerAddress:"Auth.SignUpForm.failedCreateCustomerAddress",remoteShoppingAssistanceLabel:"Auth.SignUpForm.remoteShoppingAssistanceLabel",placeholder:"Auth.InputPassword.placeholder",floatingLabel:"Auth.InputPassword.floatingLabel",requiredFieldError:"Auth.FormText.requiredFieldError.default",confirmPasswordPlaceholder:"Auth.SignUpForm.confirmPassword.placeholder",confirmPasswordFloatingLabel:"Auth.SignUpForm.confirmPassword.floatingLabel",passwordMismatch:"Auth.SignUpForm.confirmPassword.passwordMismatch"}),{passwordConfigs:t,isEmailConfirmationRequired:j}=Se(),{fieldsListConfigs:v}=Ve({fieldsConfigForApiVersion1:r,apiVersion2:i,inputsDefaultValueSet:g}),{inLineAlertProps:d,handleSetInLineAlertProps:G}=qe(),{showPasswordErrorMessage:q,confirmPassword:W,confirmPasswordMessage:$,isKeepMeLogged:J,userEmail:B,showEmailConfirmationForm:w,isSuccessful:x,isClickSubmit:Q,signUpPasswordValue:H,isLoading:O,onSubmitSignUp:y,signInButton:X,handleSetSignUpPasswordValue:Y,onKeepMeLoggedChange:Z,handleHideEmailConfirmationForm:z,handleConfirmPasswordChange:R,onBlurPassword:D,onBlurConfirmPassword:ee}=Je({requireRetypePassword:u,addressesData:s,translations:l,isEmailConfirmationRequired:j,apiVersion2:i,passwordConfigs:t,isAutoSignInEnabled:c,routeRedirectOnSignIn:N,routeSignIn:p,onErrorCallback:h,onSuccessCallback:b,setActiveComponent:S,handleSetInLineAlertProps:G,routeRedirectOnEmailConfirmationClose:C}),{isValidUniqueSymbols:k,defaultLengthMessage:P}=ye({password:H,isClickSubmit:Q,passwordConfigs:t}),K=Ne(()=>q?l.requiredFieldError:k==="error"||(P==null?void 0:P.status)==="error"?" ":"",[P==null?void 0:P.status,k,q,l.requiredFieldError]),re=!j&&(s==null?void 0:s.length);return!v.length&&i?o("div",{className:`auth-sign-up-form auth-sign-up-form--${e} skeleton-loader`,"data-testid":"SignUpForm",children:o(Oe,{activeSkeleton:"signUpForm"})}):x.status&&(a!=null&&a.SuccessNotification)?o(se,{"data-testid":"successNotificationTestId",name:"SuccessNotification",slot:a==null?void 0:a.SuccessNotification,context:{isSuccessful:x}}):w?o(ke,{formSize:e,userEmail:B,inLineAlertProps:d,hideCloseBtnOnEmailConfirmation:n,handleSetInLineAlertProps:G,onPrimaryButtonClick:z}):A("div",{className:he(["auth-sign-up-form",`auth-sign-up-form--${e}`]),"data-testid":"SignUpForm",children:[o(Ke,{title:l.title,divider:!1,className:"auth-sign-up-form__title"}),d.text?o(Ie,{className:"auth-sign-up-form__notification",type:d.type,variant:"secondary",heading:d.text,icon:d.icon}):null,A(He,{onSubmit:y,className:"auth-sign-up-form__form",loading:O,name:"signUp_form",fieldsConfig:v,slots:a,children:[A(le,{validateLengthConfig:P,className:"auth-sign-up-form__form__field",autoComplete:"current-password",name:"password",minLength:t==null?void 0:t.minLength,errorMessage:K,defaultValue:H,uniqueSymbolsStatus:k,requiredCharacterClasses:t==null?void 0:t.requiredCharacterClasses,onValue:Y,placeholder:l.placeholder,floatingLabel:l.floatingLabel,onBlur:D,children:[u?o("div",{className:"auth-sign-up-form__form__confirm-wrapper",children:o(le,{className:"auth-sign-up-form__form__field auth-sign-up-form__form__field--confirm-password",autoComplete:"confirmPassword",name:"confirmPasswordField",placeholder:l.confirmPasswordPlaceholder,floatingLabel:l.confirmPasswordFloatingLabel,errorMessage:$,defaultValue:W,onValue:R,onBlur:ee})}):null,re?o("div",{className:"auth-sign-up-form__automatic-login","data-testid":"automaticLogin",children:o(je,{children:o(Ge,{name:"",placeholder:l.keepMeLoggedText,label:l.keepMeLoggedText,checked:J,onChange:Z})})}):null]}),o(se,{name:"RemoteShoppingAssistance","data-testid":"remoteShoppingAssistance",slot:a==null?void 0:a.RemoteShoppingAssistance,children:o(Xe,{label:l.remoteShoppingAssistanceLabel})},"remoteShoppingAssistance"),o(se,{name:"PrivacyPolicyConsent","data-testid":"privacyPolicyConsent",slot:a==null?void 0:a.PrivacyPolicyConsent},"privacyPolicyConsent"),A("div",{className:"auth-sign-up-form-buttons",children:[o(ue,{className:"auth-sign-up-form-buttons--signin",type:"button",variant:"tertiary",style:{padding:0},buttonText:l.buttonSecondary,enableLoader:!1,onClick:X}),o(ue,{type:"submit",buttonText:l.buttonPrimary,variant:"primary",enableLoader:O})]})]}),o("div",{id:"createCustomerV2"})]})},Qe={loginAsCustomerEnabled:!1,loginAsCustomerConsentLabel:"",loginAsCustomerConsentTooltip:""},Xe=({label:u="",tooltipText:s="",name:e="allowRemoteShoppingAssistance",defaultChecked:g=!1,onChange:r,className:i=""})=>{const[c,n]=f(!1),[C,N]=f(g),p=Ee(null),[h,b]=f(Qe),S=a=>{const t=a.target.checked;N(t),r==null||r(t)};return fe(()=>{xe().then(a=>{b({loginAsCustomerEnabled:a.loginAsCustomerEnabled??!1,loginAsCustomerConsentLabel:a.loginAsCustomerConsentLabel??"",loginAsCustomerConsentTooltip:a.loginAsCustomerConsentTooltip??""})})},[]),h.loginAsCustomerEnabled?o("div",{className:he(["remote-shopping-assistance",i]),children:A("div",{className:"remote-shopping-assistance__wrapper",children:[A("div",{className:"remote-shopping-assistance__checkbox-wrapper",children:[o("input",{ref:p,type:"checkbox",id:`${e}-checkbox`,checked:C,onChange:S,className:"remote-shopping-assistance__checkbox"}),o("input",{type:"hidden",name:e,value:C?"true":"false"}),o("label",{htmlFor:`${e}-checkbox`,className:"remote-shopping-assistance__label",children:h.loginAsCustomerConsentLabel||u})]}),A("div",{className:"remote-shopping-assistance__info-container",children:[o("span",{className:"remote-shopping-assistance__info-icon",onMouseEnter:()=>n(!0),onMouseLeave:()=>n(!1),role:"tooltip","aria-label":s||h.loginAsCustomerConsentTooltip,children:"?"}),c&&(s||h.loginAsCustomerConsentTooltip)?A("span",{className:"remote-shopping-assistance__tooltip",children:[s||h.loginAsCustomerConsentTooltip,o("span",{className:"remote-shopping-assistance__tooltip-arrow"})]}):null]})]})}):null};export{cr as S};
//# sourceMappingURL=RemoteShoppingAssistance2.js.map
