/*! Copyright 2026 Adobe
All Rights Reserved. */
import{jsx as o,jsxs as A}from"@dropins/tools/preact-jsx-runtime.js";import{Slot as se,classes as he}from"@dropins/tools/lib.js";import"@dropins/tools/event-bus.js";import"@dropins/tools/recaptcha.js";import{g as _e,c as Ce,a as Pe}from"./createCustomerAddress.js";import{useState as f,useEffect as fe,useCallback as T,useMemo as Ne,useRef as Ee}from"@dropins/tools/preact-hooks.js";import{s as me,b as Le}from"./simplifyTransformAttributesForm.js";import{v as Ae,u as Se,a as ye}from"./usePasswordValidationMessage.js";import{p as Me,E as Ue,d as Te,e as xe}from"./getAdobeCommerceOptimizerData.js";import{c as V,g as ve,u as qe,B as ue}from"./Button.js";import{c as Be}from"./transform-attributes-form.js";import{f as ce,E as ke}from"./focusOnEmptyPasswordField.js";import{Header as Ie,InLineAlert as Ke,InputPassword as le,Field as je,Checkbox as Ge}from"@dropins/tools/components.js";import{u as $e,F as He}from"./RemoteShoppingAssistance.js";import{S as Oe}from"./SkeletonLoader.js";const de=(c,r)=>r!=null&&r.length?c.map(e=>{var u;const s=(u=r.find(({code:i})=>i===e.code))==null?void 0:u.defaultValue;return s?{...e,defaultValue:s}:e}):c,Ve=({inputsDefaultValueSet:c,fieldsConfigForApiVersion1:r,apiVersion2:e})=>{const[s,u]=f([]);return fe(()=>{(async()=>{if(e){const a=await _e("customer_account_create");if(a!=null&&a.length)if(c!=null&&c.length){const F=de(a,c);u(F)}else u(a)}else{const a=me(Le),F=me(r),C=de(a,c);u(r&&r.length?F:C)}})()},[e,r,c]),{fieldsListConfigs:s.map(i=>({...i,...i.code==="email"?{autocomplete:"username"}:{}}))}},We=(c,r)=>{const e=["dob","email","firstname","gender","lastname","middlename","password","prefix","suffix","taxvat","allow_remote_shopping_assistance"],s=Be(c,"snakeCase",{firstName:"firstname",lastName:"lastname"});if(!r)return{...s,...s!=null&&s.gender?{gender:Number(s==null?void 0:s.gender)}:{}};const u={},i=[];return Object.keys(s).forEach(a=>{e.includes(a)?u[a]=a.includes("gender")?Number(s[a]):s[a]:i.push({attribute_code:a,value:s[a]})}),i.length>0&&(u.custom_attributes=i),u},Je=({requireRetypePassword:c,addressesData:r,translations:e,isEmailConfirmationRequired:s,apiVersion2:u=!0,passwordConfigs:i,isAutoSignInEnabled:a,routeRedirectOnSignIn:F,routeSignIn:C,onErrorCallback:N,onSuccessCallback:g,setActiveComponent:h,handleSetInLineAlertProps:b,routeRedirectOnEmailConfirmationClose:S})=>{const[n,l]=f(!1),[t,j]=f(""),[v,d]=f(""),[G,q]=f(""),[W,$]=f(!1),[J,B]=f({userName:"",status:!1}),[p,x]=f(""),[Q,H]=f(!1),[O,y]=f(!1),[X,Y]=f(!0),Z=T(m=>{const _=m.target.value;l(!_.length),_.length&&t.length&&_!==t&&d(e.passwordMismatch)},[t,e.passwordMismatch]),z=T(m=>{const _=m.target.value;d(_.length?"":e.requiredFieldError),_.length&&p.length&&_!==p&&d(e.passwordMismatch)},[p,e.passwordMismatch,e.requiredFieldError]),R=T(m=>{j(m),d(m?p===m?"":e.passwordMismatch:e.requiredFieldError)},[e,p]),D=T(({target:m})=>{Y(m.checked)},[]),ee=T(()=>{if(V(h)){h("signInForm");return}V(C)&&(window.location.href=C())},[h,C]),k=T(m=>{x(m),l(!m.length),m===t&&d("")},[t]),P=T(()=>{b(),x(""),V(S)?window.location.href=S():($(!1),h==null||h("signInForm"))},[b,S,h]),I=()=>{H(!0),y(!1)},re=(m,_)=>{const te=p.length&&t.length,K=p!==t,E=()=>{l(!p.length),t||d(e.requiredFieldError),te&&K&&d(e.passwordMismatch)},M=()=>{d(t.length?e.passwordMismatch:e.requiredFieldError),ce(m,p,t)};return _?c&&(v.length||K)?(I(),M(),!0):(ce(m,p,""),E(),!1):(I(),E(),!0)};return{showPasswordErrorMessage:n,confirmPassword:t,confirmPasswordMessage:v,isKeepMeLogged:X,userEmail:G,showEmailConfirmationForm:W,isSuccessful:J,isClickSubmit:Q,signUpPasswordValue:p,isLoading:O,onSubmitSignUp:async(m,_)=>{var oe,ie,ae;if(b(),d(""),y(!0),re(m,_))return;const{confirmPasswordField:te,...K}=ve(m.target),{email:E,password:M}=K,pe=(i==null?void 0:i.requiredCharacterClasses)||0,we=(i==null?void 0:i.minLength)||1;if(!Ae(M,pe)||we>(M==null?void 0:M.length)){I();return}const Fe=We({...K},u),L=await Ce(Fe,u);if((oe=L==null?void 0:L.errors)!=null&&oe.length){const{errors:U}=L;b==null||b({type:"error",text:(ie=U[0])==null?void 0:ie.message}),N==null||N(U),q(E)}else{const U=L==null?void 0:L.firstName;if(Me(Ue.CREATE_ACCOUNT_EVENT,{...L}),s||!a){if(g==null||g({userName:U,userEmail:E,status:!0}),s){(ae=m.target)==null||ae.reset(),x(""),$(!0),q(E),y(!1);return}if(!a){y(!1),B({userName:U,status:!0});return}}const w=await Te({email:E,password:M,translations:e,handleSetInLineAlertProps:b,onErrorCallback:N});if(w!=null&&w.userName){if(r!=null&&r.length)for(const ne of r)try{await Pe(ne)}catch(be){console.error(e.failedCreateCustomerAddress,ne,be)}g==null||g({userName:w==null?void 0:w.userName,userEmail:w==null?void 0:w.userEmail,status:!0}),V(F)?window.location.href=F():B({userName:w==null?void 0:w.userName,status:!0})}else g==null||g({userName:U,userEmail:E,status:!0}),B({userName:U,status:!0})}y(!1)},signInButton:ee,handleSetSignUpPasswordValue:k,onKeepMeLoggedChange:D,handleHideEmailConfirmationForm:P,handleConfirmPasswordChange:R,onBlurPassword:Z,onBlurConfirmPassword:z}},cr=({requireRetypePassword:c=!1,addressesData:r,formSize:e="default",inputsDefaultValueSet:s,fieldsConfigForApiVersion1:u,apiVersion2:i=!0,isAutoSignInEnabled:a=!0,hideCloseBtnOnEmailConfirmation:F=!1,routeRedirectOnEmailConfirmationClose:C,routeRedirectOnSignIn:N,routeSignIn:g,onErrorCallback:h,onSuccessCallback:b,setActiveComponent:S,slots:n})=>{const l=$e({title:"Auth.SignUpForm.title",buttonPrimary:"Auth.SignUpForm.buttonPrimary",buttonSecondary:"Auth.SignUpForm.buttonSecondary",keepMeLoggedText:"Auth.SignUpForm.keepMeLoggedText",customerTokenErrorMessage:"Auth.Api.customerTokenErrorMessage",failedCreateCustomerAddress:"Auth.SignUpForm.failedCreateCustomerAddress",remoteShoppingAssistanceLabel:"Auth.SignUpForm.remoteShoppingAssistanceLabel",placeholder:"Auth.InputPassword.placeholder",floatingLabel:"Auth.InputPassword.floatingLabel",requiredFieldError:"Auth.FormText.requiredFieldError.default",confirmPasswordPlaceholder:"Auth.SignUpForm.confirmPassword.placeholder",confirmPasswordFloatingLabel:"Auth.SignUpForm.confirmPassword.floatingLabel",passwordMismatch:"Auth.SignUpForm.confirmPassword.passwordMismatch"}),{passwordConfigs:t,isEmailConfirmationRequired:j}=Se(),{fieldsListConfigs:v}=Ve({fieldsConfigForApiVersion1:u,apiVersion2:i,inputsDefaultValueSet:s}),{inLineAlertProps:d,handleSetInLineAlertProps:G}=qe(),{showPasswordErrorMessage:q,confirmPassword:W,confirmPasswordMessage:$,isKeepMeLogged:J,userEmail:B,showEmailConfirmationForm:p,isSuccessful:x,isClickSubmit:Q,signUpPasswordValue:H,isLoading:O,onSubmitSignUp:y,signInButton:X,handleSetSignUpPasswordValue:Y,onKeepMeLoggedChange:Z,handleHideEmailConfirmationForm:z,handleConfirmPasswordChange:R,onBlurPassword:D,onBlurConfirmPassword:ee}=Je({requireRetypePassword:c,addressesData:r,translations:l,isEmailConfirmationRequired:j,apiVersion2:i,passwordConfigs:t,isAutoSignInEnabled:a,routeRedirectOnSignIn:N,routeSignIn:g,onErrorCallback:h,onSuccessCallback:b,setActiveComponent:S,handleSetInLineAlertProps:G,routeRedirectOnEmailConfirmationClose:C}),{isValidUniqueSymbols:k,defaultLengthMessage:P}=ye({password:H,isClickSubmit:Q,passwordConfigs:t}),I=Ne(()=>q?l.requiredFieldError:k==="error"||(P==null?void 0:P.status)==="error"?" ":"",[P==null?void 0:P.status,k,q,l.requiredFieldError]),re=!j&&(r==null?void 0:r.length);return!v.length&&i?o("div",{className:`auth-sign-up-form auth-sign-up-form--${e} skeleton-loader`,"data-testid":"SignUpForm",children:o(Oe,{activeSkeleton:"signUpForm"})}):x.status&&(n!=null&&n.SuccessNotification)?o(se,{"data-testid":"successNotificationTestId",name:"SuccessNotification",slot:n==null?void 0:n.SuccessNotification,context:{isSuccessful:x}}):p?o(ke,{formSize:e,userEmail:B,inLineAlertProps:d,hideCloseBtnOnEmailConfirmation:F,handleSetInLineAlertProps:G,onPrimaryButtonClick:z}):A("div",{className:he(["auth-sign-up-form",`auth-sign-up-form--${e}`]),"data-testid":"SignUpForm",children:[o(Ie,{title:l.title,divider:!1,className:"auth-sign-up-form__title"}),d.text?o(Ke,{className:"auth-sign-up-form__notification",type:d.type,variant:"secondary",heading:d.text,icon:d.icon}):null,A(He,{onSubmit:y,className:"auth-sign-up-form__form",loading:O,name:"signUp_form",fieldsConfig:v,slots:n,children:[A(le,{validateLengthConfig:P,className:"auth-sign-up-form__form__field",autoComplete:"current-password",name:"password",minLength:t==null?void 0:t.minLength,errorMessage:I,defaultValue:H,uniqueSymbolsStatus:k,requiredCharacterClasses:t==null?void 0:t.requiredCharacterClasses,onValue:Y,placeholder:l.placeholder,floatingLabel:l.floatingLabel,onBlur:D,children:[c?o("div",{className:"auth-sign-up-form__form__confirm-wrapper",children:o(le,{className:"auth-sign-up-form__form__field auth-sign-up-form__form__field--confirm-password",autoComplete:"confirmPassword",name:"confirmPasswordField",placeholder:l.confirmPasswordPlaceholder,floatingLabel:l.confirmPasswordFloatingLabel,errorMessage:$,defaultValue:W,onValue:R,onBlur:ee})}):null,re?o("div",{className:"auth-sign-up-form__automatic-login","data-testid":"automaticLogin",children:o(je,{children:o(Ge,{name:"",placeholder:l.keepMeLoggedText,label:l.keepMeLoggedText,checked:J,onChange:Z})})}):null]}),o(se,{name:"RemoteShoppingAssistance","data-testid":"remoteShoppingAssistance",slot:n==null?void 0:n.RemoteShoppingAssistance,children:o(Xe,{label:l.remoteShoppingAssistanceLabel})},"remoteShoppingAssistance"),o(se,{name:"PrivacyPolicyConsent","data-testid":"privacyPolicyConsent",slot:n==null?void 0:n.PrivacyPolicyConsent},"privacyPolicyConsent"),A("div",{className:"auth-sign-up-form-buttons",children:[o(ue,{className:"auth-sign-up-form-buttons--signin",type:"button",variant:"tertiary",style:{padding:0},buttonText:l.buttonSecondary,enableLoader:!1,onClick:X}),o(ue,{type:"submit",buttonText:l.buttonPrimary,variant:"primary",enableLoader:O})]})]}),o("div",{id:"createCustomerV2"})]})},Qe={loginAsCustomerEnabled:!1,loginAsCustomerConsentLabel:"",loginAsCustomerConsentTooltip:""},Xe=({label:c="",tooltipText:r="",name:e="allowRemoteShoppingAssistance",defaultChecked:s=!1,onChange:u,className:i=""})=>{const[a,F]=f(!1),[C,N]=f(s),g=Ee(null),[h,b]=f(Qe),S=n=>{const t=n.target.checked;N(t),u==null||u(t)};return fe(()=>{xe().then(n=>{b({loginAsCustomerEnabled:n.loginAsCustomerEnabled??!1,loginAsCustomerConsentLabel:n.loginAsCustomerConsentLabel??"",loginAsCustomerConsentTooltip:n.loginAsCustomerConsentTooltip??""})})},[]),h.loginAsCustomerEnabled?o("div",{className:he(["remote-shopping-assistance",i]),children:A("div",{className:"remote-shopping-assistance__wrapper",children:[A("div",{className:"remote-shopping-assistance__checkbox-wrapper",children:[o("input",{ref:g,type:"checkbox",id:`${e}-checkbox`,checked:C,onChange:S,className:"remote-shopping-assistance__checkbox"}),o("input",{type:"hidden",name:e,value:C?"true":"false"}),o("label",{htmlFor:`${e}-checkbox`,className:"remote-shopping-assistance__label",children:h.loginAsCustomerConsentLabel||c})]}),A("div",{className:"remote-shopping-assistance__info-container",children:[o("span",{className:"remote-shopping-assistance__info-icon",onMouseEnter:()=>F(!0),onMouseLeave:()=>F(!1),role:"tooltip","aria-label":r||h.loginAsCustomerConsentTooltip,children:"?"}),a&&(r||h.loginAsCustomerConsentTooltip)?A("span",{className:"remote-shopping-assistance__tooltip",children:[r||h.loginAsCustomerConsentTooltip,o("span",{className:"remote-shopping-assistance__tooltip-arrow"})]}):null]})]})}):null};export{cr as S};
//# sourceMappingURL=RemoteShoppingAssistance2.js.map
