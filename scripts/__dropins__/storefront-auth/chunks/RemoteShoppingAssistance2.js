/*! Copyright 2026 Adobe
All Rights Reserved. */
import{jsx as i,jsxs as A}from"@dropins/tools/preact-jsx-runtime.js";import{Slot as se,classes as he}from"@dropins/tools/lib.js";import"@dropins/tools/event-bus.js";import"@dropins/tools/recaptcha.js";import{g as be,c as Ce,a as Pe}from"./createCustomerAddress.js";import{useState as f,useEffect as fe,useCallback as T,useMemo as Ne,useRef as Ee}from"@dropins/tools/preact-hooks.js";import{s as me,b as Le}from"./simplifyTransformAttributesForm.js";import{v as Ae,u as Se,a as Me}from"./usePasswordValidationMessage.js";import{p as Ue,E as ye,d as Te,e as xe}from"./getAdobeCommerceOptimizerData.js";import{c as V,g as ve,u as qe,B as ue}from"./Button.js";import{c as Be}from"./transform-attributes-form.js";import{f as ce,E as Ie}from"./focusOnEmptyPasswordField.js";import{Header as Ke,InLineAlert as je,InputPassword as le,Field as ke,Checkbox as Ge}from"@dropins/tools/components.js";import{u as $e,F as He}from"./RemoteShoppingAssistance.js";import{S as Oe}from"./SkeletonLoader.js";const de=(c,s)=>s!=null&&s.length?c.map(e=>{var n;const t=(n=s.find(({code:a})=>a===e.code))==null?void 0:n.defaultValue;return t?{...e,defaultValue:t}:e}):c,Ve=({inputsDefaultValueSet:c,fieldsConfigForApiVersion1:s,apiVersion2:e})=>{const[t,n]=f([]);return fe(()=>{(async()=>{if(e){const r=await be("customer_account_create");if(r!=null&&r.length)if(c!=null&&c.length){const _=de(r,c);n(_)}else n(r)}else{const r=me(Le),_=me(s),C=de(r,c);n(s&&s.length?_:C)}})()},[e,s,c]),{fieldsListConfigs:t.map(a=>({...a,...a.code==="email"?{autocomplete:"username"}:{}}))}},We=(c,s)=>{const e=["dob","email","firstname","gender","lastname","middlename","password","prefix","suffix","taxvat","allow_remote_shopping_assistance"],t=Be(c,"snakeCase",{firstName:"firstname",lastName:"lastname"});if(!s)return{...t,...t!=null&&t.gender?{gender:Number(t==null?void 0:t.gender)}:{}};const n={},a=[];return Object.keys(t).forEach(r=>{e.includes(r)?r.includes("gender")?n[r]=Number(t[r]):r==="allow_remote_shopping_assistance"?n[r]=t[r]==="true"||t[r]===!0:n[r]=t[r]:a.push({attribute_code:r,value:t[r]})}),a.length>0&&(n.custom_attributes=a),n},Je=({requireRetypePassword:c,addressesData:s,translations:e,isEmailConfirmationRequired:t,apiVersion2:n=!0,passwordConfigs:a,isAutoSignInEnabled:r,routeRedirectOnSignIn:_,routeSignIn:C,onErrorCallback:N,onSuccessCallback:g,setActiveComponent:h,handleSetInLineAlertProps:F,routeRedirectOnEmailConfirmationClose:S})=>{const[m,l]=f(!1),[o,k]=f(""),[v,d]=f(""),[G,q]=f(""),[W,$]=f(!1),[J,B]=f({userName:"",status:!1}),[p,x]=f(""),[Q,H]=f(!1),[O,M]=f(!1),[X,Y]=f(!0),Z=T(u=>{const b=u.target.value;l(!b.length),b.length&&o.length&&b!==o&&d(e.passwordMismatch)},[o,e.passwordMismatch]),z=T(u=>{const b=u.target.value;d(b.length?"":e.requiredFieldError),b.length&&p.length&&b!==p&&d(e.passwordMismatch)},[p,e.passwordMismatch,e.requiredFieldError]),R=T(u=>{k(u),d(u?p===u?"":e.passwordMismatch:e.requiredFieldError)},[e,p]),D=T(({target:u})=>{Y(u.checked)},[]),ee=T(()=>{if(V(h)){h("signInForm");return}V(C)&&(window.location.href=C())},[h,C]),I=T(u=>{x(u),l(!u.length),u===o&&d("")},[o]),P=T(()=>{F(),x(""),V(S)?window.location.href=S():($(!1),h==null||h("signInForm"))},[F,S,h]),K=()=>{H(!0),M(!1)},re=(u,b)=>{const te=p.length&&o.length,j=p!==o,E=()=>{l(!p.length),o||d(e.requiredFieldError),te&&j&&d(e.passwordMismatch)},U=()=>{d(o.length?e.passwordMismatch:e.requiredFieldError),ce(u,p,o)};return b?c&&(v.length||j)?(K(),U(),!0):(ce(u,p,""),E(),!1):(K(),E(),!0)};return{showPasswordErrorMessage:m,confirmPassword:o,confirmPasswordMessage:v,isKeepMeLogged:X,userEmail:G,showEmailConfirmationForm:W,isSuccessful:J,isClickSubmit:Q,signUpPasswordValue:p,isLoading:O,onSubmitSignUp:async(u,b)=>{var oe,ie,ae;if(F(),d(""),M(!0),re(u,b))return;const{confirmPasswordField:te,...j}=ve(u.target),{email:E,password:U}=j,pe=(a==null?void 0:a.requiredCharacterClasses)||0,we=(a==null?void 0:a.minLength)||1;if(!Ae(U,pe)||we>(U==null?void 0:U.length)){K();return}const _e=We({...j},n),L=await Ce(_e,n);if((oe=L==null?void 0:L.errors)!=null&&oe.length){const{errors:y}=L;F==null||F({type:"error",text:(ie=y[0])==null?void 0:ie.message}),N==null||N(y),q(E)}else{const y=L==null?void 0:L.firstName;if(Ue(ye.CREATE_ACCOUNT_EVENT,{...L}),t||!r){if(g==null||g({userName:y,userEmail:E,status:!0}),t){(ae=u.target)==null||ae.reset(),x(""),$(!0),q(E),M(!1);return}if(!r){M(!1),B({userName:y,status:!0});return}}const w=await Te({email:E,password:U,translations:e,handleSetInLineAlertProps:F,onErrorCallback:N});if(w!=null&&w.userName){if(s!=null&&s.length)for(const ne of s)try{await Pe(ne)}catch(Fe){console.error(e.failedCreateCustomerAddress,ne,Fe)}g==null||g({userName:w==null?void 0:w.userName,userEmail:w==null?void 0:w.userEmail,status:!0}),V(_)?window.location.href=_():B({userName:w==null?void 0:w.userName,status:!0})}else g==null||g({userName:y,userEmail:E,status:!0}),B({userName:y,status:!0})}M(!1)},signInButton:ee,handleSetSignUpPasswordValue:I,onKeepMeLoggedChange:D,handleHideEmailConfirmationForm:P,handleConfirmPasswordChange:R,onBlurPassword:Z,onBlurConfirmPassword:z}},cr=({requireRetypePassword:c=!1,addressesData:s,formSize:e="default",inputsDefaultValueSet:t,fieldsConfigForApiVersion1:n,apiVersion2:a=!0,isAutoSignInEnabled:r=!0,hideCloseBtnOnEmailConfirmation:_=!1,routeRedirectOnEmailConfirmationClose:C,routeRedirectOnSignIn:N,routeSignIn:g,onErrorCallback:h,onSuccessCallback:F,setActiveComponent:S,slots:m})=>{const l=$e({title:"Auth.SignUpForm.title",buttonPrimary:"Auth.SignUpForm.buttonPrimary",buttonSecondary:"Auth.SignUpForm.buttonSecondary",keepMeLoggedText:"Auth.SignUpForm.keepMeLoggedText",customerTokenErrorMessage:"Auth.Api.customerTokenErrorMessage",failedCreateCustomerAddress:"Auth.SignUpForm.failedCreateCustomerAddress",remoteShoppingAssistanceLabel:"Auth.SignUpForm.remoteShoppingAssistanceLabel",placeholder:"Auth.InputPassword.placeholder",floatingLabel:"Auth.InputPassword.floatingLabel",requiredFieldError:"Auth.FormText.requiredFieldError.default",confirmPasswordPlaceholder:"Auth.SignUpForm.confirmPassword.placeholder",confirmPasswordFloatingLabel:"Auth.SignUpForm.confirmPassword.floatingLabel",passwordMismatch:"Auth.SignUpForm.confirmPassword.passwordMismatch"}),{passwordConfigs:o,isEmailConfirmationRequired:k}=Se(),{fieldsListConfigs:v}=Ve({fieldsConfigForApiVersion1:n,apiVersion2:a,inputsDefaultValueSet:t}),{inLineAlertProps:d,handleSetInLineAlertProps:G}=qe(),{showPasswordErrorMessage:q,confirmPassword:W,confirmPasswordMessage:$,isKeepMeLogged:J,userEmail:B,showEmailConfirmationForm:p,isSuccessful:x,isClickSubmit:Q,signUpPasswordValue:H,isLoading:O,onSubmitSignUp:M,signInButton:X,handleSetSignUpPasswordValue:Y,onKeepMeLoggedChange:Z,handleHideEmailConfirmationForm:z,handleConfirmPasswordChange:R,onBlurPassword:D,onBlurConfirmPassword:ee}=Je({requireRetypePassword:c,addressesData:s,translations:l,isEmailConfirmationRequired:k,apiVersion2:a,passwordConfigs:o,isAutoSignInEnabled:r,routeRedirectOnSignIn:N,routeSignIn:g,onErrorCallback:h,onSuccessCallback:F,setActiveComponent:S,handleSetInLineAlertProps:G,routeRedirectOnEmailConfirmationClose:C}),{isValidUniqueSymbols:I,defaultLengthMessage:P}=Me({password:H,isClickSubmit:Q,passwordConfigs:o}),K=Ne(()=>q?l.requiredFieldError:I==="error"||(P==null?void 0:P.status)==="error"?" ":"",[P==null?void 0:P.status,I,q,l.requiredFieldError]),re=!k&&(s==null?void 0:s.length);return!v.length&&a?i("div",{className:`auth-sign-up-form auth-sign-up-form--${e} skeleton-loader`,"data-testid":"SignUpForm",children:i(Oe,{activeSkeleton:"signUpForm"})}):x.status&&(m!=null&&m.SuccessNotification)?i(se,{"data-testid":"successNotificationTestId",name:"SuccessNotification",slot:m==null?void 0:m.SuccessNotification,context:{isSuccessful:x}}):p?i(Ie,{formSize:e,userEmail:B,inLineAlertProps:d,hideCloseBtnOnEmailConfirmation:_,handleSetInLineAlertProps:G,onPrimaryButtonClick:z}):A("div",{className:he(["auth-sign-up-form",`auth-sign-up-form--${e}`]),"data-testid":"SignUpForm",children:[i(Ke,{title:l.title,divider:!1,className:"auth-sign-up-form__title"}),d.text?i(je,{className:"auth-sign-up-form__notification",type:d.type,variant:"secondary",heading:d.text,icon:d.icon}):null,A(He,{onSubmit:M,className:"auth-sign-up-form__form",loading:O,name:"signUp_form",fieldsConfig:v,slots:m,children:[A(le,{validateLengthConfig:P,className:"auth-sign-up-form__form__field",autoComplete:"current-password",name:"password",minLength:o==null?void 0:o.minLength,errorMessage:K,defaultValue:H,uniqueSymbolsStatus:I,requiredCharacterClasses:o==null?void 0:o.requiredCharacterClasses,onValue:Y,placeholder:l.placeholder,floatingLabel:l.floatingLabel,onBlur:D,children:[c?i("div",{className:"auth-sign-up-form__form__confirm-wrapper",children:i(le,{className:"auth-sign-up-form__form__field auth-sign-up-form__form__field--confirm-password",autoComplete:"confirmPassword",name:"confirmPasswordField",placeholder:l.confirmPasswordPlaceholder,floatingLabel:l.confirmPasswordFloatingLabel,errorMessage:$,defaultValue:W,onValue:R,onBlur:ee})}):null,re?i("div",{className:"auth-sign-up-form__automatic-login","data-testid":"automaticLogin",children:i(ke,{children:i(Ge,{name:"",placeholder:l.keepMeLoggedText,label:l.keepMeLoggedText,checked:J,onChange:Z})})}):null]}),i(se,{name:"RemoteShoppingAssistance","data-testid":"remoteShoppingAssistance",slot:m==null?void 0:m.RemoteShoppingAssistance,children:i(Xe,{label:l.remoteShoppingAssistanceLabel})},"remoteShoppingAssistance"),i(se,{name:"PrivacyPolicyConsent","data-testid":"privacyPolicyConsent",slot:m==null?void 0:m.PrivacyPolicyConsent},"privacyPolicyConsent"),A("div",{className:"auth-sign-up-form-buttons",children:[i(ue,{className:"auth-sign-up-form-buttons--signin",type:"button",variant:"tertiary",style:{padding:0},buttonText:l.buttonSecondary,enableLoader:!1,onClick:X}),i(ue,{type:"submit",buttonText:l.buttonPrimary,variant:"primary",enableLoader:O})]})]}),i("div",{id:"createCustomerV2"})]})},Qe={loginAsCustomerEnabled:!1,loginAsCustomerConsentLabel:"",loginAsCustomerConsentTooltip:""},Xe=({label:c="",tooltipText:s="",name:e="allowRemoteShoppingAssistance",defaultChecked:t=!1,onChange:n,className:a=""})=>{const[r,_]=f(!1),[C,N]=f(t),g=Ee(null),[h,F]=f(Qe),S=m=>{const o=m.target.checked;N(o),n==null||n(o)};return fe(()=>{xe().then(m=>{F({loginAsCustomerEnabled:m.loginAsCustomerEnabled??!1,loginAsCustomerConsentLabel:m.loginAsCustomerConsentLabel??"",loginAsCustomerConsentTooltip:m.loginAsCustomerConsentTooltip??""})})},[]),h.loginAsCustomerEnabled?i("div",{className:he(["remote-shopping-assistance",a]),children:A("div",{className:"remote-shopping-assistance__wrapper",children:[A("div",{className:"remote-shopping-assistance__checkbox-wrapper",children:[i("input",{ref:g,type:"checkbox",id:`${e}-checkbox`,checked:C,onChange:S,className:"remote-shopping-assistance__checkbox"}),i("input",{type:"hidden",name:e,value:C?"true":"false"}),i("label",{htmlFor:`${e}-checkbox`,className:"remote-shopping-assistance__label",children:h.loginAsCustomerConsentLabel||c})]}),A("div",{className:"remote-shopping-assistance__info-container",children:[i("span",{className:"remote-shopping-assistance__info-icon",onMouseEnter:()=>_(!0),onMouseLeave:()=>_(!1),role:"tooltip","aria-label":s||h.loginAsCustomerConsentTooltip,children:"?"}),r&&(s||h.loginAsCustomerConsentTooltip)?A("span",{className:"remote-shopping-assistance__tooltip",children:[s||h.loginAsCustomerConsentTooltip,i("span",{className:"remote-shopping-assistance__tooltip-arrow"})]}):null]})]})}):null};export{cr as S};
//# sourceMappingURL=RemoteShoppingAssistance2.js.map
