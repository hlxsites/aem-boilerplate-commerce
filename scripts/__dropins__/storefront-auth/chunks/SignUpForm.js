/*! Copyright 2026 Adobe
All Rights Reserved. */
import{jsx as c,jsxs as O}from"@dropins/tools/preact-jsx-runtime.js";import{Slot as J,classes as Fr}from"@dropins/tools/lib.js";import"@dropins/tools/event-bus.js";import"@dropins/tools/recaptcha.js";import{g as Pr,c as Er,a as br}from"./createCustomerAddress.js";import{useState as w,useEffect as Nr,useCallback as C,useMemo as _r}from"@dropins/tools/preact-hooks.js";import{s as ur,b as Lr}from"./simplifyTransformAttributesForm.js";import{v as yr,u as Mr,a as Ur}from"./usePasswordValidationMessage.js";import{a as xr}from"./getCustomerToken.js";import{p as Cr,E as Sr}from"./acdl.js";import{c as Q,g as Tr,u as qr,B as dr}from"./Button2.js";import{c as vr}from"./transform-attributes-form.js";import{f as cr,E as Br}from"./focusOnEmptyPasswordField.js";import{Header as Ar,InLineAlert as Kr,InputPassword as fr,Field as Ir,Checkbox as jr}from"@dropins/tools/components.js";import{u as Gr,F as Hr}from"./Button.js";import{S as Vr}from"./SkeletonLoader.js";const lr=(m,e)=>e!=null&&e.length?m.map(r=>{var f;const t=(f=e.find(({code:s})=>s===r.code))==null?void 0:f.defaultValue;return t?{...r,defaultValue:t}:r}):m,Wr=({inputsDefaultValueSet:m,fieldsConfigForApiVersion1:e,apiVersion2:r})=>{const[t,f]=w([]);return Nr(()=>{(async()=>{if(r){const a=await Pr("customer_account_create");if(a!=null&&a.length)if(m!=null&&m.length){const b=lr(a,m);f(b)}else f(a)}else{const a=ur(Lr),b=ur(e),L=lr(a,m);f(e&&e.length?b:L)}})()},[r,e,m]),{fieldsListConfigs:t.map(s=>({...s,...s.code==="email"?{autocomplete:"username"}:{}}))}},$r=(m,e)=>{const r=["dob","email","firstname","gender","lastname","middlename","password","prefix","suffix","taxvat"],t=vr(m,"snakeCase",{firstName:"firstname",lastName:"lastname"});if(!e)return{...t,...t!=null&&t.gender?{gender:Number(t==null?void 0:t.gender)}:{}};const f={},s=[];return Object.keys(t).forEach(a=>{r.includes(a)?f[a]=a.includes("gender")?Number(t[a]):t[a]:s.push({attribute_code:a,value:t[a]})}),s.length>0&&(f.custom_attributes=s),f},Or=({requireRetypePassword:m,addressesData:e,translations:r,isEmailConfirmationRequired:t,apiVersion2:f=!0,passwordConfigs:s,isAutoSignInEnabled:a,routeRedirectOnSignIn:b,routeSignIn:L,onErrorCallback:S,onSuccessCallback:h,setActiveComponent:F,handleSetInLineAlertProps:P,routeRedirectOnEmailConfirmationClose:T})=>{const[o,u]=w(!1),[n,G]=w(""),[q,d]=w(""),[H,v]=w(""),[X,V]=w(!1),[Y,B]=w({userName:"",status:!1}),[l,y]=w(""),[Z,W]=w(!1),[A,M]=w(!1),[k,z]=w(!0),R=C(i=>{const p=i.target.value;u(!p.length),p.length&&n.length&&p!==n&&d(r.passwordMismatch)},[n,r.passwordMismatch]),D=C(i=>{const p=i.target.value;d(p.length?"":r.requiredFieldError),p.length&&l.length&&p!==l&&d(r.passwordMismatch)},[l,r.passwordMismatch,r.requiredFieldError]),rr=C(i=>{G(i),d(i?l===i?"":r.passwordMismatch:r.requiredFieldError)},[r,l]),er=C(({target:i})=>{z(i.checked)},[]),tr=C(()=>{if(Q(F)){F("signInForm");return}Q(L)&&(window.location.href=L())},[F,L]),K=C(i=>{y(i),u(!i.length),i===n&&d("")},[n]),E=C(()=>{P(),y(""),Q(T)?window.location.href=T():(V(!1),F==null||F("signInForm"))},[P,T,F]),I=()=>{W(!0),M(!1)},or=(i,p)=>{const ir=l.length&&n.length,j=l!==n,N=()=>{u(!l.length),n||d(r.requiredFieldError),ir&&j&&d(r.passwordMismatch)},U=()=>{d(n.length?r.passwordMismatch:r.requiredFieldError),cr(i,l,n)};return p?m&&(q.length||j)?(I(),U(),!0):(cr(i,l,""),N(),!1):(I(),N(),!0)};return{showPasswordErrorMessage:o,confirmPassword:n,confirmPasswordMessage:q,isKeepMeLogged:k,userEmail:H,showEmailConfirmationForm:X,isSuccessful:Y,isClickSubmit:Z,signUpPasswordValue:l,isLoading:A,onSubmitSignUp:async(i,p)=>{var sr,ar,nr;if(P(),d(""),M(!0),or(i,p))return;const{confirmPasswordField:ir,...j}=Tr(i.target),{email:N,password:U}=j,gr=(s==null?void 0:s.requiredCharacterClasses)||0,hr=(s==null?void 0:s.minLength)||1;if(!yr(U,gr)||hr>(U==null?void 0:U.length)){I();return}const pr=$r({...j},f),_=await Er(pr,f);if((sr=_==null?void 0:_.errors)!=null&&sr.length){const{errors:x}=_;P==null||P({type:"error",text:(ar=x[0])==null?void 0:ar.message}),S==null||S(x),v(N)}else{const x=_==null?void 0:_.firstName;if(Cr(Sr.CREATE_ACCOUNT_EVENT,{..._}),t||!a){if(h==null||h({userName:x,userEmail:N,status:!0}),t){(nr=i.target)==null||nr.reset(),y(""),V(!0),v(N),M(!1);return}if(!a){M(!1),B({userName:x,status:!0});return}}const g=await xr({email:N,password:U,translations:r,handleSetInLineAlertProps:P,onErrorCallback:S});if(g!=null&&g.userName){if(e!=null&&e.length)for(const mr of e)try{await br(mr)}catch(wr){console.error(r.failedCreateCustomerAddress,mr,wr)}h==null||h({userName:g==null?void 0:g.userName,userEmail:g==null?void 0:g.userEmail,status:!0}),Q(b)?window.location.href=b():B({userName:g==null?void 0:g.userName,status:!0})}else h==null||h({userName:x,userEmail:N,status:!0}),B({userName:x,status:!0})}M(!1)},signInButton:tr,handleSetSignUpPasswordValue:K,onKeepMeLoggedChange:er,handleHideEmailConfirmationForm:E,handleConfirmPasswordChange:rr,onBlurPassword:R,onBlurConfirmPassword:D}},ne=({requireRetypePassword:m=!1,addressesData:e,formSize:r="default",inputsDefaultValueSet:t,fieldsConfigForApiVersion1:f,apiVersion2:s=!0,isAutoSignInEnabled:a=!0,hideCloseBtnOnEmailConfirmation:b=!1,routeRedirectOnEmailConfirmationClose:L,routeRedirectOnSignIn:S,routeSignIn:h,onErrorCallback:F,onSuccessCallback:P,setActiveComponent:T,slots:o})=>{const u=Gr({title:"Auth.SignUpForm.title",buttonPrimary:"Auth.SignUpForm.buttonPrimary",buttonSecondary:"Auth.SignUpForm.buttonSecondary",keepMeLoggedText:"Auth.SignUpForm.keepMeLoggedText",customerTokenErrorMessage:"Auth.Api.customerTokenErrorMessage",failedCreateCustomerAddress:"Auth.SignUpForm.failedCreateCustomerAddress",placeholder:"Auth.InputPassword.placeholder",floatingLabel:"Auth.InputPassword.floatingLabel",requiredFieldError:"Auth.FormText.requiredFieldError.default",confirmPasswordPlaceholder:"Auth.SignUpForm.confirmPassword.placeholder",confirmPasswordFloatingLabel:"Auth.SignUpForm.confirmPassword.floatingLabel",passwordMismatch:"Auth.SignUpForm.confirmPassword.passwordMismatch"}),{passwordConfigs:n,isEmailConfirmationRequired:G}=Mr(),{fieldsListConfigs:q}=Wr({fieldsConfigForApiVersion1:f,apiVersion2:s,inputsDefaultValueSet:t}),{inLineAlertProps:d,handleSetInLineAlertProps:H}=qr(),{showPasswordErrorMessage:v,confirmPassword:X,confirmPasswordMessage:V,isKeepMeLogged:Y,userEmail:B,showEmailConfirmationForm:l,isSuccessful:y,isClickSubmit:Z,signUpPasswordValue:W,isLoading:A,onSubmitSignUp:M,signInButton:k,handleSetSignUpPasswordValue:z,onKeepMeLoggedChange:R,handleHideEmailConfirmationForm:D,handleConfirmPasswordChange:rr,onBlurPassword:er,onBlurConfirmPassword:tr}=Or({requireRetypePassword:m,addressesData:e,translations:u,isEmailConfirmationRequired:G,apiVersion2:s,passwordConfigs:n,isAutoSignInEnabled:a,routeRedirectOnSignIn:S,routeSignIn:h,onErrorCallback:F,onSuccessCallback:P,setActiveComponent:T,handleSetInLineAlertProps:H,routeRedirectOnEmailConfirmationClose:L}),{isValidUniqueSymbols:K,defaultLengthMessage:E}=Ur({password:W,isClickSubmit:Z,passwordConfigs:n}),I=_r(()=>v?u.requiredFieldError:K==="error"||(E==null?void 0:E.status)==="error"?" ":"",[E==null?void 0:E.status,K,v,u.requiredFieldError]),or=!G&&(e==null?void 0:e.length);if(!q.length&&s)return c("div",{className:`auth-sign-up-form auth-sign-up-form--${r} skeleton-loader`,"data-testid":"SignUpForm",children:c(Vr,{activeSkeleton:"signUpForm"})});if(y.status&&(o!=null&&o.SuccessNotification))return c(J,{"data-testid":"successNotificationTestId",name:"SuccessNotification",slot:o==null?void 0:o.SuccessNotification,context:{isSuccessful:y}});if(l)return c(Br,{formSize:r,userEmail:B,inLineAlertProps:d,hideCloseBtnOnEmailConfirmation:b,handleSetInLineAlertProps:H,onPrimaryButtonClick:D});const $={isLoading:A,isSuccessful:y};return O("div",{className:Fr(["auth-sign-up-form",`auth-sign-up-form--${r}`]),"data-testid":"SignUpForm",children:[c(J,{name:"Title","data-testid":"title",slot:o==null?void 0:o.Title,context:{...$},children:c(Ar,{title:u.title,divider:!1,className:"auth-sign-up-form__title"})}),d.text?c(Kr,{className:"auth-sign-up-form__notification",type:d.type,variant:"secondary",heading:d.text,icon:d.icon}):null,O(Hr,{onSubmit:M,className:"auth-sign-up-form__form",loading:A,name:"signUp_form",fieldsConfig:q,slots:o,formSlot:{name:"Form",slot:o==null?void 0:o.Form,context:$,dataTestId:"form"},children:[O(fr,{validateLengthConfig:E,className:"auth-sign-up-form__form__field",autoComplete:"current-password",name:"password",minLength:n==null?void 0:n.minLength,errorMessage:I,defaultValue:W,uniqueSymbolsStatus:K,requiredCharacterClasses:n==null?void 0:n.requiredCharacterClasses,onValue:z,placeholder:u.placeholder,floatingLabel:u.floatingLabel,onBlur:er,children:[m?c("div",{className:"auth-sign-up-form__form__confirm-wrapper",children:c(fr,{className:"auth-sign-up-form__form__field auth-sign-up-form__form__field--confirm-password",autoComplete:"confirmPassword",name:"confirmPasswordField",placeholder:u.confirmPasswordPlaceholder,floatingLabel:u.confirmPasswordFloatingLabel,errorMessage:V,defaultValue:X,onValue:rr,onBlur:tr})}):null,or?c("div",{className:"auth-sign-up-form__automatic-login","data-testid":"automaticLogin",children:c(Ir,{children:c(jr,{name:"",placeholder:u.keepMeLoggedText,label:u.keepMeLoggedText,checked:Y,onChange:R})})}):null]}),c(J,{name:"PrivacyPolicyConsent","data-testid":"privacyPolicyConsent",slot:o==null?void 0:o.PrivacyPolicyConsent},"privacyPolicyConsent"),O(J,{name:"Buttons",className:"auth-sign-up-form-buttons","data-testid":"buttons",slot:o==null?void 0:o.Buttons,context:{...$},children:[c(dr,{className:"auth-sign-up-form-buttons--signin",type:"button",variant:"tertiary",style:{padding:0},buttonText:u.buttonSecondary,enableLoader:!1,onClick:k}),c(dr,{type:"submit",buttonText:u.buttonPrimary,variant:"primary",enableLoader:A})]})]}),c("div",{id:"createCustomerV2"})]})};export{ne as S};
//# sourceMappingURL=SignUpForm.js.map
