/*! Copyright 2026 Adobe
All Rights Reserved. */
import{jsx as u,jsxs as v}from"@dropins/tools/preact-jsx-runtime.js";import{Slot as J,classes as R}from"@dropins/tools/lib.js";import{c as E,g as tt,u as rt,B as Q}from"./Button2.js";import{useState as _,useCallback as c,useEffect as X,useMemo as at}from"@dropins/tools/preact-hooks.js";import"@dropins/tools/event-bus.js";import"@dropins/tools/recaptcha.js";import{a as et}from"./getCustomerToken.js";import{r as ot}from"./resendConfirmationEmail.js";import{s as it,a as st}from"./simplifyTransformAttributesForm.js";import{f as nt,E as ut}from"./focusOnEmptyPasswordField.js";import{c as mt}from"./confirmEmail.js";import{useText as ct}from"@dropins/tools/i18n.js";import{Header as ft,InLineAlert as dt,InputPassword as lt}from"@dropins/tools/components.js";import{u as ht,F as gt}from"./Button.js";const wt=({emailConfirmationStatusMessage:t,translations:e,initialEmailValue:s,routeSignUp:l,routeForgotPassword:m,routeRedirectOnSignIn:F,onErrorCallback:y,setActiveComponent:a,onSuccessCallback:f,onSignUpLinkClick:h,handleSetInLineAlertProps:i,routeRedirectOnEmailConfirmationClose:T,apiErrorMessageOverride:P})=>{const[U,j]=_(""),[q,n]=_(!1),[g,d]=_(""),[k,w]=_(!1),[V,D]=_({userName:"",status:!1}),[p,b]=_(!1),[N,I]=_([]),B=c(async r=>{i(),n(!0),w(!1),I([]),await ot(r)},[i]),G=c(r=>{r.length?w(!1):w(!0),d(r)},[]);X(()=>{t!=null&&t.text&&i({text:t.text,type:t.status?t.status:void 0})},[t,i]);const H=c(()=>{g.length||w(!0)},[g]),C=c((r,o)=>g.length?!1:(w(!0),o&&nt(r,g,""),!0),[g]),S=c((r,o)=>{o!=null&&o.userName&&(r.target.reset(),E(F)?window.location.href=F():(f==null||f({userName:o==null?void 0:o.userName,status:!0}),D({userName:o==null?void 0:o.userName,status:!0})))},[f,F]),L=c((r,o)=>{var A;if((A=r==null?void 0:r.errorMessage)!=null&&A.length){j(o);const $=r.errorMessage.includes("This account isn't confirmed. Verify and try again."),x=$?e.resendEmailInformationText:r.displayErrorMessage;I($?[{label:e.resendEmailButtonText,onClick:()=>{B(o)}}]:[]),i({text:x,type:"error"}),d("")}},[B,i,e.resendEmailButtonText,e.resendEmailInformationText]),K=c(async(r,o)=>{if(i(),C(r,o))return;b(!0);const A=tt(r.target);if(Object.values(A).every(x=>x)){const{email:x,password:O}=A,W=await et({email:x,password:O,handleSetInLineAlertProps:i,onErrorCallback:y,translations:e,apiErrorMessageOverride:P});L(W,x),S(r,W),w(!1)}b(!1)},[e,y,C,L,S,i,P]),M=c(()=>{if(E(a)){a("resetPasswordForm");return}E(m)&&(window.location.href=m())},[m,a]),Y=c(()=>{if(E(h)&&h(),E(a)){a("signUpForm");return}E(l)&&(window.location.href=l())},[h,l,a]),Z=at(()=>{const r=it(st);return s!=null&&s.length?r==null?void 0:r.map(o=>({...o,defaultValue:s})):r},[s]),z=c(()=>{i(),E(T)?window.location.href=T():n(!1)},[i,T]);return{additionalActionsAlert:N,userEmail:U,defaultEnhancedEmailFields:Z,passwordError:k,isSuccessful:V,isLoading:p,signInPasswordValue:g,showEmailConfirmationForm:q,setShowEmailConfirmationForm:n,setSignInPasswordValue:d,submitLogInUser:K,forgotPasswordCallback:M,onSignUpLinkClickCallback:Y,handledOnPrimaryButtonClick:z,handleSetPassword:G,onBlurPassword:H}},_t=()=>{let t=new URL(window.location.href),e=t.searchParams.get("email"),s=t.searchParams.get("key");e&&s&&(t.searchParams.delete("email"),t.searchParams.delete("key"),window.history.replaceState({},document.title,t.toString()))},yt=({enableEmailConfirmation:t})=>{const e=ct({accountConfirmMessage:"Auth.EmailConfirmationForm.accountConfirmMessage",accountConfirmationEmailSuccessMessage:"Auth.EmailConfirmationForm.accountConfirmationEmailSuccessMessage"}),[s,l]=_({text:"",status:""});return X(()=>{if(t){const{search:m}=window.location;m.includes("email=")&&m.includes("key=")&&(async()=>{var f,h,i;const y=new URLSearchParams(m),a=await mt({customerEmail:y.get("email"),customerConfirmationKey:y.get("key")});if(!a)return null;(f=a==null?void 0:a.errors)!=null&&f.length?l({text:a==null?void 0:a.errors[0].message,status:"error"}):(l({text:a.data.confirmEmail.customer.email?e.accountConfirmationEmailSuccessMessage.replace("{email}",(i=(h=a==null?void 0:a.data)==null?void 0:h.confirmEmail.customer)==null?void 0:i.email):e.accountConfirmMessage,status:"success"}),_t())})()}},[t,e]),{emailConfirmationStatusMessage:s}},Lt=({slots:t,labels:e,formSize:s="default",initialEmailValue:l="",renderSignUpLink:m=!1,enableEmailConfirmation:F=!1,hideCloseBtnOnEmailConfirmation:y=!1,routeRedirectOnEmailConfirmationClose:a,routeRedirectOnSignIn:f,routeForgotPassword:h,routeSignUp:i,onSuccessCallback:T,setActiveComponent:P,onErrorCallback:U,onSignUpLinkClick:j,apiErrorMessageOverride:q})=>{const n=ht({title:"Auth.SignInForm.title",buttonPrimary:"Auth.SignInForm.buttonPrimary",buttonSecondary:"Auth.SignInForm.buttonSecondary",buttonTertiary:"Auth.SignInForm.buttonTertiary",resendEmailInformationText:"Auth.Notification.resendEmailNotification.informationText",resendEmailButtonText:"Auth.Notification.resendEmailNotification.buttonText",customerTokenErrorMessage:"Auth.Api.customerTokenErrorMessage",placeholder:"Auth.InputPassword.placeholder",floatingLabel:"Auth.InputPassword.floatingLabel",requiredFieldError:"Auth.FormText.requiredFieldError.default"}),{emailConfirmationStatusMessage:g}=yt({enableEmailConfirmation:F}),{inLineAlertProps:d,handleSetInLineAlertProps:k}=rt(),{userEmail:w,additionalActionsAlert:V,defaultEnhancedEmailFields:D,passwordError:p,isSuccessful:b,isLoading:N,signInPasswordValue:I,showEmailConfirmationForm:B,submitLogInUser:G,forgotPasswordCallback:H,onSignUpLinkClickCallback:C,handledOnPrimaryButtonClick:S,handleSetPassword:L,onBlurPassword:K}=wt({translations:n,emailConfirmationStatusMessage:g,initialEmailValue:l,routeSignUp:i,routeForgotPassword:h,routeRedirectOnSignIn:f,setActiveComponent:P,onErrorCallback:U,onSuccessCallback:T,onSignUpLinkClick:j,handleSetInLineAlertProps:k,routeRedirectOnEmailConfirmationClose:a,apiErrorMessageOverride:q});if(b.status&&(t!=null&&t.SuccessNotification))return u(J,{"data-testid":"successNotificationTestId",name:"SuccessNotification",slot:t==null?void 0:t.SuccessNotification,context:{isSuccessful:b}});if(B)return u(ut,{formSize:s,userEmail:w,inLineAlertProps:d,hideCloseBtnOnEmailConfirmation:y,handleSetInLineAlertProps:k,onPrimaryButtonClick:S});const M={isLoading:N,passwordError:p};return v("div",{className:R(["auth-sign-in-form",`auth-sign-in-form--${s}`]),"data-testid":"signInForm",children:[u(J,{name:"Title","data-testid":"title",slot:t==null?void 0:t.Title,context:{...M},children:u(ft,{title:(e==null?void 0:e.formTitleText)??n.title,divider:!1,className:"auth-sign-in-form__title"})}),d.text?u(dt,{"data-testid":"authInLineAlert",className:"auth-sign-in-form__notification",type:d.type,variant:"secondary",heading:d.text,icon:d.icon,additionalActions:V}):null,v(gt,{name:"signIn_form",className:"auth-sign-in-form__form",onSubmit:G,loading:N,fieldsConfig:D,children:[u(lt,{hideStatusIndicator:!0,className:"auth-sign-in-form__form__password",autoComplete:"current-password",errorMessage:p?n.requiredFieldError:void 0,defaultValue:I,onValue:L,onBlur:K,placeholder:n.placeholder,floatingLabel:n.floatingLabel}),u("div",{className:"auth-sign-in-form__form__buttons__wrapper",children:v(J,{name:"Buttons",className:"auth-sign-in-form__form__buttons","data-testid":"buttons",slot:t==null?void 0:t.Buttons,context:{...M},children:[v("div",{className:"auth-sign-in-form__form__buttons__combine",children:[u(Q,{type:"button",variant:"tertiary",style:{padding:0},buttonText:n.buttonTertiary,className:"auth-sign-in-form__button auth-sign-in-form__button--forgot",enableLoader:!1,onClick:H,"data-testid":"switchToSignUp"}),m?u("span",{}):null,m?u(Q,{type:"button",variant:"tertiary",style:{padding:0},buttonText:n.buttonSecondary,className:"auth-sign-in-form__button auth-sign-in-form__button--signup",enableLoader:!1,onClick:C}):null]}),u(Q,{type:"submit",buttonText:(e==null?void 0:e.primaryButtonText)??n.buttonPrimary,variant:"primary",className:"auth-sign-in-form__button auth-sign-in-form__button--submit",enableLoader:N})]})})]}),u("div",{id:"generateCustomerToken"})]})};export{Lt as S};
//# sourceMappingURL=SignInForm.js.map
