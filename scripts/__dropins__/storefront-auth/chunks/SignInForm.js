/*! Copyright 2026 Adobe
All Rights Reserved. */
import{jsx as u,jsxs as k,Fragment as R}from"@dropins/tools/preact-jsx-runtime.js";import{Slot as J,classes as tt}from"@dropins/tools/lib.js";import{c as E,g as rt,u as at,B as Q}from"./Button2.js";import{useState as _,useCallback as m,useEffect as X,useMemo as et}from"@dropins/tools/preact-hooks.js";import"@dropins/tools/event-bus.js";import"@dropins/tools/recaptcha.js";import{a as ot}from"./getCustomerToken.js";import{r as it}from"./resendConfirmationEmail.js";import{s as nt,a as st}from"./simplifyTransformAttributesForm.js";import{f as ut,E as mt}from"./focusOnEmptyPasswordField.js";import{c as ct}from"./confirmEmail.js";import{useText as ft}from"@dropins/tools/i18n.js";import{Header as dt,InLineAlert as lt,InputPassword as ht}from"@dropins/tools/components.js";import{u as gt,F as wt}from"./Button.js";const _t=({emailConfirmationStatusMessage:t,translations:e,initialEmailValue:n,routeSignUp:l,routeForgotPassword:c,routeRedirectOnSignIn:F,onErrorCallback:y,setActiveComponent:a,onSuccessCallback:f,onSignUpLinkClick:h,handleSetInLineAlertProps:i,routeRedirectOnEmailConfirmationClose:b,apiErrorMessageOverride:p})=>{const[v,j]=_(""),[q,s]=_(!1),[g,d]=_(""),[B,w]=_(!1),[V,D]=_({userName:"",status:!1}),[C,x]=_(!1),[N,I]=_([]),S=m(async r=>{i(),s(!0),w(!1),I([]),await it(r)},[i]),G=m(r=>{r.length?w(!1):w(!0),d(r)},[]);X(()=>{t!=null&&t.text&&i({text:t.text,type:t.status?t.status:void 0})},[t,i]);const H=m(()=>{g.length||w(!0)},[g]),L=m((r,o)=>g.length?!1:(w(!0),o&&ut(r,g,""),!0),[g]),M=m((r,o)=>{o!=null&&o.userName&&(r.target.reset(),E(F)?window.location.href=F():(f==null||f({userName:o==null?void 0:o.userName,status:!0}),D({userName:o==null?void 0:o.userName,status:!0})))},[f,F]),U=m((r,o)=>{var P;if((P=r==null?void 0:r.errorMessage)!=null&&P.length){j(o);const $=r.errorMessage.includes("This account isn't confirmed. Verify and try again."),T=$?e.resendEmailInformationText:r.displayErrorMessage;I($?[{label:e.resendEmailButtonText,onClick:()=>{S(o)}}]:[]),i({text:T,type:"error"}),d("")}},[S,i,e.resendEmailButtonText,e.resendEmailInformationText]),K=m(async(r,o)=>{if(i(),L(r,o))return;x(!0);const P=rt(r.target);if(Object.values(P).every(T=>T)){const{email:T,password:O}=P,W=await ot({email:T,password:O,handleSetInLineAlertProps:i,onErrorCallback:y,translations:e,apiErrorMessageOverride:p});U(W,T),M(r,W),w(!1)}x(!1)},[e,y,L,U,M,i,p]),A=m(()=>{if(E(a)){a("resetPasswordForm");return}E(c)&&(window.location.href=c())},[c,a]),Y=m(()=>{if(E(h)&&h(),E(a)){a("signUpForm");return}E(l)&&(window.location.href=l())},[h,l,a]),Z=et(()=>{const r=nt(st);return n!=null&&n.length?r==null?void 0:r.map(o=>({...o,defaultValue:n})):r},[n]),z=m(()=>{i(),E(b)?window.location.href=b():s(!1)},[i,b]);return{additionalActionsAlert:N,userEmail:v,defaultEnhancedEmailFields:Z,passwordError:B,isSuccessful:V,isLoading:C,signInPasswordValue:g,showEmailConfirmationForm:q,setShowEmailConfirmationForm:s,setSignInPasswordValue:d,submitLogInUser:K,forgotPasswordCallback:A,onSignUpLinkClickCallback:Y,handledOnPrimaryButtonClick:z,handleSetPassword:G,onBlurPassword:H}},yt=()=>{let t=new URL(window.location.href),e=t.searchParams.get("email"),n=t.searchParams.get("key");e&&n&&(t.searchParams.delete("email"),t.searchParams.delete("key"),window.history.replaceState({},document.title,t.toString()))},Et=({enableEmailConfirmation:t})=>{const e=ft({accountConfirmMessage:"Auth.EmailConfirmationForm.accountConfirmMessage",accountConfirmationEmailSuccessMessage:"Auth.EmailConfirmationForm.accountConfirmationEmailSuccessMessage"}),[n,l]=_({text:"",status:""});return X(()=>{if(t){const{search:c}=window.location;c.includes("email=")&&c.includes("key=")&&(async()=>{var f,h,i;const y=new URLSearchParams(c),a=await ct({customerEmail:y.get("email"),customerConfirmationKey:y.get("key")});if(!a)return null;(f=a==null?void 0:a.errors)!=null&&f.length?l({text:a==null?void 0:a.errors[0].message,status:"error"}):(l({text:a.data.confirmEmail.customer.email?e.accountConfirmationEmailSuccessMessage.replace("{email}",(i=(h=a==null?void 0:a.data)==null?void 0:h.confirmEmail.customer)==null?void 0:i.email):e.accountConfirmMessage,status:"success"}),yt())})()}},[t,e]),{emailConfirmationStatusMessage:n}},Mt=({slots:t,labels:e,formSize:n="default",initialEmailValue:l="",renderSignUpLink:c=!1,enableEmailConfirmation:F=!1,hideCloseBtnOnEmailConfirmation:y=!1,routeRedirectOnEmailConfirmationClose:a,routeRedirectOnSignIn:f,routeForgotPassword:h,routeSignUp:i,onSuccessCallback:b,setActiveComponent:p,onErrorCallback:v,onSignUpLinkClick:j,apiErrorMessageOverride:q})=>{const s=gt({title:"Auth.SignInForm.title",buttonPrimary:"Auth.SignInForm.buttonPrimary",buttonSecondary:"Auth.SignInForm.buttonSecondary",buttonTertiary:"Auth.SignInForm.buttonTertiary",resendEmailInformationText:"Auth.Notification.resendEmailNotification.informationText",resendEmailButtonText:"Auth.Notification.resendEmailNotification.buttonText",customerTokenErrorMessage:"Auth.Api.customerTokenErrorMessage",placeholder:"Auth.InputPassword.placeholder",floatingLabel:"Auth.InputPassword.floatingLabel",requiredFieldError:"Auth.FormText.requiredFieldError.default"}),{emailConfirmationStatusMessage:g}=Et({enableEmailConfirmation:F}),{inLineAlertProps:d,handleSetInLineAlertProps:B}=at(),{userEmail:w,additionalActionsAlert:V,defaultEnhancedEmailFields:D,passwordError:C,isSuccessful:x,isLoading:N,signInPasswordValue:I,showEmailConfirmationForm:S,submitLogInUser:G,forgotPasswordCallback:H,onSignUpLinkClickCallback:L,handledOnPrimaryButtonClick:M,handleSetPassword:U,onBlurPassword:K}=_t({translations:s,emailConfirmationStatusMessage:g,initialEmailValue:l,routeSignUp:i,routeForgotPassword:h,routeRedirectOnSignIn:f,setActiveComponent:p,onErrorCallback:v,onSuccessCallback:b,onSignUpLinkClick:j,handleSetInLineAlertProps:B,routeRedirectOnEmailConfirmationClose:a,apiErrorMessageOverride:q});if(x.status&&(t!=null&&t.SuccessNotification))return u(J,{"data-testid":"successNotificationTestId",name:"SuccessNotification",slot:t==null?void 0:t.SuccessNotification,context:{isSuccessful:x}});if(S)return u(mt,{formSize:n,userEmail:w,inLineAlertProps:d,hideCloseBtnOnEmailConfirmation:y,handleSetInLineAlertProps:B,onPrimaryButtonClick:M});const A={isLoading:N,passwordError:C,isSuccessful:x};return k("div",{className:tt(["auth-sign-in-form",`auth-sign-in-form--${n}`]),"data-testid":"signInForm",children:[u(J,{name:"Title","data-testid":"title",slot:t==null?void 0:t.Title,context:{...A},children:u(dt,{title:(e==null?void 0:e.formTitleText)??s.title,divider:!1,className:"auth-sign-in-form__title"})}),d.text?u(lt,{"data-testid":"authInLineAlert",className:"auth-sign-in-form__notification",type:d.type,variant:"secondary",heading:d.text,icon:d.icon,additionalActions:V}):null,k(wt,{name:"signIn_form",className:"auth-sign-in-form__form",onSubmit:G,loading:N,fieldsConfig:D,formSlot:{name:"Form",slot:t==null?void 0:t.Form,context:A,dataTestId:"form"},children:[u(ht,{hideStatusIndicator:!0,className:"auth-sign-in-form__form__password",autoComplete:"current-password",errorMessage:C?s.requiredFieldError:void 0,defaultValue:I,onValue:U,onBlur:K,placeholder:s.placeholder,floatingLabel:s.floatingLabel}),u("div",{className:"auth-sign-in-form__form__buttons__wrapper",children:k(J,{name:"Buttons",className:"auth-sign-in-form__form__buttons","data-testid":"buttons",slot:t==null?void 0:t.Buttons,context:{...A},children:[k("div",{className:"auth-sign-in-form__form__buttons__combine",children:[u(Q,{type:"button",variant:"tertiary",style:{padding:0},buttonText:s.buttonTertiary,className:"auth-sign-in-form__button auth-sign-in-form__button--forgot",enableLoader:!1,onClick:H,"data-testid":"switchToSignUp"}),c?k(R,{children:[u("span",{}),u(Q,{type:"button",variant:"tertiary",style:{padding:0},buttonText:s.buttonSecondary,className:"auth-sign-in-form__button auth-sign-in-form__button--signup",enableLoader:!1,onClick:L})]}):null]}),u(Q,{type:"submit",buttonText:(e==null?void 0:e.primaryButtonText)??s.buttonPrimary,variant:"primary",className:"auth-sign-in-form__button auth-sign-in-form__button--submit",enableLoader:N})]})})]}),u("div",{id:"generateCustomerToken"})]})};export{Mt as S};
//# sourceMappingURL=SignInForm.js.map
