/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsxs as y,jsx as n}from"@dropins/tools/preact-jsx-runtime.js";import{W as A,g as S}from"../chunks/ConditionalWrapper.js";/* empty css                  */import{Skeleton as b,SkeletonRow as I,Button as x}from"@dropins/tools/components.js";import{classes as z,Slot as H}from"@dropins/tools/lib.js";import{I as D,F as W,U as F,h as K,s as L}from"../chunks/fetch-graphql.js";import{events as u}from"@dropins/tools/event-bus.js";import{g as U}from"../chunks/values.js";import{useState as k,useCallback as m,useEffect as f}from"@dropins/tools/preact-hooks.js";import{useText as v}from"@dropins/tools/i18n.js";import"@dropins/tools/signals.js";import"@dropins/tools/fetch-graphql.js";var p=(t=>(t.FETCH_ERROR="FETCH_ERROR",t.INVALID_INPUT="INVALID_INPUT",t.UNAUTHENTICATED="UNAUTHENTICATED",t.UNKNOWN_ERROR="UNKNOWN_ERROR",t))(p||{});const B=[{code:"INVALID_INPUT",matches:t=>t instanceof D},{code:"FETCH_ERROR",matches:t=>t instanceof W},{code:"UNAUTHENTICATED",matches:t=>t instanceof F}];function j(t){const s=B.find(o=>o.matches(t));return s?s.code:p.UNKNOWN_ERROR}const w=()=>y(b,{"data-testid":"place-order-skeleton",children:[n(I,{size:"small",variant:"empty"}),n(I,{size:"small"})]}),M=({children:t,className:s,disabled:o=!1,onClick:i})=>n("div",{className:z(["checkout-place-order",s]),children:n(x,{className:"checkout-place-order__button","data-testid":"place-order-button",disabled:o,size:"medium",type:"submit",variant:"primary",onClick:i,children:t},"placeOrder")}),V=A(M,w),oe=({disabled:t=!1,active:s=!0,handleValidation:o,handlePlaceOrder:i,slots:l,...C})=>{var E;const[T,h]=k(!1),[g,N]=k(!1),P=K.value,d=v({CheckoutUnexpectedError:"Checkout.ServerError.unexpected",placeOrderButton:"Checkout.PlaceOrder.button"}),O=m(e=>{const r=j(e),a=r===p.UNKNOWN_ERROR?d.CheckoutUnexpectedError:e.message;u.emit("checkout/error",{message:a,code:r})},[d]),_=m(async()=>{var e;try{if(o&&!o())return;await i({cartId:L.cartId,code:((e=U("selectedPaymentMethod"))==null?void 0:e.code)??""})}catch(r){O(r)}},[o,i,O]),c=m(e=>{(!e||e.isEmpty)&&N(!1)},[]);return f(()=>{if(s===!1)return;const e=u.on("cart/initialized",r=>{const a=(r==null?void 0:r.items)||[];N(a.some(R=>R.outOfStock||R.insufficientQuantity))},{eager:!0});return()=>{e==null||e.off()}},[s]),f(()=>{if(!s)return;const e=S();if(e){h(!0),c(e);return}const r=u.on("checkout/initialized",a=>{h(!0),c(a)},{eager:!0});return()=>{r==null||r.off()}},[s,c]),f(()=>{if(!s)return;const e=u.on("checkout/updated",r=>{c(r)},{eager:!1});return()=>{e==null||e.off()}},[s,c]),n(V,{...C,disabled:t||g||P,initialized:T,visible:s,onClick:_,children:n(H,{context:{code:((E=U("selectedPaymentMethod"))==null?void 0:E.code)??""},name:"Content",slot:l==null?void 0:l.Content,children:d.placeOrderButton})})};export{oe as PlaceOrder,oe as default};
//# sourceMappingURL=PlaceOrder.js.map
