/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as a,jsxs as j,Fragment as ue}from"@dropins/tools/preact-jsx-runtime.js";import{Slot as be,classes as Se}from"@dropins/tools/lib.js";import{Checkbox as ve,Card as ie,InLineAlert as le,ProgressSpinner as de,Field as me,Input as pe,Button as Y,Modal as ye,Header as Ie}from"@dropins/tools/components.js";import{useMemo as fe,useRef as ae,useCallback as R,useState as N,useEffect as ne}from"@dropins/tools/preact-hooks.js";import{f as Ce}from"../chunks/fetchUserPermissions.js";import{b as he}from"../chunks/company-permissions.js";import{useText as re}from"@dropins/tools/i18n.js";import{u as Te}from"../chunks/useCompanyContextListener.js";import{memo as ge}from"@dropins/tools/preact-compat.js";import{C as we}from"../chunks/CompanyUserForm.js";import{events as se}from"@dropins/tools/event-bus.js";import{p as oe,E as ce}from"../chunks/acdl.js";import{g as Ee,c as Ne,u as xe,a as ke,b as De,d as _e}from"../chunks/updateCompanyTeam.js";import{d as Ue}from"../chunks/updateCompanyUser.js";import{a as Me,u as Ae,b as Pe}from"../chunks/useInLineAlert.js";import"../chunks/network-error.js";import"@dropins/tools/fetch-graphql.js";const Fe=l=>{const I=new Map;for(const d of l){const b=d.parentId??null,t=I.get(b)??[];t.push(d),I.set(b,t)}for(const[,d]of I)d.sort((b,t)=>b.label.localeCompare(t.label));return I},Le=({items:l,rootId:I=null,className:d,expandedIds:b,selectedId:t=null,selectedIds:x,onExpandedChange:S,onSelectedChange:s,onSelectedIdsChange:p,renderNode:m,role:U="tree",draggable:k,canDrop:v,onMove:_,isCheckable:f,checkedIds:V,onCheckedChange:z,renderExpander:M,renderCheckbox:Q,renderIcon:K})=>{const g=fe(()=>Fe(l),[l]),w=ae(null),A=ae(!1),E=fe(()=>new Map(l.map(i=>[i.id,i])),[l]),B=(i,C)=>{const P=[],L=[C];for(;L.length;){const u=L.pop(),r=i.get(u)??[];for(const n of r)P.push(n.id),L.push(n.id)}return P},O=R(i=>B(g,i),[g]),H=R(i=>f?f(i):!0,[f]),D=R(i=>{if(!E.get(i))return{checked:!1,indeterminate:!1};const P=[i,...O(i)].filter(r=>{const n=E.get(r);return n?H(n):!1});if(P.length===0)return{checked:!1,indeterminate:!1};const L=V??new Set,u=P.reduce((r,n)=>L.has(n)?r+1:r,0);return u===0?{checked:!1,indeterminate:!1}:u===P.length?{checked:!0,indeterminate:!1}:{checked:!1,indeterminate:!0}},[E,O,H,V]),W=R(i=>{if(!z)return;const C=new Set(V??[]),{checked:P}=D(i),L=[i,...O(i)].filter(u=>{const r=E.get(u);return r?H(r):!1});if(P)for(const u of L)C.delete(u);else for(const u of L)C.add(u);z(C)},[V,z,D,O,E,H]),G=R(i=>a(ve,{name:`tree-checkbox-${Math.random().toString(36).substr(2,9)}`,checked:i.checked,indeterminate:i.indeterminate,onChange:i.onCheck}),[]),X=R(i=>{const C=new Set(b);C.has(i)?C.delete(i):C.add(i),S(C)},[b,S]),te=R(i=>{const C=E.get(i);if(C&&H(C)&&z&&W(i),!p){s==null||s(i);return}const P=!!A.current,L=P?new Set(x??[]):new Set;P&&L.has(i)?L.delete(i):L.add(i),p(L),A.current=!1},[s,p,x,E,H,z,W]),Z=(i,C)=>{const P=g.get(i)??[];return P.length?a("ul",{role:C===1?U:"group",className:C===1?d??"acm-tree":"acm-tree__group",children:P.map((u,r)=>{const n=(g.get(u.id)??[]).length>0,h=b.has(u.id),e=x?x.has(u.id):t===u.id,o=!!(k!=null&&k(u)),T=y=>v?v(y,u.id):y!==u.id,c=n?()=>M?M({expanded:h,hasChildren:n,toggle:()=>X(u.id)}):null:void 0,F=(()=>{if(!z)return;const y=E.get(u.id);if(!y||!H(y))return;const q=D(u.id),J=Q||G;return()=>J({checked:q.checked,indeterminate:q.indeterminate,onCheck:()=>W(u.id)})})(),$=K?()=>K({item:u,level:C,hasChildren:n,expanded:h}):void 0,ee=m({item:u,level:C,expanded:h,selected:!!e,hasChildren:n,toggle:()=>X(u.id),select:()=>te(u.id),...c?{expander:c}:{},...F?{checkbox:F}:{},...$?{icon:$}:{}});return j("li",{role:"treeitem",className:"acm-tree__item","data-level":C,"aria-expanded":n?h:void 0,"aria-selected":e||void 0,"aria-level":C,"aria-setsize":P.length,"aria-posinset":r+1,draggable:o,onMouseDown:y=>{A.current=!!(y.metaKey||y.ctrlKey)},onDragStart:y=>{var q;if(y.stopPropagation(),!!o){w.current=u.id;try{(q=y.dataTransfer)==null||q.setData("text/plain",u.id)}catch{}}},onDragOver:y=>{var J;y.stopPropagation();const q=w.current??(((J=y.dataTransfer)==null?void 0:J.getData("text/plain"))||"");q&&T(q)&&y.preventDefault()},onDrop:y=>{var J;y.stopPropagation();const q=w.current??(((J=y.dataTransfer)==null?void 0:J.getData("text/plain"))||"");w.current=null,q&&T(q)&&(_==null||_({id:q,newParentId:u.id}))},children:[ee,n&&h?Z(u.id,C+1):null]},u.id)})}):null};return a("div",{className:"acm-tree-root",children:Z(I,1)})};function Re(l){const{mode:I,entityId:d,parentStructureId:b,onSaved:t}=l,x=re({teamTitleRequired:"Company.CompanyStructure.shared.validation.teamTitleRequired",createTeamError:"Company.CompanyStructure.messages.createTeamError",saveTeamError:"Company.CompanyStructure.messages.saveTeamError"}),[S,s]=N({id:"",name:"",description:""}),[p,m]=N({}),[U,k]=N({}),[v,_]=N(!1),[f,V]=N(null);ne(()=>{I!=="edit"||!d||(_(!0),Ee(d).then(g=>{g&&s({id:g.id,name:g.name||"",description:g.description||""})}).finally(()=>_(!1)))},[I,d]);const z=(g,w)=>g==="name"?w.trim()?null:x.teamTitleRequired:null,M=(g,w)=>{s(A=>({...A,[g]:w})),f&&V(null)};return{values:S,errors:p,touched:U,loading:v,setValue:M,onBlur:(g,w)=>{w!==void 0&&M(g,w),k(B=>({...B,[g]:!0}));const A=w!==void 0?w:S[g]||"",E=z(g,A);m(E?B=>({...B,[g]:E}):B=>{const O={...B};return delete O[g],O})},submit:async()=>{const g=z("name",S.name);if(g){m({name:g}),k({name:!0});return}const w=S.name;try{if(I==="add"){const A=await Ne({name:S.name,description:S.description||null,targetId:b??null});if(!A){V(x.createTeamError);return}t({label:w,structureId:A.structureId,entityId:A.id,type:"team",description:S.description||void 0})}else d&&(await xe({id:d,name:S.name,description:S.description||null}),t({label:w,entityId:d,type:"team",description:S.description||void 0}))}catch(A){const E=A instanceof Error?A.message:x.saveTeamError;V(E)}},generalError:f}}const Ve=ge(({mode:l,entityId:I,parentStructureId:d,permissions:b,onSaved:t,onCancel:x})=>{const S=(b==null?void 0:b.canEditUsers)??!1,{values:s,errors:p,touched:m,loading:U,onBlur:k,submit:v,generalError:_}=Re({mode:l,entityId:I,parentStructureId:d,onSaved:t}),[f,V]=N(!1),z=re({addTeam:"Company.CompanyStructure.shared.titles.addTeam",editTeam:"Company.CompanyStructure.shared.titles.editTeam",teamTitle:"Company.CompanyStructure.shared.fields.teamTitle",description:"Company.CompanyStructure.shared.fields.description"});return j("div",{children:[a("h3",{className:"acm-structure-panel__title",children:l==="add"?z.addTeam:z.editTeam}),j(ie,{variant:"secondary",className:`company-team-form__card ${f?"is-working":""}`,children:[_?a(le,{className:"company-team-form__notification",type:"error",variant:"secondary",heading:_}):null,f?a("div",{className:"company-team-form__overlay","aria-live":"polite",children:a(de,{size:"small"})}):null,U?a(Me,{}):j("div",{className:"company-team-form__content",children:[a(me,{label:z.teamTitle,required:!0,className:"acm-structure-panel__field",error:m.name&&p.name?p.name:void 0,children:a(pe,{name:"team_title",type:"text",value:s.name,onBlur:M=>{const Q=M.target;k("name",Q.value)},variant:"primary",size:"medium",disabled:!S})}),a(me,{label:z.description,className:"acm-structure-panel__field",children:a(pe,{name:"team_description",type:"textarea",value:s.description||"",onBlur:M=>{const Q=M.target;k("description",Q.value)},variant:"primary",size:"medium",disabled:!S})})]})]}),U?null:j("div",{className:"acm-structure-modal__actions",children:[a(Y,{type:"button",variant:"primary",onClick:async()=>{if(!f){V(!0);try{await v()}finally{V(!1)}}},disabled:f||!S,children:"Save"}),a(Y,{type:"button",variant:"secondary",disabled:f,onClick:x,children:"Cancel"})]})]})});function ze({handleSetInLineAlert:l,permissions:I}={permissions:null}){const d=(I==null?void 0:I.canViewUsers)??!1,b=re({structureSuccess:"Company.CompanyStructure.messages.structureSuccess",structureError:"Company.CompanyStructure.messages.structureError",loadError:"Company.CompanyStructure.messages.loadError",updateError:"Company.CompanyStructure.messages.updateError",failedToMoveItem:"Company.CompanyStructure.messages.failedToMoveItem"}),{structureSuccess:t,structureError:x,loadError:S,updateError:s}=b,[p,m]=N(null),[U,k]=N(!0),[v,_]=N(!1),[f,V]=N(!1),[z,M]=N(new Set),[Q,K]=N(null),[g,w]=N(new Set),[A,E]=N({}),B=ae(l),O=ae(!1),H=ae(!1);ne(()=>{B.current=l},[l]);const D=R((r,n)=>{l&&(r==="success"?l({type:"success",text:n??t}):r==="error"?l({type:"error",text:n??x}):l(),_(!1))},[l,t,x]),W=R(async()=>{if(O.current)return null;if(O.current=!0,!d)return k(!1),m(null),M(new Set),K(null),w(new Set),O.current=!1,null;k(!0);try{const n=await ke();return m(n),M(new Set(n.map(h=>h.id))),k(!1),n}catch{return k(!1),B.current&&B.current({type:"error",text:S}),null}finally{O.current=!1}},[d,S]);ne(()=>{d&&!H.current&&(H.current=!0,W())},[d,W]),ne(()=>{const r=()=>{k(!0),M(new Set),K(null),w(new Set),W()},n=se.on("companyContext/changed",r,{eager:!0});return()=>{n==null||n.off()}},[W]);const G=R(async(r,n)=>{try{return _(!0),await De({id:r,parentId:n})?(m(e=>e?e.map(o=>o.id===r?{...o,parentId:n}:o):null),M(e=>new Set([...e,n])),oe(ce.EDIT_COMPANY_STRUCTURE_EVENT,{action:"move",nodeId:r,newParentId:n}),se.emit("companyStructure/updated",{message:"Structure updated",action:"move",nodeId:r,newParentId:n,nodes:p||[]}),D("success"),!0):(D("error",b.failedToMoveItem),!1)}catch(h){const e=h instanceof Error?h.message:s;return D("error",e),!1}finally{_(!1)}},[p,D,s,b.failedToMoveItem]),X=R(()=>{p&&M(new Set(p.map(r=>r.id)))},[p]),te=R(()=>{if(p){const r=p.filter(n=>n.parentId===null).map(n=>n.id);M(new Set(r))}},[p]),Z=R(r=>{m(n=>{const h=n?[...n,{id:r.id,parentId:r.parentId,label:r.label,type:r.type,entityId:r.entityId,description:r.description}]:[{id:r.id,parentId:r.parentId,label:r.label,type:r.type,entityId:r.entityId,description:r.description}];return se.emit("companyStructure/updated",{message:"Structure updated",action:"add",nodeId:r.id,newParentId:r.parentId||void 0,nodes:h}),oe(ce.EDIT_COMPANY_STRUCTURE_EVENT,{action:"add",nodeId:r.id,newParentId:r.parentId||void 0,nodeType:r.type}),h}),r.parentId&&M(n=>new Set([...n,r.parentId]))},[]),i=R((r,n,h)=>{n&&m(e=>e?e.map(o=>r.includes(o.id)?{...o,label:n,description:h}:o):null)},[]),C=R(async r=>{if(r.length)try{_(!0);const n=new Map((p||[]).map(h=>[h.id,h]));for(const h of r){const e=n.get(h);!e||!e.entityId||(e.type==="team"?await _e(e.entityId):await Ue(e.entityId))}m(h=>{if(!h)return null;const e=new Set(r);return h.filter(o=>!e.has(o.id))}),K(null),w(new Set),oe(ce.EDIT_COMPANY_STRUCTURE_EVENT,{action:"remove",nodeIds:r}),se.emit("companyStructure/updated",{message:"Structure updated",action:"remove",nodeIds:r,nodes:p||[]}),D("success")}catch(n){const h=n instanceof Error?n.message:s;D("error",h)}finally{_(!1)}},[p,D,s]),P=R(r=>{E(r)},[]),L=R(()=>{V(!0),D("success",""),E({})},[D]),u=R(r=>{r==null||r(),V(!1),E({})},[]);return{nodes:p,loading:U,submitLoading:v,showEditForm:f,inputChange:A,expanded:z,setExpanded:M,selected:Q,setSelected:K,selectedMany:g,setSelectedMany:w,move:G,expandAll:X,collapseAll:te,insertNode:Z,renameNodes:i,removeNodes:C,handleInputChange:P,handleShowEditForm:L,handleHideEditForm:u,renderAlertMessage:D,working:v}}const Oe=ge(({permissions:l,slots:I})=>{var h;const d=(l==null?void 0:l.canEditUsers)??!1,b=(l==null?void 0:l.canViewUsers)??!1,t=re({expandAll:"Company.CompanyStructure.shared.buttons.expandAll",collapseAll:"Company.CompanyStructure.shared.buttons.collapseAll",addUser:"Company.CompanyStructure.shared.buttons.addUser",addTeam:"Company.CompanyStructure.shared.buttons.addTeam",editSelected:"Company.CompanyStructure.shared.buttons.editSelected",remove:"Company.CompanyStructure.shared.buttons.remove",ok:"Company.CompanyStructure.shared.buttons.ok",cancel:"Company.CompanyStructure.shared.buttons.cancel",close:"Company.CompanyStructure.shared.buttons.close",deleting:"Company.CompanyStructure.shared.buttons.deleting",removing:"Company.CompanyStructure.shared.buttons.removing",noStructureData:"Company.CompanyStructure.messages.noStructureData",processing:"Company.CompanyStructure.shared.messages.processing",cannotDeleteUser:"Company.CompanyStructure.messages.cannotDeleteUser",cannotDeleteTeam:"Company.CompanyStructure.messages.cannotDeleteTeam",removeUserConfirm:"Company.CompanyStructure.messages.removeUserConfirm",deleteTeamConfirm:"Company.CompanyStructure.messages.deleteTeamConfirm",removeItemsConfirm:"Company.CompanyStructure.messages.removeItemsConfirm",teamDescription:"Company.CompanyStructure.shared.messages.teamDescription",removeUserMessage:"Company.CompanyStructure.messages.removeUserMessage",cannotDeleteUserMessage:"Company.CompanyStructure.messages.cannotDeleteUserMessage",cannotDeleteTeamMessage:"Company.CompanyStructure.messages.cannotDeleteTeamMessage",removeItemsMessage:"Company.CompanyStructure.messages.removeItemsMessage",companyStructureActions:"Company.CompanyStructure.shared.ariaLabels.companyStructureActions",expandAllNodes:"Company.CompanyStructure.shared.ariaLabels.expandAllNodes",collapseAllNodes:"Company.CompanyStructure.shared.ariaLabels.collapseAllNodes",addUserAria:"Company.CompanyStructure.shared.ariaLabels.addUser",addTeamAria:"Company.CompanyStructure.shared.ariaLabels.addTeam",editSelectedAria:"Company.CompanyStructure.shared.ariaLabels.editSelected",removeSelectedAria:"Company.CompanyStructure.shared.ariaLabels.removeSelected",showDescription:"Company.CompanyStructure.shared.ariaLabels.showDescription",delete:"Company.CompanyStructure.shared.options.delete",expand:"Company.CompanyStructure.shared.options.expand",collapse:"Company.CompanyStructure.shared.options.collapse",deleteTeamMessage:"Company.CompanyStructure.messages.deleteTeamMessage"}),{inLineAlertProps:x,handleSetInLineAlert:S}=Ae(),{nodes:s,loading:p,submitLoading:m,expanded:U,setExpanded:k,selected:v,setSelected:_,selectedMany:f,setSelectedMany:V,move:z,expandAll:M,collapseAll:Q,insertNode:K,renameNodes:g,removeNodes:w}=ze({handleSetInLineAlert:S,permissions:l}),[A,E]=N(null),[B,O]=N("add"),[H,D]=N(!1),[W,G]=N([]),[X,te]=N({title:"",body:"",confirmLabel:t.remove,blocked:!1}),[Z,i]=N(null),C=()=>E(null),P=((h=s==null?void 0:s.find(e=>e.parentId===null))==null?void 0:h.id)??null,L=(s||[]).map(e=>({id:e.id,parentId:e.parentId,label:e.label})),u=(e,o)=>{let T=e;const c=new Map(L.map($=>[$.id,$])),F=new Set;for(;T&&!F.has(T);){F.add(T);const $=c.get(T);if(!$)break;if($.parentId===o)return!0;T=$.parentId??null}return!1},r=(s||[]).map(e=>({id:e.id,parentId:e.parentId,label:e.label,type:e.type,description:e.description,entityId:e.entityId})),n=j(ue,{children:[(()=>{const e=f!=null&&f.size?Array.from(f):v?[v]:[],o=d&&e.length===1,T=d&&e.length>=1;return a(ie,{variant:"secondary",className:"acm-structure-toolbar-card acm-structure-toolbar-card--spaced",children:j("div",{className:"acm-structure-toolbar",role:"toolbar","aria-label":t.companyStructureActions,children:[a(Y,{type:"button",variant:"secondary",onClick:M,"aria-label":t.expandAllNodes,disabled:!b,"aria-disabled":!b,children:t.expandAll}),a(Y,{type:"button",variant:"secondary",onClick:Q,"aria-label":t.collapseAllNodes,disabled:!b,"aria-disabled":!b,children:t.collapseAll}),a(Y,{type:"button",variant:"primary",onClick:()=>{O("add"),E("user")},"aria-label":t.addUserAria,disabled:!d,"aria-disabled":!d,children:t.addUser}),a(Y,{type:"button",variant:"primary",onClick:()=>{O("add"),E("team")},"aria-label":t.addTeamAria,disabled:!d,"aria-disabled":!d,children:t.addTeam}),a(Y,{type:"button",variant:"primary",disabled:!o,"aria-disabled":!o,"aria-label":t.editSelectedAria,onClick:()=>{if(!o)return;const c=e,F=s==null?void 0:s.find($=>$.id===c[0]);(F==null?void 0:F.type)==="user"?(O("edit"),E("user")):(O("edit"),E("team"))},children:t.editSelected}),a(Y,{type:"button",variant:"secondary",disabled:!T||m,"aria-disabled":!T||m,"aria-label":t.removeSelectedAria,onClick:()=>{if(!T||m)return;const c=e;if(c.length===1){const F=s==null?void 0:s.find(ee=>ee.id===c[0]);if(!F)return;(s==null?void 0:s.some(ee=>ee.parentId===F.id))?(te({title:F.type==="user"?t.cannotDeleteUser:t.cannotDeleteTeam,body:F.type==="user"?t.cannotDeleteUserMessage:t.cannotDeleteTeamMessage,confirmLabel:void 0,blocked:!0}),G([]),D(!0)):(te({title:F.type==="user"?t.removeUserConfirm:t.deleteTeamConfirm,body:F.type==="user"?t.removeUserMessage:t.deleteTeamMessage,confirmLabel:F.type==="user"?t.remove:t.delete,blocked:!1}),G(c),D(!0))}else te({title:t.removeItemsConfirm,body:t.removeItemsMessage,confirmLabel:t.remove,blocked:!1}),G(c),D(!0)},children:t.remove})]})})})(),A?j("div",{className:"acm-structure-panel",children:[m?j("div",{className:"acm-structure-working","aria-live":"polite",children:[a(de,{size:"small"})," ",t.processing]}):null,A==="user"?(()=>{const e=f!=null&&f.size?Array.from(f):v?[v]:[],o=e.length?s==null?void 0:s.find(c=>c.id===e[0]):void 0,T=(o==null?void 0:o.id)??P;return a(we,{mode:B,entityId:o==null?void 0:o.entityId,parentStructureId:T,permissions:l,onSaved:c=>{B==="add"?c.structureId&&(K({id:c.structureId,parentId:T,label:c.label,type:c.type,entityId:c.entityId}),c.structureId&&(_(c.structureId),V(new Set([c.structureId])))):e.length&&g(e,c.label),C()},onCancel:C})})():null,A==="team"?(()=>{const e=f!=null&&f.size?Array.from(f):v?[v]:[],o=e.length?s==null?void 0:s.find(c=>c.id===e[0]):void 0,T=(o==null?void 0:o.id)??P;return a(Ve,{mode:B,entityId:o==null?void 0:o.entityId,parentStructureId:T,permissions:l,onSaved:c=>{B==="add"?c.structureId&&(K({id:c.structureId,parentId:T,label:c.label,type:c.type,entityId:c.entityId,description:c.description}),c.structureId&&(_(c.structureId),V(new Set([c.structureId])))):e.length&&g(e,c.label,c.description),C()},onCancel:C})})():null]}):null,j(ie,{variant:"secondary",className:`acm-structure-tree-card ${m?"is-working":""}`,children:[x&&x.text?a(le,{className:"acm-structure-panel__notification",type:x.type||"success",variant:"secondary",heading:x.text}):null,!p&&!m&&s&&s.length===0?a(le,{className:"acm-structure-panel__notification",type:"warning",variant:"secondary",heading:t.noStructureData}):null,!p&&m?a("div",{className:"acm-structure-tree-overlay","aria-live":"polite",children:a(de,{size:"medium"})}):null,p?a("div",{className:"acm-structure-tree-content",children:a(Pe,{rows:8})}):a("div",{className:"acm-structure-tree-content",children:a(Le,{rootId:null,items:L,expandedIds:U,selectedId:v,selectedIds:f,onExpandedChange:k,onSelectedChange:_,onSelectedIdsChange:V,renderExpander:({expanded:e,toggle:o})=>a("button",{type:"button",className:`acm-structure-expander acm-structure-expander-button ${e?"is-open":""}`,"aria-label":e?t.collapse:t.expand,onClick:T=>{T.stopPropagation(),o()},children:e?"âˆ’":"+"}),renderNode:({item:e,hasChildren:o,select:T,expander:c,checkbox:F,icon:$})=>{var ee;return j("div",{className:"acm-structure-row",onClick:T,children:[o?c?a("span",{onClick:y=>y.stopPropagation(),children:c()}):a("span",{className:"acm-structure-expander acm-structure-expander--placeholder"}):a("span",{className:"acm-structure-expander acm-structure-expander--placeholder"}),a("span",{className:"acm-structure-handle","aria-hidden":!0}),$?a("span",{onClick:y=>y.stopPropagation(),children:$()}):a("span",{className:`acm-structure-icon ${((ee=s==null?void 0:s.find(y=>y.id===e.id))==null?void 0:ee.type)==="team"?"is-team":"is-user"}`,"aria-hidden":!0}),F?a("span",{onClick:y=>y.stopPropagation(),children:F()}):null,a("span",{className:"acm-structure-label",children:e.label}),(()=>{const y=s==null?void 0:s.find(J=>J.id===e.id),q=(y==null?void 0:y.type)==="team"&&y.description||"";return q?a(Y,{type:"button",variant:"secondary",onClick:J=>{J.stopPropagation(),i({id:e.id,text:q})},"aria-label":t.showDescription,className:"acm-structure-description-button",children:"?"}):null})()]})},draggable:()=>!m&&d,canDrop:(e,o)=>{if(!d||e===o)return!1;const T=s==null?void 0:s.find(c=>c.id===e);return T&&T.parentId===o?!1:!u(o,e)},onMove:async({id:e,newParentId:o})=>{d&&await z(e,o)}})})]}),H?a(ye,{open:H,onClose:()=>{m||(D(!1),G([]))},children:j("div",{className:"acm-structure-modal-content",children:[a("h3",{className:"acm-structure-modal-title",children:X.title}),a("div",{children:X.body}),a("div",{className:"acm-structure-modal-actions",children:X.blocked?a(Y,{type:"button",variant:"secondary",disabled:m,onClick:()=>{m||(D(!1),G([]))},children:t.ok}):j(ue,{children:[a(Y,{type:"button",variant:"secondary",disabled:m,onClick:()=>{m||(D(!1),G([]))},children:t.cancel}),a(Y,{type:"button",variant:"primary",disabled:m,onClick:async()=>{await w(W),D(!1),G([])},children:m?X.confirmLabel===t.delete?t.deleting:t.removing:X.confirmLabel||t.remove})]})})]})}):null,Z?a(ye,{open:!!Z,onClose:()=>i(null),children:j("div",{className:"acm-structure-modal-content",children:[a("h3",{className:"acm-structure-modal-title",children:t.teamDescription}),a("div",{children:Z.text}),a("div",{className:"acm-structure-modal-actions",children:a(Y,{type:"button",variant:"secondary",onClick:()=>i(null),children:t.close})})]})}):null]});return I!=null&&I.StructureData?a(be,{name:"StructureData",slot:I.StructureData,context:{structureData:r,Default:n}}):n}),Be=()=>{const l=re({fetchPermissionsError:"Company.CompanyStructure.messages.fetchPermissionsError"}),[I,d]=N(null),[b,t]=N(!0),[x,S]=N(null),s=R(async()=>{var p,m;try{t(!0),S(null);const{roleResponse:U}=await Ce(),k=(m=(p=U==null?void 0:U.data)==null?void 0:p.customer)==null?void 0:m.role,v=he(k);d(v)}catch(U){S(U instanceof Error?U:new Error(l.fetchPermissionsError))}finally{t(!1)}},[l.fetchPermissionsError]);return ne(()=>{let p=!0;return(async()=>{var U,k;try{t(!0),S(null);const{roleResponse:v}=await Ce();if(!p)return;const _=(k=(U=v==null?void 0:v.data)==null?void 0:U.customer)==null?void 0:k.role,f=he(_);d(f)}catch(v){if(!p)return;S(v instanceof Error?v:new Error(l.fetchPermissionsError))}finally{p&&t(!1)}})(),()=>{p=!1}},[]),{permissions:I,loading:b,error:x,refreshPermissions:s}},st=({className:l,withHeader:I=!1,slots:d})=>{const b=re({containerTitle:"Company.CompanyStructure.containerTitle"}),{permissions:t,refreshPermissions:x}=Be();return Te(x),j("div",{className:Se(["account-company-structure",l]),children:[I?a(Ie,{title:b.containerTitle,divider:!1,className:"company-structure__title"}):null,a(Oe,{slots:d,permissions:t})]})};export{st as CompanyStructure,st as default};
//# sourceMappingURL=CompanyStructure.js.map
