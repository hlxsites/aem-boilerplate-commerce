/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsxs as M,jsx as r,Fragment as ue}from"@dropins/tools/preact-jsx-runtime.js";import{useState as h,useEffect as q,useRef as oe,useCallback as R}from"@dropins/tools/preact-hooks.js";import{Slot as be,classes as ge}from"@dropins/tools/lib.js";import{Card as re,InLineAlert as ae,ProgressSpinner as le,Field as me,Input as pe,Button as A,Modal as ye,Header as Se}from"@dropins/tools/components.js";import{f as fe}from"../chunks/fetchUserPermissions.js";import{b as Ce}from"../chunks/company-permissions.js";import{useText as $}from"@dropins/tools/i18n.js";import{u as Ie}from"../chunks/useCompanyContextListener2.js";import{a as Te,i as Ee}from"../chunks/isCompanyUser.js";import*as he from"@dropins/tools/preact-compat.js";import{memo as ve}from"@dropins/tools/preact-compat.js";import{T as we}from"../chunks/Tree.js";import{C as Ne}from"../chunks/CompanyUserForm.js";import{events as te}from"@dropins/tools/event-bus.js";import{p as ce,E as ie}from"../chunks/acdl.js";import{a as Ue,c as xe,b as _e,g as Me,u as ke,d as De}from"../chunks/updateCompanyTeam.js";import{a as Ae}from"../chunks/updateCompanyUser.js";import{u as Pe}from"../chunks/useInLineAlert.js";import{c as Le,d as Fe}from"../chunks/CompanyLoaders.js";import"../chunks/fetch-error.js";import"@dropins/tools/fetch-graphql.js";import"../chunks/useCompanyRoles.js";import"../chunks/useCompanyContextListener.js";import"../chunks/isCompanyRoleNameAvailable.js";const Ve=l=>he.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...l},he.createElement("path",{vectorEffect:"non-scaling-stroke",fillRule:"evenodd",clipRule:"evenodd",d:"M1 20.8953L12.1922 1.5L23.395 20.8953H1ZM13.0278 13.9638L13.25 10.0377V9H11.25V10.0377L11.4722 13.9638H13.0278ZM11.2994 16V17.7509H13.2253V16H11.2994Z",fill:"currentColor"}));function Re(l){const{mode:T,entityId:u,parentStructureId:S,onSaved:t}=l,I=$({teamTitleRequired:"Company.CompanyStructure.shared.validation.teamTitleRequired",createTeamError:"Company.CompanyStructure.messages.createTeamError",saveTeamError:"Company.CompanyStructure.messages.saveTeamError"}),[m,n]=h({id:"",name:"",description:""}),[d,s]=h({}),[C,f]=h({}),[p,E]=h(!1),[y,P]=h(null);q(()=>{T!=="edit"||!u||(E(!0),Ue(u).then(g=>{g&&n({id:g.id,name:g.name||"",description:g.description||""})}).finally(()=>E(!1)))},[T,u]);const z=(g,w)=>g==="name"?w.trim()?null:I.teamTitleRequired:null,U=(g,w)=>{n(_=>({..._,[g]:w})),y&&P(null)};return{values:m,errors:d,touched:C,loading:p,setValue:U,onBlur:(g,w)=>{w!==void 0&&U(g,w),f(D=>({...D,[g]:!0}));const _=w!==void 0?w:m[g]||"",k=z(g,_);s(k?D=>({...D,[g]:k}):D=>{const L={...D};return delete L[g],L})},submit:async()=>{const g=z("name",m.name);if(g){s({name:g}),f({name:!0});return}const w=m.name;try{if(T==="add"){const _=await xe({name:m.name,description:m.description||null,targetId:S??null});if(!_){P(I.createTeamError);return}t({label:w,structureId:_.structureId,entityId:_.id,type:"team",description:m.description||void 0})}else u&&(await _e({id:u,name:m.name,description:m.description||null}),t({label:w,entityId:u,type:"team",description:m.description||void 0}))}catch(_){const k=_ instanceof Error?_.message:I.saveTeamError;P(k)}},generalError:y}}const ze=ve(({mode:l,entityId:T,parentStructureId:u,permissions:S,onSaved:t,onCancel:I})=>{const m=(S==null?void 0:S.canEditUsers)??!1,{values:n,errors:d,touched:s,loading:C,onBlur:f,submit:p,generalError:E}=Re({mode:l,entityId:T,parentStructureId:u,onSaved:t}),[y,P]=h(!1),z=$({addTeam:"Company.CompanyStructure.shared.titles.addTeam",editTeam:"Company.CompanyStructure.shared.titles.editTeam",teamTitle:"Company.CompanyStructure.shared.fields.teamTitle",description:"Company.CompanyStructure.shared.fields.description"});return M("div",{children:[r("h3",{className:"acm-structure-panel__title",children:l==="add"?z.addTeam:z.editTeam}),M(re,{variant:"secondary",className:`company-team-form__card ${y?"is-working":""}`,children:[E?r(ae,{className:"company-team-form__notification",type:"error",variant:"secondary",heading:E}):null,y?r("div",{className:"company-team-form__overlay","aria-live":"polite",children:r(le,{size:"small"})}):null,C?r(Le,{}):M("div",{className:"company-team-form__content",children:[r(me,{label:z.teamTitle,required:!0,className:"acm-structure-panel__field",error:s.name&&d.name?d.name:void 0,children:r(pe,{name:"team_title",type:"text",value:n.name,onBlur:U=>{const B=U.target;f("name",B.value)},variant:"primary",size:"medium",disabled:!m})}),r(me,{label:z.description,className:"acm-structure-panel__field",children:r(pe,{name:"team_description",type:"textarea",value:n.description||"",onBlur:U=>{const B=U.target;f("description",B.value)},variant:"primary",size:"medium",disabled:!m})})]})]}),C?null:M("div",{className:"acm-structure-modal__actions",children:[r(A,{type:"button",variant:"primary",onClick:async()=>{if(!y){P(!0);try{await p()}finally{P(!1)}}},disabled:y||!m,children:"Save"}),r(A,{type:"button",variant:"secondary",disabled:y,onClick:I,children:"Cancel"})]})]})});function Oe({handleSetInLineAlert:l,permissions:T}={permissions:null}){const u=(T==null?void 0:T.canViewUsers)??!1,S=$({structureSuccess:"Company.CompanyStructure.messages.structureSuccess",structureError:"Company.CompanyStructure.messages.structureError",loadError:"Company.CompanyStructure.messages.loadError",updateError:"Company.CompanyStructure.messages.updateError",failedToMoveItem:"Company.CompanyStructure.messages.failedToMoveItem"}),{structureSuccess:t,structureError:I,loadError:m,updateError:n}=S,[d,s]=h(null),[C,f]=h(!0),[p,E]=h(!1),[y,P]=h(!1),[z,U]=h(new Set),[B,H]=h(null),[g,w]=h(new Set),[_,k]=h({}),D=oe(l),L=oe(!1),W=oe(!1);q(()=>{D.current=l},[l]);const N=R((a,i)=>{l&&(a==="success"?l({type:"success",text:i??t}):a==="error"?l({type:"error",text:i??I}):l(),E(!1))},[l,t,I]),Z=R(async()=>{if(L.current)return null;if(L.current=!0,!u)return f(!1),s(null),U(new Set),H(null),w(new Set),L.current=!1,null;f(!0);try{const i=await Me();return s(i),U(new Set(i.map(v=>v.id))),f(!1),i}catch{return f(!1),D.current&&D.current({type:"error",text:m}),null}finally{L.current=!1}},[u,m]);q(()=>{u&&!W.current&&(W.current=!0,Z())},[u,Z]),q(()=>{const a=()=>{f(!0),U(new Set),H(null),w(new Set),Z()},i=te.on("companyContext/changed",a,{eager:!0});return()=>{i==null||i.off()}},[Z]);const O=R(async(a,i)=>{try{return E(!0),await ke({id:a,parentId:i})?(s(e=>e?e.map(o=>o.id===a?{...o,parentId:i}:o):null),U(e=>new Set([...e,i])),ce(ie.EDIT_COMPANY_STRUCTURE_EVENT,{action:"move",nodeId:a,newParentId:i}),te.emit("companyStructure/updated",{message:"Structure updated",action:"move",nodeId:a,newParentId:i,nodes:d||[]}),N("success"),!0):(N("error",S.failedToMoveItem),!1)}catch(v){const e=v instanceof Error?v.message:n;return N("error",e),!1}finally{E(!1)}},[d,N,n,S.failedToMoveItem]),Y=R(()=>{d&&U(new Set(d.map(a=>a.id)))},[d]),J=R(()=>{if(d){const a=d.filter(i=>i.parentId===null).map(i=>i.id);U(new Set(a))}},[d]),K=R(a=>{s(i=>{const v=i?[...i,{id:a.id,parentId:a.parentId,label:a.label,type:a.type,entityId:a.entityId,description:a.description}]:[{id:a.id,parentId:a.parentId,label:a.label,type:a.type,entityId:a.entityId,description:a.description}];return te.emit("companyStructure/updated",{message:"Structure updated",action:"add",nodeId:a.id,newParentId:a.parentId||void 0,nodes:v}),ce(ie.EDIT_COMPANY_STRUCTURE_EVENT,{action:"add",nodeId:a.id,newParentId:a.parentId||void 0,nodeType:a.type}),v}),a.parentId&&U(i=>new Set([...i,a.parentId]))},[]),Q=R((a,i,v)=>{i&&s(e=>e?e.map(o=>a.includes(o.id)?{...o,label:i,description:v}:o):null)},[]),j=R(async a=>{if(a.length)try{E(!0);const i=new Map((d||[]).map(v=>[v.id,v]));for(const v of a){const e=i.get(v);!e||!e.entityId||(e.type==="team"?await De(e.entityId):await Ae(e.entityId))}s(v=>{if(!v)return null;const e=new Set(a);return v.filter(o=>!e.has(o.id))}),H(null),w(new Set),ce(ie.EDIT_COMPANY_STRUCTURE_EVENT,{action:"remove",nodeIds:a}),te.emit("companyStructure/updated",{message:"Structure updated",action:"remove",nodeIds:a,nodes:d||[]}),N("success")}catch(i){const v=i instanceof Error?i.message:n;N("error",v)}finally{E(!1)}},[d,N,n]),X=R(a=>{k(a)},[]),ee=R(()=>{P(!0),N("success",""),k({})},[N]),ne=R(a=>{a==null||a(),P(!1),k({})},[]);return{nodes:d,loading:C,submitLoading:p,showEditForm:y,inputChange:_,expanded:z,setExpanded:U,selected:B,setSelected:H,selectedMany:g,setSelectedMany:w,move:O,expandAll:Y,collapseAll:J,insertNode:K,renameNodes:Q,removeNodes:j,handleInputChange:X,handleShowEditForm:ee,handleHideEditForm:ne,renderAlertMessage:N,working:p}}const Be=ve(({permissions:l,slots:T})=>{var v;const u=(l==null?void 0:l.canEditUsers)??!1,S=(l==null?void 0:l.canViewUsers)??!1,t=$({expandAll:"Company.CompanyStructure.shared.buttons.expandAll",collapseAll:"Company.CompanyStructure.shared.buttons.collapseAll",addUser:"Company.CompanyStructure.shared.buttons.addUser",addTeam:"Company.CompanyStructure.shared.buttons.addTeam",editSelected:"Company.CompanyStructure.shared.buttons.editSelected",remove:"Company.CompanyStructure.shared.buttons.remove",ok:"Company.CompanyStructure.shared.buttons.ok",cancel:"Company.CompanyStructure.shared.buttons.cancel",close:"Company.CompanyStructure.shared.buttons.close",deleting:"Company.CompanyStructure.shared.buttons.deleting",removing:"Company.CompanyStructure.shared.buttons.removing",noStructureData:"Company.CompanyStructure.messages.noStructureData",processing:"Company.CompanyStructure.shared.messages.processing",cannotDeleteUser:"Company.CompanyStructure.messages.cannotDeleteUser",cannotDeleteTeam:"Company.CompanyStructure.messages.cannotDeleteTeam",removeUserConfirm:"Company.CompanyStructure.messages.removeUserConfirm",deleteTeamConfirm:"Company.CompanyStructure.messages.deleteTeamConfirm",removeItemsConfirm:"Company.CompanyStructure.messages.removeItemsConfirm",teamDescription:"Company.CompanyStructure.shared.messages.teamDescription",removeUserMessage:"Company.CompanyStructure.messages.removeUserMessage",cannotDeleteUserMessage:"Company.CompanyStructure.messages.cannotDeleteUserMessage",cannotDeleteTeamMessage:"Company.CompanyStructure.messages.cannotDeleteTeamMessage",removeItemsMessage:"Company.CompanyStructure.messages.removeItemsMessage",companyStructureActions:"Company.CompanyStructure.shared.ariaLabels.companyStructureActions",expandAllNodes:"Company.CompanyStructure.shared.ariaLabels.expandAllNodes",collapseAllNodes:"Company.CompanyStructure.shared.ariaLabels.collapseAllNodes",addUserAria:"Company.CompanyStructure.shared.ariaLabels.addUser",addTeamAria:"Company.CompanyStructure.shared.ariaLabels.addTeam",editSelectedAria:"Company.CompanyStructure.shared.ariaLabels.editSelected",removeSelectedAria:"Company.CompanyStructure.shared.ariaLabels.removeSelected",showDescription:"Company.CompanyStructure.shared.ariaLabels.showDescription",delete:"Company.CompanyStructure.shared.options.delete",expand:"Company.CompanyStructure.shared.options.expand",collapse:"Company.CompanyStructure.shared.options.collapse",deleteTeamMessage:"Company.CompanyStructure.messages.deleteTeamMessage"}),{inLineAlertProps:I,handleSetInLineAlert:m}=Pe(),{nodes:n,loading:d,submitLoading:s,expanded:C,setExpanded:f,selected:p,setSelected:E,selectedMany:y,setSelectedMany:P,move:z,expandAll:U,collapseAll:B,insertNode:H,renameNodes:g,removeNodes:w}=Oe({handleSetInLineAlert:m,permissions:l}),[_,k]=h(null),[D,L]=h("add"),[W,N]=h(!1),[Z,O]=h([]),[Y,J]=h({title:"",body:"",confirmLabel:t.remove,blocked:!1}),[K,Q]=h(null),j=()=>k(null),X=((v=n==null?void 0:n.find(e=>e.parentId===null))==null?void 0:v.id)??null,ee=(n||[]).map(e=>({id:e.id,parentId:e.parentId,label:e.label})),ne=(e,o)=>{let b=e;const c=new Map(ee.map(F=>[F.id,F])),x=new Set;for(;b&&!x.has(b);){x.add(b);const F=c.get(b);if(!F)break;if(F.parentId===o)return!0;b=F.parentId??null}return!1},a=(n||[]).map(e=>({id:e.id,parentId:e.parentId,label:e.label,type:e.type,description:e.description,entityId:e.entityId})),i=M(ue,{children:[(()=>{const e=y!=null&&y.size?Array.from(y):p?[p]:[],o=u&&e.length===1,b=u&&e.length>=1;return r(re,{variant:"secondary",className:"acm-structure-toolbar-card acm-structure-toolbar-card--spaced",children:M("div",{className:"acm-structure-toolbar",role:"toolbar","aria-label":t.companyStructureActions,children:[r(A,{type:"button",variant:"secondary",onClick:U,"aria-label":t.expandAllNodes,disabled:!S,"aria-disabled":!S,children:t.expandAll}),r(A,{type:"button",variant:"secondary",onClick:B,"aria-label":t.collapseAllNodes,disabled:!S,"aria-disabled":!S,children:t.collapseAll}),r(A,{type:"button",variant:"primary",onClick:()=>{L("add"),k("user")},"aria-label":t.addUserAria,disabled:!u,"aria-disabled":!u,children:t.addUser}),r(A,{type:"button",variant:"primary",onClick:()=>{L("add"),k("team")},"aria-label":t.addTeamAria,disabled:!u,"aria-disabled":!u,children:t.addTeam}),r(A,{type:"button",variant:"primary",disabled:!o,"aria-disabled":!o,"aria-label":t.editSelectedAria,onClick:()=>{if(!o)return;const c=e,x=n==null?void 0:n.find(F=>F.id===c[0]);(x==null?void 0:x.type)==="user"?(L("edit"),k("user")):(L("edit"),k("team"))},children:t.editSelected}),r(A,{type:"button",variant:"secondary",disabled:!b||s,"aria-disabled":!b||s,"aria-label":t.removeSelectedAria,onClick:()=>{if(!b||s)return;const c=e;if(c.length===1){const x=n==null?void 0:n.find(G=>G.id===c[0]);if(!x)return;(n==null?void 0:n.some(G=>G.parentId===x.id))?(J({title:x.type==="user"?t.cannotDeleteUser:t.cannotDeleteTeam,body:x.type==="user"?t.cannotDeleteUserMessage:t.cannotDeleteTeamMessage,confirmLabel:void 0,blocked:!0}),O([]),N(!0)):(J({title:x.type==="user"?t.removeUserConfirm:t.deleteTeamConfirm,body:x.type==="user"?t.removeUserMessage:t.deleteTeamMessage,confirmLabel:x.type==="user"?t.remove:t.delete,blocked:!1}),O(c),N(!0))}else J({title:t.removeItemsConfirm,body:t.removeItemsMessage,confirmLabel:t.remove,blocked:!1}),O(c),N(!0)},children:t.remove})]})})})(),_?M("div",{className:"acm-structure-panel",children:[s?M("div",{className:"acm-structure-working","aria-live":"polite",children:[r(le,{size:"small"})," ",t.processing]}):null,_==="user"?(()=>{const e=y!=null&&y.size?Array.from(y):p?[p]:[],o=e.length?n==null?void 0:n.find(c=>c.id===e[0]):void 0,b=(o==null?void 0:o.id)??X;return r(Ne,{mode:D,entityId:o==null?void 0:o.entityId,parentStructureId:b,permissions:l,onSaved:c=>{D==="add"?c.structureId&&(H({id:c.structureId,parentId:b,label:c.label,type:c.type,entityId:c.entityId}),c.structureId&&(E(c.structureId),P(new Set([c.structureId])))):e.length&&g(e,c.label),j()},onCancel:j})})():null,_==="team"?(()=>{const e=y!=null&&y.size?Array.from(y):p?[p]:[],o=e.length?n==null?void 0:n.find(c=>c.id===e[0]):void 0,b=(o==null?void 0:o.id)??X;return r(ze,{mode:D,entityId:o==null?void 0:o.entityId,parentStructureId:b,permissions:l,onSaved:c=>{D==="add"?c.structureId&&(H({id:c.structureId,parentId:b,label:c.label,type:c.type,entityId:c.entityId,description:c.description}),c.structureId&&(E(c.structureId),P(new Set([c.structureId])))):e.length&&g(e,c.label,c.description),j()},onCancel:j})})():null]}):null,M(re,{variant:"secondary",className:`acm-structure-tree-card ${s?"is-working":""}`,children:[I&&I.text?r(ae,{className:"acm-structure-panel__notification",type:I.type||"success",variant:"secondary",heading:I.text}):null,!d&&!s&&n&&n.length===0?r(ae,{className:"acm-structure-panel__notification",type:"warning",variant:"secondary",heading:t.noStructureData}):null,!d&&s?r("div",{className:"acm-structure-tree-overlay","aria-live":"polite",children:r(le,{size:"medium"})}):null,d?r("div",{className:"acm-structure-tree-content",children:r(Fe,{rows:8})}):r("div",{className:"acm-structure-tree-content",children:r(we,{rootId:null,items:ee,expandedIds:C,selectedId:p,selectedIds:y,onExpandedChange:f,onSelectedChange:E,onSelectedIdsChange:P,renderExpander:({expanded:e,toggle:o})=>r("button",{type:"button",className:`acm-structure-expander acm-structure-expander-button ${e?"is-open":""}`,"aria-label":e?t.collapse:t.expand,onClick:b=>{b.stopPropagation(),o()},children:e?"−":"+"}),renderNode:({item:e,hasChildren:o,select:b,expander:c,checkbox:x,icon:F})=>{var G;return M("div",{className:"acm-structure-row",onClick:b,children:[o?c?r("span",{onClick:V=>V.stopPropagation(),children:c()}):r("span",{className:"acm-structure-expander acm-structure-expander--placeholder"}):r("span",{className:"acm-structure-expander acm-structure-expander--placeholder"}),r("span",{className:"acm-structure-handle","aria-hidden":!0}),F?r("span",{onClick:V=>V.stopPropagation(),children:F()}):r("span",{className:`acm-structure-icon ${((G=n==null?void 0:n.find(V=>V.id===e.id))==null?void 0:G.type)==="team"?"is-team":"is-user"}`,"aria-hidden":!0}),x?r("span",{onClick:V=>V.stopPropagation(),children:x()}):null,r("span",{className:"acm-structure-label",children:e.label}),(()=>{const V=n==null?void 0:n.find(se=>se.id===e.id),de=(V==null?void 0:V.type)==="team"&&V.description||"";return de?r(A,{type:"button",variant:"secondary",onClick:se=>{se.stopPropagation(),Q({id:e.id,text:de})},"aria-label":t.showDescription,className:"acm-structure-description-button",children:"?"}):null})()]})},draggable:()=>!s&&u,canDrop:(e,o)=>{if(!u||e===o)return!1;const b=n==null?void 0:n.find(c=>c.id===e);return b&&b.parentId===o?!1:!ne(o,e)},onMove:async({id:e,newParentId:o})=>{u&&await z(e,o)}})})]}),W?r(ye,{open:W,onClose:()=>{s||(N(!1),O([]))},children:M("div",{className:"acm-structure-modal-content",children:[r("h3",{className:"acm-structure-modal-title",children:Y.title}),r("div",{children:Y.body}),r("div",{className:"acm-structure-modal-actions",children:Y.blocked?r(A,{type:"button",variant:"secondary",disabled:s,onClick:()=>{s||(N(!1),O([]))},children:t.ok}):M(ue,{children:[r(A,{type:"button",variant:"secondary",disabled:s,onClick:()=>{s||(N(!1),O([]))},children:t.cancel}),r(A,{type:"button",variant:"primary",disabled:s,onClick:async()=>{await w(Z),N(!1),O([])},children:s?Y.confirmLabel===t.delete?t.deleting:t.removing:Y.confirmLabel||t.remove})]})})]})}):null,K?r(ye,{open:!!K,onClose:()=>Q(null),children:M("div",{className:"acm-structure-modal-content",children:[r("h3",{className:"acm-structure-modal-title",children:t.teamDescription}),r("div",{children:K.text}),r("div",{className:"acm-structure-modal-actions",children:r(A,{type:"button",variant:"secondary",onClick:()=>Q(null),children:t.close})})]})}):null]});return T!=null&&T.StructureData?r(be,{name:"StructureData",slot:T.StructureData,context:{structureData:a,Default:i}}):i}),He=()=>{const l=$({fetchPermissionsError:"Company.CompanyStructure.messages.fetchPermissionsError"}),[T,u]=h(null),[S,t]=h(!0),[I,m]=h(null),n=R(async()=>{var d,s;try{t(!0),m(null);const{roleResponse:C}=await fe(),f=(s=(d=C==null?void 0:C.data)==null?void 0:d.customer)==null?void 0:s.role,p=Ce(f);u(p)}catch(C){m(C instanceof Error?C:new Error(l.fetchPermissionsError))}finally{t(!1)}},[l.fetchPermissionsError]);return q(()=>{let d=!0;return(async()=>{var C,f;try{t(!0),m(null);const{roleResponse:p}=await fe();if(!d)return;const E=(f=(C=p==null?void 0:p.data)==null?void 0:C.customer)==null?void 0:f.role,y=Ce(E);u(y)}catch(p){if(!d)return;m(p instanceof Error?p:new Error(l.fetchPermissionsError))}finally{d&&t(!1)}})(),()=>{d=!1}},[]),{permissions:T,loading:S,error:I,refreshPermissions:n}},Ye="/customer/company/create",qe=({className:l,children:T,createCompanyAccountUrl:u=Ye,...S})=>{const t=$({individualUserMessage:"Company.CustomerCompanyInfo.individualUserMessage",createAccountCta:"Company.CustomerCompanyInfo.createAccountCta"}),I=t.individualUserMessage||"You don't have a company account yet.";return r(re,{variant:"secondary",className:ge(["company-management-company-structure-card",l]),...S,children:M("div",{children:[r(ae,{type:"warning",variant:"secondary",heading:I,icon:r(Ve,{}),className:"company-management-company-structure-card__alert","data-testid":"company-structure-inline-alert"}),r("div",{className:"company-management-company-structure-card__cta",children:r(A,{as:"a",href:u,variant:"primary","data-testid":"company-structure-create-company-button",children:t.createAccountCta||"Create a Company Account"})})]})})},yt=({className:l,withHeader:T=!1,slots:u,isAuthenticated:S=!1,onRedirectLogin:t,onRedirectAccount:I})=>{const m=$({containerTitle:"Company.CompanyStructure.containerTitle"}),{permissions:n,refreshPermissions:d}=He(),[s,C]=h("loading");return Ie(d),q(()=>{let f=!0;return(async()=>{try{if(!S){f&&C("redirect-login");return}if(!await Te()){f&&(console.log("Company registration disabled - redirecting to account dashboard"),C("redirect-account"));return}await Ee()?f&&C("show-structure"):f&&C("show-empty")}catch(p){console.error("Error in CompanyStructure - redirecting to login page:",p),f&&C("redirect-login")}})(),()=>{f=!1}},[S]),q(()=>{s==="redirect-login"&&t&&t(),s==="redirect-account"&&I&&I()},[s,t,I]),s==="loading"||s==="redirect-login"||s==="redirect-account"?null:s==="show-empty"?r(qe,{className:l}):s==="show-structure"?M("div",{className:ge(["account-company-structure",l]),children:[T?r(Se,{title:m.containerTitle,divider:!1,className:"company-structure__title"}):null,r(Be,{slots:u,permissions:n})]}):null};export{yt as CompanyStructure,yt as default};
//# sourceMappingURL=CompanyStructure.js.map
