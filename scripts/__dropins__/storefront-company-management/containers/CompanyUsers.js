/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as t,jsxs as y}from"@dropins/tools/preact-jsx-runtime.js";import{useState as h,useRef as G,useCallback as m,useEffect as z,useMemo as j}from"@dropins/tools/preact-hooks.js";import{Button as S,Icon as Q,Skeleton as X,SkeletonRow as Y,InLineAlert as ee,Picker as ae}from"@dropins/tools/components.js";import{Fragment as te}from"@dropins/tools/preact.js";import{classes as V,VComponent as q}from"@dropins/tools/lib.js";import{useText as $}from"@dropins/tools/i18n.js";import{events as ne}from"@dropins/tools/event-bus.js";import{u as re,d as se,g as oe}from"../chunks/getCompanyUsers.js";import{u as ie,C as le}from"../chunks/CompanyLoaders.js";import"../chunks/fetch-error.js";import"@dropins/tools/fetch-graphql.js";import"@dropins/tools/preact-compat.js";const ce=({className:v,children:u,columns:g=[],rowData:s=[],mobileLayout:T="none",caption:A,expandedRows:E=new Set,loading:i=!1,skeletonRowCount:C=10,onSortChange:U,...N})=>{const l=$({sortedAscending:"Dropin.Table.sortedAscending",sortedDescending:"Dropin.Table.sortedDescending",sortBy:"Dropin.Table.sortBy"}),c=e=>{if(!U)return;let r;e.sortBy===!0?r="asc":e.sortBy==="asc"?r="desc":r=!0,U(e.key,r)},B=e=>{if(e.sortBy===void 0)return null;let r,d;return e.sortBy==="asc"?(r="ChevronUp",d=l.sortedAscending.replace("{label}",e.label)):e.sortBy==="desc"?(r="ChevronDown",d=l.sortedDescending.replace("{label}",e.label)):(r="Sort",d=l.sortBy.replace("{label}",e.label)),t(S,{variant:"tertiary",size:"medium",className:"dropin-table__header__sort-button",icon:t(Q,{source:r}),"aria-label":d,onClick:()=>c(e)})},P=()=>Array.from({length:C},(e,r)=>t("tr",{className:"dropin-table__body__row",children:g.map(d=>t("td",{className:"dropin-table__body__cell","data-label":d.label,children:t(X,{children:t(Y,{variant:"row",size:"small",fullWidth:!0})})},d.key))},`skeleton-${r}`)),_=()=>s.map((e,r)=>{const d=e._rowDetails!==void 0,k=E.has(r);return y(te,{children:[t("tr",{className:"dropin-table__body__row",children:g.map(p=>{const I=e[p.key];return typeof I=="string"||typeof I=="number"?t("td",{className:"dropin-table__body__cell","data-label":p.label,children:I},p.key):t("td",{className:"dropin-table__body__cell","data-label":p.label,children:t(q,{node:I})},p.key)})}),d&&k&&t("tr",{className:"dropin-table__row-details dropin-table__row-details--expanded",id:`row-${r}-details`,children:t("td",{className:"dropin-table__row-details__cell",colSpan:g.length,role:"region","aria-labelledby":`row-${r}-details`,children:typeof e._rowDetails=="string"?e._rowDetails:t(q,{node:e._rowDetails})})},`${r}-details`)]},r)}),w=e=>{if(e.sortBy===!0)return"none";if(e.sortBy==="asc")return"ascending";if(e.sortBy==="desc")return"descending"};return t("div",{className:V(["dropin-table",`dropin-table--mobile-layout-${T}`,v]),children:y("table",{...N,className:"dropin-table__table",children:[A&&t("caption",{className:"dropin-table__caption",children:A}),t("thead",{className:"dropin-table__header",children:t("tr",{className:"dropin-table__header__row",children:g.map(e=>y("th",{className:V(["dropin-table__header__cell",["dropin-table__header__cell--sorted",e.sortBy==="asc"||e.sortBy==="desc"],["dropin-table__header__cell--sortable",e.sortBy!==void 0]]),"aria-sort":w(e),children:[e.label,B(e)]},e.key))})}),t("tbody",{className:"dropin-table__body",children:i?P():_()})]})})},me=({className:v,userId:u,userStatus:g,onClose:s,isOpen:T=!1,...A})=>{const[E,i]=h(!1),[C,U]=h(!1),{inLineAlertProps:N,showError:l,clearAlert:c}=ie(),B=G(null),P=G(null),_=`modal-title-${u}`,w=`modal-desc-${u}`,e=$({title:"Company.CompanyUsers.managementModal.title",setActiveText:"Company.CompanyUsers.managementModal.setActiveText",setInactiveText:"Company.CompanyUsers.managementModal.setInactiveText",deleteText:"Company.CompanyUsers.managementModal.deleteText",setActiveButton:"Company.CompanyUsers.managementModal.setActiveButton",setInactiveButton:"Company.CompanyUsers.managementModal.setInactiveButton",settingActiveButton:"Company.CompanyUsers.managementModal.settingActiveButton",settingInactiveButton:"Company.CompanyUsers.managementModal.settingInactiveButton",deleteButton:"Company.CompanyUsers.managementModal.deleteButton",deletingButton:"Company.CompanyUsers.managementModal.deletingButton",cancelButton:"Company.CompanyUsers.managementModal.cancelButton",setActiveErrorGeneric:"Company.CompanyUsers.managementModal.setActiveErrorGeneric",setActiveErrorSpecific:"Company.CompanyUsers.managementModal.setActiveErrorSpecific",setInactiveErrorGeneric:"Company.CompanyUsers.managementModal.setInactiveErrorGeneric",setInactiveErrorSpecific:"Company.CompanyUsers.managementModal.setInactiveErrorSpecific",deleteErrorGeneric:"Company.CompanyUsers.managementModal.deleteErrorGeneric",deleteErrorSpecific:"Company.CompanyUsers.managementModal.deleteErrorSpecific",ariaCloseModal:"Company.CompanyUsers.managementModal.ariaLabels.closeModal",ariaModalDescription:"Company.CompanyUsers.managementModal.ariaLabels.modalDescription"}),r=m(async()=>{if(C)return;const a=g==="ACTIVE"?"INACTIVE":"ACTIVE",f=a==="ACTIVE";U(!0),c();try{(await re({id:u,status:a})).success?s():l(f?e.setActiveErrorSpecific:e.setInactiveErrorSpecific)}catch{l(f?e.setActiveErrorGeneric:e.setInactiveErrorGeneric)}finally{U(!1)}},[u,g,s,C,c,l,e.setActiveErrorSpecific,e.setInactiveErrorSpecific,e.setActiveErrorGeneric,e.setInactiveErrorGeneric]),d=m(async()=>{if(!E){i(!0),c();try{(await se({id:u})).success?s():l(e.deleteErrorSpecific)}catch{l(e.deleteErrorGeneric)}finally{i(!1)}}},[u,s,E,c,l,e.deleteErrorSpecific,e.deleteErrorGeneric]),k=m(()=>{c(),s()},[s,c]),p=m(a=>{if(a.key==="Escape"&&(c(),s()),a.key==="Tab"){const f=B.current;if(!f)return;const b=f.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'),M=b[0],L=b[b.length-1];a.shiftKey?document.activeElement===M&&(L.focus(),a.preventDefault()):document.activeElement===L&&(M.focus(),a.preventDefault())}},[s,c]),I=m(a=>{a.target===a.currentTarget&&(c(),s())},[s,c]),x=m(()=>{c(),s()},[s,c]);return z(()=>{if(T)return P.current=document.activeElement,document.addEventListener("keydown",p),setTimeout(()=>{const a=B.current;if(a){const f=a.querySelector("button");f?f.focus():a.focus()}},100),()=>{document.removeEventListener("keydown",p)};P.current&&P.current.focus()},[T,p]),T?t("div",{className:V(["company-management-company-users-management-modal-overlay",v]),onClick:I,...A,children:y("div",{ref:B,className:"company-management-company-users-management-modal",role:"dialog","aria-modal":"true","aria-labelledby":_,"aria-describedby":w,tabIndex:-1,children:[y("div",{className:"company-management-company-users-management-modal__header",children:[t("h2",{id:_,className:"company-management-company-users-management-modal__title",children:e.title}),t("button",{className:"company-management-company-users-management-modal__close",onClick:x,"aria-label":e.ariaCloseModal,children:"Ã—"})]}),y("div",{id:w,className:"company-management-company-users-management-modal__content",children:[t("p",{className:"company-management-company-users-management-modal__text",children:g==="ACTIVE"?e.setInactiveText:e.setActiveText}),t("p",{className:"company-management-company-users-management-modal__text",children:e.deleteText})]}),(N==null?void 0:N.text)&&t("div",{className:"company-management-company-users-management-modal__alert",role:"alert","aria-live":"assertive",children:t(ee,{type:"error",heading:N.text,icon:N.icon,"data-testid":"companyUsersManagementModalAlert"})}),y("div",{className:"company-management-company-users-management-modal__actions",children:[t(S,{variant:"primary",onClick:r,disabled:C,className:"company-management-company-users-management-modal__button-primary",children:C?g==="ACTIVE"?e.settingInactiveButton:e.settingActiveButton:g==="ACTIVE"?e.setInactiveButton:e.setActiveButton}),t("button",{type:"button",onClick:d,disabled:E,className:"company-management-company-users-management-modal__button-delete",children:E?e.deletingButton:e.deleteButton}),t(S,{variant:"secondary",onClick:k,className:"company-management-company-users-management-modal__button-cancel",children:e.cancelButton})]})]})}):null},de=20,F=1,pe=[{text:"20",value:"20"},{text:"30",value:"30"},{text:"50",value:"50"},{text:"100",value:"100"},{text:"200",value:"200"}],ye=(v,u)=>v==="ACTIVE"?u.statusActive:v==="INACTIVE"?u.statusInactive:v.charAt(0).toUpperCase()+v.slice(1).toLowerCase(),Ie=({children:v,className:u,...g})=>{var R;const[s,T]=h([]),[A,E]=h(!1),[i,C]=h(F),[U,N]=h(de),[l,c]=h("all"),[B,P]=h(0),[_,w]=h(1),[e,r]=h(""),[d,k]=h(!1),[p,I]=h(""),x=G(null),a=$({showAllUsers:"Company.CompanyUsers.filters.showAll",showActiveUsers:"Company.CompanyUsers.filters.showActive",showInactiveUsers:"Company.CompanyUsers.filters.showInactive",idColumn:"Company.CompanyUsers.columns.id",nameColumn:"Company.CompanyUsers.columns.name",emailColumn:"Company.CompanyUsers.columns.email",roleColumn:"Company.CompanyUsers.columns.role",teamColumn:"Company.CompanyUsers.columns.team",statusColumn:"Company.CompanyUsers.columns.status",actionsColumn:"Company.CompanyUsers.columns.actions",statusActive:"Company.CompanyUsers.status.active",statusInactive:"Company.CompanyUsers.status.inactive",emptyTeam:"Company.CompanyUsers.emptyTeam",emptyActions:"Company.CompanyUsers.emptyActions",itemsText:"Company.CompanyUsers.pagination.itemsCount",itemsPerPageLabel:"Company.CompanyUsers.pagination.itemsPerPage",showLabel:"Company.CompanyUsers.pagination.show",perPageLabel:"Company.CompanyUsers.pagination.perPage",previousPage:"Company.CompanyUsers.pagination.previous",nextPage:"Company.CompanyUsers.pagination.next",pageInfo:"Company.CompanyUsers.pagination.pageInfo",ariaLoadingUsers:"Company.CompanyUsers.ariaLabels.loadingUsers",ariaUsersTable:"Company.CompanyUsers.ariaLabels.usersTable",ariaFilterOptions:"Company.CompanyUsers.ariaLabels.filterOptions",ariaPaginationNav:"Company.CompanyUsers.ariaLabels.paginationNav",ariaPageSizeSelector:"Company.CompanyUsers.ariaLabels.pageSizeSelector",ariaPreviousPageFull:"Company.CompanyUsers.ariaLabels.previousPageFull",ariaNextPageFull:"Company.CompanyUsers.ariaLabels.nextPageFull",ariaCurrentPage:"Company.CompanyUsers.ariaLabels.currentPage",ariaShowingUsers:"Company.CompanyUsers.ariaLabels.showingUsers",ariaDataLoaded:"Company.CompanyUsers.ariaLabels.dataLoaded",ariaDataError:"Company.CompanyUsers.ariaLabels.dataError",ariaPageNavigation:"Company.CompanyUsers.ariaLabels.pageNavigation",manageUser:"Company.CompanyUsers.actions.manage",ariaManageUser:"Company.CompanyUsers.ariaLabels.manageUser"}),f=m(()=>{switch(l){case"active":return{status:"ACTIVE"};case"inactive":return{status:"INACTIVE"};default:return}},[l]),b=m(async()=>{var n;E(!0);try{const o=await oe({pageSize:U,currentPage:i,filter:f()});if(T(o.users),P(o.totalCount||o.users.length),r(a.ariaDataLoaded.replace("{count}",o.users.length.toString())),(n=o.pageInfo)!=null&&n.totalPages)w(o.pageInfo.totalPages);else{const D=Math.ceil((o.totalCount||o.users.length)/U);w(D||1)}}catch(o){console.error("Failed to fetch company users:",o),T([]),P(0),w(1),r(a.ariaDataError)}finally{E(!1)}},[U,i,f,a.ariaDataLoaded,a.ariaDataError]);z(()=>{b()},[b]),z(()=>{!A&&x.current&&s.length>0&&x.current.setAttribute("aria-busy","false")},[A,i,l,s.length]),z(()=>{const n=()=>{C(F),b()},o=ne.on("companyContext/changed",n,{eager:!0});return()=>{o==null||o.off()}},[b]);const M=m(n=>{c(n),C(F)},[]),L=m(n=>{let o;if(typeof n=="string")o=n;else if("target"in n&&n.target&&"value"in n.target)o=n.target.value;else return;const D=parseInt(o,10);isNaN(D)||(N(D),C(F))},[]),K=m(()=>{i>1&&C(i-1)},[i]),Z=m(()=>{i<_&&C(i+1)},[i,_]),O=m(n=>{I(n),k(!0)},[]),W=m(()=>{k(!1),I(""),b()},[b]),H=j(()=>[{key:"id",label:a.idColumn},{key:"name",label:a.nameColumn},{key:"email",label:a.emailColumn},{key:"role",label:a.roleColumn},{key:"team",label:a.teamColumn},{key:"status",label:a.statusColumn},{key:"actions",label:a.actionsColumn}],[a]),J=j(()=>s.map(n=>{var o;return{id:n.id,name:`${n.firstName} ${n.lastName}`.trim(),email:n.email,role:n.role,team:n.team||a.emptyTeam,status:ye(n.status,a),actions:t(S,{variant:"tertiary",onClick:()=>O(n.id),"aria-label":((o=a.ariaManageUser)==null?void 0:o.replace("{name}",`${n.firstName} ${n.lastName}`.trim()))||`Manage user ${n.firstName} ${n.lastName}`.trim(),className:"manage-user-button",children:a.manageUser||"Manage"})}}),[s,a,O]);return y("section",{className:u,...g,children:[t("div",{className:"sr-only",role:"status","aria-live":"polite","aria-atomic":"true",children:e}),y("div",{className:"filterButtons",role:"group","aria-label":a.ariaFilterOptions,children:[l!=="all"&&t(S,{variant:"tertiary",onClick:()=>M("all"),"aria-label":a.showAllUsers,children:a.showAllUsers}),l!=="active"&&t(S,{variant:"tertiary",onClick:()=>M("active"),"aria-label":a.showActiveUsers,children:a.showActiveUsers}),l!=="inactive"&&t(S,{variant:"tertiary",onClick:()=>M("inactive"),"aria-label":a.showInactiveUsers,children:a.showInactiveUsers})]}),t("div",{ref:x,"aria-busy":A,children:A?y("div",{className:"loadingContainer",role:"status","aria-live":"polite",children:[t(le,{testId:"companyUsersTableLoader"}),t("span",{className:"sr-only",children:a.ariaLoadingUsers})]}):t(ce,{columns:H,rowData:J,mobileLayout:"stacked","aria-label":a.ariaUsersTable,summary:a.ariaShowingUsers.replace("{count}",s.length.toString())})}),y("nav",{"aria-label":a.ariaPaginationNav,className:"paginationContainer",children:[t("div",{"aria-live":"polite","aria-atomic":"true",children:a.itemsText.replace("{count}",B.toString())}),_>1&&y("div",{className:"paginationButtons",role:"group","aria-label":a.ariaPageNavigation,children:[t(S,{variant:"secondary",onClick:K,disabled:i===1,"aria-label":a.ariaPreviousPageFull.replace("{current}",i.toString()),children:a.previousPage}),t("span",{"aria-current":"page","aria-live":"polite",children:a.pageInfo.replace("{current}",i.toString()).replace("{total}",_.toString())}),t(S,{variant:"secondary",onClick:Z,disabled:i===_,"aria-label":a.ariaNextPageFull.replace("{current}",i.toString()),children:a.nextPage})]}),y("div",{className:"pageSizeSelector",children:[t("label",{htmlFor:"page-size-select",id:"page-size-label",children:t("span",{children:a.showLabel})}),t(ae,{id:"page-size-select",name:"pageSize",value:U.toString(),options:pe,onChange:L,"aria-labelledby":"page-size-label","aria-describedby":"page-size-description"}),t("span",{id:"page-size-description",children:a.perPageLabel})]})]}),v,p&&t(me,{isOpen:d,userId:p,userStatus:((R=s.find(n=>n.id===p))==null?void 0:R.status)||"ACTIVE",onClose:W})]})};export{Ie as CompanyUsers,Ie as default};
//# sourceMappingURL=CompanyUsers.js.map
