/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as a,jsxs as A}from"@dropins/tools/preact-jsx-runtime.js";import{useState as E,useRef as F,useMemo as R,useCallback as h,useEffect as G}from"@dropins/tools/preact-hooks.js";import{InLineAlert as K,Button as P,Icon as Z,Skeleton as W,SkeletonRow as H,Picker as J}from"@dropins/tools/components.js";import{Fragment as Q}from"@dropins/tools/preact.js";import{classes as $,VComponent as q}from"@dropins/tools/lib.js";import{useText as O}from"@dropins/tools/i18n.js";import{u as X,C as Y}from"../chunks/useInLineAlert.js";import{g as ee,u as ae,d as te}from"../chunks/getCompanyUsers.js";import{u as ne}from"../chunks/useCompanyContextListener.js";import{f as re}from"../chunks/fetchUserPermissions.js";import"@dropins/tools/preact-compat.js";import"../chunks/fetch-error.js";import"@dropins/tools/fetch-graphql.js";import"@dropins/tools/event-bus.js";const se=(c,i)=>!c||typeof c!="string"?"":c==="ACTIVE"&&i.statusActive?i.statusActive:c==="INACTIVE"&&i.statusInactive?i.statusInactive:c.charAt(0).toUpperCase()+c.slice(1).toLowerCase(),oe=(c,i)=>{const y=(c==null?void 0:c.trim())||"",l=(i==null?void 0:i.trim())||"";return`${y} ${l}`.trim()},ie=20,V=1,le=({translations:c})=>{const[i,y]=E([]),[l,S]=E(!1),[p,b]=E(V),[I,t]=E(ie),[g,f]=E("all"),[m,d]=E(0),[v,T]=E(1),[N,w]=E(""),[e,n]=E(null),u=F(c);u.current=c;const B=R(()=>{switch(g){case"active":return{status:"ACTIVE"};case"inactive":return{status:"INACTIVE"};default:return}},[g]),C=h(async()=>{S(!0);try{const o=await ee({pageSize:I,currentPage:p,filter:B});y(o.users),d(o.totalCount||o.users.length),T(o.pageInfo.totalPages),w(u.current.ariaDataLoaded.replace("{count}",o.users.length.toString()))}catch{y([]),d(0),T(1),w(u.current.ariaDataError)}finally{S(!1)}},[I,p,B]),U=h(async()=>{try{const{allowedIds:o}=await re();n(o)}catch{n(new Set)}},[]);G(()=>{C()},[C]),G(()=>{U()},[U]);const L=h(o=>{f(o),b(V)},[]),s=h(o=>{let r;if(typeof o=="string")r=o;else if("target"in o&&o.target&&"value"in o.target)r=o.target.value;else return;const D=parseInt(r,10);isNaN(D)||(t(D),b(V))},[]),_=h(()=>{p>1&&b(p-1)},[p]),k=h(()=>{p<v&&b(p+1)},[p,v]),x=(e==null?void 0:e.has("Magento_Company::users_edit"))||!1,M=h(async()=>{await C()},[C]);return{users:i,userPermissions:e,currentPage:p,pageSize:I,totalItems:m,totalPages:v,filterType:g,filter:B,loading:l,announcement:N,canEditUsers:x,handleFilterChange:L,handlePageSizeChange:s,handlePreviousPage:_,handleNextPage:k,refreshUsers:M}},ce=({className:c,userId:i,userStatus:y,onClose:l,isOpen:S=!1,...p})=>{const[b,I]=E(!1),[t,g]=E(!1),{inLineAlertProps:f,showError:m,clearAlert:d}=X(),v=F(null),T=F(null),N=`modal-title-${i}`,w=`modal-desc-${i}`,e=O({title:"Company.CompanyUsers.managementModal.title",setActiveText:"Company.CompanyUsers.managementModal.setActiveText",setInactiveText:"Company.CompanyUsers.managementModal.setInactiveText",deleteText:"Company.CompanyUsers.managementModal.deleteText",setActiveButton:"Company.CompanyUsers.managementModal.setActiveButton",setInactiveButton:"Company.CompanyUsers.managementModal.setInactiveButton",settingActiveButton:"Company.CompanyUsers.managementModal.settingActiveButton",settingInactiveButton:"Company.CompanyUsers.managementModal.settingInactiveButton",deleteButton:"Company.CompanyUsers.managementModal.deleteButton",deletingButton:"Company.CompanyUsers.managementModal.deletingButton",cancelButton:"Company.CompanyUsers.managementModal.cancelButton",setActiveErrorGeneric:"Company.CompanyUsers.managementModal.setActiveErrorGeneric",setActiveErrorSpecific:"Company.CompanyUsers.managementModal.setActiveErrorSpecific",setInactiveErrorGeneric:"Company.CompanyUsers.managementModal.setInactiveErrorGeneric",setInactiveErrorSpecific:"Company.CompanyUsers.managementModal.setInactiveErrorSpecific",deleteErrorGeneric:"Company.CompanyUsers.managementModal.deleteErrorGeneric",deleteErrorSpecific:"Company.CompanyUsers.managementModal.deleteErrorSpecific",ariaCloseModal:"Company.CompanyUsers.managementModal.ariaLabels.closeModal",ariaModalDescription:"Company.CompanyUsers.managementModal.ariaLabels.modalDescription"}),n=h(async()=>{if(t)return;const s=y==="ACTIVE"?"INACTIVE":"ACTIVE",_=s==="ACTIVE";g(!0),d();try{(await ae({id:i,status:s})).success?l():m(_?e.setActiveErrorSpecific:e.setInactiveErrorSpecific)}catch{m(_?e.setActiveErrorGeneric:e.setInactiveErrorGeneric)}finally{g(!1)}},[i,y,l,t,d,m,e.setActiveErrorSpecific,e.setInactiveErrorSpecific,e.setActiveErrorGeneric,e.setInactiveErrorGeneric]),u=h(async()=>{if(!b){I(!0),d();try{(await te({id:i})).success?l():m(e.deleteErrorSpecific)}catch{m(e.deleteErrorGeneric)}finally{I(!1)}}},[i,l,b,d,m,e.deleteErrorSpecific,e.deleteErrorGeneric]),B=h(()=>{d(),l()},[l,d]),C=h(s=>{if(s.key==="Escape"&&(d(),l()),s.key==="Tab"){const _=v.current;if(!_)return;const k=_.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'),x=k[0],M=k[k.length-1];s.shiftKey?document.activeElement===x&&(M.focus(),s.preventDefault()):document.activeElement===M&&(x.focus(),s.preventDefault())}},[l,d]),U=h(s=>{s.target===s.currentTarget&&(d(),l())},[l,d]),L=h(()=>{d(),l()},[l,d]);return G(()=>{if(S)return T.current=document.activeElement,document.addEventListener("keydown",C),setTimeout(()=>{const s=v.current;if(s){const _=s.querySelector("button");_?_.focus():s.focus()}},100),()=>{document.removeEventListener("keydown",C)};T.current&&T.current.focus()},[S,C]),S?a("div",{className:$(["company-management-company-users-management-modal-overlay",c]),onClick:U,...p,children:A("div",{ref:v,className:"company-management-company-users-management-modal",role:"dialog","aria-modal":"true","aria-labelledby":N,"aria-describedby":w,tabIndex:-1,children:[A("div",{className:"company-management-company-users-management-modal__header",children:[a("h2",{id:N,className:"company-management-company-users-management-modal__title",children:e.title}),a("button",{className:"company-management-company-users-management-modal__close",onClick:L,"aria-label":e.ariaCloseModal,children:"Ã—"})]}),A("div",{id:w,className:"company-management-company-users-management-modal__content",children:[a("p",{className:"company-management-company-users-management-modal__text",children:y==="ACTIVE"?e.setInactiveText:e.setActiveText}),a("p",{className:"company-management-company-users-management-modal__text",children:e.deleteText})]}),(f==null?void 0:f.text)&&a("div",{className:"company-management-company-users-management-modal__alert",role:"alert","aria-live":"assertive",children:a(K,{type:"error",heading:f.text,icon:f.icon,"data-testid":"companyUsersManagementModalAlert"})}),A("div",{className:"company-management-company-users-management-modal__actions",children:[a(P,{variant:"primary",onClick:n,disabled:t,className:"company-management-company-users-management-modal__button-primary",children:t?y==="ACTIVE"?e.settingInactiveButton:e.settingActiveButton:y==="ACTIVE"?e.setInactiveButton:e.setActiveButton}),a(P,{variant:"tertiary",onClick:u,disabled:b,className:"company-management-company-users-management-modal__button-delete",children:b?e.deletingButton:e.deleteButton}),a(P,{variant:"secondary",onClick:B,className:"company-management-company-users-management-modal__button-cancel",children:e.cancelButton})]})]})}):null},me=({className:c,children:i,columns:y=[],rowData:l=[],mobileLayout:S="none",caption:p,expandedRows:b=new Set,loading:I=!1,skeletonRowCount:t=10,onSortChange:g,...f})=>{const m=O({sortedAscending:"Dropin.Table.sortedAscending",sortedDescending:"Dropin.Table.sortedDescending",sortBy:"Dropin.Table.sortBy"}),d=e=>{if(!g)return;let n;e.sortBy===!0?n="asc":e.sortBy==="asc"?n="desc":n=!0,g(e.key,n)},v=e=>{if(e.sortBy===void 0)return null;let n,u;return e.sortBy==="asc"?(n="ChevronUp",u=m.sortedAscending.replace("{label}",e.label)):e.sortBy==="desc"?(n="ChevronDown",u=m.sortedDescending.replace("{label}",e.label)):(n="Sort",u=m.sortBy.replace("{label}",e.label)),a(P,{variant:"tertiary",size:"medium",className:"dropin-table__header__sort-button",icon:a(Z,{source:n}),"aria-label":u,onClick:()=>d(e)})},T=()=>Array.from({length:t},(e,n)=>a("tr",{className:"dropin-table__body__row",children:y.map(u=>a("td",{className:"dropin-table__body__cell","data-label":u.label,children:a(W,{children:a(H,{variant:"row",size:"small",fullWidth:!0})})},u.key))},`skeleton-${n}`)),N=()=>l.map((e,n)=>{const u=e._rowDetails!==void 0,B=b.has(n);return A(Q,{children:[a("tr",{className:"dropin-table__body__row",children:y.map(C=>{const U=e[C.key];return typeof U=="string"||typeof U=="number"?a("td",{className:"dropin-table__body__cell","data-label":C.label,children:U},C.key):a("td",{className:"dropin-table__body__cell","data-label":C.label,children:a(q,{node:U})},C.key)})}),u&&B&&a("tr",{className:"dropin-table__row-details dropin-table__row-details--expanded",id:`row-${n}-details`,children:a("td",{className:"dropin-table__row-details__cell",colSpan:y.length,role:"region","aria-labelledby":`row-${n}-details`,children:typeof e._rowDetails=="string"?e._rowDetails:a(q,{node:e._rowDetails})})},`${n}-details`)]},n)}),w=e=>{if(e.sortBy===!0)return"none";if(e.sortBy==="asc")return"ascending";if(e.sortBy==="desc")return"descending"};return a("div",{className:$(["dropin-table",`dropin-table--mobile-layout-${S}`,c]),children:A("table",{...f,className:"dropin-table__table",children:[p&&a("caption",{className:"dropin-table__caption",children:p}),a("thead",{className:"dropin-table__header",children:a("tr",{className:"dropin-table__header__row",children:y.map(e=>A("th",{className:$(["dropin-table__header__cell",["dropin-table__header__cell--sorted",e.sortBy==="asc"||e.sortBy==="desc"],["dropin-table__header__cell--sortable",e.sortBy!==void 0]]),"aria-sort":w(e),children:[e.label,v(e)]},e.key))})}),a("tbody",{className:"dropin-table__body",children:I?T():N()})]})})},de=[{text:"20",value:"20"},{text:"30",value:"30"},{text:"50",value:"50"},{text:"100",value:"100"},{text:"200",value:"200"}],Se=({children:c,className:i,...y})=>{var o;const[l,S]=E(!1),[p,b]=E(""),I=F(null),t=O({showAllUsers:"Company.CompanyUsers.filters.showAll",showActiveUsers:"Company.CompanyUsers.filters.showActive",showInactiveUsers:"Company.CompanyUsers.filters.showInactive",idColumn:"Company.CompanyUsers.columns.id",nameColumn:"Company.CompanyUsers.columns.name",emailColumn:"Company.CompanyUsers.columns.email",roleColumn:"Company.CompanyUsers.columns.role",teamColumn:"Company.CompanyUsers.columns.team",statusColumn:"Company.CompanyUsers.columns.status",actionsColumn:"Company.CompanyUsers.columns.actions",statusActive:"Company.CompanyUsers.status.active",statusInactive:"Company.CompanyUsers.status.inactive",emptyTeam:"Company.CompanyUsers.emptyTeam",emptyActions:"Company.CompanyUsers.emptyActions",itemsText:"Company.CompanyUsers.pagination.itemsCount",itemsPerPageLabel:"Company.CompanyUsers.pagination.itemsPerPage",showLabel:"Company.CompanyUsers.pagination.show",perPageLabel:"Company.CompanyUsers.pagination.perPage",previousPage:"Company.CompanyUsers.pagination.previous",nextPage:"Company.CompanyUsers.pagination.next",pageInfo:"Company.CompanyUsers.pagination.pageInfo",ariaLoadingUsers:"Company.CompanyUsers.ariaLabels.loadingUsers",ariaUsersTable:"Company.CompanyUsers.ariaLabels.usersTable",ariaFilterOptions:"Company.CompanyUsers.ariaLabels.filterOptions",ariaPaginationNav:"Company.CompanyUsers.ariaLabels.paginationNav",ariaPageSizeSelector:"Company.CompanyUsers.ariaLabels.pageSizeSelector",ariaPreviousPageFull:"Company.CompanyUsers.ariaLabels.previousPageFull",ariaNextPageFull:"Company.CompanyUsers.ariaLabels.nextPageFull",ariaCurrentPage:"Company.CompanyUsers.ariaLabels.currentPage",ariaShowingUsers:"Company.CompanyUsers.ariaLabels.showingUsers",ariaDataLoaded:"Company.CompanyUsers.ariaLabels.dataLoaded",ariaDataError:"Company.CompanyUsers.ariaLabels.dataError",ariaPageNavigation:"Company.CompanyUsers.ariaLabels.pageNavigation",manageUser:"Company.CompanyUsers.actions.manage",ariaManageUser:"Company.CompanyUsers.ariaLabels.manageUser"}),{users:g,loading:f,currentPage:m,pageSize:d,filterType:v,totalItems:T,totalPages:N,announcement:w,canEditUsers:e,handleFilterChange:n,handlePageSizeChange:u,handlePreviousPage:B,handleNextPage:C,refreshUsers:U}=le({translations:{ariaDataLoaded:t.ariaDataLoaded,ariaDataError:t.ariaDataError}}),L=F(t);L.current=t,G(()=>{!f&&I.current&&g.length>0&&I.current.setAttribute("aria-busy","false")},[f,m,v,g.length]);const s=h(()=>{U()},[U]);ne(s);const _=h(r=>{b(r),S(!0)},[]),k=h(()=>{S(!1),b(""),U()},[U]),x=R(()=>{const r=L.current;return[{key:"id",label:r.idColumn},{key:"name",label:r.nameColumn},{key:"email",label:r.emailColumn},{key:"role",label:r.roleColumn},{key:"team",label:r.teamColumn},{key:"status",label:r.statusColumn},{key:"actions",label:r.actionsColumn}]},[]),M=R(()=>g.map(r=>{var j;const D=oe(r.firstName,r.lastName),z=L.current;return{id:r.id,name:D,email:r.email,role:r.role,team:r.team||z.emptyTeam,status:se(r.status,z),actions:e?a(P,{variant:"tertiary",onClick:()=>_(r.id),"aria-label":((j=z.ariaManageUser)==null?void 0:j.replace("{name}",D))||`Manage user ${D}`,className:"manage-user-button",children:z.manageUser||"Manage"}):a("span",{className:"no-actions",children:z.emptyActions})}}),[g,_,e]);return A("section",{className:i,...y,children:[a("div",{className:"sr-only",role:"status","aria-live":"polite","aria-atomic":"true",children:w}),A("div",{className:"filterButtons",role:"group","aria-label":t.ariaFilterOptions,children:[v!=="all"&&a(P,{variant:"tertiary",onClick:()=>n("all"),"aria-label":t.showAllUsers,children:t.showAllUsers}),v!=="active"&&a(P,{variant:"tertiary",onClick:()=>n("active"),"aria-label":t.showActiveUsers,children:t.showActiveUsers}),v!=="inactive"&&a(P,{variant:"tertiary",onClick:()=>n("inactive"),"aria-label":t.showInactiveUsers,children:t.showInactiveUsers})]}),a("div",{ref:I,"aria-busy":f,children:f?A("div",{className:"loadingContainer",role:"status","aria-live":"polite",children:[a(Y,{testId:"companyUsersTableLoader"}),a("span",{className:"sr-only",children:t.ariaLoadingUsers})]}):a(me,{columns:x,rowData:M,mobileLayout:"stacked","aria-label":t.ariaUsersTable,summary:t.ariaShowingUsers.replace("{count}",g.length.toString())})}),A("nav",{"aria-label":t.ariaPaginationNav,className:"paginationContainer",children:[a("div",{"aria-live":"polite","aria-atomic":"true",children:t.itemsText.replace("{count}",T.toString())}),N>1&&A("div",{className:"paginationButtons",role:"group","aria-label":t.ariaPageNavigation,children:[a(P,{variant:"secondary",onClick:B,disabled:m===1,"aria-label":t.ariaPreviousPageFull.replace("{current}",m.toString()),children:t.previousPage}),a("span",{"aria-current":"page","aria-live":"polite",children:t.pageInfo.replace("{current}",m.toString()).replace("{total}",N.toString())}),a(P,{variant:"secondary",onClick:C,disabled:m===N,"aria-label":t.ariaNextPageFull.replace("{current}",m.toString()),children:t.nextPage})]}),A("div",{className:"pageSizeSelector",children:[a("label",{htmlFor:"page-size-select",id:"page-size-label",children:a("span",{children:t.showLabel})}),a(J,{id:"page-size-select",name:"pageSize",value:d.toString(),options:de,onChange:u,"aria-labelledby":"page-size-label","aria-describedby":"page-size-description"}),a("span",{id:"page-size-description",children:t.perPageLabel})]})]}),c,p&&e&&a(ce,{isOpen:l,userId:p,userStatus:((o=g.find(r=>r.id===p))==null?void 0:o.status)||"ACTIVE",onClose:k})]})};export{Se as CompanyUsers,Se as default};
//# sourceMappingURL=CompanyUsers.js.map
