/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as e,jsxs as h,Fragment as O}from"@dropins/tools/preact-jsx-runtime.js";import{useState as g,useRef as _,useMemo as k,useCallback as z,useEffect as F}from"@dropins/tools/preact-hooks.js";/* empty css                                   */import{Card as I,InLineAlert as T,Price as D,Table as Z,Button as w,Picker as U}from"@dropins/tools/components.js";import{events as G}from"@dropins/tools/event-bus.js";import{a as $,b as q}from"../chunks/CompanyLoaders.js";import{g as J,a as K}from"../chunks/getCompanyCreditHistory.js";import{useText as j}from"@dropins/tools/i18n.js";import{classes as Q}from"@dropins/tools/lib.js";import"../chunks/network-error.js";import"@dropins/tools/fetch-graphql.js";const V=20,A=1,W=({initialParams:c={},translations:m})=>{const[i,a]=g([]),[o,d]=g(!1),[t,y]=g(c.currentPage||A),[f,v]=g(c.pageSize||V),[H,p]=g(0),[u,P]=g(1),[N,L]=g(""),b=_(m);b.current=m;const n=_(c),s=k(()=>({...n.current,currentPage:t,pageSize:f}),[t,f]),C=z(async()=>{var r;d(!0);try{const l=await J(s);l?(a(l.items),p(l.totalCount||l.items.length),P(((r=l.pageInfo)==null?void 0:r.totalPages)||1),L(b.current.ariaDataLoaded.replace("{count}",l.items.length.toString()))):(a([]),p(0),P(1),L(b.current.ariaDataError))}catch(l){console.error("Failed to load company credit history:",l),a([]),p(0),P(1),L(b.current.ariaDataError)}finally{d(!1)}},[s]);F(()=>{C()},[C]);const B=z(r=>{let l;if(typeof r=="string")l=r;else if("target"in r&&r.target&&"value"in r.target)l=r.target.value;else return;const R=parseInt(l,10);isNaN(R)||(v(R),y(A))},[]),S=z(()=>{t>1&&y(t-1)},[t]),x=z(()=>{t<u&&y(t+1)},[t,u]),E=z(r=>{r>=1&&r<=u&&r!==t&&y(r)},[t,u]),M=z(async()=>{await C()},[C]);return{items:i,currentPage:t,pageSize:f,totalItems:H,totalPages:u,loading:o,announcement:N,handlePageSizeChange:B,handlePreviousPage:S,handleNextPage:x,handlePageChange:E,refreshCreditHistory:M}},X=({className:c,...m})=>{var u,P,N,L,b,n,s,C,B;const i=j({creditAvailable:"Company.CompanyCredit.creditAvailable",creditLimit:"Company.CompanyCredit.creditLimit",outstandingBalance:"Company.CompanyCredit.outstandingBalance",noData:"Company.shared.messages.noData",loading:"Company.shared.messages.loading",loadError:"Company.CompanyCredit.messages.loadError"}),[a,o]=g(null),[d,t]=g(!1),[y,f]=g(null),v=_(!1),H=_(!1),p=z(async()=>{if(!v.current){v.current=!0,t(!0),f(null);try{const S=await K();o(S)}catch(S){console.error("Failed to load company credit:",S),f(i.loadError),o(null)}finally{t(!1),v.current=!1}}},[i.loadError]);return F(()=>{H.current||(H.current=!0,p())},[p]),F(()=>{const S=()=>{o(null),H.current=!1,p()},x=G.on("companyContext/changed",S,{eager:!0});return()=>{var E;(E=x==null?void 0:x.off)==null||E.call(x)}},[p]),d?e("div",{...m,className:c,children:e(I,{variant:"primary",className:"company-management-company-credit-loading",children:e($,{testId:"companyCreditLoader"})})}):y?e("div",{...m,className:c,children:e(T,{heading:y,type:"error",icon:void 0,variant:"primary",className:"company-management-company-credit-error",children:e("p",{children:y})})}):e("div",{...m,className:c,children:a===null||!a.credit?e(T,{heading:i.noData,type:"error",icon:void 0,variant:"primary",className:"company-management-company-credit-error",children:e("p",{children:i.noData})}):h("div",{className:"company-management-company-credit-grid",children:[e(I,{variant:"secondary",className:"company-management-company-credit-outstanding-balance",children:h("p",{children:[i.outstandingBalance,e("br",{}),e(D,{size:"large",amount:((u=a.credit.outstanding_balance)==null?void 0:u.value)??0,currency:((P=a.credit.outstanding_balance)==null?void 0:P.currency)??"",className:(((N=a.credit.outstanding_balance)==null?void 0:N.value)??0)<0?".company-management-company-credit-grid .company-management-company-credit-negative":void 0})]})}),e(I,{variant:"secondary",className:"company-management-company-credit-available-credit",children:h("p",{children:[i.creditAvailable,e("br",{}),e(D,{size:"large",amount:((L=a.credit.available_credit)==null?void 0:L.value)??0,currency:((b=a.credit.available_credit)==null?void 0:b.currency)??"",className:(((n=a.credit.available_credit)==null?void 0:n.value)??0)<0?".company-management-company-credit-grid .company-management-company-credit-negative":void 0})]})}),e(I,{variant:"secondary",className:"company-management-company-credit-credit-limit",children:h("p",{children:[i.creditLimit,e("br",{}),e(D,{size:"large",amount:((s=a.credit.credit_limit)==null?void 0:s.value)??0,currency:((C=a.credit.credit_limit)==null?void 0:C.currency)??"",className:(((B=a.credit.credit_limit)==null?void 0:B.value)??0)<0?".company-management-company-credit-grid .company-management-company-credit-negative":void 0})]})})]})})},Y=[{text:"20",value:"20"},{text:"30",value:"30"},{text:"50",value:"50"},{text:"100",value:"100"},{text:"200",value:"200"}],aa=({className:c,initialParams:m={},...i})=>{const a=j({loading:"Company.shared.messages.loading",noData:"Company.shared.messages.noData",error:"Company.shared.messages.error",dateColumn:"Company.CompanyCreditHistory.columns.date",operationColumn:"Company.CompanyCreditHistory.columns.operation",amountColumn:"Company.CompanyCreditHistory.columns.amount",outstandingBalanceColumn:"Company.CompanyCreditHistory.columns.outstandingBalance",availableCreditColumn:"Company.CompanyCreditHistory.columns.availableCredit",creditLimitColumn:"Company.CompanyCreditHistory.columns.creditLimit",customReferenceColumn:"Company.CompanyCreditHistory.columns.customReference",updatedByColumn:"Company.CompanyCreditHistory.columns.updatedBy",itemsText:"Company.CompanyCreditHistory.pagination.itemsCount",itemsPerPageLabel:"Company.CompanyCreditHistory.pagination.itemsPerPage",showLabel:"Company.CompanyCreditHistory.pagination.show",perPageLabel:"Company.CompanyCreditHistory.pagination.perPage",previousPage:"Company.CompanyCreditHistory.pagination.previous",nextPage:"Company.CompanyCreditHistory.pagination.next",pageInfo:"Company.CompanyCreditHistory.pagination.pageInfo",ariaDataLoaded:"Company.CompanyCreditHistory.ariaLabels.dataLoaded",ariaDataError:"Company.CompanyCreditHistory.ariaLabels.dataError",ariaLoadingHistory:"Company.CompanyCreditHistory.ariaLabels.loadingHistory",ariaHistoryTable:"Company.CompanyCreditHistory.ariaLabels.historyTable",ariaPaginationNav:"Company.CompanyCreditHistory.ariaLabels.paginationNav",ariaPageSizeSelector:"Company.CompanyCreditHistory.ariaLabels.pageSizeSelector",ariaPreviousPageFull:"Company.CompanyCreditHistory.ariaLabels.previousPageFull",ariaNextPageFull:"Company.CompanyCreditHistory.ariaLabels.nextPageFull",ariaShowingHistory:"Company.CompanyCreditHistory.ariaLabels.showingHistory",ariaPageNavigation:"Company.CompanyCreditHistory.ariaLabels.pageNavigation"}),{items:o,loading:d,currentPage:t,pageSize:y,totalItems:f,totalPages:v,announcement:H,handlePageSizeChange:p,handlePreviousPage:u,handleNextPage:P,refreshCreditHistory:N}=W({initialParams:m,translations:{ariaDataLoaded:a.ariaDataLoaded,ariaDataError:a.ariaDataError}});F(()=>{const n=()=>{N()},s=G.on("companyContext/changed",n,{eager:!0});return()=>{var C;(C=s==null?void 0:s.off)==null||C.call(s)}},[N]);const L=k(()=>[{key:"date",label:a.dateColumn},{key:"operation",label:a.operationColumn},{key:"amount",label:a.amountColumn},{key:"outstandingBalance",label:a.outstandingBalanceColumn},{key:"availableCredit",label:a.availableCreditColumn},{key:"creditLimit",label:a.creditLimitColumn},{key:"customReference",label:a.customReferenceColumn},{key:"updatedBy",label:a.updatedByColumn}],[a.dateColumn,a.operationColumn,a.amountColumn,a.outstandingBalanceColumn,a.availableCreditColumn,a.creditLimitColumn,a.customReferenceColumn,a.updatedByColumn]),b=k(()=>o.map(n=>({date:new Date(n.date).toLocaleDateString(),operation:n.type.replace("_"," "),amount:n.amount.value===0?"":h("span",{className:`company-management-amount ${n.amount.value>=0?"company-management-amount--positive":"company-management-amount--negative"}`,children:[n.amount.value>=0?"+":"",e(D,{amount:Math.abs(n.amount.value),currency:n.amount.currency,size:"small"})]}),outstandingBalance:e(D,{amount:n.balance.outstandingBalance.value,currency:n.balance.outstandingBalance.currency,size:"small"}),availableCredit:e(D,{amount:n.balance.availableCredit.value,currency:n.balance.availableCredit.currency,size:"small"}),creditLimit:e(D,{amount:n.balance.creditLimit.value,currency:n.balance.creditLimit.currency,size:"small"}),customReference:n.customReferenceNumber||"-",updatedBy:n.updatedBy.name})),[o]);return h("section",{...i,className:Q(["company-management-company-credit-history-display",c]),children:[e("div",{className:"sr-only",role:"status","aria-live":"polite","aria-atomic":"true",children:H}),e("div",{"aria-busy":d,children:d?e("div",{className:"loadingContainer",role:"status","aria-live":"polite",children:e(q,{testId:"companyCreditHistoryLoader"})}):e(O,{children:o.length?e(Z,{className:"company-management-company-credit-history-table",columns:L,rowData:b,mobileLayout:"stacked","aria-label":a.ariaHistoryTable,summary:a.ariaShowingHistory.replace("{count}",o.length.toString())}):e("div",{className:"company-management-company-credit-history-empty",children:e("p",{children:a.noData})})})}),!d&&o.length>0&&h("nav",{"aria-label":a.ariaPaginationNav,className:"paginationContainer",children:[e("div",{"aria-live":"polite","aria-atomic":"true",children:a.itemsText.replace("{count}",f.toString())}),v>1&&h("div",{className:"paginationButtons",role:"group","aria-label":a.ariaPageNavigation,children:[e(w,{variant:"secondary",onClick:u,disabled:t===1||d,"aria-label":a.ariaPreviousPageFull.replace("{current}",t.toString()),children:a.previousPage}),e("span",{"aria-current":"page","aria-live":"polite",children:a.pageInfo.replace("{current}",t.toString()).replace("{total}",v.toString())}),e(w,{variant:"secondary",onClick:P,disabled:t===v||d,"aria-label":a.ariaNextPageFull.replace("{current}",t.toString()),children:a.nextPage})]}),h("div",{className:"pageSizeSelector",children:[e("label",{htmlFor:"page-size-select",id:"page-size-label",children:e("span",{children:a.showLabel})}),e(U,{id:"page-size-select",name:"pageSize",value:y.toString(),options:Y,handleSelect:p,"aria-labelledby":"page-size-label","aria-describedby":"page-size-description"}),e("span",{id:"page-size-description",children:a.perPageLabel})]})]})]})},ya=({creditHistoryParams:c={},showCreditHistory:m=!0,className:i,children:a,...o})=>h("section",{...o,className:i,children:[e(X,{}),m&&e(aa,{initialParams:c,style:{marginTop:"24px"}}),a]});export{ya as CompanyCredit,ya as default};
//# sourceMappingURL=CompanyCredit.js.map
