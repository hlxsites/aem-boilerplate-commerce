/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsxs as d,jsx as i}from"@dropins/tools/preact-jsx-runtime.js";import{useState as S,useRef as b,useEffect as _}from"@dropins/tools/preact-hooks.js";/* empty css                                   */import{ProgressSpinner as A,InLineAlert as L,Button as g}from"@dropins/tools/components.js";import"@dropins/tools/event-bus.js";import{classes as v}from"@dropins/tools/lib.js";import{g as x,c as N}from"../chunks/getCustomerCompany.js";import{a as T}from"../chunks/acceptCompanyInvitation.js";import{useText as C}from"@dropins/tools/i18n.js";/* empty css            */import"../chunks/network-error.js";import"@dropins/tools/fetch-graphql.js";import"../chunks/fetch-error.js";async function D(a,e){const s="DROPIN__COMPANYSWITCHER__COMPANY__CONTEXT",r="DROPIN__COMPANYSWITCHER__GROUP__CONTEXT";if(!sessionStorage.getItem(s))try{const t=await x();if(!(t!=null&&t.customerId)||t.customerId!==e)return;sessionStorage.setItem(s,a),sessionStorage.removeItem(r)}catch(t){console.error("Failed to switch company context:",t)}}const M=(a=!1)=>{const e=new URLSearchParams(window.location.search),s=e.get("code"),r=e.get("customer[customer_id]"),n=e.get("customer[company_id]"),t=!s||!r||!n,o=C({companyDisabledError:"Company.AcceptInvitation.companyDisabledError",invalidLinkError:"Company.AcceptInvitation.invalidLinkError",expiredLinkError:"Company.AcceptInvitation.expiredLinkError",genericError:"Company.AcceptInvitation.genericError"}),[y,c]=S({isLoading:!1,isSuccess:!1,isError:t,errorMessage:"",isCompanyDisabled:!1}),p=b(!1);return _(()=>{if(p.current)return;(async()=>{if(t){p.current=!0,c({isLoading:!1,isSuccess:!1,isError:!0,errorMessage:o.invalidLinkError,isCompanyDisabled:!1});return}if(p.current=!0,c({isLoading:!0,isSuccess:!1,isError:!1,errorMessage:"",isCompanyDisabled:!1}),!await N()){c({isLoading:!1,isSuccess:!1,isError:!0,errorMessage:o.companyDisabledError,isCompanyDisabled:!0});return}const E=e.get("customer[job_title]"),h=e.get("customer[telephone]"),f=e.get("customer[status]"),w={code:s,user:{customerId:r,companyId:n,jobTitle:E||null,telephone:h||null,status:f?f==="1"?"ACTIVE":"INACTIVE":null},roleId:null};try{const m=await T(w);if(m&&m.success){const u=new URL(window.location.href);u.search="",window.history.replaceState({},"",u.toString()),a&&await D(n,r),c({isLoading:!1,isSuccess:!0,isError:!1,errorMessage:"",isCompanyDisabled:!1})}else c({isLoading:!1,isSuccess:!1,isError:!0,errorMessage:o.expiredLinkError,isCompanyDisabled:!1})}catch(m){const u=m instanceof Error?m.message:o.genericError;c({isLoading:!1,isSuccess:!1,isError:!0,errorMessage:u,isCompanyDisabled:!1})}})()},[o]),y},P=({routeMyAccount:a,routeLogin:e,isAuthenticated:s=!1,labels:r,className:n=""})=>{const{isLoading:t,isSuccess:o,isError:y,errorMessage:c,isCompanyDisabled:p}=M(s),l={...C({title:"Company.AcceptInvitation.title",loadingText:"Company.AcceptInvitation.loadingText",successMessage:"Company.AcceptInvitation.successMessage",myAccountButton:"Company.AcceptInvitation.myAccountButton",loginButton:"Company.AcceptInvitation.loginButton"}),...r};return t?d("div",{className:v(["company-accept-invitation-wrapper",n]),children:[i("h2",{children:l.title}),d("div",{className:"company-accept-invitation-loading",children:[i(A,{}),i("p",{children:l.loadingText})]})]}):o||y?d("div",{className:v(["company-accept-invitation-wrapper",n]),children:[i("h2",{children:l.title}),i(L,{type:o?"success":"error",variant:"secondary",heading:o?l.successMessage||"":c}),d("div",{className:"company-accept-invitation-wrapper__buttons",children:[!p&&!s&&e&&i(g,{variant:"primary",onClick:()=>{window.location.href=e()},className:"company-accept-invitation-wrapper__submit",children:l.loginButton}),s&&a&&i(g,{variant:"primary",onClick:()=>{window.location.href=a()},className:"company-accept-invitation-wrapper__submit",children:l.myAccountButton})]})]}):null},G=({routeMyAccount:a,routeLogin:e,isAuthenticated:s,labels:r,className:n=""})=>i("div",{className:`company-accept-invitation-container ${n}`,children:i(P,{routeMyAccount:a,routeLogin:e,isAuthenticated:s,labels:r})});export{G as AcceptInvitation};
//# sourceMappingURL=AcceptInvitation.js.map
