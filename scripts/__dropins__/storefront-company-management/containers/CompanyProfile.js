/*! Copyright 2025 Adobe
All Rights Reserved. */
<<<<<<< HEAD
import{jsx as t,jsxs as h,Fragment as K}from"@dropins/tools/preact-jsx-runtime.js";import{classes as me,Slot as ge}from"@dropins/tools/lib.js";import{Card as Q,Button as X,Field as R,Input as V,Picker as ce,Header as ue,InLineAlert as he,ProgressSpinner as fe}from"@dropins/tools/components.js";import{useState as L,useRef as J,useEffect as H,useCallback as U,useMemo as G}from"@dropins/tools/preact-hooks.js";import{events as ye}from"@dropins/tools/event-bus.js";import{p as ve,E as Ce}from"../chunks/acdl.js";import{u as Ae}from"../chunks/useCompanyContextListener.js";import{g as Ne,u as Ie}from"../chunks/updateCompany.js";import{g as pe,v as _e}from"../chunks/validateCompanyEmail.js";import{useText as j}from"@dropins/tools/i18n.js";import{u as Ee,d as be}from"../chunks/useInLineAlert.js";import"../chunks/fetchUserPermissions.js";import"../chunks/company-permissions.js";import"../chunks/network-error.js";import"@dropins/tools/fetch-graphql.js";import"@dropins/tools/preact-compat.js";const xe=({company:a,slots:e,showEditForm:u,handleShowEditForm:y})=>{const o=j({editButton:"Company.shared.buttons.edit",noDataMessage:"Company.CompanyProfile.companyProfileCard.noDataMessage",companyName:"Company.shared.fields.companyName",email:"Company.shared.fields.email",legalName:"Company.shared.fields.legalName",vatTaxId:"Company.shared.fields.vatTaxId",resellerId:"Company.shared.fields.resellerId",legalAddress:"Company.shared.fields.legalAddress",contacts:"Company.CompanyProfile.companyProfileCard.contacts",companyAdministrator:"Company.CompanyProfile.companyProfileCard.companyAdministrator",salesRepresentative:"Company.CompanyProfile.companyProfileCard.salesRepresentative",paymentInformation:"Company.CompanyProfile.companyProfileCard.paymentInformation",shippingInformation:"Company.CompanyProfile.companyProfileCard.shippingInformation",availablePaymentMethods:"Company.CompanyProfile.companyProfileCard.availablePaymentMethods",availableShippingMethods:"Company.CompanyProfile.companyProfileCard.availableShippingMethods",noPaymentMethods:"Company.CompanyProfile.companyProfileCard.noPaymentMethods",noShippingMethods:"Company.CompanyProfile.companyProfileCard.noShippingMethods"});if(!a)return t(Q,{variant:"secondary",className:"account-company-profile-card",children:t("div",{className:"account-company-profile-card__wrapper",children:t("div",{className:"account-company-profile-card__content",children:t("div",{className:"account-company-profile-card__no-data",children:t("p",{children:o.noDataMessage})})})})});const i=a.permissionsFlags||{canViewAccount:!0,canViewAddress:!0,canViewContacts:!0,canViewPaymentInformation:!0,canViewShippingInformation:!0},r=[i.canViewAccount?{name:"name",label:o.companyName,value:a.name||"",legalName:a.legalName||""}:null,i.canViewAccount?{name:"email",label:o.email,value:a.email||""}:null,i.canViewAccount?{name:"vatTaxId",label:o.vatTaxId,value:a.vatTaxId||""}:null,i.canViewAccount?{name:"resellerId",label:o.resellerId,value:a.resellerId||""}:null].filter(Boolean);return t(Q,{variant:"secondary",className:me(["account-company-profile-card",["account-company-profile-card-short",u]]),children:h("div",{className:"account-company-profile-card__wrapper",children:[t("div",{className:"account-company-profile-card__actions",children:(a.canEditAccount||a.canEditAddress)&&t(X,{type:"button",variant:"tertiary",onClick:y,children:o.editButton})}),t("div",{className:"account-company-profile-card__content",children:(()=>{var v,p;const N=h(K,{children:[r.map((l,d)=>{if(!l.value)return null;let g;return l.name==="name"&&l.legalName?g=`${l.label}: ${l.value} (${l.legalName})`:g=l.label?`${l.label}: ${l.value}`:l.value,t("p",{"data-testid":`${l.name}_${d}`,children:g},`${l.name}_${d}`)}),i.canViewAddress&&a.legalAddress&&h("div",{className:"company-legal-address",children:[t("p",{children:h("strong",{children:[o.legalAddress,":"]})}),(v=a.legalAddress.street)==null?void 0:v.map((l,d)=>t("p",{children:l},d)),h("p",{children:[a.legalAddress.city,", ",(p=a.legalAddress.region)==null?void 0:p.region," ",a.legalAddress.postcode]}),t("p",{children:a.legalAddress.countryCode}),a.legalAddress.telephone&&h("p",{children:["Phone: ",a.legalAddress.telephone]})]}),i.canViewContacts&&(a.companyAdmin||a.salesRepresentative)&&h("div",{className:"company-contacts",children:[t("p",{children:h("strong",{children:[o.contacts,":"]})}),a.companyAdmin&&h("div",{className:"company-contact",children:[t("p",{children:h("strong",{children:[o.companyAdministrator,":"]})}),h("p",{children:[a.companyAdmin.firstname," ",a.companyAdmin.lastname]}),a.companyAdmin.jobTitle&&t("p",{children:a.companyAdmin.jobTitle}),t("p",{children:a.companyAdmin.email})]}),a.salesRepresentative&&h("div",{className:"company-contact",children:[t("p",{children:h("strong",{children:[o.salesRepresentative,":"]})}),h("p",{children:[a.salesRepresentative.firstname," ",a.salesRepresentative.lastname]}),t("p",{children:a.salesRepresentative.email})]})]}),i.canViewPaymentInformation&&h("div",{className:"company-payment-methods",children:[t("p",{children:h("strong",{children:[o.paymentInformation,":"]})}),a.availablePaymentMethods&&a.availablePaymentMethods.length>0?h(K,{children:[t("p",{children:h("strong",{children:[o.availablePaymentMethods,":"]})}),t("ul",{className:"payment-methods-list",children:a.availablePaymentMethods.map((l,d)=>t("li",{children:l.title},`payment_${d}`))})]}):t("div",{className:"message message-notice notice",children:t("div",{children:o.noPaymentMethods})})]}),i.canViewShippingInformation&&h("div",{className:"company-shipping-methods",children:[t("p",{children:h("strong",{children:[o.shippingInformation,":"]})}),a.availableShippingMethods&&a.availableShippingMethods.length>0?h(K,{children:[t("p",{children:h("strong",{children:[o.availableShippingMethods,":"]})}),t("ul",{className:"shipping-methods-list",children:a.availableShippingMethods.map((l,d)=>t("li",{children:l.title},`shipping_${d}`))})]}):t("div",{className:"message message-notice notice",children:t("div",{children:o.noShippingMethods})})]})]});return e!=null&&e.CompanyData?t(ge,{name:"CompanyData",slot:e.CompanyData,context:{companyData:r,Default:N}}):N})()})]})})},Te=({handleSetInLineAlert:a,editFormRef:e})=>{const u=j({companySuccess:"Company.CompanyProfile.editCompanyProfile.companySuccess",companyError:"Company.CompanyProfile.editCompanyProfile.companyError",loadError:"Company.CompanyProfile.messages.loadError",updateError:"Company.CompanyProfile.messages.updateError",noDataToUpdate:"Company.CompanyProfile.messages.noDataToUpdate"}),{companySuccess:y,companyError:o,loadError:i,updateError:r,noDataToUpdate:N}=u,[v,p]=L(null),[l,d]=L(!0),[g,C]=L(!1),[_,$]=L(!1),[m,k]=L([]),[D,A]=L({}),z=J(a),w=J(!1),P=J(!1);H(()=>{z.current=a},[a]);const O=U(f=>{A(f)},[]),F=U((f,B)=>{a&&(f==="success"?a({type:"success",text:B??y}):f==="error"?a({type:"error",text:B??o}):a(),C(!1))},[a,y,o]),S=U(async()=>{if(w.current)return null;w.current=!0,d(!0);try{const f=await Ne();return f&&p(f),d(!1),f}catch(f){return console.error("Failed to load company:",f),d(!1),z.current&&z.current({type:"error",text:i}),null}finally{w.current=!1}},[i]);H(()=>{P.current||(P.current=!0,S())},[S]),Ae(U(()=>{d(!0),$(!1),A({}),S()},[S])),H(()=>{pe().then(f=>{k(f.availableCountries)}).catch(f=>{console.error("Failed to load countries:",f)})},[]);const W=U(()=>{$(!0),F("success",""),A({})},[F]);H(()=>{_&&(e!=null&&e.current)&&setTimeout(()=>{var f;(f=e.current)==null||f.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})},100)},[_,e]);const q=U(f=>{f==null||f(),$(!1),A({})},[]),Y=U(async f=>{try{if(C(!0),!f){F("error",N);return}const B=await Ie(f);p(B),$(!1),A({}),F("success"),ve(Ce.EDIT_COMPANY_EVENT,{...f,companyId:v==null?void 0:v.id}),ye.emit("company/updated",{company:B})}catch(B){console.error("Failed to update company:",B),F("error",B.message||r)}finally{C(!1)}},[v,F,r,N]);return{company:v,countries:m,loading:l,submitLoading:g,showEditForm:_,inputChange:D,handleShowEditForm:W,handleHideEditForm:q,handleUpdateCompany:Y,handleInputChange:O,renderAlertMessage:F,saving:g}},$e=a=>{const[e,u]=L(null),[y,o]=L(!0);H(()=>{let p=!0;return pe().then(({availableCountries:l,countriesWithRequiredRegion:d,optionalZipCountries:g})=>{p&&(u({availableCountries:l,countriesWithRequiredRegion:d,optionalZipCountries:g}),o(!1))}).catch(()=>{p&&o(!1)}),()=>{p=!1}},[]);const i=G(()=>(e==null?void 0:e.availableCountries)||[],[e]),r=G(()=>{if(!a||!e)return[];const p=e.availableCountries.find(l=>l.value===a);return!(p!=null&&p.availableRegions)||p.availableRegions.length===0?[]:p.availableRegions.map(l=>({text:l.name,value:`${l.code},${l.id}`}))},[a,e]),N=G(()=>!a||!e?!1:e.countriesWithRequiredRegion.includes(a),[a,e]),v=G(()=>r.length>0,[r]);return{countryOptions:i,regionOptions:r,isRegionRequired:N,hasRegionOptions:v,loadingCountries:y}},we=({loading:a,value:e,errors:u,touched:y,onBlur:o,namePrefix:i="",fieldPathPrefix:r=""})=>{const N=j({companyName:"Company.shared.fields.companyName",email:"Company.shared.fields.email",legalName:"Company.shared.fields.legalName",vatTaxId:"Company.shared.fields.vatTaxId",resellerId:"Company.shared.fields.resellerId"}),v=i?`${i}_`:"",p=g=>r?`${r}.${g}`:g,l=g=>C=>{const _=C.target;o(p(g),_.value)},d={disabled:!!a,variant:"primary",size:"medium"};return h("div",{className:"account-edit-company-profile-form__group",children:[t(R,{label:N.companyName,required:!0,className:"account-edit-company-profile-form__field",error:y.name&&u.name?u.name:void 0,children:t(V,{name:`${v}name`,type:"text",value:e.name,onBlur:l("name"),...d,maxLength:40})}),t(R,{label:N.legalName,className:"account-edit-company-profile-form__field",children:t(V,{name:`${v}legalName`,type:"text",value:e.legalName,onBlur:l("legalName"),...d,maxLength:80})}),t(R,{label:N.email,required:!0,className:"account-edit-company-profile-form__field",error:y.email&&u.email?u.email:void 0,children:t(V,{name:`${v}email`,type:"email",value:e.email,onBlur:l("email"),...d})}),t(R,{label:N.vatTaxId,className:"account-edit-company-profile-form__field",children:t(V,{name:`${v}vatTaxId`,type:"text",value:e.vatTaxId,onBlur:l("vatTaxId"),...d,maxLength:40})}),t(R,{label:N.resellerId,className:"account-edit-company-profile-form__field",children:t(V,{name:`${v}resellerId`,type:"text",value:e.resellerId,onBlur:l("resellerId"),...d,maxLength:40})})]})},Pe=({loading:a,loadingCountries:e,value:u,errors:y,touched:o,onChange:i,onBlur:r,countryOptions:N,regionOptions:v,isRegionRequired:p,hasRegionOptions:l,namePrefix:d="legalAddress",fieldPathPrefix:g="legalAddress",requiredConfig:C})=>{var z;const _=j({legalAddress:"Company.shared.fields.legalAddress",streetAddress:"Company.shared.fields.streetAddress",city:"Company.shared.fields.city",country:"Company.shared.fields.country",stateProvince:"Company.shared.fields.stateProvince",zipPostalCode:"Company.shared.fields.zipPostalCode",phoneNumber:"Company.shared.fields.phoneNumber"}),$={street:`${d}_street`,street2:`${d}_street2`,city:`${d}_city`,countryCode:`${d}_countryCode`,region:`${d}_region`,postcode:`${d}_postcode`,telephone:`${d}_telephone`},m={street:`${g}.street`,street2:`${g}.street2`,city:`${g}.city`,countryCode:`${g}.countryCode`,region:`${g}.region`,regionCode:`${g}.regionCode`,postcode:`${g}.postcode`,telephone:`${g}.telephone`},k={street:(C==null?void 0:C.street)??!0,city:(C==null?void 0:C.city)??!0,postcode:(C==null?void 0:C.postcode)??!0,telephone:(C==null?void 0:C.telephone)??!0},D=w=>P=>{const O=P.target;r(w,O.value)},A={disabled:!!a,variant:"primary",size:"medium"};return h("div",{className:"account-edit-company-profile-form__section",children:[t("h3",{className:"account-edit-company-profile-form__section-title",children:_.legalAddress}),t(R,{label:_.streetAddress,required:k.street,className:"account-edit-company-profile-form__field",error:o[m.street]&&y[m.street]?y[m.street]:void 0,children:t(V,{name:$.street,type:"text",value:u.street,onBlur:D(m.street),...A})}),t(R,{label:`${_.streetAddress} 2`,className:"account-edit-company-profile-form__field",children:t(V,{name:$.street2,type:"text",value:u.street2,onBlur:D(m.street2),...A})}),t(R,{label:_.city,required:k.city,className:"account-edit-company-profile-form__field",error:o[m.city]&&y[m.city]?y[m.city]:void 0,children:t(V,{name:$.city,type:"text",value:u.city,onBlur:D(m.city),...A})}),t(R,{label:_.country,required:!0,className:"account-edit-company-profile-form__field",error:o[m.countryCode]&&y[m.countryCode]?y[m.countryCode]:void 0,children:t(ce,{name:$.countryCode,floatingLabel:`${_.country} *`,placeholder:_.country,options:N,value:u.countryCode,handleSelect:w=>{const P=w.target;i(m.countryCode)(P.value)},onBlur:()=>r(m.countryCode),disabled:!!a||e})}),t(R,{label:_.stateProvince,required:p,className:"account-edit-company-profile-form__field",error:o["legalAddress.region"]&&y["legalAddress.region"]?y["legalAddress.region"]:void 0,children:l?t(ce,{name:"legalAddress_region",floatingLabel:`${_.stateProvince} ${p?"*":""}`,placeholder:_.stateProvince,options:v,value:u.regionCode&&((z=v.find(w=>w.value.split(",")[0]===u.regionCode))==null?void 0:z.value)||"",handleSelect:w=>{var S;const P=w.target,[O]=P.value.split(","),F=((S=v.find(W=>W.value===P.value))==null?void 0:S.text)||"";i(m.region)(F),i(m.regionCode)(O)},onBlur:()=>r(m.region),disabled:!!a||e},`region_picker_${u.countryCode}`):t(V,{name:$.region,type:"text",value:u.region,onBlur:D(m.region),disabled:!!a||e,...A},`region_input_${u.countryCode}`)}),t(R,{label:_.zipPostalCode,required:k.postcode,className:"account-edit-company-profile-form__field",error:o[m.postcode]&&y[m.postcode]?y[m.postcode]:void 0,children:t(V,{name:$.postcode,type:"text",value:u.postcode,onBlur:D(m.postcode),...A})}),t(R,{label:_.phoneNumber,required:k.telephone,className:"account-edit-company-profile-form__field",error:o[m.telephone]&&y[m.telephone]?y[m.telephone]:void 0,children:t(V,{name:$.telephone,type:"tel",value:u.telephone,onBlur:D(m.telephone),...A})})]})},Fe=({inLineAlertProps:a,company:e,loading:u=!1,onSubmit:y,onCancel:o})=>{var S,W,q,Y,f,B,Z,ee,te,ae,re,se,le,ne;const i=j({title:"Company.EditCompanyProfile.title",cancel:"Company.shared.buttons.cancel",save:"Company.shared.buttons.save",saving:"Company.shared.buttons.saving",required:"Company.shared.validation.required",invalidEmail:"Company.shared.validation.invalidEmail",companyNameRequired:"Company.shared.validation.companyNameRequired",emailRequired:"Company.shared.validation.emailRequired",emailNotAvailable:"Company.shared.validation.emailNotAvailable",companyNameLengthError:"Company.shared.validation.companyNameLengthError",legalNameLengthError:"Company.shared.validation.legalNameLengthError",vatTaxIdLengthError:"Company.shared.validation.vatTaxIdLengthError",resellerIdLengthError:"Company.shared.validation.resellerIdLengthError"}),[r,N]=L({name:(e==null?void 0:e.name)||"",email:(e==null?void 0:e.email)||"",legalName:(e==null?void 0:e.legalName)||"",vatTaxId:(e==null?void 0:e.vatTaxId)||"",resellerId:(e==null?void 0:e.resellerId)||"",legalAddress:{street:((W=(S=e==null?void 0:e.legalAddress)==null?void 0:S.street)==null?void 0:W[0])||"",street2:((Y=(q=e==null?void 0:e.legalAddress)==null?void 0:q.street)==null?void 0:Y[1])||"",city:((f=e==null?void 0:e.legalAddress)==null?void 0:f.city)||"",region:((Z=(B=e==null?void 0:e.legalAddress)==null?void 0:B.region)==null?void 0:Z.region)||"",regionCode:((te=(ee=e==null?void 0:e.legalAddress)==null?void 0:ee.region)==null?void 0:te.regionCode)||"",countryCode:((ae=e==null?void 0:e.legalAddress)==null?void 0:ae.countryCode)||"",postcode:((re=e==null?void 0:e.legalAddress)==null?void 0:re.postcode)||"",telephone:((se=e==null?void 0:e.legalAddress)==null?void 0:se.telephone)||""}}),[v,p]=L({}),[l,d]=L({}),g=((le=e==null?void 0:e.permissionsFlags)==null?void 0:le.canEditAccount)===!0,C=((ne=e==null?void 0:e.permissionsFlags)==null?void 0:ne.canEditAddress)===!0,{countryOptions:_,regionOptions:$,isRegionRequired:m,hasRegionOptions:k,loadingCountries:D}=$e(r.legalAddress.countryCode),A=(s,n)=>s==="name"?n.trim()?n.length>40?i.companyNameLengthError:null:i.companyNameRequired:s==="email"?n.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n)?null:i.invalidEmail:i.emailRequired:s==="legalName"?n.length>80?i.legalNameLengthError:null:s==="vatTaxId"?n.length>40?i.vatTaxIdLengthError:null:s==="resellerId"?n.length>40?i.resellerIdLengthError:null:s==="legalAddress.street"||s==="legalAddress.city"||s==="legalAddress.postcode"||s==="legalAddress.telephone"||s==="legalAddress.countryCode"?n.trim()?null:i.required:s==="legalAddress.region"&&m&&!n.trim()?i.required:null,z=()=>{var T,M;const s={};let n=!0;const x=((T=e==null?void 0:e.permissionsFlags)==null?void 0:T.canEditAccount)===!0,c=((M=e==null?void 0:e.permissionsFlags)==null?void 0:M.canEditAddress)===!0;if(x){const I=A("name",r.name);I&&(s.name=I,n=!1);const E=A("email",r.email);if(E&&(s.email=E,n=!1),r.legalName){const b=A("legalName",r.legalName);b&&(s.legalName=b,n=!1)}if(r.vatTaxId){const b=A("vatTaxId",r.vatTaxId);b&&(s.vatTaxId=b,n=!1)}if(r.resellerId){const b=A("resellerId",r.resellerId);b&&(s.resellerId=b,n=!1)}}if(c){const I=A("legalAddress.street",r.legalAddress.street);I&&(s["legalAddress.street"]=I,n=!1);const E=A("legalAddress.city",r.legalAddress.city);E&&(s["legalAddress.city"]=E,n=!1);const b=A("legalAddress.postcode",r.legalAddress.postcode);b&&(s["legalAddress.postcode"]=b,n=!1);const oe=A("legalAddress.telephone",r.legalAddress.telephone);oe&&(s["legalAddress.telephone"]=oe,n=!1);const ie=A("legalAddress.countryCode",r.legalAddress.countryCode);ie&&(s["legalAddress.countryCode"]=ie,n=!1);const de=A("legalAddress.region",r.legalAddress.region);de&&(s["legalAddress.region"]=de,n=!1)}return p(s),n},w=async s=>{var T,M;s.preventDefault();const n=((T=e==null?void 0:e.permissionsFlags)==null?void 0:T.canEditAccount)===!0,x=((M=e==null?void 0:e.permissionsFlags)==null?void 0:M.canEditAddress)===!0,c={};if(n&&(c.name=!0,c.email=!0,c.legalName=!0,c.vatTaxId=!0,c.resellerId=!0),x&&(c["legalAddress.street"]=!0,c["legalAddress.street2"]=!0,c["legalAddress.city"]=!0,c["legalAddress.region"]=!0,c["legalAddress.regionCode"]=!0,c["legalAddress.countryCode"]=!0,c["legalAddress.postcode"]=!0,c["legalAddress.telephone"]=!0),d(c),!!z()){if(n&&r.email!==(e==null?void 0:e.email)){const I=await _e(r.email);if(!I.isValid){p(E=>({...E,email:I.error||i.emailNotAvailable}));return}}if(y){const I={};n&&(I.name=r.name,I.email=r.email,I.legalName=r.legalName,I.vatTaxId=r.vatTaxId,I.resellerId=r.resellerId),x&&(I.legalAddress={street:[r.legalAddress.street,r.legalAddress.street2].filter(Boolean),city:r.legalAddress.city,region:{region:r.legalAddress.region,regionCode:r.legalAddress.regionCode},countryCode:r.legalAddress.countryCode,postcode:r.legalAddress.postcode,telephone:r.legalAddress.telephone}),await y(I)}}},P=(s,n)=>{if(s.startsWith("legalAddress.")){const x=s.split(".")[1];x==="countryCode"?(N(c=>({...c,legalAddress:{...c.legalAddress,[x]:n,region:"",regionCode:""}})),p(c=>{const T={...c};return delete T["legalAddress.region"],delete T["legalAddress.regionCode"],T}),d(c=>{const T={...c};return delete T["legalAddress.region"],delete T["legalAddress.regionCode"],T})):N(x==="region"?c=>({...c,legalAddress:{...c.legalAddress,region:n,regionCode:k?c.legalAddress.regionCode:n}}):c=>({...c,legalAddress:{...c.legalAddress,[x]:n}}))}else N(x=>({...x,[s]:n}))},O=s=>n=>{const x=new Set(["name","email","legalName","vatTaxId","resellerId"]),c=s.startsWith("legalAddress.");x.has(s)&&!g||c&&!C||(P(s,n),v[s]&&p(M=>{const I={...M};return delete I[s],I}))},F=(s,n)=>{const x=new Set(["name","email","legalName","vatTaxId","resellerId"]),c=s.startsWith("legalAddress.");if(x.has(s)&&!g||c&&!C)return;n!==void 0&&P(s,n),d(E=>({...E,[s]:!0}));let M=n;if(M===void 0)if(s.startsWith("legalAddress.")){const E=s.split(".")[1],b=r.legalAddress[E];M=typeof b=="string"?b:""}else{const E=r[s];M=typeof E=="string"?E:""}const I=A(s,M);p(I?E=>({...E,[s]:I}):E=>{const b={...E};return delete b[s],b})};return h(Q,{variant:"secondary",className:"account-edit-company-profile",children:[t(ue,{title:i.title,divider:!1,className:"account-edit-company-profile__title"}),a!=null&&a.text?t(he,{className:"account-edit-company-profile__notification",type:a.type,variant:"secondary",heading:a.text,icon:a.icon,"data-testid":"editCompanyInLineAlert"}):null,h("form",{className:"account-edit-company-profile-form",onSubmit:w,children:[g&&t(we,{loading:u,value:{name:r.name,email:r.email,legalName:r.legalName,vatTaxId:r.vatTaxId,resellerId:r.resellerId},errors:v,touched:l,onBlur:F}),C&&t(Pe,{loading:u,loadingCountries:D,value:r.legalAddress,errors:v,touched:l,onChange:O,onBlur:F,countryOptions:_,regionOptions:$,isRegionRequired:m,hasRegionOptions:k}),h("div",{className:"account-edit-company-profile__actions",children:[t(X,{disabled:u,type:"button",variant:"secondary",onClick:()=>o==null?void 0:o(),children:i.cancel}),t(X,{disabled:u||!g&&!C,type:"submit",variant:"primary",children:i.save})]})]}),u&&h("div",{className:"account-edit-company-profile__loading-overlay","data-testid":"editCompanyLoadingOverlay",children:[t(fe,{size:"large"}),t("div",{className:"account-edit-company-profile__loading-text",children:i.saving})]})]})},Ge=({className:a,withHeader:e=!0,slots:u})=>{const y=j({containerTitle:"Company.CompanyProfile.containerTitle"}),{inLineAlertProps:o,handleSetInLineAlert:i}=Ee(),r=J(null),{company:N,loading:v,saving:p,showEditForm:l,handleShowEditForm:d,handleHideEditForm:g,handleUpdateCompany:C}=Te({handleSetInLineAlert:i,editFormRef:r});return v?t("div",{"data-testid":"companyProfileLoader",children:t(be,{withCard:!0})}):h("div",{className:me(["account-company-profile",a]),children:[e?t(ue,{title:y.containerTitle,divider:!1,className:"company-profile__title"}):null,t(xe,{company:N,slots:u,showEditForm:l,handleShowEditForm:d}),l?t("div",{ref:r,children:t(Fe,{inLineAlertProps:o,company:N,loading:p,onSubmit:C,onCancel:g})}):null]})};export{Ge as CompanyProfile,Ge as default};
=======
import{jsxs as h,jsx as t,Fragment as K}from"@dropins/tools/preact-jsx-runtime.js";import{classes as Z,Slot as fe}from"@dropins/tools/lib.js";import{Card as J,Skeleton as ye,SkeletonRow as Q,Button as X,Field as F,Input as L,Picker as ue,Header as pe,InLineAlert as ve,ProgressSpinner as Ae}from"@dropins/tools/components.js";import{useState as D,useEffect as j,useMemo as U,useRef as G,useCallback as k}from"@dropins/tools/preact-hooks.js";import{events as Ce}from"@dropins/tools/event-bus.js";import{u as Ne}from"../chunks/useCompanyContextListener2.js";import{g as be,u as Ee}from"../chunks/updateCompany.js";import{useText as W}from"@dropins/tools/i18n.js";import{g as ge,v as _e}from"../chunks/validateCompanyEmail.js";import{u as Ie}from"../chunks/useInLineAlert.js";import"../chunks/fetch-error.js";import"../chunks/fetchUserPermissions.js";import"../chunks/company-permissions.js";import"../chunks/fetch-graphql.js";import"@dropins/tools/fetch-graphql.js";import"@dropins/tools/preact-compat.js";const xe=({testId:a,withCard:e=!0})=>{const o=h(ye,{"data-testid":a||"companySkeletonLoader",children:[t(Q,{variant:"heading",size:"xlarge",fullWidth:!1,lines:1}),t(Q,{variant:"heading",size:"xlarge",fullWidth:!0,lines:1}),t(Q,{variant:"heading",size:"xlarge",fullWidth:!0,lines:1})]});return e?o:t(J,{variant:"secondary",className:Z(["company-company-loaders","company-company-loaders--card-loader"]),children:o})},Te=({company:a,slots:e,showEditForm:o,handleShowEditForm:f})=>{const n=W({editButton:"Company.shared.buttons.edit",noDataMessage:"Company.CompanyProfile.companyProfileCard.noDataMessage",companyName:"Company.shared.fields.companyName",email:"Company.shared.fields.email",legalName:"Company.shared.fields.legalName",vatTaxId:"Company.shared.fields.vatTaxId",resellerId:"Company.shared.fields.resellerId",legalAddress:"Company.shared.fields.legalAddress",contacts:"Company.CompanyProfile.companyProfileCard.contacts",companyAdministrator:"Company.CompanyProfile.companyProfileCard.companyAdministrator",salesRepresentative:"Company.CompanyProfile.companyProfileCard.salesRepresentative",paymentInformation:"Company.CompanyProfile.companyProfileCard.paymentInformation",shippingInformation:"Company.CompanyProfile.companyProfileCard.shippingInformation",availablePaymentMethods:"Company.CompanyProfile.companyProfileCard.availablePaymentMethods",availableShippingMethods:"Company.CompanyProfile.companyProfileCard.availableShippingMethods",noPaymentMethods:"Company.CompanyProfile.companyProfileCard.noPaymentMethods",noShippingMethods:"Company.CompanyProfile.companyProfileCard.noShippingMethods"});if(!a)return t(J,{variant:"secondary",className:"account-company-profile-card",children:t("div",{className:"account-company-profile-card__wrapper",children:t("div",{className:"account-company-profile-card__content",children:t("div",{className:"account-company-profile-card__no-data",children:t("p",{children:n.noDataMessage})})})})});const d=a.permissionsFlags||{canViewAccount:!0,canViewAddress:!0,canViewContacts:!0,canViewPaymentInformation:!0,canViewShippingInformation:!0},r=[d.canViewAccount?{name:"name",label:n.companyName,value:a.name||"",legalName:a.legalName||""}:null,d.canViewAccount?{name:"email",label:n.email,value:a.email||""}:null,d.canViewAccount?{name:"vatTaxId",label:n.vatTaxId,value:a.vatTaxId||""}:null,d.canViewAccount?{name:"resellerId",label:n.resellerId,value:a.resellerId||""}:null].filter(Boolean);return t(J,{variant:"secondary",className:Z(["account-company-profile-card",["account-company-profile-card-short",o]]),children:h("div",{className:"account-company-profile-card__wrapper",children:[t("div",{className:"account-company-profile-card__actions",children:(a.canEditAccount||a.canEditAddress)&&t(X,{type:"button",variant:"tertiary",onClick:f,children:n.editButton})}),t("div",{className:"account-company-profile-card__content",children:(()=>{var C,p;const v=h(K,{children:[r.map((s,c)=>{if(!s.value)return null;let A;return s.name==="name"&&s.legalName?A=`${s.label}: ${s.value} (${s.legalName})`:A=s.label?`${s.label}: ${s.value}`:s.value,t("p",{"data-testid":`${s.name}_${c}`,children:A},`${s.name}_${c}`)}),d.canViewAddress&&a.legalAddress&&h("div",{className:"company-legal-address",children:[t("p",{children:h("strong",{children:[n.legalAddress,":"]})}),(C=a.legalAddress.street)==null?void 0:C.map((s,c)=>t("p",{children:s},c)),h("p",{children:[a.legalAddress.city,", ",(p=a.legalAddress.region)==null?void 0:p.region," ",a.legalAddress.postcode]}),t("p",{children:a.legalAddress.countryCode}),a.legalAddress.telephone&&h("p",{children:["Phone: ",a.legalAddress.telephone]})]}),d.canViewContacts&&(a.companyAdmin||a.salesRepresentative)&&h("div",{className:"company-contacts",children:[t("p",{children:h("strong",{children:[n.contacts,":"]})}),a.companyAdmin&&h("div",{className:"company-contact",children:[t("p",{children:h("strong",{children:[n.companyAdministrator,":"]})}),h("p",{children:[a.companyAdmin.firstname," ",a.companyAdmin.lastname]}),a.companyAdmin.jobTitle&&t("p",{children:a.companyAdmin.jobTitle}),t("p",{children:a.companyAdmin.email})]}),a.salesRepresentative&&h("div",{className:"company-contact",children:[t("p",{children:h("strong",{children:[n.salesRepresentative,":"]})}),h("p",{children:[a.salesRepresentative.firstname," ",a.salesRepresentative.lastname]}),t("p",{children:a.salesRepresentative.email})]})]}),d.canViewPaymentInformation&&h("div",{className:"company-payment-methods",children:[t("p",{children:h("strong",{children:[n.paymentInformation,":"]})}),a.availablePaymentMethods&&a.availablePaymentMethods.length>0?h(K,{children:[t("p",{children:h("strong",{children:[n.availablePaymentMethods,":"]})}),t("ul",{className:"payment-methods-list",children:a.availablePaymentMethods.map((s,c)=>t("li",{children:s.title},`payment_${c}`))})]}):t("div",{className:"message message-notice notice",children:t("div",{children:n.noPaymentMethods})})]}),d.canViewShippingInformation&&h("div",{className:"company-shipping-methods",children:[t("p",{children:h("strong",{children:[n.shippingInformation,":"]})}),a.availableShippingMethods&&a.availableShippingMethods.length>0?h(K,{children:[t("p",{children:h("strong",{children:[n.availableShippingMethods,":"]})}),t("ul",{className:"shipping-methods-list",children:a.availableShippingMethods.map((s,c)=>t("li",{children:s.title},`shipping_${c}`))})]}):t("div",{className:"message message-notice notice",children:t("div",{children:n.noShippingMethods})})]})]});return e!=null&&e.CompanyData?t(fe,{name:"CompanyData",slot:e.CompanyData,context:{companyData:r,Default:v}}):v})()})]})})},$e=a=>{const[e,o]=D(null),[f,n]=D(!0);j(()=>{let p=!0;return ge().then(({availableCountries:s,countriesWithRequiredRegion:c,optionalZipCountries:A})=>{p&&(o({availableCountries:s,countriesWithRequiredRegion:c,optionalZipCountries:A}),n(!1))}).catch(()=>{p&&n(!1)}),()=>{p=!1}},[]);const d=U(()=>(e==null?void 0:e.availableCountries)||[],[e]),r=U(()=>{if(!a||!e)return[];const p=e.availableCountries.find(s=>s.value===a);return!(p!=null&&p.availableRegions)||p.availableRegions.length===0?[]:p.availableRegions.map(s=>({text:s.name,value:`${s.code},${s.id}`}))},[a,e]),v=U(()=>!a||!e?!1:e.countriesWithRequiredRegion.includes(a),[a,e]),C=U(()=>r.length>0,[r]);return{countryOptions:d,regionOptions:r,isRegionRequired:v,hasRegionOptions:C,loadingCountries:f}},we=({loading:a,value:e,errors:o,touched:f,onBlur:n,namePrefix:d="",fieldPathPrefix:r=""})=>{const v=W({companyName:"Company.shared.fields.companyName",email:"Company.shared.fields.email",legalName:"Company.shared.fields.legalName",vatTaxId:"Company.shared.fields.vatTaxId",resellerId:"Company.shared.fields.resellerId"}),C=d?`${d}_`:"",p=s=>r?`${r}.${s}`:s;return h("div",{className:"account-edit-company-profile-form__group",children:[t(F,{label:v.companyName,required:!0,className:"account-edit-company-profile-form__field",error:f.name&&o.name?o.name:void 0,children:t(L,{name:`${C}name`,type:"text",value:e.name,onBlur:s=>{const c=s.target;n(p("name"),c.value)},disabled:!!a,variant:"primary",size:"medium",maxLength:40})}),t(F,{label:v.legalName,className:"account-edit-company-profile-form__field",children:t(L,{name:`${C}legalName`,type:"text",value:e.legalName,onBlur:s=>{const c=s.target;n(p("legalName"),c.value)},disabled:!!a,variant:"primary",size:"medium",maxLength:80})}),t(F,{label:v.email,required:!0,className:"account-edit-company-profile-form__field",error:f.email&&o.email?o.email:void 0,children:t(L,{name:`${C}email`,type:"email",value:e.email,onBlur:s=>{const c=s.target;n(p("email"),c.value)},disabled:!!a,variant:"primary",size:"medium"})}),t(F,{label:v.vatTaxId,className:"account-edit-company-profile-form__field",children:t(L,{name:`${C}vatTaxId`,type:"text",value:e.vatTaxId,onBlur:s=>{const c=s.target;n(p("vatTaxId"),c.value)},disabled:!!a,variant:"primary",size:"medium",maxLength:40})}),t(F,{label:v.resellerId,className:"account-edit-company-profile-form__field",children:t(L,{name:`${C}resellerId`,type:"text",value:e.resellerId,onBlur:s=>{const c=s.target;n(p("resellerId"),c.value)},disabled:!!a,variant:"primary",size:"medium",maxLength:40})})]})},Pe=({loading:a,loadingCountries:e,value:o,errors:f,touched:n,onChange:d,onBlur:r,countryOptions:v,regionOptions:C,isRegionRequired:p,hasRegionOptions:s,namePrefix:c="legalAddress",fieldPathPrefix:A="legalAddress",requiredConfig:N})=>{var S;const _=W({legalAddress:"Company.shared.fields.legalAddress",streetAddress:"Company.shared.fields.streetAddress",city:"Company.shared.fields.city",country:"Company.shared.fields.country",stateProvince:"Company.shared.fields.stateProvince",zipPostalCode:"Company.shared.fields.zipPostalCode",phoneNumber:"Company.shared.fields.phoneNumber"}),M={street:`${c}_street`,street2:`${c}_street2`,city:`${c}_city`,countryCode:`${c}_countryCode`,region:`${c}_region`,postcode:`${c}_postcode`,telephone:`${c}_telephone`},g={street:`${A}.street`,street2:`${A}.street2`,city:`${A}.city`,countryCode:`${A}.countryCode`,region:`${A}.region`,regionCode:`${A}.regionCode`,postcode:`${A}.postcode`,telephone:`${A}.telephone`},V={street:(N==null?void 0:N.street)??!0,city:(N==null?void 0:N.city)??!0,postcode:(N==null?void 0:N.postcode)??!0,telephone:(N==null?void 0:N.telephone)??!0};return h("div",{className:"account-edit-company-profile-form__section",children:[t("h3",{className:"account-edit-company-profile-form__section-title",children:_.legalAddress}),t(F,{label:_.streetAddress,required:V.street,className:"account-edit-company-profile-form__field",error:n[g.street]&&f[g.street]?f[g.street]:void 0,children:t(L,{name:M.street,type:"text",value:o.street,onBlur:m=>{const b=m.target;r(g.street,b.value)},disabled:!!a,variant:"primary",size:"medium"})}),t(F,{label:`${_.streetAddress} 2`,className:"account-edit-company-profile-form__field",children:t(L,{name:M.street2,type:"text",value:o.street2,onBlur:m=>{const b=m.target;r(g.street2,b.value)},disabled:!!a,variant:"primary",size:"medium"})}),t(F,{label:_.city,required:V.city,className:"account-edit-company-profile-form__field",error:n[g.city]&&f[g.city]?f[g.city]:void 0,children:t(L,{name:M.city,type:"text",value:o.city,onBlur:m=>{const b=m.target;r(g.city,b.value)},disabled:!!a,variant:"primary",size:"medium"})}),t(F,{label:_.country,required:!0,className:"account-edit-company-profile-form__field",error:n[g.countryCode]&&f[g.countryCode]?f[g.countryCode]:void 0,children:t(ue,{name:M.countryCode,floatingLabel:`${_.country} *`,placeholder:_.country,options:v,value:o.countryCode,handleSelect:m=>{const b=m.target;d(g.countryCode)(b.value)},onBlur:()=>r(g.countryCode),disabled:!!a||e})}),t(F,{label:_.stateProvince,required:p,className:"account-edit-company-profile-form__field",error:n["legalAddress.region"]&&f["legalAddress.region"]?f["legalAddress.region"]:void 0,children:s?t(ue,{name:"legalAddress_region",floatingLabel:`${_.stateProvince} ${p?"*":""}`,placeholder:_.stateProvince,options:C,value:o.regionCode&&((S=C.find(m=>m.value.split(",")[0]===o.regionCode))==null?void 0:S.value)||"",handleSelect:m=>{var w;const b=m.target,[B]=b.value.split(","),O=((w=C.find(z=>z.value===b.value))==null?void 0:w.text)||"";d(g.region)(O),d(g.regionCode)(B)},onBlur:()=>r(g.region),disabled:!!a||e},`region_picker_${o.countryCode}`):t(L,{name:M.region,type:"text",value:o.region,onBlur:m=>{const b=m.target;r(g.region,b.value)},disabled:!!a||e,variant:"primary",size:"medium"},`region_input_${o.countryCode}`)}),t(F,{label:_.zipPostalCode,required:V.postcode,className:"account-edit-company-profile-form__field",error:n[g.postcode]&&f[g.postcode]?f[g.postcode]:void 0,children:t(L,{name:M.postcode,type:"text",value:o.postcode,onBlur:m=>{const b=m.target;r(g.postcode,b.value)},disabled:!!a,variant:"primary",size:"medium"})}),t(F,{label:_.phoneNumber,required:V.telephone,className:"account-edit-company-profile-form__field",error:n[g.telephone]&&f[g.telephone]?f[g.telephone]:void 0,children:t(L,{name:M.telephone,type:"tel",value:o.telephone,onBlur:m=>{const b=m.target;r(g.telephone,b.value)},disabled:!!a,variant:"primary",size:"medium"})})]})},Fe=({inLineAlertProps:a,company:e,loading:o=!1,onSubmit:f,onCancel:n})=>{var H,Y,q,y,R,ee,ae,te,re,se,le,ne,ie,oe;const d=W({title:"Company.EditCompanyProfile.title",cancel:"Company.shared.buttons.cancel",save:"Company.shared.buttons.save",saving:"Company.shared.buttons.saving",required:"Company.shared.validation.required",invalidEmail:"Company.shared.validation.invalidEmail",companyNameRequired:"Company.shared.validation.companyNameRequired",emailRequired:"Company.shared.validation.emailRequired",emailNotAvailable:"Company.shared.validation.emailNotAvailable",companyNameLengthError:"Company.shared.validation.companyNameLengthError",legalNameLengthError:"Company.shared.validation.legalNameLengthError",vatTaxIdLengthError:"Company.shared.validation.vatTaxIdLengthError",resellerIdLengthError:"Company.shared.validation.resellerIdLengthError"}),[r,v]=D({name:(e==null?void 0:e.name)||"",email:(e==null?void 0:e.email)||"",legalName:(e==null?void 0:e.legalName)||"",vatTaxId:(e==null?void 0:e.vatTaxId)||"",resellerId:(e==null?void 0:e.resellerId)||"",legalAddress:{street:((Y=(H=e==null?void 0:e.legalAddress)==null?void 0:H.street)==null?void 0:Y[0])||"",street2:((y=(q=e==null?void 0:e.legalAddress)==null?void 0:q.street)==null?void 0:y[1])||"",city:((R=e==null?void 0:e.legalAddress)==null?void 0:R.city)||"",region:((ae=(ee=e==null?void 0:e.legalAddress)==null?void 0:ee.region)==null?void 0:ae.region)||"",regionCode:((re=(te=e==null?void 0:e.legalAddress)==null?void 0:te.region)==null?void 0:re.regionCode)||"",countryCode:((se=e==null?void 0:e.legalAddress)==null?void 0:se.countryCode)||"",postcode:((le=e==null?void 0:e.legalAddress)==null?void 0:le.postcode)||"",telephone:((ne=e==null?void 0:e.legalAddress)==null?void 0:ne.telephone)||""}}),[C,p]=D({}),[s,c]=D({}),A=((ie=e==null?void 0:e.permissionsFlags)==null?void 0:ie.canEditAccount)===!0,N=((oe=e==null?void 0:e.permissionsFlags)==null?void 0:oe.canEditAddress)===!0,{countryOptions:_,regionOptions:M,isRegionRequired:g,hasRegionOptions:V,loadingCountries:S}=$e(r.legalAddress.countryCode),m=(l,i)=>l==="name"?i.trim()?i.length>40?d.companyNameLengthError:null:d.companyNameRequired:l==="email"?i.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(i)?null:d.invalidEmail:d.emailRequired:l==="legalName"?i.length>80?d.legalNameLengthError:null:l==="vatTaxId"?i.length>40?d.vatTaxIdLengthError:null:l==="resellerId"?i.length>40?d.resellerIdLengthError:null:l==="legalAddress.street"||l==="legalAddress.city"||l==="legalAddress.postcode"||l==="legalAddress.telephone"||l==="legalAddress.countryCode"?i.trim()?null:d.required:l==="legalAddress.region"&&g&&!i.trim()?d.required:null,b=()=>{var $,P;const l={};let i=!0;const T=(($=e==null?void 0:e.permissionsFlags)==null?void 0:$.canEditAccount)===!0,u=((P=e==null?void 0:e.permissionsFlags)==null?void 0:P.canEditAddress)===!0;if(T){const E=m("name",r.name);E&&(l.name=E,i=!1);const I=m("email",r.email);if(I&&(l.email=I,i=!1),r.legalName){const x=m("legalName",r.legalName);x&&(l.legalName=x,i=!1)}if(r.vatTaxId){const x=m("vatTaxId",r.vatTaxId);x&&(l.vatTaxId=x,i=!1)}if(r.resellerId){const x=m("resellerId",r.resellerId);x&&(l.resellerId=x,i=!1)}}if(u){const E=m("legalAddress.street",r.legalAddress.street);E&&(l["legalAddress.street"]=E,i=!1);const I=m("legalAddress.city",r.legalAddress.city);I&&(l["legalAddress.city"]=I,i=!1);const x=m("legalAddress.postcode",r.legalAddress.postcode);x&&(l["legalAddress.postcode"]=x,i=!1);const de=m("legalAddress.telephone",r.legalAddress.telephone);de&&(l["legalAddress.telephone"]=de,i=!1);const ce=m("legalAddress.countryCode",r.legalAddress.countryCode);ce&&(l["legalAddress.countryCode"]=ce,i=!1);const me=m("legalAddress.region",r.legalAddress.region);me&&(l["legalAddress.region"]=me,i=!1)}return p(l),i},B=async l=>{var $,P;l.preventDefault();const i=(($=e==null?void 0:e.permissionsFlags)==null?void 0:$.canEditAccount)===!0,T=((P=e==null?void 0:e.permissionsFlags)==null?void 0:P.canEditAddress)===!0,u={};if(i&&(u.name=!0,u.email=!0,u.legalName=!0,u.vatTaxId=!0,u.resellerId=!0),T&&(u["legalAddress.street"]=!0,u["legalAddress.street2"]=!0,u["legalAddress.city"]=!0,u["legalAddress.region"]=!0,u["legalAddress.regionCode"]=!0,u["legalAddress.countryCode"]=!0,u["legalAddress.postcode"]=!0,u["legalAddress.telephone"]=!0),c(u),!!b()){if(i&&r.email!==(e==null?void 0:e.email)){const E=await _e(r.email);if(!E.isValid){p(I=>({...I,email:E.error||d.emailNotAvailable}));return}}if(f){const E={};i&&(E.name=r.name,E.email=r.email,E.legalName=r.legalName,E.vatTaxId=r.vatTaxId,E.resellerId=r.resellerId),T&&(E.legalAddress={street:[r.legalAddress.street,r.legalAddress.street2].filter(Boolean),city:r.legalAddress.city,region:{region:r.legalAddress.region,regionCode:r.legalAddress.regionCode},countryCode:r.legalAddress.countryCode,postcode:r.legalAddress.postcode,telephone:r.legalAddress.telephone}),await f(E)}}},O=(l,i)=>{if(l.startsWith("legalAddress.")){const T=l.split(".")[1];T==="countryCode"?(v(u=>({...u,legalAddress:{...u.legalAddress,[T]:i,region:"",regionCode:""}})),p(u=>{const $={...u};return delete $["legalAddress.region"],delete $["legalAddress.regionCode"],$}),c(u=>{const $={...u};return delete $["legalAddress.region"],delete $["legalAddress.regionCode"],$})):v(T==="region"?u=>({...u,legalAddress:{...u.legalAddress,region:i,regionCode:V?u.legalAddress.regionCode:i}}):u=>({...u,legalAddress:{...u.legalAddress,[T]:i}}))}else v(T=>({...T,[l]:i}))},w=l=>i=>{const T=new Set(["name","email","legalName","vatTaxId","resellerId"]),u=l.startsWith("legalAddress.");T.has(l)&&!A||u&&!N||(O(l,i),C[l]&&p(P=>{const E={...P};return delete E[l],E}))},z=(l,i)=>{const T=new Set(["name","email","legalName","vatTaxId","resellerId"]),u=l.startsWith("legalAddress.");if(T.has(l)&&!A||u&&!N)return;i!==void 0&&O(l,i),c(I=>({...I,[l]:!0}));let P=i;if(P===void 0)if(l.startsWith("legalAddress.")){const I=l.split(".")[1],x=r.legalAddress[I];P=typeof x=="string"?x:""}else{const I=r[l];P=typeof I=="string"?I:""}const E=m(l,P);p(E?I=>({...I,[l]:E}):I=>{const x={...I};return delete x[l],x})};return h(J,{variant:"secondary",className:"account-edit-company-profile",children:[t(pe,{title:d.title,divider:!1,className:"account-edit-company-profile__title"}),a!=null&&a.text?t(ve,{className:"account-edit-company-profile__notification",type:a.type,variant:"secondary",heading:a.text,icon:a.icon,"data-testid":"editCompanyInLineAlert"}):null,h("form",{className:"account-edit-company-profile-form",onSubmit:B,children:[A&&t(we,{loading:o,value:{name:r.name,email:r.email,legalName:r.legalName,vatTaxId:r.vatTaxId,resellerId:r.resellerId},errors:C,touched:s,onBlur:z}),N&&t(Pe,{loading:o,loadingCountries:S,value:r.legalAddress,errors:C,touched:s,onChange:w,onBlur:z,countryOptions:_,regionOptions:M,isRegionRequired:g,hasRegionOptions:V}),h("div",{className:"account-edit-company-profile__actions",children:[t(X,{disabled:o,type:"button",variant:"secondary",onClick:()=>n==null?void 0:n(),children:d.cancel}),t(X,{disabled:o||!A&&!N,type:"submit",variant:"primary",children:d.save})]})]}),o&&h("div",{className:"account-edit-company-profile__loading-overlay","data-testid":"editCompanyLoadingOverlay",children:[t(Ae,{size:"large"}),t("div",{className:"account-edit-company-profile__loading-text",children:d.saving})]})]})};var he=(a=>(a.EDIT_COMPANY_EVENT="edit-company",a))(he||{});const Me={EDIT_COMPANY_EVENT:"edit-company"},Re=()=>(window.adobeDataLayer||(window.adobeDataLayer=[]),window.adobeDataLayer),Le=a=>{Re().push(o=>{const f=o.getState?o.getState():{};o.push({event:a,context:f})})},De=(a,e)=>{if(!Me[a])return null;switch(a){case"edit-company":Le({type:"company",eventType:"edit",companyData:e});break;default:return null}},Se=({handleSetInLineAlert:a,editFormRef:e})=>{const o=W({companySuccess:"Company.CompanyProfile.editCompanyProfile.companySuccess",companyError:"Company.CompanyProfile.editCompanyProfile.companyError",loadError:"Company.CompanyProfile.messages.loadError",updateError:"Company.CompanyProfile.messages.updateError"}),{companySuccess:f,companyError:n,loadError:d,updateError:r}=o,[v,C]=D(null),[p,s]=D(!0),[c,A]=D(!1),[N,_]=D(!1),[M,g]=D([]),[V,S]=D({}),m=G(a),b=G(!1),B=G(!1);j(()=>{m.current=a},[a]);const O=k(y=>{S(y)},[]),w=k((y,R)=>{a&&(y==="success"?a({type:"success",text:R??f}):y==="error"?a({type:"error",text:R??n}):a(),A(!1))},[a,f,n]),z=k(async()=>{if(b.current)return null;b.current=!0,s(!0);try{const y=await be();return y&&C(y),s(!1),y}catch(y){return console.error("Failed to load company:",y),s(!1),m.current&&m.current({type:"error",text:d}),null}finally{b.current=!1}},[d]);j(()=>{B.current||(B.current=!0,z())},[z]),Ne(k(()=>{s(!0),_(!1),S({}),z()},[z])),j(()=>{ge().then(y=>{g(y.availableCountries)}).catch(y=>{console.error("Failed to load countries:",y)})},[]);const H=k(()=>{_(!0),w("success",""),S({})},[w]);j(()=>{N&&(e!=null&&e.current)&&setTimeout(()=>{var y;(y=e.current)==null||y.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})},100)},[N,e]);const Y=k(y=>{y==null||y(),_(!1),S({})},[]),q=k(async y=>{try{if(A(!0),!y){w("error","No data to update");return}const R=await Ee(y);C(R),_(!1),S({}),w("success"),De(he.EDIT_COMPANY_EVENT,{...y,companyId:v==null?void 0:v.id}),Ce.emit("company/updated",{company:R})}catch(R){console.error("Failed to update company:",R),w("error",R.message||r)}finally{A(!1)}},[v,w,r]);return{company:v,countries:M,loading:p,submitLoading:c,showEditForm:N,inputChange:V,handleShowEditForm:H,handleHideEditForm:Y,handleUpdateCompany:q,handleInputChange:O,renderAlertMessage:w,saving:c}},Ze=({className:a,withHeader:e=!0,slots:o})=>{const f=W({containerTitle:"Company.CompanyProfile.containerTitle"}),{inLineAlertProps:n,handleSetInLineAlert:d}=Ie(),r=G(null),{company:v,loading:C,saving:p,showEditForm:s,handleShowEditForm:c,handleHideEditForm:A,handleUpdateCompany:N}=Se({handleSetInLineAlert:d,editFormRef:r});return C?t("div",{"data-testid":"companyProfileLoader",children:t(xe,{withCard:!0})}):h("div",{className:Z(["account-company-profile",a]),children:[e?t(pe,{title:f.containerTitle,divider:!1,className:"company-profile__title"}):null,t(Te,{company:v,slots:o,showEditForm:s,handleShowEditForm:c}),s?t("div",{ref:r,children:t(Fe,{inLineAlertProps:n,company:v,loading:p,onSubmit:N,onCancel:A})}):null]})};export{Ze as CompanyProfile,Ze as default};
>>>>>>> mainline/b2b
//# sourceMappingURL=CompanyProfile.js.map
