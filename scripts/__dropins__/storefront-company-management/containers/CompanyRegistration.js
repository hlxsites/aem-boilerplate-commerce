/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsxs as y,jsx as u,Fragment as J}from"@dropins/tools/preact-jsx-runtime.js";import{useRef as D,useEffect as H,useState as $,useMemo as M,useCallback as ee}from"@dropins/tools/preact-hooks.js";import{Field as B,Picker as ae,Input as re,ProgressSpinner as z,Button as ne}from"@dropins/tools/components.js";import{classes as k,Slot as oe}from"@dropins/tools/lib.js";import{memo as te}from"@dropins/tools/preact-compat.js";import{useText as W}from"@dropins/tools/i18n.js";import{g as se,c as ie}from"../chunks/createCompany.js";import{g as Z,v as le}from"../chunks/validateCompanyEmail.js";/* empty css            */import{a as de,i as ce}from"../chunks/isCompanyUser.js";import"../chunks/network-error.js";import"@dropins/tools/fetch-graphql.js";import"@dropins/tools/event-bus.js";import"../chunks/fetch-error.js";import"../chunks/company-permissions.js";var A=(a=>(a.TEXT="TEXT",a.EMAIL="EMAIL",a.TEL="TEL",a.SELECT="SELECT",a.HIDDEN="HIDDEN",a))(A||{});const me=te(({loading:a,values:e={},fields:p,errors:n={},className:h="",regionOptions:s,countryOptions:g,onChange:o,onBlur:i,onFocus:m,slots:T,fieldIdPrefix:f})=>{const _=`${h}__field`,E=W({selectCountry:"Company.FormText.selectCountry",selectRegion:"Company.FormText.selectRegion",selectCountryFirst:"Company.FormText.selectCountryFirst",country:"Company.shared.fields.country",stateProvince:"Company.shared.fields.stateProvince","Company.Registration.companyInformation":"Company.shared.fields.companyInformation","Company.Registration.legalAddress":"Company.shared.fields.legalAddress","Company.Registration.companyAdmin":"Company.shared.fields.companyAdmin"}),N={CompanyInformationSection:["companyName","legalName","companyEmail","vatTaxId","resellerId"],LegalAddressSection:["street","streetLine2","city","countryCode","region","postcode","addressTelephone"],CompanyAdministratorSection:["adminEmail","adminFirstname","adminLastname","adminJobTitle","adminWorkTelephone","adminGender"]},v=r=>({CompanyInformationSection:"Company.Registration.companyInformation",LegalAddressSection:"Company.Registration.legalAddress",CompanyAdministratorSection:"Company.Registration.companyAdmin"})[r],S=r=>{var C,R,F,V;if((r.code==="region"||r.code==="regionCode")&&r.fieldType===A.SELECT){const x=((C=e.regionCode)==null?void 0:C.toString())||"",I=((R=e.regionId)==null?void 0:R.toString())||"";return x&&I?`${x},${I}`:(F=e[r.code])!=null&&F.toString().includes(",")?(V=e[r.code])==null?void 0:V.toString():""}return null},l=r=>{var C;return r.code==="street"?Array.isArray(e.street)?e.street[0]||"":((C=e.street)==null?void 0:C.toString())||"":r.code==="streetLine2"?Array.isArray(e.street)&&e.street[1]||"":null},t=(r,C)=>{const R=`CompanyFormInput_${r.code}`,F=T==null?void 0:T[R];if(!F)return null;const V={inputName:r.code,handleOnChange:o||(()=>{}),errorMessage:C,errors:Object.values(n),formData:e,fieldConfig:{required:r.required,disabled:r.disabled||a,placeholder:r.placeholder||r.label,label:r.label}};return u(oe,{"data-testid":`companyFormInput_${r.code}`,name:R,slot:F,context:V})},d=(r,C,R)=>{let F=r.options;return r.code==="countryCode"||r.code==="country_code"?F=(g==null?void 0:g.map(V=>({value:V.value,text:V.text,isDefault:!1})))||[]:(r.code==="region"||r.code==="regionCode")&&(F=(s==null?void 0:s.map(V=>({text:V.text,value:V.value,isDefault:!1})))||[]),u(J,{children:t(r,R)??u(B,{error:R,className:k([_,`${_}--${r.id}`,[`${_}--${r.id}-hidden`,r.isHidden],r.className]),"data-testid":`${h}--${r.id}`,disabled:a,children:u(ae,{"aria-label":r.label,"aria-required":r.required?"true":"false",id:f?`${f}_${r.code}`:r.code,required:r==null?void 0:r.required,name:r.customUpperCode||r.code,floatingLabel:`${r.label} ${r.required?"*":""}`,placeholder:r.label,options:F,onBlur:i,onFocus:m,handleSelect:o,defaultValue:C,value:C})},r.id)})},c=(r,C,R)=>{let F="text";return r.fieldType===A.EMAIL?F="email":r.fieldType===A.TEL&&(F="tel"),u(J,{children:t(r,R)??u(B,{error:R,className:k([_,`${_}--${r.id}`,[`${_}--${r.id}-hidden`,r.isHidden],r.className]),"data-testid":`${h}--${r.id}`,disabled:a,children:u(re,{"aria-label":r.label,"aria-required":r.required?"true":"false",id:f?`${f}_${r.code}`:r.code,type:F,name:r.customUpperCode,value:C??r.defaultValue,placeholder:r.label,floatingLabel:`${r.label} ${r.required?"*":""}`,maxLength:r.maxlength,onBlur:i,onFocus:m,onChange:o})},r.id)})},b=r=>p==null?void 0:p.filter(C=>r.includes(C.code)&&!C.isHidden).map(C=>{var I,q;let R=((I=e[C.code])==null?void 0:I.toString())||"";const F=l(C);F!==null&&(R=F);const V=S(C);V!==null&&(R=V);const x=n[C.customUpperCode||C.code]||"";return C.code==="region"||C.code==="regionCode"?C.fieldType===A.SELECT?d(C,R,x):c(C,R,x):C.fieldType===A.SELECT||((q=C.options)==null?void 0:q.length)>0?d(C,R,x):c(C,R,x)}),L=r=>{const C=N[r],R=v(r);return(p==null?void 0:p.some(V=>C.includes(V.code)&&!V.isHidden))?y("div",{className:`${h}__section`,children:[u("h3",{className:`${h}__section-title`,children:E[R]}),b(C)]},`section-${r}`):null};return y("div",{className:`${h}__inputs`,children:[L("CompanyInformationSection"),L("LegalAddressSection"),L("CompanyAdministratorSection")]})}),ue=({showFormLoader:a,slots:e,name:p="companyForm",loading:n,submitting:h,children:s,className:g="company-form",fieldsConfig:o=[],values:i={},errors:m={},onSubmit:T,onChange:f,onBlur:_,regionOptions:E,countryOptions:N,fieldIdPrefix:v})=>{const S=D(null),l=W({loading:"Company.FormText.loading",submitting:"Company.FormText.submitting"});H(()=>{h&&window.scrollTo({top:0,behavior:"smooth"})},[h]);const t=async c=>{c.preventDefault(),T&&await T(c,!0)};if(a||n)return y("div",{className:k(["company-form-loader"]),"data-testid":"company-form-loader",children:[u(z,{size:"large"}),u("div",{className:"company-form-loader__text",children:l.loading})]});const d=c=>{const b=c.target,{name:L,value:r}=b;f&&f({[L]:r})};return y("div",{className:"company-form-container",children:[y("form",{id:p,ref:S,className:k(["company-form",g,h&&"company-form--submitting"]),onSubmit:t,noValidate:!0,children:[u(me,{className:g,fields:o,values:i,errors:m,loading:h,onChange:d,onBlur:_,slots:e,regionOptions:E,countryOptions:N,fieldIdPrefix:v}),s]}),h&&y("div",{className:"company-form__submitting-overlay","data-testid":"company-form-submitting-overlay",children:[u(z,{size:"large"}),u("div",{className:"company-form__submitting-text",children:l.submitting})]})]})},pe=(a={})=>{const{defaultCountry:e="US",formName:p="company_registration"}=a,[n,h]=$(null),[s,g]=$(()=>{var d;try{const c=sessionStorage.getItem(`${p}_formData`);return c?{countryCode:(d=JSON.parse(c))==null?void 0:d.countryCode}:{countryCode:e}}catch{return{countryCode:e}}}),[o,i]=$(!0),[m,T]=$(!0),[f,_]=$([]);H(()=>{i(!0),T(!0),Z().then(({availableCountries:d,countriesWithRequiredRegion:c,optionalZipCountries:b})=>{h({availableCountries:d,countriesWithRequiredRegion:c,optionalZipCountries:b}),i(!1),T(!1)}).catch(d=>{console.error("Failed to load countries:",d),i(!1),T(!1)})},[]),H(()=>{if(s!=null&&s.countryCode&&n){const d=n.availableCountries.find(c=>c.value===s.countryCode);if(d!=null&&d.availableRegions&&d.availableRegions.length>0){const c=d.availableRegions.map(b=>({text:b.name,value:`${b.code},${b.id}`,id:b.id,code:b.code}));_(c)}else _([])}else _([])},[s==null?void 0:s.countryCode,n]);const E=M(()=>(n==null?void 0:n.availableCountries)||[],[n]),N=M(()=>!(s!=null&&s.countryCode)||!n?!1:n.countriesWithRequiredRegion.includes(s.countryCode),[s==null?void 0:s.countryCode,n]),v=M(()=>!(s!=null&&s.countryCode)||!n?!0:!n.optionalZipCountries.includes(s.countryCode),[s==null?void 0:s.countryCode,n]),S=M(()=>f,[f]),l=M(()=>S.length>0,[S.length]),t=ee((d,c)=>{g(b=>{const L={...b,[d]:c};return d==="countryCode"&&(L.regionCode="",L.regionId=void 0),L})},[]);return{countryOptions:E,regionOptions:S,isRequiredRegion:N,isRequiredPostCode:v,disableField:o,loadingCountries:m,hasRegions:l,handleInputChange:t,inputChange:s}},he=a=>{var T;const{formData:e,isRequiredRegion:p=!1,isRequiredPostCode:n=!1,hasRegions:h=!1,disableField:s=!1,translations:g={}}=a,o=f=>(g==null?void 0:g[f])||f,i=f=>{const _=o(f);return f==="countryCode"||f==="region"||f==="adminGender"?`Select ${_.toLowerCase()}`:`Enter ${_.toLowerCase()}`},m={isRequiredRegion:p,isRequiredPostCode:n};return[{code:"companyName",name:"companyName",id:"companyName",label:o("companyName"),placeholder:i("companyName"),required:!0,fieldType:A.TEXT,isHidden:!1,customUpperCode:"companyName",defaultValue:(e==null?void 0:e.companyName)||"",options:[],maxlength:40,...m,validateRules:[]},{code:"legalName",name:"legalName",id:"legalName",label:o("legalName"),placeholder:i("legalName"),required:!1,fieldType:A.TEXT,isHidden:!1,customUpperCode:"legalName",defaultValue:(e==null?void 0:e.legalName)||"",options:[],maxlength:80,validateRules:[],...m},{code:"companyEmail",name:"companyEmail",id:"companyEmail",label:o("companyEmail"),placeholder:i("companyEmail"),required:!0,fieldType:A.EMAIL,isHidden:!1,customUpperCode:"companyEmail",defaultValue:(e==null?void 0:e.companyEmail)||"",options:[],maxlength:254,validateRules:[{INPUT_VALIDATION:"email"},{MIN_TEXT_LENGTH:5},{MAX_TEXT_LENGTH:254}],...m},{code:"vatTaxId",name:"vatTaxId",id:"vatTaxId",label:o("vatTaxId"),placeholder:i("vatTaxId"),required:!1,fieldType:A.TEXT,isHidden:!1,customUpperCode:"vatTaxId",defaultValue:(e==null?void 0:e.vatTaxId)||"",options:[],maxlength:40,validateRules:[],...m},{code:"resellerId",name:"resellerId",id:"resellerId",label:o("resellerId"),placeholder:i("resellerId"),required:!1,fieldType:A.TEXT,isHidden:!1,customUpperCode:"resellerId",defaultValue:(e==null?void 0:e.resellerId)||"",options:[],maxlength:40,validateRules:[],...m},{code:"street",name:"street",id:"street",label:o("street"),placeholder:i("street"),required:!0,fieldType:A.TEXT,isHidden:!1,customUpperCode:"street",defaultValue:Array.isArray(e==null?void 0:e.street)?e.street[0]:(e==null?void 0:e.street)||"",options:[],validateRules:[],...m},{code:"streetLine2",name:"streetLine2",id:"streetLine2",label:o("streetLine2"),placeholder:i("streetLine2"),required:!1,fieldType:A.TEXT,isHidden:!1,customUpperCode:"streetLine2",defaultValue:Array.isArray(e==null?void 0:e.street)?e.street[1]:"",options:[],validateRules:[],...m},{code:"city",name:"city",id:"city",label:o("city"),placeholder:i("city"),required:!0,fieldType:A.TEXT,isHidden:!1,customUpperCode:"city",defaultValue:(e==null?void 0:e.city)||"",options:[],validateRules:[],...m},{code:"countryCode",name:"countryCode",id:"countryCode",label:o("country"),placeholder:i("country"),required:!0,disabled:s,fieldType:A.SELECT,isHidden:!1,customUpperCode:"countryCode",defaultValue:(e==null?void 0:e.countryCode)||"",options:[],validateRules:[]},{code:"region",name:"region",id:"region",label:o("stateProvince"),placeholder:i("stateProvince"),required:p,disabled:!1,fieldType:h?A.SELECT:A.TEXT,isHidden:!1,customUpperCode:"region",defaultValue:(e==null?void 0:e.regionCode)||"",options:[]},{code:"postcode",name:"postcode",id:"postcode",label:o("postalCode"),placeholder:i("postalCode"),required:n,fieldType:A.TEXT,isHidden:!1,customUpperCode:"postcode",defaultValue:(e==null?void 0:e.postcode)||"",options:[],validateRules:[{INPUT_VALIDATION:"postal-code"},{MIN_TEXT_LENGTH:3},{MAX_TEXT_LENGTH:20}],...m},{code:"addressTelephone",name:"addressTelephone",id:"addressTelephone",label:o("telephone"),placeholder:i("telephone"),required:!0,fieldType:A.TEL,isHidden:!1,customUpperCode:"addressTelephone",defaultValue:(e==null?void 0:e.addressTelephone)||"",options:[],validateRules:[{INPUT_VALIDATION:"phone"},{MIN_TEXT_LENGTH:1},{MAX_TEXT_LENGTH:20}],...m},{code:"adminJobTitle",name:"adminJobTitle",id:"adminJobTitle",label:o("adminJobTitle"),placeholder:i("adminJobTitle"),required:!1,fieldType:A.TEXT,isHidden:!1,customUpperCode:"adminJobTitle",defaultValue:(e==null?void 0:e.adminJobTitle)||"",options:[],validateRules:[],...m},{code:"adminWorkTelephone",name:"adminWorkTelephone",id:"adminWorkTelephone",label:o("adminWorkTelephone"),placeholder:i("adminWorkTelephone"),required:!1,fieldType:A.TEL,isHidden:!1,customUpperCode:"adminWorkTelephone",defaultValue:(e==null?void 0:e.adminWorkTelephone)||"",options:[],validateRules:[{INPUT_VALIDATION:"phone"},{MIN_TEXT_LENGTH:1},{MAX_TEXT_LENGTH:20}],...m},{code:"adminEmail",name:"adminEmail",id:"adminEmail",label:o("adminEmail"),placeholder:i("adminEmail"),required:!0,fieldType:A.EMAIL,isHidden:!1,customUpperCode:"adminEmail",defaultValue:(e==null?void 0:e.adminEmail)||"",options:[],validateRules:[{INPUT_VALIDATION:"email"},{MIN_TEXT_LENGTH:5},{MAX_TEXT_LENGTH:254}],...m},{code:"adminFirstname",name:"adminFirstname",id:"adminFirstname",label:o("adminFirstname"),placeholder:i("adminFirstname"),required:!0,fieldType:A.TEXT,isHidden:!1,customUpperCode:"adminFirstname",defaultValue:(e==null?void 0:e.adminFirstname)||"",options:[],validateRules:[{INPUT_VALIDATION:"name"},{MIN_TEXT_LENGTH:1},{MAX_TEXT_LENGTH:255}],...m},{code:"adminLastname",name:"adminLastname",id:"adminLastname",label:o("adminLastname"),placeholder:i("adminLastname"),required:!0,fieldType:A.TEXT,isHidden:!1,customUpperCode:"adminLastname",defaultValue:(e==null?void 0:e.adminLastname)||"",options:[],validateRules:[{INPUT_VALIDATION:"name"},{MIN_TEXT_LENGTH:1},{MAX_TEXT_LENGTH:255}],...m},{code:"adminGender",name:"adminGender",id:"adminGender",label:o("adminGender"),placeholder:i("adminGender"),required:!1,fieldType:A.SELECT,isHidden:!1,customUpperCode:"adminGender",defaultValue:((T=e==null?void 0:e.adminGender)==null?void 0:T.toString())||"",options:[{value:"1",text:"Male",isDefault:!0},{value:"2",text:"Female",isDefault:!1},{value:"0",text:"Not Specified",isDefault:!1}],validateRules:[],...m}]},ge=a=>a.reduce((e,p)=>({...e,...p}),{}),ye=a=>/^[0-9]+$/.test(a),Ce=a=>/^[a-zA-Z0-9]+$/.test(a),fe=a=>/^[a-zA-Z0-9\s]+$/.test(a),Te=a=>/^[a-zA-Z]+$/.test(a),Ee=a=>/^[a-z0-9,!#$%&'*+/=?^_`{|}~-]+(\.[a-z0-9,!#$%&'*+/=?^_`{|}~-]+)*@([a-z0-9-]+\.)+[a-z]{2,}$/i.test(a),_e=a=>/(?:[\d\s+\-()]{1,20})/u.test(a),Ne=a=>/^(https?|ftp):\/\/[^\s/$.?#].[^\s]*$/i.test(a),ve=a=>/^[A-Z0-9\s-]{3,10}$/i.test(a),be=a=>/^(?:[\p{L}\p{M},\-_.'`&\s\d]){1,255}$/u.test(a),Ie=(a,e,p)=>{const n=a.length;return n>=e&&n<=p},Q=(a,e,p,n)=>{var r,C;const{requiredFieldError:h,lengthTextError:s,numericError:g,alphaNumWithSpacesError:o,alphaNumericError:i,alphaError:m,emailError:T,phoneError:f,postalCodeError:_,urlError:E,nameError:N}=p,v=e==null?void 0:e.customUpperCode,S={[v]:""};n[v]&&delete n[v];const l=(a==null?void 0:a.trim())||"";if(e!=null&&e.required&&(!l||l==="false"))return{[v]:h};if(!(e!=null&&e.required)&&!l||!((r=e==null?void 0:e.validateRules)!=null&&r.length))return S;const t=ge(e==null?void 0:e.validateRules),d=Number(t.MIN_TEXT_LENGTH)??1,c=Number(t.MAX_TEXT_LENGTH)??255;if(!Ie(l,d,c))return{[v]:s.replace("{min}",d.toString()).replace("{max}",c.toString())};const L={numeric:{validate:ye,error:g},"alphanum-with-spaces":{validate:fe,error:o},alphanumeric:{validate:Ce,error:i},alpha:{validate:Te,error:m},email:{validate:Ee,error:T},phone:{validate:_e,error:f},"postal-code":{validate:R=>ve(R),error:_},url:{validate:Ne,error:E},name:{validate:be,error:N}}[t.INPUT_VALIDATION];return L&&!L.validate(l)&&!((C=n[v])!=null&&C.length)?{[v]:L.error}:S},Ae=a=>({requiredFieldError:a.requiredFieldError,lengthTextError:a.lengthTextError,numericError:a.numericError,alphaNumWithSpacesError:a.alphaNumWithSpacesError,alphaNumericError:a.alphaNumericError,alphaError:a.alphaError,emailError:a.emailError,phoneError:a.phoneError,postalCodeError:a.postalCodeError,urlError:a.urlError,nameError:a.nameError}),Y=(a,e)=>({fieldsConfig:a,translations:Ae(e)}),Le=(a,e,p)=>{const{fieldsConfig:n,translations:h}=p,s=n.find(m=>m.code===a);if(!s)return"";const g=Array.isArray(e)?e.join(""):e.toString(),o={validateRules:s.validateRules||[],customUpperCode:s.customUpperCode,required:s.required};return Q(g,o,h,{})[s.customUpperCode]||""},Re=(a,e)=>{const{fieldsConfig:p,translations:n}=e,h=p[0],s=(h==null?void 0:h.isRequiredRegion)||!1,g=(h==null?void 0:h.isRequiredPostCode)||!1;let o=!1;const i={};Object.entries(a).forEach(([_,E])=>{const N=p.find(t=>t.code===_);if(!N)return;const v=Array.isArray(E)?E.join(""):E.toString(),S={validateRules:N.validateRules,customUpperCode:N.customUpperCode,required:N.required},l=Q(v,S,n,{});l[N.customUpperCode]&&(i[N.customUpperCode]=l[N.customUpperCode],o=!0)});const m=typeof a.regionId=="number"&&a.regionId>0,T=a.regionCode&&a.regionCode.toString().trim(),f=a.region&&a.region.toString().trim();return s&&!m&&!T&&!f&&(i.region=n.requiredFieldError,o=!0),g&&!a.postcode.toString().trim()&&(i.postcode=n.requiredFieldError,o=!0),{isValid:!o,fieldErrors:i}},K=(a,e,p,n)=>{const h=Y(p,n);return Le(a,e,h)},Se=(a,e,p)=>{const n=Y(e,p);return Re(a,n)},Fe=a=>{const{setFormData:e,hasRegions:p,regionOptions:n,fieldsConfig:h,formTranslations:s,setFieldErrors:g}=a,o=(l,t)=>{const d=K(l,t,h,s);g&&d?g(c=>({...c,[l]:d})):g&&g(c=>{const b={...c};return delete b[l],b})},i=l=>{e(t=>{const d=Array.isArray(t.street)?t.street:[t.street||"",""],c=Array.isArray(l)?l:[l,d[1]||""];return{...t,street:c}}),o("street",l)},m=l=>{e(t=>{const c=[(Array.isArray(t.street)?t.street:[t.street||"",""])[0]||"",l];return{...t,street:c}}),o("streetLine2",l)},T=l=>{e(t=>({...t,region:l,regionCode:"",regionId:void 0})),o("region",l)},f=l=>{e(t=>({...t,regionCode:l,...p?{}:{regionId:void 0}})),o("regionCode",l)},_=l=>{const t=typeof l=="string"?parseInt(l,10)||void 0:l;e(d=>{const c={...d,regionId:t};if(t&&n.length>0){const b=n.find(L=>L.id===t||L.value===(t==null?void 0:t.toString()));b&&b.code&&(c.regionCode=b.code)}return c}),o("regionId",l)},E=l=>{e(t=>({...t,countryCode:l,regionCode:"",regionId:void 0,region:""})),o("countryCode",l),g&&g(t=>{const d={...t};return delete d.region,delete d.regionCode,delete d.regionId,d})},N=(l,t)=>{e(d=>({...d,[l]:t})),o(l,t)};return{handleInputChange:l=>{const t=l.target;if(!t)return;const{name:d,value:c}=t;switch(d){case"street":i(c);break;case"streetLine2":m(c);break;case"region":p?_(c):T(c);break;case"regionCode":f(c);break;case"countryCode":E(c);break;default:N(d,c);break}},handleInputChangeFromValues:l=>{Object.entries(l).forEach(([t,d])=>{switch(t){case"street":i(d);break;case"streetLine2":m(d);break;case"region":T(d);break;case"regionCode":f(d);break;case"regionId":_(d);break;case"countryCode":E(d);break;default:N(t,d);break}})},handleStreetChange:i,handleStreetLine2Change:m,handleRegionTextChange:T,handleRegionCodeChange:f,handleRegionDropdownChange:_,handleCountryChange:E,handleGenericFieldChange:N}},xe=({onSuccess:a,onError:e})=>{const[p,n]=$(!1),[h,s]=$({}),[g,o]=$("US"),[i,m]=$(!0),{countryOptions:T,regionOptions:f,isRequiredRegion:_,isRequiredPostCode:E,hasRegions:N,loadingCountries:v,disableField:S,handleInputChange:l}=pe({defaultCountry:g,formName:"companyRegistration"}),[t,d]=$({countryCode:g,region:"",regionCode:"",regionId:"",street:["",""]});H(()=>{(async()=>{try{m(!0);const q=(await se()).defaultCountry||"US";o(q),d(w=>({...w,countryCode:q}))}catch(I){console.error("Failed to load store config:",I)}finally{m(!1)}})()},[]),H(()=>{g&&!i&&l("countryCode",g)},[g,l,i]);const c=W({requiredFieldError:"Company.shared.validation.required",lengthTextError:"Company.FormText.lengthTextError",numericError:"Company.FormText.numericError",alphaNumWithSpacesError:"Company.FormText.alphaNumWithSpacesError",alphaNumericError:"Company.FormText.alphaNumericError",alphaError:"Company.FormText.alphaError",emailError:"Company.shared.validation.invalidEmail",phoneError:"Company.shared.validation.phoneInvalid",postalCodeError:"Company.shared.validation.postalCodeInvalid",urlError:"Company.FormText.urlError",nameError:"Company.FormText.nameError"}),b=W({title:"Company.shared.fields.title",submitButton:"Company.shared.fields.submit",submittingButton:"Company.shared.fields.submitting",cancelButton:"Company.shared.buttons.cancel",createCompanyError:"Company.shared.fields.createCompanyError",unexpectedError:"Company.shared.fields.unexpectedError",emailNotAvailable:"Company.shared.validation.emailNotAvailable",companyName:"Company.shared.fields.companyName",legalName:"Company.shared.fields.legalName",companyEmail:"Company.shared.fields.companyEmail",vatTaxId:"Company.shared.fields.vatTaxId",resellerId:"Company.shared.fields.resellerId",street:"Company.shared.fields.street",streetLine2:"Company.shared.fields.streetLine2",city:"Company.shared.fields.city",country:"Company.shared.fields.country",stateProvince:"Company.shared.fields.stateProvince",postalCode:"Company.shared.fields.postalCode",telephone:"Company.shared.fields.telephone",adminJobTitle:"Company.shared.fields.adminJobTitle",adminWorkTelephone:"Company.shared.fields.adminWorkTelephone",adminEmail:"Company.shared.fields.adminEmail",adminFirstname:"Company.shared.fields.adminFirstname",adminLastname:"Company.shared.fields.adminLastname",adminGender:"Company.shared.fields.adminGender"}),L=M(()=>he({formData:{countryCode:t.countryCode,regionCode:t.regionCode,regionId:t.regionId},isRequiredRegion:_,isRequiredPostCode:E,hasRegions:N,disableField:S,translations:b}).map(I=>I.code==="region"?{...I,required:_,disabled:v,fieldType:N?"SELECT":"TEXT",options:N?f.map(q=>({text:q.text,value:q.value,isDefault:!1})):[]}:I.code==="postcode"?{...I,required:!0}:I.code==="countryCode"?{...I,disabled:S||v,options:T.map(q=>({text:q.text,value:q.value,isDefault:!1}))}:I),[_,E,N,v,S,T,f,t.countryCode,t.regionCode,t.regionId,b]),r=x=>{const I=Se(x,L,c);return s(I.fieldErrors),I.isValid},C=M(()=>Fe({setFormData:d,hasRegions:N,regionOptions:f,fieldsConfig:L,formTranslations:c,setFieldErrors:s}),[N,f,L,c]);return{formValues:t,fieldErrors:h,isSubmitting:p,loadingStoreConfig:i,fieldsConfig:L,countryOptions:T,regionOptions:f,loadingCountries:v,handleInputChange:x=>{C.handleInputChangeFromValues(x),Object.entries(x).forEach(([I,q])=>{I==="countryCode"&&l("countryCode",q)})},handleBlur:x=>{const I=x.target,{name:q,value:w}=I,P=L.find(X=>X.customUpperCode===q);if(P){const X=K(P.code,w,L,c);s(O=>({...O,[q]:X||""}))}},handleFormSubmit:async(x,I)=>{const q=x.target,w=new FormData(q),P={};for(const[G,U]of w.entries())P[G]=U;const X={...P,...t},O=r(X);if(!(!I||!O)){n(!0);try{const G=await le(X.companyEmail);if(!G.isValid){s(j=>({...j,companyEmail:G.error||b.emailNotAvailable})),n(!1);return}const U=await ie(X);if(U.success&&U.company)a==null||a(U.company);else{const j=U.errors||[b.createCompanyError];e==null||e(j)}}catch(G){const U=G instanceof Error?G.message:b.unexpectedError;e==null||e([U])}finally{n(!1)}}},translations:b,formTranslations:c}},qe=({onSuccess:a,onError:e,className:p="",slots:n,hideActionFormButtons:h=!1})=>{const{formValues:s,fieldErrors:g,isSubmitting:o,loadingStoreConfig:i,fieldsConfig:m,countryOptions:T,regionOptions:f,loadingCountries:_,handleInputChange:E,handleBlur:N,handleFormSubmit:v,translations:S}=xe({onSuccess:a,onError:e}),l=i||_;return y("div",{className:k(["company-form-wrapper",p]),children:[u("h2",{children:S.title}),u(ue,{regionOptions:f,countryOptions:T,slots:n,className:"company-registration-form",name:"companyRegistrationForm",fieldsConfig:m,values:s,errors:g,onChange:E,onBlur:N,onSubmit:v,loading:l,submitting:o,children:!h&&u("div",{className:k(["company-form-wrapper__buttons"]),children:u(ne,{type:"submit",disabled:o||l,className:"company-form-wrapper__submit",children:S.submitButton})})})]})},Ve=({company:a})=>{var h;const[e,p]=$(""),n=W({pendingApproval:"Company.CompanyRegistration.success.pendingApproval",companyDetails:"Company.CompanyRegistration.success.companyDetails",companyName:"Company.shared.fields.companyName",companyEmail:"Company.shared.fields.companyEmail",legalName:"Company.shared.fields.legalName",vatTaxId:"Company.shared.fields.vatTaxId",resellerId:"Company.shared.fields.resellerId",address:"Company.shared.fields.legalAddress",street:"Company.shared.fields.street",city:"Company.shared.fields.city",stateProvince:"Company.shared.fields.stateProvince",postcode:"Company.shared.fields.postcode",country:"Company.shared.fields.country",telephone:"Company.shared.fields.telephone",companyAdmin:"Company.shared.fields.companyAdmin",adminFirstname:"Company.shared.fields.adminFirstname",adminLastname:"Company.shared.fields.adminLastname",adminEmail:"Company.shared.fields.adminEmail",adminJobTitle:"Company.shared.fields.adminJobTitle",adminWorkTelephone:"Company.shared.fields.adminWorkTelephone"});return H(()=>{(async()=>{var g;if((g=a.legalAddress)!=null&&g.countryCode)try{const{availableCountries:o}=await Z(),i=o.find(m=>{var T;return m.value===((T=a.legalAddress)==null?void 0:T.countryCode)});i&&p(i.text)}catch(o){console.error("Failed to fetch countries:",o),p(a.legalAddress.countryCode)}})()},[(h=a.legalAddress)==null?void 0:h.countryCode]),y("div",{className:"company-registration-success",children:[u("div",{className:"company-registration-success__header",children:u("p",{className:"company-registration-success__pending",children:n.pendingApproval})}),y("div",{className:"company-registration-success__details",children:[u("h2",{className:"company-registration-success__details-title",children:n.companyDetails}),y("div",{className:"company-registration-success__grid",children:[y("div",{className:"company-registration-success__item",children:[y("span",{className:"company-registration-success__label",children:[n.companyName,":"]}),u("span",{className:"company-registration-success__value",children:a.name})]}),a.legalName&&y("div",{className:"company-registration-success__item",children:[y("span",{className:"company-registration-success__label",children:[n.legalName,":"]}),u("span",{className:"company-registration-success__value",children:a.legalName})]}),y("div",{className:"company-registration-success__item",children:[y("span",{className:"company-registration-success__label",children:[n.companyEmail,":"]}),u("span",{className:"company-registration-success__value",children:a.email})]}),a.vatTaxId&&y("div",{className:"company-registration-success__item",children:[y("span",{className:"company-registration-success__label",children:[n.vatTaxId,":"]}),u("span",{className:"company-registration-success__value",children:a.vatTaxId})]}),a.resellerId&&y("div",{className:"company-registration-success__item",children:[y("span",{className:"company-registration-success__label",children:[n.resellerId,":"]}),u("span",{className:"company-registration-success__value",children:a.resellerId})]}),a.legalAddress&&y(J,{children:[u("div",{className:"company-registration-success__section-header",children:u("h3",{children:n.address})}),a.legalAddress.street&&a.legalAddress.street[0]&&y("div",{className:"company-registration-success__item",children:[y("span",{className:"company-registration-success__label",children:[n.street,":"]}),u("span",{className:"company-registration-success__value",children:a.legalAddress.street.map((s,g)=>u("div",{children:s},g))})]}),a.legalAddress.city&&y("div",{className:"company-registration-success__item",children:[y("span",{className:"company-registration-success__label",children:[n.city,":"]}),u("span",{className:"company-registration-success__value",children:a.legalAddress.city})]}),a.legalAddress.countryCode&&y("div",{className:"company-registration-success__item",children:[y("span",{className:"company-registration-success__label",children:[n.country,":"]}),u("span",{className:"company-registration-success__value",children:e||a.legalAddress.countryCode})]}),a.legalAddress.region&&y("div",{className:"company-registration-success__item",children:[y("span",{className:"company-registration-success__label",children:[n.stateProvince,":"]}),u("span",{className:"company-registration-success__value",children:a.legalAddress.region.region||a.legalAddress.region.regionCode})]}),a.legalAddress.postcode&&y("div",{className:"company-registration-success__item",children:[y("span",{className:"company-registration-success__label",children:[n.postcode,":"]}),u("span",{className:"company-registration-success__value",children:a.legalAddress.postcode})]}),a.legalAddress.telephone&&y("div",{className:"company-registration-success__item",children:[y("span",{className:"company-registration-success__label",children:[n.telephone,":"]}),u("span",{className:"company-registration-success__value",children:a.legalAddress.telephone})]})]}),a.companyAdmin&&y(J,{children:[u("div",{className:"company-registration-success__section-header",children:u("h3",{children:n.companyAdmin})}),a.companyAdmin.jobTitle&&y("div",{className:"company-registration-success__item",children:[y("span",{className:"company-registration-success__label",children:[n.adminJobTitle,":"]}),u("span",{className:"company-registration-success__value",children:a.companyAdmin.jobTitle})]}),a.companyAdmin.telephone&&y("div",{className:"company-registration-success__item",children:[y("span",{className:"company-registration-success__label",children:[n.adminWorkTelephone,":"]}),u("span",{className:"company-registration-success__value",children:a.companyAdmin.telephone})]}),y("div",{className:"company-registration-success__item",children:[y("span",{className:"company-registration-success__label",children:[n.adminEmail,":"]}),u("span",{className:"company-registration-success__value",children:a.companyAdmin.email})]})]})]})]})]})},Ze=({isAuthenticated:a=!1,onRedirectLogin:e,onRedirectAccount:p,onSuccess:n,onError:h,className:s,slots:g})=>{const[o,i]=$("loading"),[m,T]=$(null);H(()=>{let E=!0;return(async()=>{try{if(!await de()){if(E){const v=a?"redirect-account":"redirect-login";console.log(`Company registration disabled - redirecting to ${a?"account dashboard":"login page"}`),i(v)}return}if(a)try{if(await ce()){E&&(console.log("User already belongs to a company - redirecting to account dashboard"),i("redirect-account"));return}}catch(v){console.error("Error checking company membership - redirecting to account dashboard:",v),E&&i("redirect-account");return}E&&i("show-form")}catch(N){console.error("Error checking B2B status:",N),E&&i(a?"redirect-account":"redirect-login")}})(),()=>{E=!1}},[a]),H(()=>{o==="redirect-login"&&e&&e(),o==="redirect-account"&&p&&p()},[o,e,p]);const f=E=>{i("success"),T(E),n==null||n(E)},_=E=>{h==null||h(E)};return o==="loading"||o==="redirect-login"||o==="redirect-account"?null:o==="success"&&m?u("div",{className:`company-registration-container ${s||""}`,children:u(Ve,{company:m})}):u("div",{className:`company-registration-container ${s||""}`,children:u(qe,{onSuccess:f,onError:_,slots:g})})};export{Ze as CompanyRegistration,Ze as default};
//# sourceMappingURL=CompanyRegistration.js.map
