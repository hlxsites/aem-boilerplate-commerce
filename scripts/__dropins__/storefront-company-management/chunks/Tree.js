/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as O,jsxs as re}from"@dropins/tools/preact-jsx-runtime.js";import{useMemo as X,useRef as Y,useCallback as g}from"@dropins/tools/preact-hooks.js";import{Checkbox as se}from"@dropins/tools/components.js";const ce=(k,S=!1)=>{const x=new Map;for(const h of k){const w=h.parentId??null,u=x.get(w)??[];u.push(h),x.set(w,u)}if(!S)for(const[,h]of x)h.sort((w,u)=>w.label.localeCompare(u.label));return x},ie=({items:k,rootId:S=null,className:x,expandedIds:h,selectedId:w=null,selectedIds:u,onExpandedChange:$,onSelectedChange:D,onSelectedIdsChange:_,renderNode:Z,role:E="tree",preserveOrder:q=!1,draggable:j,canDrop:v,onMove:F,isCheckable:M,checkedIds:P,onCheckedChange:b,biDirectionalChecking:R=!1,renderExpander:A,renderCheckbox:I,renderIcon:B})=>{const T=X(()=>ce(k,q),[k,q]),N=Y(null),K=Y(!1),d=X(()=>new Map(k.map(e=>[e.id,e])),[k]),C=(e,n)=>{const a=[],o=[n];for(;o.length;){const t=o.pop(),s=e.get(t)??[];for(const r of s)a.push(r.id),o.push(r.id)}return a},y=g(e=>C(T,e),[T]),f=g(e=>M?M(e):!0,[M]),z=g(e=>{if(!d.get(e))return{checked:!1,indeterminate:!1};const a=P??new Set;if(R){if(a.has(e))return{checked:!0,indeterminate:!1};const s=y(e).filter(l=>{const p=d.get(l);return p?f(p):!1});return s.length===0?{checked:!1,indeterminate:!1}:s.reduce((l,p)=>a.has(p)?l+1:l,0)===0?{checked:!1,indeterminate:!1}:{checked:!1,indeterminate:!0}}const o=[e,...y(e)].filter(s=>{const r=d.get(s);return r?f(r):!1});if(o.length===0)return{checked:!1,indeterminate:!1};const t=o.reduce((s,r)=>a.has(r)?s+1:s,0);return t===0?{checked:!1,indeterminate:!1}:t===o.length?{checked:!0,indeterminate:!1}:{checked:!1,indeterminate:!0}},[d,y,f,P,R]),H=g(e=>{if(!b)return;const n=new Set(P??[]),{checked:a}=z(e),o=y(e),t=[e,...o].filter(s=>{const r=d.get(s);return r?f(r):!1});if(a)for(const s of t)n.delete(s);else for(const s of t)n.add(s);if(R&&!a){const s=d.get(e);if(s){let r=s.parentId;for(;r;){const l=d.get(r);if(!l||!f(l))break;n.add(r),r=l.parentId}}}b(n)},[P,b,z,y,d,f,R]),ee=g(e=>O(se,{name:`tree-checkbox-${Math.random().toString(36).substr(2,9)}`,checked:e.checked,indeterminate:e.indeterminate,onChange:e.onCheck}),[]),G=g(e=>{const n=new Set(h);n.has(e)?n.delete(e):n.add(e),$(n)},[h,$]),te=g(e=>{const n=d.get(e);if(n&&f(n)&&b&&H(e),!_){D==null||D(e);return}const a=!!K.current,o=a?new Set(u??[]):new Set;a&&o.has(e)?o.delete(e):o.add(e),_(o),K.current=!1},[D,_,u,d,f,b,H]),J=(e,n)=>{const a=T.get(e)??[];return a.length?O("ul",{role:n===1?E:"group",className:n===1?x??"acm-tree":"acm-tree__group",children:a.map((t,s)=>{const r=(T.get(t.id)??[]).length>0,l=h.has(t.id),p=u?u.has(t.id):w===t.id,L=!!(j!=null&&j(t)),Q=c=>v?v(c,t.id):c!==t.id,U=r?()=>A?A({expanded:l,hasChildren:r,toggle:()=>G(t.id)}):null:void 0,V=(()=>{if(!b)return;const c=d.get(t.id);if(!c||!f(c))return;const i=z(t.id),m=I||ee;return()=>m({checked:i.checked,indeterminate:i.indeterminate,onCheck:()=>H(t.id)})})(),W=B?()=>B({item:t,level:n,hasChildren:r,expanded:l}):void 0,ne=Z({item:t,level:n,expanded:l,selected:!!p,hasChildren:r,toggle:()=>G(t.id),select:()=>te(t.id),...U?{expander:U}:{},...V?{checkbox:V}:{},...W?{icon:W}:{}});return re("li",{role:"treeitem",className:"acm-tree__item","data-level":n,"aria-expanded":r?l:void 0,"aria-selected":p||void 0,"aria-level":n,"aria-setsize":a.length,"aria-posinset":s+1,draggable:L,onMouseDown:c=>{K.current=!!(c.metaKey||c.ctrlKey)},onDragStart:c=>{var i;if(c.stopPropagation(),!!L){N.current=t.id;try{(i=c.dataTransfer)==null||i.setData("text/plain",t.id)}catch{}}},onDragOver:c=>{var m;c.stopPropagation();const i=N.current??(((m=c.dataTransfer)==null?void 0:m.getData("text/plain"))||"");i&&Q(i)&&c.preventDefault()},onDrop:c=>{var m;c.stopPropagation();const i=N.current??(((m=c.dataTransfer)==null?void 0:m.getData("text/plain"))||"");N.current=null,i&&Q(i)&&(F==null||F({id:i,newParentId:t.id}))},children:[ne,r&&l?J(t.id,n+1):null]},t.id)})}):null};return O("div",{className:"acm-tree-root",children:J(S,1)})};export{ie as T};
//# sourceMappingURL=Tree.js.map
