/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as $,jsxs as re}from"@dropins/tools/preact-jsx-runtime.js";import{useMemo as W,useRef as X,useCallback as g}from"@dropins/tools/preact-hooks.js";import{Checkbox as se}from"@dropins/tools/components.js";const ae=(k,_=!1)=>{const x=new Map;for(const h of k){const w=h.parentId??null,f=x.get(w)??[];f.push(h),x.set(w,f)}if(!_)for(const[,h]of x)h.sort((w,f)=>w.label.localeCompare(f.label));return x},ie=({items:k,rootId:_=null,className:x,expandedIds:h,selectedId:w=null,selectedIds:f,onExpandedChange:q,onSelectedChange:R,onSelectedIdsChange:j,renderNode:Y,role:Z="tree",preserveOrder:v=!1,draggable:C,canDrop:A,onMove:F,isCheckable:M,checkedIds:T,onCheckedChange:b,biDirectionalChecking:N=!1,renderExpander:B,renderCheckbox:E,renderIcon:G})=>{const y=W(()=>ae(k,v),[k,v]),S=X(null),K=X(!1),d=W(()=>new Map(k.map(e=>[e.id,e])),[k]),I=(e,n)=>{const c=[],o=[n];for(;o.length;){const t=o.pop(),s=e.get(t)??[];for(const r of s)c.push(r.id),o.push(r.id)}return c},D=g(e=>I(y,e),[y]),u=g(e=>M?M(e):!0,[M]),z=g(e=>{if(!d.get(e))return{checked:!1,indeterminate:!1};const c=T??new Set;if(N){if(c.has(e))return{checked:!0,indeterminate:!1};const s=D(e).filter(l=>{const p=d.get(l);return p?u(p):!1});return s.length===0?{checked:!1,indeterminate:!1}:s.reduce((l,p)=>c.has(p)?l+1:l,0)===0?{checked:!1,indeterminate:!1}:{checked:!1,indeterminate:!0}}const o=[e,...D(e)].filter(s=>{const r=d.get(s);return r?u(r):!1});if(o.length===0)return{checked:!1,indeterminate:!1};const t=o.reduce((s,r)=>c.has(r)?s+1:s,0);return t===0?{checked:!1,indeterminate:!1}:t===o.length?{checked:!0,indeterminate:!1}:{checked:!1,indeterminate:!0}},[d,D,u,T,N]),H=g(e=>{if(!b)return;const n=new Set(T??[]),{checked:c}=z(e),o=D(e),t=[e,...o].filter(s=>{const r=d.get(s);return r?u(r):!1});if(c)for(const s of t)n.delete(s);else for(const s of t)n.add(s);if(N){const s=d.get(e);if(s){let r=s.parentId;for(;r;){const l=d.get(r);if(!l||!u(l))break;c?(y.get(r)??[]).some(P=>u(P)&&n.has(P.id))||n.delete(r):n.add(r),r=l.parentId}}}b(n)},[T,b,z,D,d,y,u,N]),ee=g(e=>$(se,{name:`tree-checkbox-${Math.random().toString(36).substr(2,9)}`,checked:e.checked,indeterminate:e.indeterminate,onChange:e.onCheck}),[]),J=g(e=>{const n=new Set(h);n.has(e)?n.delete(e):n.add(e),q(n)},[h,q]),te=g(e=>{const n=d.get(e);if(n&&u(n)&&b&&H(e),!j){R==null||R(e);return}const c=!!K.current,o=c?new Set(f??[]):new Set;c&&o.has(e)?o.delete(e):o.add(e),j(o),K.current=!1},[R,j,f,d,u,b,H]),L=(e,n)=>{const c=y.get(e)??[];return c.length?$("ul",{role:n===1?Z:"group",className:n===1?x??"acm-tree":"acm-tree__group",children:c.map((t,s)=>{const r=(y.get(t.id)??[]).length>0,l=h.has(t.id),p=f?f.has(t.id):w===t.id,O=!!(C!=null&&C(t)),P=a=>A?A(a,t.id):a!==t.id,Q=r?()=>B?B({expanded:l,hasChildren:r,toggle:()=>J(t.id)}):null:void 0,U=(()=>{if(!b)return;const a=d.get(t.id);if(!a||!u(a))return;const i=z(t.id),m=E||ee;return()=>m({checked:i.checked,indeterminate:i.indeterminate,onCheck:()=>H(t.id)})})(),V=G?()=>G({item:t,level:n,hasChildren:r,expanded:l}):void 0,ne=Y({item:t,level:n,expanded:l,selected:!!p,hasChildren:r,toggle:()=>J(t.id),select:()=>te(t.id),...Q?{expander:Q}:{},...U?{checkbox:U}:{},...V?{icon:V}:{}});return re("li",{role:"treeitem",className:"acm-tree__item","data-level":n,"aria-expanded":r?l:void 0,"aria-selected":p||void 0,"aria-level":n,"aria-setsize":c.length,"aria-posinset":s+1,draggable:O,onMouseDown:a=>{K.current=!!(a.metaKey||a.ctrlKey)},onDragStart:a=>{var i;if(a.stopPropagation(),!!O){S.current=t.id;try{(i=a.dataTransfer)==null||i.setData("text/plain",t.id)}catch{}}},onDragOver:a=>{var m;a.stopPropagation();const i=S.current??(((m=a.dataTransfer)==null?void 0:m.getData("text/plain"))||"");i&&P(i)&&a.preventDefault()},onDrop:a=>{var m;a.stopPropagation();const i=S.current??(((m=a.dataTransfer)==null?void 0:m.getData("text/plain"))||"");S.current=null,i&&P(i)&&(F==null||F({id:i,newParentId:t.id}))},children:[ne,r&&l?L(t.id,n+1):null]},t.id)})}):null};return $("div",{className:"acm-tree-root",children:L(_,1)})};export{ie as T};
//# sourceMappingURL=Tree.js.map
