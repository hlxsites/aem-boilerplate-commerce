/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as r,jsxs as g}from"@dropins/tools/preact-jsx-runtime.js";import{Fragment as A}from"@dropins/tools/preact.js";import{classes as D,VComponent as k}from"@dropins/tools/lib.js";import{Button as P,Icon as R,Skeleton as $,SkeletonRow as C}from"@dropins/tools/components.js";import{useText as x}from"@dropins/tools/i18n.js";import{useState as B,useRef as w,useCallback as E,useEffect as U}from"@dropins/tools/preact-hooks.js";import{b as j}from"./company-permissions.js";import{f as z}from"./fetchUserPermissions.js";const M=({className:h,children:N,columns:l=[],rowData:_=[],mobileLayout:y="none",caption:i,expandedRows:o=new Set,loading:b=!1,skeletonRowCount:n=10,onSortChange:d,...p})=>{const s=x({sortedAscending:"Dropin.Table.sortedAscending",sortedDescending:"Dropin.Table.sortedDescending",sortBy:"Dropin.Table.sortBy"}),m=e=>{if(!d)return;let t;e.sortBy===!0?t="asc":e.sortBy==="asc"?t="desc":t=!0,d(e.key,t)},u=e=>{if(e.sortBy===void 0)return null;let t,a;return e.sortBy==="asc"?(t="ChevronUp",a=s.sortedAscending.replace("{label}",e.label)):e.sortBy==="desc"?(t="ChevronDown",a=s.sortedDescending.replace("{label}",e.label)):(t="Sort",a=s.sortBy.replace("{label}",e.label)),r(P,{variant:"tertiary",size:"medium",className:"dropin-table__header__sort-button",icon:r(R,{source:t}),"aria-label":a,onClick:()=>m(e)})},S=()=>Array.from({length:n},(e,t)=>r("tr",{className:"dropin-table__body__row",children:l.map(a=>r("td",{className:"dropin-table__body__cell","data-label":a.label,children:r($,{children:r(C,{variant:"row",size:"small",fullWidth:!0})})},a.key))},`skeleton-${t}`)),v=()=>_.map((e,t)=>{const a=e._rowDetails!==void 0,T=o.has(t);return g(A,{children:[r("tr",{className:"dropin-table__body__row",children:l.map(c=>{const f=e[c.key];return typeof f=="string"||typeof f=="number"?r("td",{className:"dropin-table__body__cell","data-label":c.label,children:f},c.key):r("td",{className:"dropin-table__body__cell","data-label":c.label,children:r(k,{node:f})},c.key)})}),a&&T&&r("tr",{className:"dropin-table__row-details dropin-table__row-details--expanded",id:`row-${t}-details`,children:r("td",{className:"dropin-table__row-details__cell",colSpan:l.length,role:"region","aria-labelledby":`row-${t}-details`,children:typeof e._rowDetails=="string"?e._rowDetails:r(k,{node:e._rowDetails})})},`${t}-details`)]},t)}),F=e=>{if(e.sortBy===!0)return"none";if(e.sortBy==="asc")return"ascending";if(e.sortBy==="desc")return"descending"};return r("div",{className:D(["dropin-table",`dropin-table--mobile-layout-${y}`,h]),children:g("table",{...p,className:"dropin-table__table",children:[i&&r("caption",{className:"dropin-table__caption",children:i}),r("thead",{className:"dropin-table__header",children:r("tr",{className:"dropin-table__header__row",children:l.map(e=>g("th",{className:D(["dropin-table__header__cell",["dropin-table__header__cell--sorted",e.sortBy==="asc"||e.sortBy==="desc"],["dropin-table__header__cell--sortable",e.sortBy!==void 0]]),"aria-sort":F(e),children:[e.label,u(e)]},e.key))})}),r("tbody",{className:"dropin-table__body",children:b?S():v()})]})})},O=()=>{const[h,N]=B(null),[l,_]=B(!0),[y,i]=B(null),o=w(!1),b=w(!1),n=E(async()=>{var d,p;if(!o.current){o.current=!0,_(!0),i(null);try{const{roleResponse:s}=await z(),m=(p=(d=s==null?void 0:s.data)==null?void 0:d.customer)==null?void 0:p.role,u=j(m);N(u)}catch(s){console.error("Failed to fetch user permissions:",s),i(s)}finally{_(!1),o.current=!1}}},[]);return U(()=>{b.current||(b.current=!0,n())},[n]),{permissions:h,loading:l,error:y,refetch:n}};export{M as T,O as u};
//# sourceMappingURL=useUserPermissions.js.map
