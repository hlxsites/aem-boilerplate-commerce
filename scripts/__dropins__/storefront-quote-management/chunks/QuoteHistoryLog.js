/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsxs as n,jsx as l}from"@dropins/tools/preact-jsx-runtime.js";import{useState as $,useEffect as D}from"@dropins/tools/preact-compat.js";import{events as U}from"@dropins/tools/event-bus.js";import{getGlobalLocale as Q,classes as q}from"@dropins/tools/lib.js";/* empty css                */import{useText as P}from"@dropins/tools/i18n.js";function f(s,p){return p.format(new Date(s))}function I(){try{return Intl.DateTimeFormat().resolvedOptions().timeZone}catch(s){return console.warn("Failed to detect user timezone, falling back to UTC:",s),"UTC"}}const k=({className:s,children:p,quoteData:o,...v})=>{const c=Q()||"en-US",t=P({quoteCreated:"historyLog.changeTypes.created",quoteUpdated:"historyLog.changeTypes.updated",statusChanged:"historyLog.changeTypes.statusChanged",commentAdded:"historyLog.changeTypes.commentAdded",expirationChanged:"historyLog.changeTypes.expirationChanged",buyerNoteAdded:"historyLog.noteTypes.buyerNoteAdded",sellerNoteAdded:"historyLog.noteTypes.sellerNoteAdded",buyerLabel:"historyLog.authorLabels.buyer",sellerLabel:"historyLog.authorLabels.seller",commentDetail:"historyLog.changeDetails.comment",statusChangedFromTo:"historyLog.changeDetails.statusChangedFromTo",statusSetTo:"historyLog.changeDetails.statusSetTo",expirationChangedFromTo:"historyLog.changeDetails.expirationChangedFromTo",expirationSetTo:"historyLog.changeDetails.expirationSetTo",totalChangedFromTo:"historyLog.changeDetails.totalChangedFromTo",customChange:"historyLog.changeDetails.customChange",productsRemovedFromCatalog:"historyLog.changeDetails.productsRemovedFromCatalog",productsRemovedFromQuote:"historyLog.changeDetails.productsRemovedFromQuote",noDetailsAvailable:"historyLog.changeDetails.noDetailsAvailable",emptyState:"historyLog.emptyState",never:"dateUtils.never"}),h=new Intl.DateTimeFormat(c,{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",timeZone:I()}),x=e=>{switch(e){case"CREATED":return t.quoteCreated;case"UPDATED":return t.quoteUpdated;case"STATUS_CHANGED":return t.statusChanged;case"COMMENT_ADDED":return t.commentAdded;case"EXPIRATION_CHANGED":return t.expirationChanged;default:return e.replace(/_/g," ").toLowerCase().replace(/\b\w/g,r=>r.toUpperCase())}},S=e=>{var a,u,T,y,m,C,L,N,F,_,b,w;const r=[];if((a=e==null?void 0:e.commentAdded)!=null&&a.comment&&r.push(t.commentDetail.replace("{comment}",e.commentAdded.comment)),(u=e==null?void 0:e.statuses)!=null&&u.changes&&e.statuses.changes.forEach(i=>{i.oldStatus&&i.newStatus?r.push(t.statusChangedFromTo.replace("{oldStatus}",i.oldStatus).replace("{newStatus}",i.newStatus)):i.newStatus&&r.push(t.statusSetTo.replace("{newStatus}",i.newStatus))}),(T=e==null?void 0:e.expiration)!=null&&T.newExpiration&&((y=e==null?void 0:e.expiration)!=null&&y.oldExpiration)){const i=f(e.expiration.newExpiration,h),d=f(e.expiration.oldExpiration,h);r.push(t.expirationChangedFromTo.replace("{oldExpiration}",d).replace("{newExpiration}",i))}else if((m=e==null?void 0:e.expiration)!=null&&m.newExpiration){const i=f(e.expiration.newExpiration,h);r.push(t.expirationSetTo.replace("{newExpiration}",i))}if((C=e==null?void 0:e.total)!=null&&C.newPrice&&((L=e==null?void 0:e.total)!=null&&L.oldPrice)){const i=`${e.total.newPrice.currency} ${e.total.newPrice.value}`,d=`${e.total.oldPrice.currency} ${e.total.oldPrice.value}`;r.push(t.totalChangedFromTo.replace("{oldTotal}",d).replace("{newTotal}",i))}if((N=e==null?void 0:e.customChanges)!=null&&N.title&&((F=e==null?void 0:e.customChanges)!=null&&F.old_value)&&((_=e==null?void 0:e.customChanges)!=null&&_.new_value)&&r.push(t.customChange.replace("{title}",e.customChanges.title).replace("{oldValue}",e.customChanges.old_value).replace("{newValue}",e.customChanges.new_value)),(b=e==null?void 0:e.productsRemoved)!=null&&b.productsRemovedFromCatalog&&e.productsRemoved.productsRemovedFromCatalog.length>0&&r.push(t.productsRemovedFromCatalog.replace("{products}",e.productsRemoved.productsRemovedFromCatalog.join(", "))),(w=e==null?void 0:e.productsRemoved)!=null&&w.productsRemovedFromQuote&&e.productsRemoved.productsRemovedFromQuote.length>0){const i=e.productsRemoved.productsRemovedFromQuote.map(d=>d.name||d.sku||d.uid).join(", ");r.push(t.productsRemovedFromQuote.replace("{products}",i))}return r.length>0?r:[t.noDetailsAvailable]},E=(()=>{const e=[],r=(a,u,T,y)=>{a&&Array.isArray(a)&&a.forEach(m=>{m&&m.note&&m.note.trim()&&e.push({...m,type:u,productName:y.product.name,productSku:y.product.sku,authorName:T})})};return o!=null&&o.items&&o.items.forEach(a=>{r(a.noteFromBuyer,"buyer",`${o.buyer.firstname} ${o.buyer.lastname} ${t.buyerLabel}`,a),r(a.noteFromSeller,"seller",`${o.salesRepName} ${t.sellerLabel}`,a)}),e})(),A=((o==null?void 0:o.history)||[]).map(e=>({...e,entryType:"history"})),R=E.map(e=>({...e,entryType:"note"})),g=[...A,...R];return n("div",{...v,className:q(["quote-management-quote-history-log",s]),children:[g.length>0?l("div",{className:"quote-management-quote-history-log__entries",children:g.map((e,r)=>n("div",{className:"quote-management-quote-history-log__entry",children:[n("div",{className:"quote-management-quote-history-log__entry-header",children:[n("div",{className:"quote-management-quote-history-log__entry-meta",children:[l("span",{className:"quote-management-quote-history-log__entry-date",children:h.format(new Date(e.createdAt))}),l("span",{className:"quote-management-quote-history-log__entry-author",children:e.entryType==="history"?`by ${e.author.firstname} ${e.author.lastname} ${e.author.firstname===(o==null?void 0:o.buyer.firstname)&&e.author.lastname===(o==null?void 0:o.buyer.lastname)?t.buyerLabel:t.sellerLabel}`:`by ${e.authorName}`})]}),l("div",{className:"quote-management-quote-history-log__entry-type",children:e.entryType==="history"?x(e.changeType):e.type==="buyer"?t.buyerNoteAdded:t.sellerNoteAdded})]}),l("div",{className:"quote-management-quote-history-log__entry-changes",children:e.entryType==="history"?S(e.changes).map((a,u)=>l("div",{className:"quote-management-quote-history-log__entry-change",children:a},u)):n("div",{className:"quote-management-quote-history-log__entry-change",children:[n("div",{children:[e.productName,"(",e.productSku,")"]}),n("div",{children:['"',e.note,'"']})]})})]},e.entryType==="history"?e.uid:`${e.noteUid}-${r}`))}):l("div",{className:"quote-management-quote-history-log__empty",children:t.emptyState}),p]})},Z=({quoteData:s,...p})=>{const[o,v]=$(s);return D(()=>{const c=U.on("quote-management/quote-data",t=>{v(t.quote)},{eager:!0});return()=>c==null?void 0:c.off()},[]),o?l("div",{...p,children:l(k,{quoteData:o})}):null};export{Z as Q};
//# sourceMappingURL=QuoteHistoryLog.js.map
