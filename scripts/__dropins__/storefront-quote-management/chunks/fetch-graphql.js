/*! Copyright 2025 Adobe
All Rights Reserved. */
import{FetchGraphQL as b}from"@dropins/tools/fetch-graphql.js";const x={requestQuote:!1,editQuote:!1,deleteQuote:!1,checkoutQuote:!1},y={authenticated:!1,permissions:x},E=new Proxy(y,{get:(e,t)=>e[t],set:(e,t,r)=>(e[t]=r,!0)});var h=(e=>(e.NEW="NEW",e.SUBMITTED="SUBMITTED",e.PENDING="PENDING",e.UPDATED="UPDATED",e.OPEN="OPEN",e.ORDERED="ORDERED",e.CLOSED="CLOSED",e.DECLINED="DECLINED",e.EXPIRED="EXPIRED",e.DRAFT="DRAFT",e))(h||{});function I(e){var r,s,i,g,m,f;const t=v(e);return{uid:e.uid,name:e.name,createdAt:e.created_at,updatedAt:e.updated_at,expirationDate:e.expiration_date,status:t?h.NEW:e.status,salesRepName:e.sales_rep_name,buyer:{firstname:e.buyer.firstname,lastname:e.buyer.lastname},templateName:e.template_name,comments:(r=e.comments)==null?void 0:r.map(a=>{const c={uid:a.uid,createdAt:a.created_at,author:{firstname:a.author.firstname,lastname:a.author.lastname},text:a.text};return Array.isArray(a.attachments)&&a.attachments.length>0&&(c.attachments=a.attachments.map(o=>({name:o.name,url:o.url}))),c}),prices:e.prices&&{subtotalExcludingTax:e.prices.subtotal_excluding_tax&&{value:e.prices.subtotal_excluding_tax.value,currency:e.prices.subtotal_excluding_tax.currency},subtotalIncludingTax:e.prices.subtotal_including_tax&&{value:e.prices.subtotal_including_tax.value,currency:e.prices.subtotal_including_tax.currency},subtotalWithDiscountExcludingTax:e.prices.subtotal_with_discount_excluding_tax&&{value:e.prices.subtotal_with_discount_excluding_tax.value,currency:e.prices.subtotal_with_discount_excluding_tax.currency},appliedTaxes:(s=e.prices.applied_taxes)==null?void 0:s.map(a=>({amount:{value:a.amount.value,currency:a.amount.currency},label:a.label})),grandTotal:e.prices.grand_total&&{value:e.prices.grand_total.value,currency:e.prices.grand_total.currency}},history:(i=e.history)==null?void 0:i.map(a=>{var c,o,u,p,d,_,n;return{uid:a.uid,createdAt:a.created_at,author:{firstname:a.author.firstname,lastname:a.author.lastname},changeType:a.change_type,changes:{commentAdded:((c=a.changes)==null?void 0:c.comment_added)&&{comment:a.changes.comment_added.comment},customChanges:((o=a.changes)==null?void 0:o.custom_changes)&&{new_value:a.changes.custom_changes.new_value,old_value:a.changes.custom_changes.old_value,title:a.changes.custom_changes.title},expiration:((u=a.changes)==null?void 0:u.expiration)&&{newExpiration:a.changes.expiration.new_expiration,oldExpiration:a.changes.expiration.old_expiration},productsRemoved:((p=a.changes)==null?void 0:p.products_removed)&&{productsRemovedFromCatalog:a.changes.products_removed.products_removed_from_catalog||[],productsRemovedFromQuote:a.changes.products_removed.products_removed_from_quote||[]},statuses:((d=a.changes)==null?void 0:d.statuses)&&{changes:((_=a.changes.statuses.changes)==null?void 0:_.map(l=>({newStatus:l.new_status,oldStatus:l.old_status})))||[]},total:((n=a.changes)==null?void 0:n.total)&&a.changes.total.new_price&&a.changes.total.old_price&&{newPrice:{value:a.changes.total.new_price.value,currency:a.changes.total.new_price.currency},oldPrice:{value:a.changes.total.old_price.value,currency:a.changes.total.old_price.currency}}}}}),items:((g=e.items)==null?void 0:g.map(a=>{var c,o,u,p,d,_;return{product:{uid:a.product.uid,sku:a.product.sku,name:a.product.name},catalogDiscount:{amountOff:a.prices.catalog_discount.amount_off,percentOff:a.prices.catalog_discount.percent_off},discounts:((o=(c=a.prices)==null?void 0:c.discounts)==null?void 0:o.map(n=>({label:n.label,value:n.value,amount:{value:n.amount.value,currency:n.amount.currency}})))??[],stockStatus:a.product.stock_status,quantity:a.quantity,prices:{originalItemPrice:{value:a.prices.original_item_price.value,currency:a.prices.original_item_price.currency},rowTotal:{value:a.prices.row_total.value,currency:a.prices.row_total.currency}},noteFromBuyer:(u=a.note_from_buyer)==null?void 0:u.map(n=>({createdAt:n.created_at,creatorId:n.creator_id,creatorType:n.creator_type,negotiableQuoteItemUid:n.negotiable_quote_item_uid,note:n.note,noteUid:n.note_uid})),noteFromSeller:(p=a.note_from_seller)==null?void 0:p.map(n=>({createdAt:n.created_at,creatorId:n.creator_id,creatorType:n.creator_type,negotiableQuoteItemUid:n.negotiable_quote_item_uid,note:n.note,noteUid:n.note_uid})),configurableOptions:(d=a.configurable_options)==null?void 0:d.map(n=>({optionLabel:n.option_label,valueLabel:n.value_label})),bundleOptions:(_=a.bundle_options)==null?void 0:_.map(n=>({label:n.label,values:n.values.map(l=>({label:l.label,quantity:l.quantity,originalPrice:{value:l.original_price.value,currency:l.original_price.currency},price:{value:l.priceV2.value,currency:l.priceV2.currency}}))}))}}))||[],shippingAddresses:(m=e.shipping_addresses)==null?void 0:m.map(a=>{const c={uid:a.uid,firstname:a.firstname,lastname:a.lastname,company:a.company,street:a.street,city:a.city,postcode:a.postcode,country:{code:a.country.code,label:a.country.label},telephone:a.telephone};return a.region&&(c.region={code:a.region.code,label:a.region.label,regionId:a.region.region_id}),c}),canCheckout:["UPDATED","DECLINED"].includes(e.status)&&E.permissions.checkoutQuote&&((f=e.shipping_addresses)==null?void 0:f.length)>0,canSendForReview:(t||["DRAFT","UPDATED","DECLINED","EXPIRED","NEW"].includes(e.status))&&E.permissions.editQuote}}function w(e){return e?I(e):null}function v(e){return e.status==="SUBMITTED"&&!(e.history??[]).some(t=>{var r,s;return t.change_type==="UPDATED"&&(((s=(r=t.changes)==null?void 0:r.statuses)==null?void 0:s.changes)??[]).length>0})}function D(e){const t=v(e);return{uid:e.uid,name:e.name,createdAt:e.created_at,updatedAt:e.updated_at,status:t?h.NEW:e.status,buyer:{firstname:e.buyer.firstname,lastname:e.buyer.lastname},templateName:e.template_name,prices:{grandTotal:{value:e.prices.grand_total.value,currency:e.prices.grand_total.currency}}}}function A(e){var s;if(!e)return null;const t={items:((s=e.items)==null?void 0:s.filter(i=>i==null?void 0:i.uid).map(D))||[],pageInfo:{currentPage:e.page_info.current_page,pageSize:e.page_info.page_size,totalPages:e.page_info.total_pages},totalCount:e.total_count,sortFields:e.sort_fields?{default:e.sort_fields.default,options:e.sort_fields.options}:void 0},r=T(t);return{...t,paginationInfo:r||void 0}}function T(e){if(!(e!=null&&e.pageInfo)||!e.totalCount)return null;const{currentPage:t,pageSize:r,totalPages:s}=e.pageInfo,{totalCount:i}=e,g=i>0?(t-1)*r+1:0,m=Math.min(t*r,i);return{currentPage:t,totalCount:i,pageSize:r,startItem:g,endItem:m,totalPages:s,pageSizeOptions:[20,30,50,100,200]}}const R=()=>[20,30,50,100,200],{setEndpoint:N,setFetchGraphQlHeader:C,removeFetchGraphQlHeader:F,setFetchGraphQlHeaders:O,fetchGraphQl:U,getConfig:L}=new b().getMethods();export{x as D,A as a,N as b,C as c,O as d,L as e,U as f,R as g,F as r,E as s,w as t};
//# sourceMappingURL=fetch-graphql.js.map
