/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as a,jsxs as f,Fragment as Ae}from"@dropins/tools/preact-jsx-runtime.js";import{useState as l,useEffect as ne,useCallback as s,useMemo as N,useRef as _a,createPortal as U}from"@dropins/tools/preact-compat.js";import{classes as d,VComponent as E,Slot as S}from"@dropins/tools/lib.js";import{f as xe}from"../chunks/dateUtils.js";import{events as ya}from"@dropins/tools/event-bus.js";import{Skeleton as Ra,SkeletonRow as A,InLineAlert as I,Modal as Da,Input as ue,Button as w,TextArea as Sa,Icon as ee}from"@dropins/tools/components.js";import{N as Ue}from"../chunks/transform-quote-template.js";import{S as La,A as Ea,T as Ia,R as ka}from"../chunks/RenameQuoteModal.js";/* empty css                              */import"@dropins/tools/preact.js";import"@dropins/tools/preact-hooks.js";import{C as ae}from"../chunks/ConfirmationModal.js";/* empty css                        *//* empty css                          */import{a as $,S as ge}from"../chunks/WarningFilled.js";import{useText as fe}from"@dropins/tools/i18n.js";import"../chunks/state.js";import{d as wa,c as Ba,s as Ha,a as Fa,o as xa}from"../chunks/openQuoteTemplate.js";import{g as Ua}from"../chunks/generateQuoteFromTemplate.js";import{S as Aa}from"../chunks/ShippingAddressDisplay.js";import{I as Wa}from"../chunks/ItemsQuotedTemplate.js";import{Q as Oa}from"../chunks/QuoteTemplateCommentsList.js";import{Q as Ga}from"../chunks/QuoteTemplateHistoryLog.js";import"../chunks/transform-quote.js";import"@dropins/tools/fetch-graphql.js";import"../chunks/NegotiableQuoteTemplateFragment.js";import"../chunks/LineItemNoteModal.js";import"../chunks/addQuoteTemplateLineItemNote.js";import"../chunks/QuoteCommentsList.js";import"../chunks/QuoteHistoryLog.js";const $a=({className:n,loading:u,templateName:c,templateStatus:q,banner:e,details:T,actionBar:Q,referenceDocuments:b,itemsTable:M,shippingInformationTitle:m,shippingInformation:r,commentsTitle:v,comments:g,footer:h,...y})=>u?a(za,{}):f("div",{...y,className:d(["quote-management-manage-negotiable-quote-template",n]),children:[f("div",{className:d(["quote-management-manage-negotiable-quote-template__header"]),children:[c&&a(E,{node:c,className:d(["quote-management-manage-negotiable-quote-template__template-name"])}),q&&a(E,{node:q,className:d(["quote-management-manage-negotiable-quote-template__template-status"])})]}),e&&a(E,{node:e,className:d(["quote-management-manage-negotiable-quote-template__banner"])}),T&&a(E,{node:T,className:d(["quote-management-manage-negotiable-quote-template__details"])}),Q&&a(E,{node:Q,className:d(["quote-management-manage-negotiable-quote-template__action-bar"])}),b&&a("div",{"data-testid":"reference-documents-container",className:d(["quote-management-manage-negotiable-quote-template__reference-documents-container"]),children:a(E,{node:b,className:d(["quote-management-manage-negotiable-quote-template__reference-documents"])})}),M&&a(E,{node:M,className:d(["quote-management-manage-negotiable-quote-template__items-table"])}),f("div",{"data-testid":"template-shipping-information-container",className:d(["quote-management-manage-negotiable-quote-template__shipping-information-container"]),children:[m&&a(E,{node:m,className:d(["quote-management-manage-negotiable-quote-template__shipping-information-title"])}),r&&a(E,{node:r,className:d(["quote-management-manage-negotiable-quote-template__shipping-information"])})]}),f("div",{"data-testid":"comments-container",className:d(["quote-management-manage-negotiable-quote-template__comments-container"]),children:[v&&a(E,{node:v,className:d(["quote-management-manage-negotiable-quote-template__comments-title"])}),g&&a(E,{node:g,className:d(["quote-management-manage-negotiable-quote-template__comments"])})]}),h&&a(E,{node:h,className:d(["quote-management-manage-negotiable-quote-template__footer"])})]}),za=()=>f(Ra,{"data-testid":"manage-negotiable-quote-template-skeleton",children:[a(A,{variant:"heading",fullWidth:!0,size:"large"}),a(A,{variant:"row",fullWidth:!1,size:"small"}),a(A,{variant:"row",fullWidth:!1,size:"small"}),a(A,{variant:"row",fullWidth:!0}),a(A,{variant:"row",fullWidth:!0,size:"xlarge",lines:2}),a(A,{variant:"row",fullWidth:!1,size:"small"})]}),Pa=({className:n,open:u,document:c,errorMessage:q,errorBanner:e,successBanner:T,showCloseButton:Q=!0,isSubmitting:b=!1,onSave:M,onClose:m})=>{const[r,v]=l(""),[g,h]=l(""),[y,k]=l(""),[_,R]=l({}),C=fe({title:"NegotiableQuoteTemplate.Manage.referenceDocuments.form.title",documentNameLabel:"NegotiableQuoteTemplate.Manage.referenceDocuments.form.documentNameLabel",documentIdentifierLabel:"NegotiableQuoteTemplate.Manage.referenceDocuments.form.documentIdentifierLabel",referenceUrlLabel:"NegotiableQuoteTemplate.Manage.referenceDocuments.form.referenceUrlLabel",addButton:"NegotiableQuoteTemplate.Manage.referenceDocuments.form.addButton",updateButton:"NegotiableQuoteTemplate.Manage.referenceDocuments.form.updateButton",cancelButton:"NegotiableQuoteTemplate.Manage.referenceDocuments.form.cancelButton",documentNameRequired:"NegotiableQuoteTemplate.Manage.referenceDocuments.form.documentNameRequired",documentIdentifierRequired:"NegotiableQuoteTemplate.Manage.referenceDocuments.form.documentIdentifierRequired",referenceUrlRequired:"NegotiableQuoteTemplate.Manage.referenceDocuments.form.referenceUrlRequired",invalidUrl:"NegotiableQuoteTemplate.Manage.referenceDocuments.form.invalidUrl",errorHeading:"NegotiableQuoteTemplate.Manage.referenceDocuments.form.errorHeading"}),B=e||(q?a(I,{type:"error",variant:"primary",icon:a($,{}),heading:C.errorHeading,description:q,"data-testid":"reference-document-form-modal-error-banner-inline"}):null),x=!!c;ne(()=>{u&&(c?(v(c.name||""),h(c.identifier||""),k(c.url||"")):(v(""),h(""),k("")),R({}))},[u,c]);const D=s(p=>{if(!p.trim())return!1;try{return new URL(p),!0}catch{return!1}},[]),te=s(()=>{const p={};if(r.trim()||(p.documentName=C.documentNameRequired),y.trim()?D(y.trim())||(p.referenceUrl=C.invalidUrl):p.referenceUrl=C.referenceUrlRequired,g.trim()||(p.documentIdentifier=C.documentIdentifierRequired),Object.keys(p).length>0){R(p);return}M({uid:c==null?void 0:c.uid,name:r.trim(),identifier:g.trim(),url:y.trim()})},[r,g,y,c,C,D,M]),H=s(()=>{v(""),h(""),k(""),R({}),m==null||m()},[m]);return u?f(Da,{open:u,size:"medium",title:a(Ae,{children:C.title}),onClose:H,clickToDismiss:!0,escapeToDismiss:!0,showCloseButton:Q,className:d(["quote-management-reference-document-form-modal",n]),"data-testid":"reference-document-form-modal",children:[B&&a("div",{className:d(["quote-management-reference-document-form-modal__error-banner"]),"data-testid":"reference-document-form-modal-error-banner",children:B}),T&&a("div",{className:d(["quote-management-reference-document-form-modal__success-banner"]),"data-testid":"reference-document-form-modal-success-banner",children:T}),f("div",{className:d(["quote-management-reference-document-form-modal__content"]),children:[f("div",{children:[a(ue,{name:"documentName",type:"text",value:r,onInput:p=>{v(p.target.value),R({..._,documentName:void 0})},floatingLabel:C.documentNameLabel,required:!0,error:!!_.documentName,disabled:b,"data-testid":"reference-document-name-input"}),_.documentName&&a("span",{className:d(["quote-management-reference-document-form-modal__error-text"]),"data-testid":"reference-document-name-error",children:_.documentName})]}),f("div",{children:[a(ue,{name:"documentIdentifier",type:"text",value:g,onInput:p=>{h(p.target.value),R({..._,documentIdentifier:void 0})},floatingLabel:C.documentIdentifierLabel,error:!!_.documentIdentifier,disabled:b,"data-testid":"reference-document-identifier-input"}),_.documentIdentifier&&a("span",{className:d(["quote-management-reference-document-form-modal__error-text"]),"data-testid":"reference-document-identifier-error",children:_.documentIdentifier})]}),f("div",{children:[a(ue,{name:"referenceUrl",type:"url",value:y,onInput:p=>{k(p.target.value),R({..._,referenceUrl:void 0})},floatingLabel:C.referenceUrlLabel,required:!0,error:!!_.referenceUrl,disabled:b,"data-testid":"reference-document-url-input"}),_.referenceUrl&&a("span",{className:d(["quote-management-reference-document-form-modal__error-text"]),"data-testid":"reference-document-url-error",children:_.referenceUrl})]})]}),f("div",{className:d(["quote-management-reference-document-form-modal__actions"]),children:[a(w,{variant:"secondary",size:"medium",onClick:H,disabled:b,className:d(["quote-management-reference-document-form-modal__cancel-button"]),"data-testid":"reference-document-form-cancel-button",children:C.cancelButton}),a(w,{variant:"primary",size:"medium",onClick:te,disabled:b,className:d(["quote-management-reference-document-form-modal__save-button"]),"data-testid":"reference-document-form-save-button",children:x?C.updateButton:C.addButton})]})]}):null},ja=({className:n,documents:u,isEditable:c=!1,onAdd:q,onEdit:e,onRemove:T,...Q})=>{const b=fe({add:"NegotiableQuoteTemplate.Manage.referenceDocuments.add",edit:"NegotiableQuoteTemplate.Manage.referenceDocuments.edit",remove:"NegotiableQuoteTemplate.Manage.referenceDocuments.remove",noReferenceDocuments:"NegotiableQuoteTemplate.Manage.referenceDocuments.noReferenceDocuments"}),M=r=>r.identifier?`${r.name}, ${r.identifier}`:`${r.name} ${r.url}`,m=(r,v)=>{r.preventDefault(),window.open(v,"_blank","noopener,noreferrer")};return a("div",{className:d(["quote-management-reference-documents-list",n]),"data-testid":"reference-documents-list",...Q,children:f("div",{className:"quote-management-reference-documents-list__content",children:[u.map(r=>f("div",{className:"quote-management-reference-documents-list__document","data-testid":`reference-document-${r.uid||r.url}`,children:[a("a",{href:r.url,onClick:v=>m(v,r.url),className:"quote-management-reference-documents-list__document-link",target:"_blank",rel:"noopener noreferrer","data-testid":`reference-document-link-${r.uid||r.url}`,children:M(r)}),c&&f("div",{className:"quote-management-reference-documents-list__document-actions",children:[a(w,{variant:"tertiary",onClick:()=>e==null?void 0:e(r),className:"quote-management-reference-documents-list__edit-button","data-testid":`reference-document-edit-${r.uid||r.url}`,children:b.edit}),a("span",{className:"quote-management-reference-documents-list__separator",children:"|"}),a(w,{variant:"tertiary",onClick:()=>T==null?void 0:T(r),className:"quote-management-reference-documents-list__remove-button","data-testid":`reference-document-remove-${r.uid||r.url}`,children:b.remove})]})]},r.uid||r.url)),c&&f(w,{variant:"tertiary",onClick:q,className:"quote-management-reference-documents-list__add-button","data-testid":"reference-documents-add-button",children:["+ ",b.add]}),u.length===0&&!c&&a("div",{className:"quote-management-reference-documents-list__empty",children:b.noReferenceDocuments})]})})},Va=n=>{const{templateReferenceDocuments:u,localReferenceDocuments:c}=n,q=s(m=>{if(u)return u.find(r=>m.uid&&r.uid?r.uid===m.uid:r.url===m.url)},[u]),e=s(m=>q(m)!==void 0,[q]),T=s((m,r)=>m.name!==r.name||m.identifier!==r.identifier||m.url!==r.url,[]),Q=s(()=>u?c.filter(m=>!u.some(r=>m.uid&&r.uid?r.uid===m.uid:r.url===m.url)):c,[u,c]),b=s(()=>c.map(m=>({uid:m.uid,name:m.name,identifier:m.identifier,url:m.url})),[c]),M=N(()=>u?c.some(g=>q(g)===void 0)||u.some(g=>!c.some(h=>h.uid&&g.uid?h.uid===g.uid:h.url===g.url))?!0:c.some(g=>{const h=q(g);return h?T(g,h):!1}):c.length>0,[u,c,q,T]);return{isDocumentInTemplateData:e,getNewDocuments:Q,getReferenceDocumentLinks:b,hasUnsavedChanges:M}},Ja=(n={})=>{const{initialTemplateName:u,templateNameRequiredErrorMessage:c="Template name is required"}=n,[q,e]=l(!1),[T,Q]=l(""),[b,M]=l(""),[m,r]=l(""),[v,g]=l(""),[h,y]=l(""),k=s(D=>{Q(D||u||""),M(""),r(""),g(""),y(""),e(!0)},[u]),_=s(()=>{e(!1),Q(""),M(""),r(""),g(""),y("")},[]),R=s(D=>{Q(D),D.trim()&&g("")},[]),C=s(D=>{M(D)},[]),B=s(()=>T.trim()?(r(""),g(""),e(!1),!0):(g(c),!1),[T,c]),x=s(()=>{Q(""),M(""),r(""),g(""),y("")},[]);return{isRenameModalOpen:q,renameTemplateName:T,renameReason:b,renameError:m,renameTemplateNameError:v,renameSuccess:h,handleRenameClick:k,handleRenameClose:_,handleRenameTemplateNameChange:R,handleRenameReasonChange:C,handleRenameSave:B,resetRenameState:x}},Sn=({slots:n,onActionsButtonClick:u,onSendForReview:c,...q})=>{const[e,T]=l(void 0),[Q,b]=l(!0),[M,m]=l(""),[r,v]=l(!1),[g,h]=l(!1),[y,k]=l(null),[_,R]=l(!1),[C,B]=l(!1),[x,D]=l(null),[te,H]=l(!1),[p,W]=l([]),[pe,z]=l(!1),[P,j]=l(void 0),[We,V]=l(null),[be,Me]=l(!1),[he,Ne]=l(!1),[Te,J]=l(""),[Qe,K]=l(""),[ve,Ce]=l(!1),[qe,_e]=l(!1),[ye,X]=l(""),[Re,Y]=l(""),De=_a(!1),{getReferenceDocumentLinks:Se,hasUnsavedChanges:Le}=Va({templateReferenceDocuments:e==null?void 0:e.referenceDocuments,localReferenceDocuments:p}),t=fe({createdLabel:"NegotiableQuoteTemplate.Manage.createdLabel",salesRepLabel:"NegotiableQuoteTemplate.Manage.salesRepLabel",expiresLabel:"NegotiableQuoteTemplate.Manage.expiresLabel",templateIdLabel:"NegotiableQuoteTemplate.Manage.templateIdLabel",actionsLabel:"NegotiableQuoteTemplate.Manage.actionsLabel",referenceDocumentsTitle:"NegotiableQuoteTemplate.Manage.referenceDocuments.title",commentsTitle:"NegotiableQuoteTemplate.Manage.comments.title",historyLogTitle:"NegotiableQuoteTemplate.Manage.historyLog.title",itemsQuotedTab:"NegotiableQuoteTemplate.Manage.tabs.itemsQuoted",commentsTab:"NegotiableQuoteTemplate.Manage.tabs.comments",historyLogTab:"NegotiableQuoteTemplate.Manage.tabs.historyLog",templateCommentsPlaceholder:"NegotiableQuoteTemplate.Manage.templateComments.placeholder",sendForReview:"NegotiableQuoteTemplate.Manage.actionButtons.sendForReview",delete:"NegotiableQuoteTemplate.Manage.actionButtons.delete",cancel:"NegotiableQuoteTemplate.Manage.actionButtons.cancel",confirmationModalDeleteTitle:"NegotiableQuoteTemplate.Manage.confirmationModal.delete.title",confirmationModalDeleteMessage:"NegotiableQuoteTemplate.Manage.confirmationModal.delete.message",confirmationModalDeleteConfirm:"NegotiableQuoteTemplate.Manage.confirmationModal.delete.confirm",confirmationModalDeleteErrorHeading:"NegotiableQuoteTemplate.Manage.confirmationModal.delete.errorHeading",confirmationModalDeleteErrorFallback:"NegotiableQuoteTemplate.Manage.confirmationModal.delete.errorFallback",confirmationModalDeleteSuccessHeading:"NegotiableQuoteTemplate.Manage.confirmationModal.delete.successHeading",confirmationModalDeleteSuccessDescription:"NegotiableQuoteTemplate.Manage.confirmationModal.delete.successDescription",confirmationModalCancelTitle:"NegotiableQuoteTemplate.Manage.confirmationModal.cancelTemplate.title",confirmationModalCancelMessage:"NegotiableQuoteTemplate.Manage.confirmationModal.cancelTemplate.message",confirmationModalCancelConfirm:"NegotiableQuoteTemplate.Manage.confirmationModal.cancelTemplate.confirm",confirmationModalCancelErrorHeading:"NegotiableQuoteTemplate.Manage.confirmationModal.cancelTemplate.errorHeading",confirmationModalCancelErrorFallback:"NegotiableQuoteTemplate.Manage.confirmationModal.cancelTemplate.errorFallback",confirmationModalCancelSuccessHeading:"NegotiableQuoteTemplate.Manage.confirmationModal.cancelTemplate.successHeading",confirmationModalCancelSuccessDescription:"NegotiableQuoteTemplate.Manage.confirmationModal.cancelTemplate.successDescription",confirmationModalCancel:"NegotiableQuoteTemplate.Manage.confirmationModal.cancel",accept:"NegotiableQuoteTemplate.Manage.actionButtons.accept",generateQuote:"NegotiableQuoteTemplate.Manage.actionButtons.generateQuote",generateQuoteModalTitle:"NegotiableQuoteTemplate.Manage.actionButtons.generateQuote",generateQuoteModalMessage:"NegotiableQuoteTemplate.Manage.confirmationModal.generateQuote.message",generateQuoteModalCancel:"NegotiableQuoteTemplate.Manage.confirmationModal.cancel",generateQuoteModalConfirm:"NegotiableQuoteTemplate.Manage.confirmationModal.generateQuote.confirm",generateQuoteModalConfirmLoading:"NegotiableQuoteTemplate.Manage.confirmationModal.generateQuote.confirmLoading",generateQuoteModalSuccessHeading:"NegotiableQuoteTemplate.Manage.confirmationModal.generateQuote.successHeading",generateQuoteSuccessMessage:"NegotiableQuoteTemplate.Manage.confirmationModal.generateQuote.successDescription",generateQuoteModalErrorHeading:"NegotiableQuoteTemplate.Manage.confirmationModal.generateQuote.errorHeading",generateQuoteErrorFallback:"NegotiableQuoteTemplate.Manage.confirmationModal.generateQuote.errorFallback",acceptModalTitle:"NegotiableQuoteTemplate.Manage.confirmationModal.accept.title",acceptModalMessage:"NegotiableQuoteTemplate.Manage.confirmationModal.accept.message",acceptModalCancel:"NegotiableQuoteTemplate.Manage.confirmationModal.cancel",acceptModalConfirm:"NegotiableQuoteTemplate.Manage.confirmationModal.accept.confirm",acceptModalConfirmLoading:"NegotiableQuoteTemplate.Manage.confirmationModal.accept.confirmLoading",acceptModalSuccessHeading:"NegotiableQuoteTemplate.Manage.confirmationModal.accept.successHeading",acceptSuccessMessage:"NegotiableQuoteTemplate.Manage.confirmationModal.accept.successDescription",acceptModalErrorHeading:"NegotiableQuoteTemplate.Manage.confirmationModal.accept.errorHeading",acceptErrorFallback:"NegotiableQuoteTemplate.Manage.confirmationModal.accept.errorFallback",documentDuplicateUidError:"NegotiableQuoteTemplate.Manage.referenceDocuments.form.duplicateUidError",renameTitle:"NegotiableQuoteTemplate.Manage.rename.title",renameTemplateNameLabel:"NegotiableQuoteTemplate.Manage.rename.templateNameLabel",renameReasonLabel:"NegotiableQuoteTemplate.Manage.rename.reasonLabel",renameButton:"NegotiableQuoteTemplate.Manage.rename.renameButton",renameCancelButton:"NegotiableQuoteTemplate.Manage.rename.cancelButton",renameErrorHeading:"NegotiableQuoteTemplate.Manage.rename.errorHeading",renameTemplateNameRequired:"NegotiableQuoteTemplate.Manage.rename.templateNameRequired",renameErrorDefault:"NegotiableQuoteTemplate.Manage.rename.errorDefault",renameSuccessHeading:"NegotiableQuoteTemplate.Manage.rename.successHeading",renameSuccessMessage:"NegotiableQuoteTemplate.Manage.rename.successMessage",shippingInformationTitle:"NegotiableQuoteTemplate.Manage.shippingInformation.title",unsavedChangesWarningHeading:"NegotiableQuoteTemplate.Manage.unsavedChangesWarningHeading",unsavedChangesWarningMessage:"NegotiableQuoteTemplate.Manage.unsavedChangesWarningMessage"}),{isRenameModalOpen:Ee,renameTemplateName:L,renameReason:O,renameError:re,renameTemplateNameError:Oe,renameSuccess:oe,handleRenameClick:Ie,handleRenameClose:Ge,handleRenameTemplateNameChange:$e,handleRenameReasonChange:ze,handleRenameSave:Pe,resetRenameState:ke}=Ja({initialTemplateName:e==null?void 0:e.name,templateNameRequiredErrorMessage:t.renameTemplateNameRequired}),we=N(()=>L!==""&&L!==(e==null?void 0:e.name),[L,e==null?void 0:e.name]),G=N(()=>Le||we,[Le,we]);ne(()=>{const o=ya.on("quote-management/quote-template-data",i=>{i.quoteTemplate&&(T(i.quoteTemplate),b(!1),m(""),v(!1),W(i.quoteTemplate.referenceDocuments||[]),ke())},{eager:!0});return()=>o==null?void 0:o.off()},[ke]),ne(()=>{e!=null&&e.referenceDocuments&&W(e.referenceDocuments)},[e==null?void 0:e.referenceDocuments]),ne(()=>{e&&e.status===Ue.UPDATED&&!De.current&&(De.current=!0,(async()=>{try{await xa({templateId:e.id})}catch(i){console.error("Failed to auto-open quote template:",i)}})())},[e]);const je=s(()=>{h(!1),k(null),R(!1)},[]),Ve=s(async()=>{if(e!=null&&e.id){k(null),R(!1);try{await wa({templateId:e.id}),R(!0),setTimeout(()=>{h(!1),R(!1)},2e3)}catch(o){const i=o.message||t.confirmationModalDeleteErrorFallback;k(i)}}},[e,t.confirmationModalDeleteErrorFallback]),Je=s(()=>{k(null)},[]),Ke=s(()=>{R(!1)},[]),Xe=s(()=>{B(!1),D(null),H(!1)},[]),Ye=s(async()=>{if(e!=null&&e.id){D(null),H(!1);try{await Ba({templateId:e.id}),H(!0),setTimeout(()=>{B(!1),H(!1)},2e3)}catch(o){const i=o.message||t.confirmationModalCancelErrorFallback;D(i)}}},[e,t.confirmationModalCancelErrorFallback]),Ze=s(()=>{D(null)},[]),ea=s(()=>{H(!1)},[]),ie=s(async()=>{const o=Se(),i=[O.trim(),M.trim()].filter(Boolean).join(`

`).trim()||void 0,F=L&&L!==(e==null?void 0:e.name)?L:void 0;if(c){c({templateData:e,name:F,comment:i,referenceDocumentLinks:o});return}v(!0);try{await Ha({templateId:e.id,name:F,comment:i,referenceDocumentLinks:o.length>0?o:void 0})}catch(qa){console.error("Failed to send quote template for review:",qa),v(!1)}},[e,c,M,O,L,Se]),ce=s(()=>{j(void 0),V(null),z(!0)},[]),me=s(o=>{j(o),V(null),z(!0)},[]),le=s(o=>{W(i=>i.filter(F=>F.uid!==o.uid||F.url!==o.url))},[]),aa=s(o=>{V(null),W(P?i=>i.map(F=>F.identifier===P.identifier?o:F):i=>[...i,o]),z(!1),j(void 0)},[P]),na=s(()=>{z(!1),j(void 0),V(null)},[]),ta=s(async()=>{Ne(!0),K(""),J("");try{await Ua({templateId:e.id}),J(t.generateQuoteSuccessMessage)}catch(o){console.error("Failed to generate quote from template:",o);const i=o instanceof Error?o.message:t.generateQuoteErrorFallback;K(i)}finally{Ne(!1)}},[e,t.generateQuoteSuccessMessage,t.generateQuoteErrorFallback]),ra=s(()=>{Me(!1),K(""),J("")},[]),oa=s(async()=>{_e(!0),Y(""),X("");try{await Fa({templateId:e.id}),X(t.acceptSuccessMessage)}catch(o){console.error("Failed to accept quote template:",o);const i=o instanceof Error?o.message:t.acceptErrorFallback;Y(i)}finally{_e(!1)}},[e,t.acceptSuccessMessage,t.acceptErrorFallback]),ia=s(()=>{Ce(!1),Y(""),X("")},[]),ca=N(()=>{const o=!(e!=null&&e.canSendForReview),i=L||(e==null?void 0:e.name);return a(S,{name:"TemplateName",slot:n==null?void 0:n.TemplateName,context:{templateName:e==null?void 0:e.name,templateData:e,templateDisplayName:i,isRenameDisabled:o},children:f("div",{className:"quote-management-manage-negotiable-quote-template__template-name-wrapper",children:[a("h1",{"data-testid":"template-name",className:"quote-management-manage-negotiable-quote-template__template-name-title",children:i}),a("button",{onClick:()=>Ie(i),disabled:o,"data-testid":"rename-template-button",className:"quote-management-manage-negotiable-quote-template__rename-button","aria-label":"Rename template",children:a(La,{})})]})})},[n==null?void 0:n.TemplateName,e,Ie,L]),ma=N(()=>a(S,{name:"TemplateStatus",slot:n==null?void 0:n.TemplateStatus,context:{templateStatus:e==null?void 0:e.status,templateData:e},children:a("div",{"data-testid":"template-status",children:e==null?void 0:e.status})}),[n==null?void 0:n.TemplateStatus,e]),la=N(()=>{if(!e)return;const o=e.expirationDate?xe(e.expirationDate,"short"):void 0;return f(S,{name:"Details",slot:n==null?void 0:n.Details,context:{templateData:e},children:[f("div",{className:"quote-management-manage-negotiable-quote-template__detail",children:[a("span",{className:"quote-management-manage-negotiable-quote-template__detail-title","data-testid":"template-id-label",children:t.templateIdLabel}),a("span",{className:"quote-management-manage-negotiable-quote-template__detail-content","data-testid":"template-id-value",children:e.id})]}),f("div",{className:"quote-management-manage-negotiable-quote-template__detail",children:[a("span",{className:"quote-management-manage-negotiable-quote-template__detail-title","data-testid":"created-label",children:t.createdLabel}),f("span",{className:"quote-management-manage-negotiable-quote-template__detail-content","data-testid":"created-value",children:[xe(e.createdAt,"short")," (",e.buyer.firstname," ",e.buyer.lastname,")"]})]}),f("div",{className:"quote-management-manage-negotiable-quote-template__detail",children:[a("span",{className:"quote-management-manage-negotiable-quote-template__detail-title","data-testid":"sales-rep-label",children:t.salesRepLabel}),a("span",{className:"quote-management-manage-negotiable-quote-template__detail-content","data-testid":"sales-rep-value",children:e.salesRepName})]}),o&&f("div",{className:"quote-management-manage-negotiable-quote-template__detail",children:[a("span",{className:"quote-management-manage-negotiable-quote-template__detail-title","data-testid":"expires-label",children:t.expiresLabel}),a("span",{className:"quote-management-manage-negotiable-quote-template__detail-content","data-testid":"expires-value",children:o})]})]})},[n==null?void 0:n.Details,t,e]),Be=N(()=>[{label:t.generateQuote,value:"generateQuote",disabled:!(e!=null&&e.canGenerateQuoteFromTemplate)}],[t,e==null?void 0:e.canGenerateQuoteFromTemplate]),sa=N(()=>{const o=i=>{switch(i){case"generateQuote":Me(!0),K(""),J(""),u==null||u(i);break}};return a(S,{name:"ActionBar",slot:n==null?void 0:n.ActionBar,context:{templateData:e},children:a(Ea,{dropdownPlaceholder:t.actionsLabel,dropdownOptions:[],buttons:Be.map(i=>a(w,{variant:"tertiary",onClick:()=>o(i.value),"data-testid":`actions-bar-${i.value}-button`,"data-action":i.value,disabled:i.disabled,children:i.label},i.value))})})},[Be,t,n==null?void 0:n.ActionBar,e,u]),Z=N(()=>{const o=e==null?void 0:e.status;return o==="Draft"||o==="Open"},[e==null?void 0:e.status]),da=N(()=>{const o=p.length>0||Z,i=o?t.referenceDocumentsTitle:void 0;return a(S,{name:"ReferenceDocuments",slot:n==null?void 0:n.ReferenceDocuments,context:{templateData:e,referenceDocuments:p,isEditable:Z,onAddDocument:ce,onEditDocument:me,onRemoveDocument:le,referenceDocumentsTitle:t.referenceDocumentsTitle},children:f("div",{"data-testid":"reference-documents",children:[o&&a("h2",{children:i}),a(ja,{documents:p,isEditable:Z,onAdd:ce,onEdit:me,onRemove:le})]})})},[n==null?void 0:n.ReferenceDocuments,t,e,p,Z,ce,me,le]),ua=N(()=>a(S,{name:"ShippingInformationTitle",slot:n==null?void 0:n.ShippingInformationTitle,context:{templateData:e},children:a("h2",{children:t.shippingInformationTitle})}),[n==null?void 0:n.ShippingInformationTitle,e,t]),ga=N(()=>{var o;return a(S,{name:"ShippingInformation",slot:n==null?void 0:n.ShippingInformation,context:{templateData:e,loading:Q,setLoading:b},children:a(Aa,{shippingAddress:(o=e==null?void 0:e.shippingAddresses)==null?void 0:o[0],loading:Q,"data-testid":"manage-template-shipping-address"})})},[n==null?void 0:n.ShippingInformation,e,Q,b]),fa=N(()=>a(S,{name:"ItemsTable",slot:n==null?void 0:n.ItemsTable,context:{templateData:e},children:a(Ia,{tabs:new Map([["items-quoted",t.itemsQuotedTab],["comments",t.commentsTab],["history-log",t.historyLogTab]]),tabsContent:new Map([["items-quoted",a(S,{name:"ItemsQuotedTab",slot:n==null?void 0:n.ItemsQuotedTab,context:{templateData:e},children:a(Wa,{templateData:e})},"items-quoted")],["comments",a(S,{name:"CommentsTab",slot:n==null?void 0:n.CommentsTab,context:{templateData:e},children:a(Oa,{templateData:e})},"comments")],["history-log",a(S,{name:"HistoryLogTab",slot:n==null?void 0:n.HistoryLogTab,context:{templateData:e},children:a(Ga,{templateData:e})},"history-log")]])})}),[n==null?void 0:n.ItemsTable,n==null?void 0:n.ItemsQuotedTab,n==null?void 0:n.CommentsTab,n==null?void 0:n.HistoryLogTab,t,e]),pa=N(()=>a(S,{name:"CommentsTitle",slot:n==null?void 0:n.CommentsTitle,context:{templateData:e},children:a("h2",{children:t.commentsTitle})}),[n==null?void 0:n.CommentsTitle,t,e]),ba=N(()=>a(S,{name:"Comments",slot:n==null?void 0:n.Comments,context:{templateData:e},children:a(Sa,{name:"templateComments",placeholder:t.templateCommentsPlaceholder,rows:3,value:M,onInput:o=>{m(o.target.value)},disabled:!(e!=null&&e.canSendForReview)||r})}),[n==null?void 0:n.Comments,t,e,M,r]),Ma=N(()=>G?a(I,{type:"warning",variant:"primary",icon:a($,{}),heading:t.unsavedChangesWarningHeading,description:t.unsavedChangesWarningMessage,"data-testid":"unsaved-changes-warning-alert"}):void 0,[G,t.unsavedChangesWarningHeading,t.unsavedChangesWarningMessage]),ha=N(()=>{const o=(e==null?void 0:e.status)===Ue.OPEN&&(e==null?void 0:e.canAccept);return f(S,{name:"Footer",slot:n==null?void 0:n.Footer,context:{templateData:e,comment:M,isSubmitting:r,referenceDocuments:p,hasUnsavedChanges:G,handleSendForReview:ie,showAcceptButton:o,renameTemplateName:L,renameReason:O},children:[o&&a(w,{variant:"primary",onClick:()=>{Ce(!0),Y(""),X("")},"data-testid":"accept-button",disabled:r||G,children:t.accept}),(e==null?void 0:e.canSendForReview)&&a(w,{variant:"primary",onClick:ie,"data-testid":"send-for-review-button",disabled:r,children:t.sendForReview}),(e==null?void 0:e.canCancel)&&a(w,{variant:"tertiary",onClick:()=>B(!0),"data-testid":"cancel-template-button",disabled:r,children:t.cancel}),(e==null?void 0:e.canDelete)&&a(w,{variant:"tertiary",onClick:()=>h(!0),"data-testid":"delete-template-button",disabled:r,children:t.delete})]})},[n==null?void 0:n.Footer,t,e,M,r,ie,p,G,L,O]),Na=y?a(I,{type:"error",variant:"primary",icon:a($,{}),heading:t.confirmationModalDeleteErrorHeading,description:y,onDismiss:Je,"data-testid":"confirmation-modal-error-banner"}):null,He=(_?a(I,{type:"success",variant:"primary",icon:a(ge,{}),heading:t.confirmationModalDeleteSuccessHeading,description:t.confirmationModalDeleteSuccessDescription,onDismiss:Ke,"data-testid":"confirmation-modal-success-banner"}):null)||Na,Ta=x?a(I,{type:"error",variant:"primary",icon:a($,{}),heading:t.confirmationModalCancelErrorHeading,description:x,onDismiss:Ze,"data-testid":"confirmation-modal-cancel-error-banner"}):null,Fe=(te?a(I,{type:"success",variant:"primary",icon:a(ge,{}),heading:t.confirmationModalCancelSuccessHeading,description:t.confirmationModalCancelSuccessDescription,onDismiss:ea,"data-testid":"confirmation-modal-cancel-success-banner"}):null)||Ta,Qa=N(()=>re?a(I,{type:"error",variant:"primary",icon:a($,{color:"var(--color-error)"}),heading:t.renameErrorHeading,description:re}):void 0,[re,t.renameErrorHeading]),va=N(()=>oe?a(I,{type:"success",variant:"primary",icon:a(ge,{}),heading:t.renameSuccessHeading,description:oe}):void 0,[oe,t.renameSuccessHeading]),Ca={...q,loading:Q,templateName:ca,templateStatus:ma,banner:Ma,details:la,actionBar:sa,referenceDocuments:da,itemsTable:fa,shippingInformationTitle:ua,shippingInformation:ga,commentsTitle:pa,comments:ba,footer:ha};let se=null;Te?se=a(I,{type:"success",variant:"primary",icon:a(ee,{source:"CheckWithCircle"}),heading:t.generateQuoteModalSuccessHeading,description:Te,"data-testid":"generate-quote-success-banner"}):Qe&&(se=a(I,{type:"error",variant:"primary",icon:a(ee,{source:"WarningFilled"}),heading:t.generateQuoteModalErrorHeading,description:Qe,"data-testid":"generate-quote-error-banner"}));let de=null;return ye?de=a(I,{type:"success",variant:"primary",icon:a(ee,{source:"CheckWithCircle"}),heading:t.acceptModalSuccessHeading,description:ye,"data-testid":"accept-success-banner"}):Re&&(de=a(I,{type:"error",variant:"primary",icon:a(ee,{source:"WarningFilled"}),heading:t.acceptModalErrorHeading,description:Re,"data-testid":"accept-error-banner"})),f(Ae,{children:[a($a,{...Ca}),g&&U(a(ae,{open:g,title:t.confirmationModalDeleteTitle,message:t.confirmationModalDeleteMessage,cancelLabel:t.confirmationModalCancel,confirmLabel:t.confirmationModalDeleteConfirm,onCancel:je,onConfirm:Ve,showCloseButton:!He,confirmationBanner:He}),document.body),C&&U(a(ae,{open:C,title:t.confirmationModalCancelTitle,message:t.confirmationModalCancelMessage,cancelLabel:t.confirmationModalCancel,confirmLabel:t.confirmationModalCancelConfirm,onCancel:Xe,onConfirm:Ye,showCloseButton:!Fe,confirmationBanner:Fe}),document.body),pe&&U(a(Pa,{open:pe,document:P,errorMessage:We||void 0,onSave:aa,onClose:na,isSubmitting:r}),document.body),be&&U(a(ae,{open:be,title:t.generateQuoteModalTitle,message:t.generateQuoteModalMessage,cancelLabel:t.generateQuoteModalCancel,confirmLabel:he?t.generateQuoteModalConfirmLoading:t.generateQuoteModalConfirm,onCancel:ra,onConfirm:he?void 0:ta,showCloseButton:!0,confirmationBanner:se,"data-testid":"generate-quote-confirmation-modal"}),document.body),ve&&U(a(ae,{open:ve,title:t.acceptModalTitle,message:t.acceptModalMessage,cancelLabel:t.acceptModalCancel,confirmLabel:qe?t.acceptModalConfirmLoading:t.acceptModalConfirm,onCancel:ia,onConfirm:qe?void 0:oa,showCloseButton:!0,confirmationBanner:de,"data-testid":"accept-confirmation-modal"}),document.body),Ee&&U(a(ka,{open:Ee,quoteName:L,renameReason:O,quoteNameError:Oe,errorBanner:Qa,successBanner:va,onQuoteNameChange:$e,onRenameReasonChange:ze,onSave:Pe,onClose:Ge}),document.body)]})};export{Sn as ManageNegotiableQuoteTemplate,Sn as default};
//# sourceMappingURL=ManageNegotiableQuoteTemplate.js.map
