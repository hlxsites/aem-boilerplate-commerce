/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as a,jsxs as p,Fragment as pe}from"@dropins/tools/preact-jsx-runtime.js";import{useState as l,useEffect as P,useCallback as s,useMemo as b,useRef as Ia,createPortal as W}from"@dropins/tools/preact-compat.js";import{classes as d,VComponent as I,Slot as D}from"@dropins/tools/lib.js";import{f as $e}from"../chunks/dateUtils.js";import{events as Pe}from"@dropins/tools/event-bus.js";import{Skeleton as wa,SkeletonRow as U,InLineAlert as E,Modal as Ha,Input as ue,Button as H,TextArea as ka,Icon as ae}from"@dropins/tools/components.js";import{N as ze}from"../chunks/transform-quote-template.js";import{S as Ba,A as Aa,T as Fa,R as xa}from"../chunks/RenameQuoteModal.js";/* empty css                              */import"@dropins/tools/preact.js";import"@dropins/tools/preact-hooks.js";import{C as ne}from"../chunks/ConfirmationModal.js";/* empty css                        *//* empty css                          */import{S as F}from"../chunks/WarningFilled.js";import{useText as fe}from"@dropins/tools/i18n.js";import"../chunks/state.js";import{d as Wa,c as Ua,s as Oa,a as Ga,o as $a}from"../chunks/openQuoteTemplate.js";import{g as Pa}from"../chunks/generateQuoteFromTemplate.js";import{S as za}from"../chunks/ShippingAddressDisplay.js";import{I as ja}from"../chunks/ItemsQuotedTemplate.js";import{Q as Va}from"../chunks/QuoteTemplateCommentsList.js";import{Q as Ja}from"../chunks/QuoteTemplateHistoryLog.js";import{S as ge}from"../chunks/CheckWithCircle.js";import"../chunks/transform-quote.js";import"@dropins/tools/fetch-graphql.js";import"../chunks/NegotiableQuoteTemplateFragment.js";import"../chunks/LineItemNoteModal.js";import"../chunks/addQuoteTemplateLineItemNote.js";import"../chunks/QuoteCommentsList.js";import"../chunks/QuoteHistoryLog.js";const Ka=({className:n,loading:u,templateName:c,templateStatus:q,banner:e,details:N,actionBar:Q,referenceDocuments:M,itemsTable:h,shippingInformationTitle:m,shippingInformation:r,commentsTitle:v,comments:g,footer:T,...y})=>u?a(Xa,{}):p("div",{...y,className:d(["quote-management-manage-negotiable-quote-template",n]),children:[p("div",{className:d(["quote-management-manage-negotiable-quote-template__header"]),children:[c&&a(I,{node:c,className:d(["quote-management-manage-negotiable-quote-template__template-name"])}),q&&a(I,{node:q,className:d(["quote-management-manage-negotiable-quote-template__template-status"])})]}),e&&a(I,{node:e,className:d(["quote-management-manage-negotiable-quote-template__banner"])}),N&&a(I,{node:N,className:d(["quote-management-manage-negotiable-quote-template__details"])}),Q&&a(I,{node:Q,className:d(["quote-management-manage-negotiable-quote-template__action-bar"])}),M&&a("div",{"data-testid":"reference-documents-container",className:d(["quote-management-manage-negotiable-quote-template__reference-documents-container"]),children:a(I,{node:M,className:d(["quote-management-manage-negotiable-quote-template__reference-documents"])})}),h&&a(I,{node:h,className:d(["quote-management-manage-negotiable-quote-template__items-table"])}),p("div",{"data-testid":"template-shipping-information-container",className:d(["quote-management-manage-negotiable-quote-template__shipping-information-container"]),children:[m&&a(I,{node:m,className:d(["quote-management-manage-negotiable-quote-template__shipping-information-title"])}),r&&a(I,{node:r,className:d(["quote-management-manage-negotiable-quote-template__shipping-information"])})]}),p("div",{"data-testid":"comments-container",className:d(["quote-management-manage-negotiable-quote-template__comments-container"]),children:[v&&a(I,{node:v,className:d(["quote-management-manage-negotiable-quote-template__comments-title"])}),g&&a(I,{node:g,className:d(["quote-management-manage-negotiable-quote-template__comments"])})]}),T&&a(I,{node:T,className:d(["quote-management-manage-negotiable-quote-template__footer"])})]}),Xa=()=>p(wa,{"data-testid":"manage-negotiable-quote-template-skeleton",children:[a(U,{variant:"heading",fullWidth:!0,size:"large"}),a(U,{variant:"row",fullWidth:!1,size:"small"}),a(U,{variant:"row",fullWidth:!1,size:"small"}),a(U,{variant:"row",fullWidth:!0}),a(U,{variant:"row",fullWidth:!0,size:"xlarge",lines:2}),a(U,{variant:"row",fullWidth:!1,size:"small"})]}),Ya=({className:n,open:u,document:c,errorMessage:q,errorBanner:e,successBanner:N,showCloseButton:Q=!0,isSubmitting:M=!1,onSave:h,onClose:m})=>{const[r,v]=l(""),[g,T]=l(""),[y,w]=l(""),[_,R]=l({}),C=fe({title:"NegotiableQuoteTemplate.Manage.referenceDocuments.form.title",documentNameLabel:"NegotiableQuoteTemplate.Manage.referenceDocuments.form.documentNameLabel",documentIdentifierLabel:"NegotiableQuoteTemplate.Manage.referenceDocuments.form.documentIdentifierLabel",referenceUrlLabel:"NegotiableQuoteTemplate.Manage.referenceDocuments.form.referenceUrlLabel",addButton:"NegotiableQuoteTemplate.Manage.referenceDocuments.form.addButton",updateButton:"NegotiableQuoteTemplate.Manage.referenceDocuments.form.updateButton",cancelButton:"NegotiableQuoteTemplate.Manage.referenceDocuments.form.cancelButton",documentNameRequired:"NegotiableQuoteTemplate.Manage.referenceDocuments.form.documentNameRequired",documentIdentifierRequired:"NegotiableQuoteTemplate.Manage.referenceDocuments.form.documentIdentifierRequired",referenceUrlRequired:"NegotiableQuoteTemplate.Manage.referenceDocuments.form.referenceUrlRequired",invalidUrl:"NegotiableQuoteTemplate.Manage.referenceDocuments.form.invalidUrl",errorHeading:"NegotiableQuoteTemplate.Manage.referenceDocuments.form.errorHeading"}),k=e||(q?a(E,{type:"error",variant:"primary",icon:a(F,{}),heading:C.errorHeading,description:q,"data-testid":"reference-document-form-modal-error-banner-inline"}):null),x=!!c;P(()=>{u&&(c?(v(c.name||""),T(c.identifier||""),w(c.url||"")):(v(""),T(""),w("")),R({}))},[u,c]);const S=s(f=>{if(!f.trim())return!1;try{return new URL(f),!0}catch{return!1}},[]),te=s(()=>{const f={};if(r.trim()||(f.documentName=C.documentNameRequired),y.trim()?S(y.trim())||(f.referenceUrl=C.invalidUrl):f.referenceUrl=C.referenceUrlRequired,g.trim()||(f.documentIdentifier=C.documentIdentifierRequired),Object.keys(f).length>0){R(f);return}h({uid:c==null?void 0:c.uid,name:r.trim(),identifier:g.trim(),url:y.trim()})},[r,g,y,c,C,S,h]),B=s(()=>{v(""),T(""),w(""),R({}),m==null||m()},[m]);return u?p(Ha,{open:u,size:"medium",title:a(pe,{children:C.title}),onClose:B,clickToDismiss:!0,escapeToDismiss:!0,showCloseButton:Q,className:d(["quote-management-reference-document-form-modal",n]),"data-testid":"reference-document-form-modal",children:[k&&a("div",{className:d(["quote-management-reference-document-form-modal__error-banner"]),"data-testid":"reference-document-form-modal-error-banner",children:k}),N&&a("div",{className:d(["quote-management-reference-document-form-modal__success-banner"]),"data-testid":"reference-document-form-modal-success-banner",children:N}),p("div",{className:d(["quote-management-reference-document-form-modal__content"]),children:[p("div",{children:[a(ue,{name:"documentName",type:"text",value:r,onInput:f=>{v(f.target.value),R({..._,documentName:void 0})},floatingLabel:C.documentNameLabel,required:!0,error:!!_.documentName,disabled:M,"data-testid":"reference-document-name-input"}),_.documentName&&a("span",{className:d(["quote-management-reference-document-form-modal__error-text"]),"data-testid":"reference-document-name-error",children:_.documentName})]}),p("div",{children:[a(ue,{name:"documentIdentifier",type:"text",value:g,onInput:f=>{T(f.target.value),R({..._,documentIdentifier:void 0})},floatingLabel:C.documentIdentifierLabel,error:!!_.documentIdentifier,disabled:M,"data-testid":"reference-document-identifier-input"}),_.documentIdentifier&&a("span",{className:d(["quote-management-reference-document-form-modal__error-text"]),"data-testid":"reference-document-identifier-error",children:_.documentIdentifier})]}),p("div",{children:[a(ue,{name:"referenceUrl",type:"url",value:y,onInput:f=>{w(f.target.value),R({..._,referenceUrl:void 0})},floatingLabel:C.referenceUrlLabel,required:!0,error:!!_.referenceUrl,disabled:M,"data-testid":"reference-document-url-input"}),_.referenceUrl&&a("span",{className:d(["quote-management-reference-document-form-modal__error-text"]),"data-testid":"reference-document-url-error",children:_.referenceUrl})]})]}),p("div",{className:d(["quote-management-reference-document-form-modal__actions"]),children:[a(H,{variant:"secondary",size:"medium",onClick:B,disabled:M,className:d(["quote-management-reference-document-form-modal__cancel-button"]),"data-testid":"reference-document-form-cancel-button",children:C.cancelButton}),a(H,{variant:"primary",size:"medium",onClick:te,disabled:M,className:d(["quote-management-reference-document-form-modal__save-button"]),"data-testid":"reference-document-form-save-button",children:x?C.updateButton:C.addButton})]})]}):null},Za=({className:n,documents:u,isEditable:c=!1,onAdd:q,onEdit:e,onRemove:N,...Q})=>{const M=fe({add:"NegotiableQuoteTemplate.Manage.referenceDocuments.add",edit:"NegotiableQuoteTemplate.Manage.referenceDocuments.edit",remove:"NegotiableQuoteTemplate.Manage.referenceDocuments.remove",noReferenceDocuments:"NegotiableQuoteTemplate.Manage.referenceDocuments.noReferenceDocuments"}),h=r=>r.identifier?`${r.name}, ${r.identifier}`:`${r.name} ${r.url}`,m=(r,v)=>{r.preventDefault(),window.open(v,"_blank","noopener,noreferrer")};return a("div",{className:d(["quote-management-reference-documents-list",n]),"data-testid":"reference-documents-list",...Q,children:p("div",{className:"quote-management-reference-documents-list__content",children:[u.map(r=>p("div",{className:"quote-management-reference-documents-list__document","data-testid":`reference-document-${r.uid||r.url}`,children:[a("a",{href:r.url,onClick:v=>m(v,r.url),className:"quote-management-reference-documents-list__document-link",target:"_blank",rel:"noopener noreferrer","data-testid":`reference-document-link-${r.uid||r.url}`,children:h(r)}),c&&p("div",{className:"quote-management-reference-documents-list__document-actions",children:[a(H,{variant:"tertiary",onClick:()=>e==null?void 0:e(r),className:"quote-management-reference-documents-list__edit-button","data-testid":`reference-document-edit-${r.uid||r.url}`,children:M.edit}),a("span",{className:"quote-management-reference-documents-list__separator",children:"|"}),a(H,{variant:"tertiary",onClick:()=>N==null?void 0:N(r),className:"quote-management-reference-documents-list__remove-button","data-testid":`reference-document-remove-${r.uid||r.url}`,children:M.remove})]})]},r.uid||r.url)),c&&p(H,{variant:"tertiary",onClick:q,className:"quote-management-reference-documents-list__add-button","data-testid":"reference-documents-add-button",children:["+ ",M.add]}),u.length===0&&!c&&a("div",{className:"quote-management-reference-documents-list__empty",children:M.noReferenceDocuments})]})})},en=n=>{const{templateReferenceDocuments:u,localReferenceDocuments:c}=n,q=s(m=>{if(u)return u.find(r=>m.uid&&r.uid?r.uid===m.uid:r.url===m.url)},[u]),e=s(m=>q(m)!==void 0,[q]),N=s((m,r)=>m.name!==r.name||m.identifier!==r.identifier||m.url!==r.url,[]),Q=s(()=>u?c.filter(m=>!u.some(r=>m.uid&&r.uid?r.uid===m.uid:r.url===m.url)):c,[u,c]),M=s(()=>c.map(m=>({uid:m.uid,name:m.name,identifier:m.identifier,url:m.url})),[c]),h=b(()=>u?c.some(g=>q(g)===void 0)||u.some(g=>!c.some(T=>T.uid&&g.uid?T.uid===g.uid:T.url===g.url))?!0:c.some(g=>{const T=q(g);return T?N(g,T):!1}):c.length>0,[u,c,q,N]);return{isDocumentInTemplateData:e,getNewDocuments:Q,getReferenceDocumentLinks:M,hasUnsavedChanges:h}},an=(n={})=>{const{initialTemplateName:u,templateNameRequiredErrorMessage:c="Template name is required"}=n,[q,e]=l(!1),[N,Q]=l(""),[M,h]=l(""),[m,r]=l(""),[v,g]=l(""),[T,y]=l(""),w=s(S=>{Q(S||u||""),h(""),r(""),g(""),y(""),e(!0)},[u]),_=s(()=>{e(!1),Q(""),h(""),r(""),g(""),y("")},[]),R=s(S=>{Q(S),S.trim()&&g("")},[]),C=s(S=>{h(S)},[]),k=s(()=>N.trim()?(r(""),g(""),e(!1),!0):(g(c),!1),[N,c]),x=s(()=>{Q(""),h(""),r(""),g(""),y("")},[]);return{isRenameModalOpen:q,renameTemplateName:N,renameReason:M,renameError:m,renameTemplateNameError:v,renameSuccess:T,handleRenameClick:w,handleRenameClose:_,handleRenameTemplateNameChange:R,handleRenameReasonChange:C,handleRenameSave:k,resetRenameState:x}},Bn=({slots:n,onActionsButtonClick:u,onSendForReview:c,...q})=>{var Ge;const[e,N]=l(void 0),[Q,M]=l(!0),[h,m]=l(""),[r,v]=l(!1),[g,T]=l(!1),[y,w]=l(null),[_,R]=l(!1),[C,k]=l(!1),[x,S]=l(null),[te,B]=l(!1),[f,O]=l([]),[be,z]=l(!1),[j,V]=l(void 0),[je,J]=l(null),[Me,he]=l(!1),[Te,Ne]=l(!1),[Qe,K]=l(""),[ve,X]=l(""),[Ce,qe]=l(!1),[_e,ye]=l(!1),[Re,Y]=l(""),[Se,Z]=l(""),De=Ia(!1),[Ee,Ve]=l(!0),{getReferenceDocumentLinks:Le,hasUnsavedChanges:Ie}=en({templateReferenceDocuments:e==null?void 0:e.referenceDocuments,localReferenceDocuments:f}),t=fe({createdLabel:"NegotiableQuoteTemplate.Manage.createdLabel",salesRepLabel:"NegotiableQuoteTemplate.Manage.salesRepLabel",expiresLabel:"NegotiableQuoteTemplate.Manage.expiresLabel",templateIdLabel:"NegotiableQuoteTemplate.Manage.templateIdLabel",actionsLabel:"NegotiableQuoteTemplate.Manage.actionsLabel",referenceDocumentsTitle:"NegotiableQuoteTemplate.Manage.referenceDocuments.title",commentsTitle:"NegotiableQuoteTemplate.Manage.comments.title",historyLogTitle:"NegotiableQuoteTemplate.Manage.historyLog.title",itemsQuotedTab:"NegotiableQuoteTemplate.Manage.tabs.itemsQuoted",commentsTab:"NegotiableQuoteTemplate.Manage.tabs.comments",historyLogTab:"NegotiableQuoteTemplate.Manage.tabs.historyLog",templateCommentsPlaceholder:"NegotiableQuoteTemplate.Manage.templateComments.placeholder",sendForReview:"NegotiableQuoteTemplate.Manage.actionButtons.sendForReview",delete:"NegotiableQuoteTemplate.Manage.actionButtons.delete",cancel:"NegotiableQuoteTemplate.Manage.actionButtons.cancel",confirmationModalDeleteTitle:"NegotiableQuoteTemplate.Manage.confirmationModal.delete.title",confirmationModalDeleteMessage:"NegotiableQuoteTemplate.Manage.confirmationModal.delete.message",confirmationModalDeleteConfirm:"NegotiableQuoteTemplate.Manage.confirmationModal.delete.confirm",confirmationModalDeleteErrorHeading:"NegotiableQuoteTemplate.Manage.confirmationModal.delete.errorHeading",confirmationModalDeleteErrorFallback:"NegotiableQuoteTemplate.Manage.confirmationModal.delete.errorFallback",confirmationModalDeleteSuccessHeading:"NegotiableQuoteTemplate.Manage.confirmationModal.delete.successHeading",confirmationModalDeleteSuccessDescription:"NegotiableQuoteTemplate.Manage.confirmationModal.delete.successDescription",confirmationModalCancelTitle:"NegotiableQuoteTemplate.Manage.confirmationModal.cancelTemplate.title",confirmationModalCancelMessage:"NegotiableQuoteTemplate.Manage.confirmationModal.cancelTemplate.message",confirmationModalCancelConfirm:"NegotiableQuoteTemplate.Manage.confirmationModal.cancelTemplate.confirm",confirmationModalCancelErrorHeading:"NegotiableQuoteTemplate.Manage.confirmationModal.cancelTemplate.errorHeading",confirmationModalCancelErrorFallback:"NegotiableQuoteTemplate.Manage.confirmationModal.cancelTemplate.errorFallback",confirmationModalCancelSuccessHeading:"NegotiableQuoteTemplate.Manage.confirmationModal.cancelTemplate.successHeading",confirmationModalCancelSuccessDescription:"NegotiableQuoteTemplate.Manage.confirmationModal.cancelTemplate.successDescription",confirmationModalCancel:"NegotiableQuoteTemplate.Manage.confirmationModal.cancel",accept:"NegotiableQuoteTemplate.Manage.actionButtons.accept",generateQuote:"NegotiableQuoteTemplate.Manage.actionButtons.generateQuote",generateQuoteModalTitle:"NegotiableQuoteTemplate.Manage.actionButtons.generateQuote",generateQuoteModalMessage:"NegotiableQuoteTemplate.Manage.confirmationModal.generateQuote.message",generateQuoteModalCancel:"NegotiableQuoteTemplate.Manage.confirmationModal.cancel",generateQuoteModalConfirm:"NegotiableQuoteTemplate.Manage.confirmationModal.generateQuote.confirm",generateQuoteModalConfirmLoading:"NegotiableQuoteTemplate.Manage.confirmationModal.generateQuote.confirmLoading",generateQuoteModalSuccessHeading:"NegotiableQuoteTemplate.Manage.confirmationModal.generateQuote.successHeading",generateQuoteSuccessMessage:"NegotiableQuoteTemplate.Manage.confirmationModal.generateQuote.successDescription",generateQuoteModalErrorHeading:"NegotiableQuoteTemplate.Manage.confirmationModal.generateQuote.errorHeading",generateQuoteErrorFallback:"NegotiableQuoteTemplate.Manage.confirmationModal.generateQuote.errorFallback",acceptModalTitle:"NegotiableQuoteTemplate.Manage.confirmationModal.accept.title",acceptModalMessage:"NegotiableQuoteTemplate.Manage.confirmationModal.accept.message",acceptModalCancel:"NegotiableQuoteTemplate.Manage.confirmationModal.cancel",acceptModalConfirm:"NegotiableQuoteTemplate.Manage.confirmationModal.accept.confirm",acceptModalConfirmLoading:"NegotiableQuoteTemplate.Manage.confirmationModal.accept.confirmLoading",acceptModalSuccessHeading:"NegotiableQuoteTemplate.Manage.confirmationModal.accept.successHeading",acceptSuccessMessage:"NegotiableQuoteTemplate.Manage.confirmationModal.accept.successDescription",acceptModalErrorHeading:"NegotiableQuoteTemplate.Manage.confirmationModal.accept.errorHeading",acceptErrorFallback:"NegotiableQuoteTemplate.Manage.confirmationModal.accept.errorFallback",documentDuplicateUidError:"NegotiableQuoteTemplate.Manage.referenceDocuments.form.duplicateUidError",renameTitle:"NegotiableQuoteTemplate.Manage.rename.title",renameTemplateNameLabel:"NegotiableQuoteTemplate.Manage.rename.templateNameLabel",renameReasonLabel:"NegotiableQuoteTemplate.Manage.rename.reasonLabel",renameButton:"NegotiableQuoteTemplate.Manage.rename.renameButton",renameCancelButton:"NegotiableQuoteTemplate.Manage.rename.cancelButton",renameErrorHeading:"NegotiableQuoteTemplate.Manage.rename.errorHeading",renameTemplateNameRequired:"NegotiableQuoteTemplate.Manage.rename.templateNameRequired",renameErrorDefault:"NegotiableQuoteTemplate.Manage.rename.errorDefault",renameSuccessHeading:"NegotiableQuoteTemplate.Manage.rename.successHeading",renameSuccessMessage:"NegotiableQuoteTemplate.Manage.rename.successMessage",shippingInformationTitle:"NegotiableQuoteTemplate.Manage.shippingInformation.title",unsavedChangesWarningHeading:"NegotiableQuoteTemplate.Manage.unsavedChangesWarningHeading",unsavedChangesWarningMessage:"NegotiableQuoteTemplate.Manage.unsavedChangesWarningMessage",shippingAddressWarningHeading:"NegotiableQuoteTemplate.Manage.shippingAddressWarningHeading",shippingAddressWarningMessage:"NegotiableQuoteTemplate.Manage.shippingAddressWarningMessage",noEditQuoteTemplateAccessTitle:"QuoteManagement.permissions.noEditQuoteTemplateAccessTitle",noEditQuoteTemplateAccessMessage:"QuoteManagement.permissions.noEditQuoteTemplateAccessMessage"});P(()=>{const o=Pe.on("quote-management/permissions",i=>{Ve(!!(i.manageQuoteTemplates||i.viewQuoteTemplates))},{eager:!0});return()=>o==null?void 0:o.off()},[]);const{isRenameModalOpen:we,renameTemplateName:L,renameReason:G,renameError:re,renameTemplateNameError:Je,renameSuccess:oe,handleRenameClick:He,handleRenameClose:Ke,handleRenameTemplateNameChange:Xe,handleRenameReasonChange:Ye,handleRenameSave:Ze,resetRenameState:ke}=an({initialTemplateName:e==null?void 0:e.name,templateNameRequiredErrorMessage:t.renameTemplateNameRequired}),Be=b(()=>L!==""&&L!==(e==null?void 0:e.name),[L,e==null?void 0:e.name]),$=b(()=>Ie||Be,[Ie,Be]);P(()=>{const o=Pe.on("quote-management/quote-template-data",i=>{i.quoteTemplate&&(N(i.quoteTemplate),M(!1),m(""),v(!1),O(i.quoteTemplate.referenceDocuments||[]),ke())},{eager:!0});return()=>o==null?void 0:o.off()},[ke]),P(()=>{e!=null&&e.referenceDocuments&&O(e.referenceDocuments)},[e==null?void 0:e.referenceDocuments]),P(()=>{e&&e.status===ze.UPDATED&&!De.current&&(De.current=!0,(async()=>{try{await $a({templateId:e.id})}catch(i){console.error("Failed to auto-open quote template:",i)}})())},[e]);const ea=s(()=>{T(!1),w(null),R(!1)},[]),aa=s(async()=>{if(e!=null&&e.id){w(null),R(!1);try{await Wa({templateId:e.id}),R(!0),setTimeout(()=>{T(!1),R(!1)},2e3)}catch(o){const i=o.message||t.confirmationModalDeleteErrorFallback;w(i)}}},[e,t.confirmationModalDeleteErrorFallback]),na=s(()=>{w(null)},[]),ta=s(()=>{R(!1)},[]),ra=s(()=>{k(!1),S(null),B(!1)},[]),oa=s(async()=>{if(e!=null&&e.id){S(null),B(!1);try{await Ua({templateId:e.id}),B(!0),setTimeout(()=>{k(!1),B(!1)},2e3)}catch(o){const i=o.message||t.confirmationModalCancelErrorFallback;S(i)}}},[e,t.confirmationModalCancelErrorFallback]),ia=s(()=>{S(null)},[]),ca=s(()=>{B(!1)},[]),ie=s(async()=>{const o=Le(),i=[G.trim(),h.trim()].filter(Boolean).join(`

`).trim()||void 0,A=L&&L!==(e==null?void 0:e.name)?L:void 0;if(c){c({templateData:e,name:A,comment:i,referenceDocumentLinks:o});return}v(!0);try{await Oa({templateId:e.id,name:A,comment:i,referenceDocumentLinks:o.length>0?o:void 0})}catch(La){console.error("Failed to send quote template for review:",La),v(!1)}},[e,c,h,G,L,Le]),ce=s(()=>{V(void 0),J(null),z(!0)},[]),me=s(o=>{V(o),J(null),z(!0)},[]),le=s(o=>{O(i=>i.filter(A=>A.uid!==o.uid||A.url!==o.url))},[]),ma=s(o=>{J(null),O(j?i=>i.map(A=>A.identifier===j.identifier?o:A):i=>[...i,o]),z(!1),V(void 0)},[j]),la=s(()=>{z(!1),V(void 0),J(null)},[]),sa=s(async()=>{Ne(!0),X(""),K("");try{await Pa({templateId:e.id}),K(t.generateQuoteSuccessMessage)}catch(o){console.error("Failed to generate quote from template:",o);const i=o instanceof Error?o.message:t.generateQuoteErrorFallback;X(i)}finally{Ne(!1)}},[e,t.generateQuoteSuccessMessage,t.generateQuoteErrorFallback]),da=s(()=>{he(!1),X(""),K("")},[]),ua=s(async()=>{ye(!0),Z(""),Y("");try{await Ga({templateId:e.id}),Y(t.acceptSuccessMessage)}catch(o){console.error("Failed to accept quote template:",o);const i=o instanceof Error?o.message:t.acceptErrorFallback;Z(i)}finally{ye(!1)}},[e,t.acceptSuccessMessage,t.acceptErrorFallback]),ga=s(()=>{qe(!1),Z(""),Y("")},[]),pa=b(()=>{const o=!(e!=null&&e.canSendForReview),i=L||(e==null?void 0:e.name);return a(D,{name:"TemplateName",slot:n==null?void 0:n.TemplateName,context:{templateName:e==null?void 0:e.name,templateData:e,templateDisplayName:i,isRenameDisabled:o},children:p("div",{className:"quote-management-manage-negotiable-quote-template__template-name-wrapper",children:[a("h1",{"data-testid":"template-name",className:"quote-management-manage-negotiable-quote-template__template-name-title",children:i}),a("button",{onClick:()=>He(i),disabled:o,"data-testid":"rename-template-button",className:"quote-management-manage-negotiable-quote-template__rename-button","aria-label":"Rename template",children:a(Ba,{})})]})})},[n==null?void 0:n.TemplateName,e,He,L]),fa=b(()=>a(D,{name:"TemplateStatus",slot:n==null?void 0:n.TemplateStatus,context:{templateStatus:e==null?void 0:e.status,templateData:e},children:a("div",{"data-testid":"template-status",children:e==null?void 0:e.status})}),[n==null?void 0:n.TemplateStatus,e]),ba=b(()=>{if(!e)return;const o=e.expirationDate?$e(e.expirationDate,"short"):void 0;return p(D,{name:"Details",slot:n==null?void 0:n.Details,context:{templateData:e},children:[p("div",{className:"quote-management-manage-negotiable-quote-template__detail",children:[a("span",{className:"quote-management-manage-negotiable-quote-template__detail-title","data-testid":"template-id-label",children:t.templateIdLabel}),a("span",{className:"quote-management-manage-negotiable-quote-template__detail-content","data-testid":"template-id-value",children:e.id})]}),p("div",{className:"quote-management-manage-negotiable-quote-template__detail",children:[a("span",{className:"quote-management-manage-negotiable-quote-template__detail-title","data-testid":"created-label",children:t.createdLabel}),p("span",{className:"quote-management-manage-negotiable-quote-template__detail-content","data-testid":"created-value",children:[$e(e.createdAt,"short")," (",e.buyer.firstname," ",e.buyer.lastname,")"]})]}),p("div",{className:"quote-management-manage-negotiable-quote-template__detail",children:[a("span",{className:"quote-management-manage-negotiable-quote-template__detail-title","data-testid":"sales-rep-label",children:t.salesRepLabel}),a("span",{className:"quote-management-manage-negotiable-quote-template__detail-content","data-testid":"sales-rep-value",children:e.salesRepName})]}),o&&p("div",{className:"quote-management-manage-negotiable-quote-template__detail",children:[a("span",{className:"quote-management-manage-negotiable-quote-template__detail-title","data-testid":"expires-label",children:t.expiresLabel}),a("span",{className:"quote-management-manage-negotiable-quote-template__detail-content","data-testid":"expires-value",children:o})]})]})},[n==null?void 0:n.Details,t,e]),Ae=b(()=>[{label:t.generateQuote,value:"generateQuote",disabled:!(e!=null&&e.canGenerateQuoteFromTemplate)}],[t,e==null?void 0:e.canGenerateQuoteFromTemplate]),Ma=b(()=>{const o=i=>{switch(i){case"generateQuote":he(!0),X(""),K(""),u==null||u(i);break}};return a(D,{name:"ActionBar",slot:n==null?void 0:n.ActionBar,context:{templateData:e},children:a(Aa,{dropdownPlaceholder:t.actionsLabel,dropdownOptions:[],buttons:Ae.map(i=>a(H,{variant:"tertiary",onClick:()=>o(i.value),"data-testid":`actions-bar-${i.value}-button`,"data-action":i.value,disabled:i.disabled,children:i.label},i.value))})})},[Ae,t,n==null?void 0:n.ActionBar,e,u]),ee=b(()=>{const o=e==null?void 0:e.status;return o==="Draft"||o==="Open"},[e==null?void 0:e.status]),ha=b(()=>{const o=f.length>0||ee,i=o?t.referenceDocumentsTitle:void 0;return a(D,{name:"ReferenceDocuments",slot:n==null?void 0:n.ReferenceDocuments,context:{templateData:e,referenceDocuments:f,isEditable:ee,onAddDocument:ce,onEditDocument:me,onRemoveDocument:le,referenceDocumentsTitle:t.referenceDocumentsTitle},children:p("div",{"data-testid":"reference-documents",children:[o&&a("h2",{children:i}),a(Za,{documents:f,isEditable:ee,onAdd:ce,onEdit:me,onRemove:le})]})})},[n==null?void 0:n.ReferenceDocuments,t,e,f,ee,ce,me,le]),Ta=b(()=>a(D,{name:"ShippingInformationTitle",slot:n==null?void 0:n.ShippingInformationTitle,context:{templateData:e},children:a("h2",{children:t.shippingInformationTitle})}),[n==null?void 0:n.ShippingInformationTitle,e,t]),Na=b(()=>{var o;return a(D,{name:"ShippingInformation",slot:n==null?void 0:n.ShippingInformation,context:{templateData:e,loading:Q,setLoading:M},children:a(za,{shippingAddress:(o=e==null?void 0:e.shippingAddresses)==null?void 0:o[0],loading:Q,"data-testid":"manage-template-shipping-address"})})},[n==null?void 0:n.ShippingInformation,e,Q,M]),Qa=b(()=>a(D,{name:"ItemsTable",slot:n==null?void 0:n.ItemsTable,context:{templateData:e},children:a(Fa,{tabs:new Map([["items-quoted",t.itemsQuotedTab],["comments",t.commentsTab],["history-log",t.historyLogTab]]),tabsContent:new Map([["items-quoted",a(D,{name:"ItemsQuotedTab",slot:n==null?void 0:n.ItemsQuotedTab,context:{templateData:e},children:a(ja,{templateData:e})},"items-quoted")],["comments",a(D,{name:"CommentsTab",slot:n==null?void 0:n.CommentsTab,context:{templateData:e},children:a(Va,{templateData:e})},"comments")],["history-log",a(D,{name:"HistoryLogTab",slot:n==null?void 0:n.HistoryLogTab,context:{templateData:e},children:a(Ja,{templateData:e})},"history-log")]])})}),[n==null?void 0:n.ItemsTable,n==null?void 0:n.ItemsQuotedTab,n==null?void 0:n.CommentsTab,n==null?void 0:n.HistoryLogTab,t,e]),va=b(()=>a(D,{name:"CommentsTitle",slot:n==null?void 0:n.CommentsTitle,context:{templateData:e},children:a("h2",{children:t.commentsTitle})}),[n==null?void 0:n.CommentsTitle,t,e]),Ca=b(()=>a(D,{name:"Comments",slot:n==null?void 0:n.Comments,context:{templateData:e},children:a(ka,{name:"templateComments",placeholder:t.templateCommentsPlaceholder,rows:3,value:h,onInput:o=>{m(o.target.value)},disabled:!(e!=null&&e.canSendForReview)||r})}),[n==null?void 0:n.Comments,t,e,h,r]),Fe=b(()=>$?a(E,{type:"warning",variant:"primary",icon:a(F,{}),heading:t.unsavedChangesWarningHeading,description:t.unsavedChangesWarningMessage,"data-testid":"unsaved-changes-warning-alert"}):void 0,[$,t.unsavedChangesWarningHeading,t.unsavedChangesWarningMessage]),xe=b(()=>{var o;return(o=e==null?void 0:e.shippingAddresses)!=null&&o.length?void 0:a(E,{type:"warning",variant:"primary",icon:a(F,{}),heading:t.shippingAddressWarningHeading,description:t.shippingAddressWarningMessage,"data-testid":"shipping-address-warning-alert"})},[(Ge=e==null?void 0:e.shippingAddresses)==null?void 0:Ge.length,t.shippingAddressWarningHeading,t.shippingAddressWarningMessage]),We=b(()=>!Ee&&e?a(E,{type:"warning",variant:"primary",icon:a(F,{}),heading:t.noEditQuoteTemplateAccessTitle,description:t.noEditQuoteTemplateAccessMessage,"data-testid":"quote-template-permission-warning-banner"}):void 0,[Ee,e,t.noEditQuoteTemplateAccessTitle,t.noEditQuoteTemplateAccessMessage]),qa=b(()=>p(pe,{children:[We,Fe,xe]}),[We,Fe,xe]),_a=b(()=>{var i;const o=(e==null?void 0:e.status)===ze.OPEN&&(e==null?void 0:e.canAccept);return p(D,{name:"Footer",slot:n==null?void 0:n.Footer,context:{templateData:e,comment:h,isSubmitting:r,referenceDocuments:f,hasUnsavedChanges:$,handleSendForReview:ie,showAcceptButton:o,renameTemplateName:L,renameReason:G},children:[o&&a(H,{variant:"primary",onClick:()=>{qe(!0),Z(""),Y("")},"data-testid":"accept-button",disabled:r||$,children:t.accept}),(e==null?void 0:e.canSendForReview)&&a(H,{variant:"primary",onClick:ie,"data-testid":"send-for-review-button",disabled:r||!((i=e==null?void 0:e.shippingAddresses)!=null&&i.length),children:t.sendForReview}),(e==null?void 0:e.canCancel)&&a(H,{variant:"tertiary",onClick:()=>k(!0),"data-testid":"cancel-template-button",disabled:r,children:t.cancel}),(e==null?void 0:e.canDelete)&&a(H,{variant:"tertiary",onClick:()=>T(!0),"data-testid":"delete-template-button",disabled:r,children:t.delete})]})},[n==null?void 0:n.Footer,t,e,h,r,ie,f,$,L,G]),ya=y?a(E,{type:"error",variant:"primary",icon:a(F,{}),heading:t.confirmationModalDeleteErrorHeading,description:y,onDismiss:na,"data-testid":"confirmation-modal-error-banner"}):null,Ue=(_?a(E,{type:"success",variant:"primary",icon:a(ge,{}),heading:t.confirmationModalDeleteSuccessHeading,description:t.confirmationModalDeleteSuccessDescription,onDismiss:ta,"data-testid":"confirmation-modal-success-banner"}):null)||ya,Ra=x?a(E,{type:"error",variant:"primary",icon:a(F,{}),heading:t.confirmationModalCancelErrorHeading,description:x,onDismiss:ia,"data-testid":"confirmation-modal-cancel-error-banner"}):null,Oe=(te?a(E,{type:"success",variant:"primary",icon:a(ge,{}),heading:t.confirmationModalCancelSuccessHeading,description:t.confirmationModalCancelSuccessDescription,onDismiss:ca,"data-testid":"confirmation-modal-cancel-success-banner"}):null)||Ra,Sa=b(()=>re?a(E,{type:"error",variant:"primary",icon:a(F,{color:"var(--color-error)"}),heading:t.renameErrorHeading,description:re}):void 0,[re,t.renameErrorHeading]),Da=b(()=>oe?a(E,{type:"success",variant:"primary",icon:a(ge,{}),heading:t.renameSuccessHeading,description:oe}):void 0,[oe,t.renameSuccessHeading]),Ea={...q,loading:Q,templateName:pa,templateStatus:fa,banner:qa,details:ba,actionBar:Ma,referenceDocuments:ha,itemsTable:Qa,shippingInformationTitle:Ta,shippingInformation:Na,commentsTitle:va,comments:Ca,footer:_a};let se=null;Qe?se=a(E,{type:"success",variant:"primary",icon:a(ae,{source:"CheckWithCircle"}),heading:t.generateQuoteModalSuccessHeading,description:Qe,"data-testid":"generate-quote-success-banner"}):ve&&(se=a(E,{type:"error",variant:"primary",icon:a(ae,{source:"WarningFilled"}),heading:t.generateQuoteModalErrorHeading,description:ve,"data-testid":"generate-quote-error-banner"}));let de=null;return Re?de=a(E,{type:"success",variant:"primary",icon:a(ae,{source:"CheckWithCircle"}),heading:t.acceptModalSuccessHeading,description:Re,"data-testid":"accept-success-banner"}):Se&&(de=a(E,{type:"error",variant:"primary",icon:a(ae,{source:"WarningFilled"}),heading:t.acceptModalErrorHeading,description:Se,"data-testid":"accept-error-banner"})),p(pe,{children:[a(Ka,{...Ea}),g&&W(a(ne,{open:g,title:t.confirmationModalDeleteTitle,message:t.confirmationModalDeleteMessage,cancelLabel:t.confirmationModalCancel,confirmLabel:t.confirmationModalDeleteConfirm,onCancel:ea,onConfirm:aa,showCloseButton:!Ue,confirmationBanner:Ue}),document.body),C&&W(a(ne,{open:C,title:t.confirmationModalCancelTitle,message:t.confirmationModalCancelMessage,cancelLabel:t.confirmationModalCancel,confirmLabel:t.confirmationModalCancelConfirm,onCancel:ra,onConfirm:oa,showCloseButton:!Oe,confirmationBanner:Oe}),document.body),be&&W(a(Ya,{open:be,document:j,errorMessage:je||void 0,onSave:ma,onClose:la,isSubmitting:r}),document.body),Me&&W(a(ne,{open:Me,title:t.generateQuoteModalTitle,message:t.generateQuoteModalMessage,cancelLabel:t.generateQuoteModalCancel,confirmLabel:Te?t.generateQuoteModalConfirmLoading:t.generateQuoteModalConfirm,onCancel:da,onConfirm:Te?void 0:sa,showCloseButton:!0,confirmationBanner:se,"data-testid":"generate-quote-confirmation-modal"}),document.body),Ce&&W(a(ne,{open:Ce,title:t.acceptModalTitle,message:t.acceptModalMessage,cancelLabel:t.acceptModalCancel,confirmLabel:_e?t.acceptModalConfirmLoading:t.acceptModalConfirm,onCancel:ga,onConfirm:_e?void 0:ua,showCloseButton:!0,confirmationBanner:de,"data-testid":"accept-confirmation-modal"}),document.body),we&&W(a(xa,{open:we,quoteName:L,renameReason:G,quoteNameError:Je,errorBanner:Sa,successBanner:Da,onQuoteNameChange:Xe,onRenameReasonChange:Ye,onSave:Ze,onClose:Ke}),document.body)]})};export{Bn as ManageNegotiableQuoteTemplate,Bn as default};
//# sourceMappingURL=ManageNegotiableQuoteTemplate.js.map
