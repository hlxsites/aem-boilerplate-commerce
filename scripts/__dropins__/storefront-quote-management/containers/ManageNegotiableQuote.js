/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as t,jsxs as p}from"@dropins/tools/preact-jsx-runtime.js";import{useState as x,useMemo as b,useEffect as M,useCallback as F}from"@dropins/tools/preact-compat.js";import{classes as d,VComponent as c,Slot as u,getGlobalLocale as D}from"@dropins/tools/lib.js";/* empty css                     */import{Picker as J,Skeleton as K,SkeletonRow as Q,InLineAlert as Y,Button as C,TextArea as Z}from"@dropins/tools/components.js";import{events as y}from"@dropins/tools/event-bus.js";/* empty css                          */import"@dropins/tools/preact.js";/* empty css                        *//* empty css                                  *//* empty css                          */import{S as O}from"../chunks/ShippingAddressDisplay.js";import{Q as k}from"../chunks/QuoteHistoryLog.js";import"../chunks/transform-quote.js";import"@dropins/tools/fetch-graphql.js";import{s as B}from"../chunks/sendForReview.js";import{I as A}from"../chunks/ItemsQuoted.js";import{Q as ee}from"../chunks/QuoteCommentsList.js";import{S as ae}from"../chunks/WarningFilled.js";import{useText as te}from"@dropins/tools/i18n.js";import"../chunks/NegotiableQuoteFragment.js";const ne=({className:q,dropdownPlaceholder:e,dropdownOptions:n,handleDropdownChange:s,buttons:g,...a})=>{const f=n&&n.length>0,h=g&&g.length>0,l=(n==null?void 0:n.map(m=>({text:m.label,value:m.value})))||[];return l.unshift({text:e||"",value:""}),t("div",{className:"quote-management-actions-bar__container","data-testid":"actions-bar-container",children:p("div",{className:d(["quote-management-actions-bar",q]),"data-testid":"actions-bar",...a,children:[f&&t(J,{name:"dropdown",id:"dropdown",onInput:s,className:"quote-management-actions-bar__dropdown","data-testid":"dropdown",options:l}),h&&t("div",{className:"quote-management-actions-bar__buttons","data-testid":"buttons-container",children:g==null?void 0:g.map((m,_)=>t(c,{node:m,className:d(["quote-management-actions-bar__button"])},_))})]})})},re=({className:q,loading:e,quoteName:n,quoteStatus:s,banner:g,details:a,actionBar:f,quoteContent:h,shippingInformationTitle:l,shippingInformation:m,quoteCommentsTitle:_,quoteComments:v,footer:T,...r})=>e?t(ie,{}):p("div",{...r,className:d(["quote-management-manage-negotiable-quote",q]),children:[p("div",{className:d(["quote-management-manage-negotiable-quote__header"]),children:[n&&t(c,{node:n,className:d(["quote-management-manage-negotiable-quote__quote-name"])}),s&&t(c,{node:s,className:d(["quote-management-manage-negotiable-quote__quote-status"])})]}),g&&t(c,{node:g,className:d(["quote-management-manage-negotiable-quote__banner"])}),a&&t(c,{node:a,className:d(["quote-management-manage-negotiable-quote__details"])}),f&&t(c,{node:f,className:d(["quote-management-manage-negotiable-quote__action-bar"])}),h&&t(c,{node:h,className:d(["quote-management-manage-negotiable-quote__quote-content"])}),p("div",{"data-testid":"quote-shipping-information-container",className:d(["quote-management-manage-negotiable-quote__shipping-information-container"]),children:[l&&t(c,{node:l,className:d(["quote-management-manage-negotiable-quote__shipping-information-title"])}),m&&t(c,{node:m,className:d(["quote-management-manage-negotiable-quote__shipping-information"])})]}),p("div",{"data-testid":"quote-comments-container",className:d(["quote-management-manage-negotiable-quote__quote-comments-container"]),children:[_&&t(c,{node:_,className:d(["quote-management-manage-negotiable-quote__quote-comments-title"])}),v&&t(c,{node:v,className:d(["quote-management-manage-negotiable-quote__quote-comments"])})]}),t(c,{node:T,className:d(["quote-management-manage-negotiable-quote__footer"])})]}),ie=()=>p(K,{"data-testid":"manage-negotiable-quote-skeleton",children:[t(Q,{variant:"heading",fullWidth:!0,size:"large"}),t(Q,{variant:"row",fullWidth:!1,size:"small"}),t(Q,{variant:"row",fullWidth:!1,size:"small"}),t(Q,{variant:"row",fullWidth:!0}),t(Q,{variant:"row",fullWidth:!0,size:"xlarge",lines:2}),t(Q,{variant:"row",fullWidth:!1,size:"small"})]}),me=({className:q,tabs:e,tabsContent:n,defaultActiveTab:s,...g})=>{const[a,f]=x(s||Array.from(e.keys())[0]),h=m=>{f(m)},l=b(()=>n.get(a),[a,n]);return p("div",{...g,className:d(["quote-management-tabbed-content",q]),children:[e&&t("div",{"data-testid":"tabbed-content-tabs",className:d(["quote-management-tabbed-content__tabs"]),children:Array.from(e.entries()).map(([m,_])=>t("button",{className:d(["quote-management-tabbed-content__tab",["quote-management-tabbed-content__tab--active",m===a]]),onClick:()=>h(m),children:_},m))}),l&&t("div",{className:d(["quote-management-tabbed-content__active-tab-content"]),children:t(c,{node:l})})]})},we=({onActionsDropdownChange:q,slots:e,onActionsButtonClick:n,onSendForReview:s,...g})=>{const[a,f]=x(void 0),[h,l]=x(!0),[m,_]=x(""),[v,T]=x(!1),r=te({createdLabel:"NegotiableQuote.Manage.createdLabel",salesRepLabel:"NegotiableQuote.Manage.salesRepLabel",expiresLabel:"NegotiableQuote.Manage.expiresLabel",actionsLabel:"NegotiableQuote.Manage.actionsLabel",remove:"NegotiableQuote.Manage.actions.remove",close:"NegotiableQuote.Manage.actionButtons.close",delete:"NegotiableQuote.Manage.actionButtons.delete",print:"NegotiableQuote.Manage.actionButtons.print",createTemplate:"NegotiableQuote.Manage.actionButtons.createTemplate",createCopy:"NegotiableQuote.Manage.actionButtons.createCopy",shippingInformationTitle:"NegotiableQuote.Manage.shippingInformation.title",quoteCommentsTitle:"NegotiableQuote.Manage.quoteComments.title",quoteCommentsPlaceholder:"NegotiableQuote.Manage.quoteComments.placeholder",sendForReview:"NegotiableQuote.Manage.actionButtons.sendForReview",bannerTitle:"NegotiableQuote.Manage.bannerTitle",statusSubmitted:"NegotiableQuote.Manage.bannerStatusMessages.submitted",statusPending:"NegotiableQuote.Manage.bannerStatusMessages.pending",statusExpired:"NegotiableQuote.Manage.bannerStatusMessages.expired"});M(()=>{const o=y.on("quote-management/quote-data",N=>{const{quote:i}=N;i&&(f(i),l(!1))},{eager:!0});return()=>o==null?void 0:o.off()},[]),M(()=>{const o=y.on("quote-management/shipping-address-set",N=>{const{quote:i}=N;i&&f(i)},{eager:!0});return()=>o==null?void 0:o.off()},[]),M(()=>{const o=y.on("quote-management/quote-sent-for-review",N=>{const{quote:i}=N;f(i),_(""),T(!1)},{eager:!0});return()=>o==null?void 0:o.off()},[]);const P=b(()=>t(u,{name:"QuoteName",slot:e==null?void 0:e.QuoteName,context:{quoteName:a==null?void 0:a.name,quoteData:a},children:t("h1",{"data-testid":"quote-name",children:a==null?void 0:a.name})}),[e==null?void 0:e.QuoteName,a]),R=b(()=>t(u,{name:"QuoteStatus",slot:e==null?void 0:e.QuoteStatus,context:{quoteStatus:a==null?void 0:a.status,quoteData:a},children:t("div",{"data-testid":"quote-status",children:a==null?void 0:a.status})}),[e==null?void 0:e.QuoteStatus,a]),S=F(o=>{switch(o){case"SUBMITTED":return r.statusSubmitted;case"PENDING":return r.statusPending;case"EXPIRED":return r.statusExpired;default:return null}},[r])(a==null?void 0:a.status),I=S&&t(Y,{type:"warning",variant:"secondary",icon:t(ae,{}),heading:r.bannerTitle,description:S}),W=I&&t(u,{name:"Banner","data-testid":"banner",slot:e==null?void 0:e.Banner,context:{quoteData:a},children:I}),z=b(()=>{if(!a)return null;const o=D()||"en-US",N=new Intl.DateTimeFormat(o,{year:"numeric",month:"long",day:"numeric"});let i;try{i=N.format(new Date(a.expirationDate))}catch{i=a.expirationDate}return p(u,{name:"Details",slot:e==null?void 0:e.Details,context:{quoteData:a},children:[p("div",{className:"quote-management-manage-negotiable-quote__detail",children:[t("span",{className:"quote-management-manage-negotiable-quote__detail-title","data-testid":"created-label",children:r.createdLabel}),p("span",{className:"quote-management-manage-negotiable-quote__detail-content","data-testid":"created-value",children:[N.format(new Date(a.createdAt))," (",a.buyer.firstname," ",a.buyer.lastname,")"]})]}),p("div",{className:"quote-management-manage-negotiable-quote__detail",children:[t("span",{className:"quote-management-manage-negotiable-quote__detail-title","data-testid":"sales-rep-label",children:r.salesRepLabel}),t("span",{className:"quote-management-manage-negotiable-quote__detail-content","data-testid":"sales-rep-value",children:a.salesRepName})]}),p("div",{className:"quote-management-manage-negotiable-quote__detail",children:[t("span",{className:"quote-management-manage-negotiable-quote__detail-title","data-testid":"expires-label",children:r.expiresLabel}),t("span",{className:"quote-management-manage-negotiable-quote__detail-content","data-testid":"expires-value",children:i})]})]})},[e==null?void 0:e.Details,r,a]),L=b(()=>[{label:r.close,value:"close"},{label:r.delete,value:"delete"},{label:r.print,value:"print"},{label:r.createTemplate,value:"createTemplate"},{label:r.createCopy,value:"createCopy"}],[r]),H=b(()=>{const o=i=>{q==null||q(i)},N=i=>{switch(i){case"close":n==null||n(i);break;case"delete":n==null||n(i);break;case"print":n==null||n(i);break;case"createTemplate":n==null||n(i);break;case"createCopy":n==null||n(i);break}};return t(u,{name:"ActionBar",slot:e==null?void 0:e.ActionBar,context:{quoteData:a},children:t(ne,{dropdownPlaceholder:r.actionsLabel,dropdownOptions:[{label:r.remove,value:"remove"}],handleDropdownChange:o,buttons:L.map(i=>t(C,{variant:"tertiary",onClick:()=>N(i.value),"data-testid":`actions-bar-${i.value}-button`,"data-action":i.value,disabled:i.disabled,children:i.label},i.value))})})},[L,r,e==null?void 0:e.ActionBar,a,q,n]),E=b(()=>t(u,{name:"QuoteContent",slot:e==null?void 0:e.QuoteContent,context:{quoteData:a},children:t(me,{tabs:new Map([["items-quoted","Items Quoted"],["comments","Comments"],["history-log","History Log"]]),tabsContent:new Map([["items-quoted",t(u,{name:"ItemsQuotedTab",slot:e==null?void 0:e.ItemsQuotedTab,context:{quoteData:a},children:t(A,{quoteData:a})},"items-quoted")],["comments",t(u,{name:"CommentsTab",slot:e==null?void 0:e.CommentsTab,context:{quoteData:a},children:t(ee,{quoteData:a})},"comments")],["history-log",t(u,{name:"HistoryLogTab",slot:e==null?void 0:e.HistoryLogTab,context:{quoteData:a},children:t(k,{quoteData:a})},"history-log")]])})}),[e==null?void 0:e.QuoteContent,e==null?void 0:e.HistoryLogTab,e==null?void 0:e.CommentsTab,e==null?void 0:e.ItemsQuotedTab,a]),U=b(()=>t(u,{name:"ShippingInformationTitle",slot:e==null?void 0:e.ShippingInformationTitle,context:{quoteData:a},children:t("h2",{children:r.shippingInformationTitle})}),[e==null?void 0:e.ShippingInformationTitle,a,r]),j=b(()=>t(u,{name:"ShippingInformation",slot:e==null?void 0:e.ShippingInformation,context:{quoteData:a,loading:h,setLoading:l},children:t(O,{quoteData:a,loading:h,"data-testid":"manage-quote-shipping-address"})}),[e==null?void 0:e.ShippingInformation,a,h,l]),G=b(()=>t(u,{name:"QuoteCommentsTitle",slot:e==null?void 0:e.QuoteCommentsTitle,context:{quoteData:a},children:t("h2",{children:r.quoteCommentsTitle})}),[e==null?void 0:e.QuoteCommentsTitle,r,a]),$=b(()=>t(u,{name:"QuoteComments",slot:e==null?void 0:e.QuoteComments,context:{quoteData:a},children:t(Z,{name:"quoteComments",placeholder:r.quoteCommentsPlaceholder,rows:3,value:m,onInput:o=>{_(o.target.value)},disabled:v})}),[e==null?void 0:e.QuoteComments,r,a,m,v]),w=F(async()=>{if(s){s({quoteData:a,comment:m.trim()||void 0});return}T(!0);try{await B({quoteUid:a.uid,comment:m.trim()||void 0})}catch(o){console.error("Failed to send quote for review:",o),T(!1)}},[a,s,m]),V=b(()=>t(u,{name:"Footer",slot:e==null?void 0:e.Footer,context:{quoteData:a,comment:m,isSubmitting:v},children:t(C,{variant:"primary",onClick:w,"data-testid":"send-for-review-button",disabled:!(a!=null&&a.canSendForReview)||v||!a,children:r.sendForReview})}),[e==null?void 0:e.Footer,r,a,m,v,w]),X={...g,loading:h,quoteName:P,quoteStatus:R,banner:W||void 0,details:z,actionBar:H,quoteContent:E,shippingInformationTitle:U,shippingInformation:j,quoteCommentsTitle:G,quoteComments:$,footer:V};return t(re,{...X})};export{we as ManageNegotiableQuote,we as default};
//# sourceMappingURL=ManageNegotiableQuote.js.map
