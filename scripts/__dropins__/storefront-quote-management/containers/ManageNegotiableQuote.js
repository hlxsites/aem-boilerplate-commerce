/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as t,jsxs as l,Fragment as re}from"@dropins/tools/preact-jsx-runtime.js";import*as te from"@dropins/tools/preact-compat.js";import{useState as _,useMemo as v,useEffect as P,useCallback as Q,createPortal as ne}from"@dropins/tools/preact-compat.js";import{classes as m,VComponent as M,Slot as q,getGlobalLocale as Ee}from"@dropins/tools/lib.js";/* empty css                        */import{Picker as Re,Skeleton as we,SkeletonRow as x,Modal as ie,Button as C,Input as Ie,TextArea as me,InLineAlert as R}from"@dropins/tools/components.js";import{events as z}from"@dropins/tools/event-bus.js";/* empty css                          */import"@dropins/tools/preact.js";import{useText as V}from"@dropins/tools/i18n.js";/* empty css                        *//* empty css                                  *//* empty css                          */import{S as Fe}from"../chunks/ShippingAddressDisplay.js";import{Q as He}from"../chunks/QuoteHistoryLog.js";import{I as ke}from"../chunks/ItemsQuoted.js";import"../chunks/state.js";import{r as Pe,s as ze,d as We}from"../chunks/renameNegotiableQuote.js";import{Q as Be}from"../chunks/QuoteCommentsList.js";import{a as $,S as oe}from"../chunks/WarningFilled.js";import"../chunks/transform-quote.js";import"@dropins/tools/fetch-graphql.js";import"../chunks/NegotiableQuoteFragment.js";const Ue=g=>te.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",className:"feather feather-edit-2",...g},te.createElement("path",{d:"M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"})),je=({className:g,dropdownPlaceholder:a,dropdownOptions:r,handleDropdownChange:h,buttons:d,...e})=>{const b=r&&r.length>0,f=d&&d.length>0,u=(r==null?void 0:r.map(c=>({text:c.label,value:c.value})))||[];return u.unshift({text:a||"",value:""}),t("div",{className:"quote-management-actions-bar__container","data-testid":"actions-bar-container",children:l("div",{className:m(["quote-management-actions-bar",g]),"data-testid":"actions-bar",...e,children:[b&&t(Re,{name:"dropdown",id:"dropdown",onInput:h,className:"quote-management-actions-bar__dropdown","data-testid":"dropdown",options:u}),f&&t("div",{className:"quote-management-actions-bar__buttons","data-testid":"buttons-container",children:d==null?void 0:d.map((c,N)=>t(M,{node:c,className:m(["quote-management-actions-bar__button"])},N))})]})})},Ge=({className:g,loading:a,quoteName:r,quoteStatus:h,banner:d,details:e,actionBar:b,quoteContent:f,shippingInformationTitle:u,shippingInformation:c,quoteCommentsTitle:N,quoteComments:y,footer:p,...S})=>a?t(Oe,{}):l("div",{...S,className:m(["quote-management-manage-negotiable-quote",g]),children:[l("div",{className:m(["quote-management-manage-negotiable-quote__header"]),children:[r&&t(M,{node:r,className:m(["quote-management-manage-negotiable-quote__quote-name"])}),h&&t(M,{node:h,className:m(["quote-management-manage-negotiable-quote__quote-status"])})]}),d&&t(M,{node:d,className:m(["quote-management-manage-negotiable-quote__banner"])}),e&&t(M,{node:e,className:m(["quote-management-manage-negotiable-quote__details"])}),b&&t(M,{node:b,className:m(["quote-management-manage-negotiable-quote__action-bar"])}),f&&t(M,{node:f,className:m(["quote-management-manage-negotiable-quote__quote-content"])}),l("div",{"data-testid":"quote-shipping-information-container",className:m(["quote-management-manage-negotiable-quote__shipping-information-container"]),children:[u&&t(M,{node:u,className:m(["quote-management-manage-negotiable-quote__shipping-information-title"])}),c&&t(M,{node:c,className:m(["quote-management-manage-negotiable-quote__shipping-information"])})]}),l("div",{"data-testid":"quote-comments-container",className:m(["quote-management-manage-negotiable-quote__quote-comments-container"]),children:[N&&t(M,{node:N,className:m(["quote-management-manage-negotiable-quote__quote-comments-title"])}),y&&t(M,{node:y,className:m(["quote-management-manage-negotiable-quote__quote-comments"])})]}),t(M,{node:p,className:m(["quote-management-manage-negotiable-quote__footer"])})]}),Oe=()=>l(we,{"data-testid":"manage-negotiable-quote-skeleton",children:[t(x,{variant:"heading",fullWidth:!0,size:"large"}),t(x,{variant:"row",fullWidth:!1,size:"small"}),t(x,{variant:"row",fullWidth:!1,size:"small"}),t(x,{variant:"row",fullWidth:!0}),t(x,{variant:"row",fullWidth:!0,size:"xlarge",lines:2}),t(x,{variant:"row",fullWidth:!1,size:"small"})]}),$e=({open:g=!1,title:a,message:r,cancelLabel:h,confirmLabel:d,onCancel:e,onConfirm:b,showCloseButton:f,confirmationBanner:u,...c})=>{const N=V({cancel:"ConfirmationModal.cancel",confirm:"ConfirmationModal.confirm"});if(!g)return null;const{className:y,...p}=c;return t(ie,{...p,size:"medium",onClose:e,clickToDismiss:!0,escapeToDismiss:!0,showCloseButton:f,"data-testid":"confirmation-modal",className:y,children:l("div",{className:"confirmation-modal__content",children:[u&&t("div",{className:"confirmation-modal__banner","data-testid":"confirmation-modal-banner",children:u}),a&&t("div",{className:"confirmation-modal__title","data-testid":"confirmation-modal-title",children:a}),r&&t("div",{className:"confirmation-modal__message","data-testid":"confirmation-modal-message",children:r}),l("div",{className:"confirmation-modal__actions","data-testid":"confirmation-modal-actions",children:[t(C,{variant:"secondary",onClick:e,"data-testid":"confirmation-modal-cancel",children:h??N.cancel}),t(C,{variant:"primary",onClick:b,"data-testid":"confirmation-modal-confirm",children:d??N.confirm})]})]})})},Ve=({className:g,tabs:a,tabsContent:r,defaultActiveTab:h,...d})=>{const[e,b]=_(h||Array.from(a.keys())[0]),f=c=>{b(c)},u=v(()=>r.get(e),[e,r]);return l("div",{...d,className:m(["quote-management-tabbed-content",g]),children:[a&&t("div",{"data-testid":"tabbed-content-tabs",className:m(["quote-management-tabbed-content__tabs"]),children:Array.from(a.entries()).map(([c,N])=>t("button",{className:m(["quote-management-tabbed-content__tab",["quote-management-tabbed-content__tab--active",c===e]]),onClick:()=>f(c),children:N},c))}),u&&t("div",{className:m(["quote-management-tabbed-content__active-tab-content"]),children:t(M,{node:u})})]})},Xe=({className:g,open:a,quoteName:r,renameReason:h,quoteNameError:d,errorBanner:e,successBanner:b,showCloseButton:f=!0,onQuoteNameChange:u,onRenameReasonChange:c,onSave:N,onClose:y})=>{const p=V({title:"NegotiableQuote.Manage.rename.title",quoteNameLabel:"NegotiableQuote.Manage.rename.quoteNameLabel",reasonLabel:"NegotiableQuote.Manage.rename.reasonLabel",renameButton:"NegotiableQuote.Manage.rename.renameButton",cancelButton:"NegotiableQuote.Manage.rename.cancelButton"});return a?l(ie,{open:a,size:"medium",title:t(re,{children:p.title}),onClose:y,clickToDismiss:!0,escapeToDismiss:!0,showCloseButton:f,className:m(["quote-management-rename-quote-modal",g]),"data-testid":"rename-quote-modal",children:[e&&t("div",{className:m(["quote-management-rename-quote-modal__error-banner"]),"data-testid":"rename-quote-modal-error-banner",children:e}),b&&t("div",{className:m(["quote-management-rename-quote-modal__success-banner"]),"data-testid":"rename-quote-modal-success-banner",children:b}),l("div",{className:m(["quote-management-rename-quote-modal__content"]),children:[l("div",{children:[t(Ie,{name:"quoteName",type:"text",value:r,onInput:S=>u(S.target.value),floatingLabel:p.quoteNameLabel,required:!0,error:!!d}),d&&t("span",{className:m(["quote-management-rename-quote-modal__error-text"]),children:d})]}),t(me,{name:"quoteComment",value:h,onInput:S=>c(S.target.value),label:p.reasonLabel,rows:3})]}),l("div",{className:m(["quote-management-rename-quote-modal__actions"]),children:[t(C,{variant:"secondary",size:"medium",onClick:y,className:m(["quote-management-rename-quote-modal__cancel-button"]),children:p.cancelButton}),t(C,{variant:"primary",size:"medium",onClick:N,className:m(["quote-management-rename-quote-modal__save-button"]),children:p.renameButton})]})]}):null},_a=({onActionsDropdownChange:g,slots:a,onActionsButtonClick:r,onSendForReview:h,...d})=>{const[e,b]=_(void 0),[f,u]=_(!0),[c,N]=_(!1),[y,p]=_(null),[S,w]=_(!1),[T,X]=_(""),[L,W]=_(!1),[J,B]=_(!1),[I,F]=_(""),[U,H]=_(""),[j,E]=_(""),[ce,D]=_(""),[G,k]=_(""),n=V({createdLabel:"NegotiableQuote.Manage.createdLabel",salesRepLabel:"NegotiableQuote.Manage.salesRepLabel",expiresLabel:"NegotiableQuote.Manage.expiresLabel",actionsLabel:"NegotiableQuote.Manage.actionsLabel",remove:"NegotiableQuote.Manage.actions.remove",close:"NegotiableQuote.Manage.actionButtons.close",delete:"NegotiableQuote.Manage.actionButtons.delete",print:"NegotiableQuote.Manage.actionButtons.print",createTemplate:"NegotiableQuote.Manage.actionButtons.createTemplate",createCopy:"NegotiableQuote.Manage.actionButtons.createCopy",shippingInformationTitle:"NegotiableQuote.Manage.shippingInformation.title",quoteCommentsTitle:"NegotiableQuote.Manage.quoteComments.title",quoteCommentsPlaceholder:"NegotiableQuote.Manage.quoteComments.placeholder",sendForReview:"NegotiableQuote.Manage.actionButtons.sendForReview",bannerTitle:"NegotiableQuote.Manage.bannerTitle",statusSubmitted:"NegotiableQuote.Manage.bannerStatusMessages.submitted",statusPending:"NegotiableQuote.Manage.bannerStatusMessages.pending",statusExpired:"NegotiableQuote.Manage.bannerStatusMessages.expired",renameErrorHeading:"NegotiableQuote.Manage.rename.errorHeading",renameQuoteNameRequired:"NegotiableQuote.Manage.rename.quoteNameRequired",renameErrorDefault:"NegotiableQuote.Manage.rename.errorDefault",renameSuccessHeading:"NegotiableQuote.Manage.rename.successHeading",renameSuccessMessage:"NegotiableQuote.Manage.rename.successMessage",confirmationModalCancel:"NegotiableQuote.Manage.confirmationModal.cancel",confirmationModalDeleteTitle:"NegotiableQuote.Manage.confirmationModal.delete.title",confirmationModalDeleteMessage:"NegotiableQuote.Manage.confirmationModal.delete.message",confirmationModalDeleteConfirm:"NegotiableQuote.Manage.confirmationModal.delete.confirm",confirmationModalDeleteErrorHeading:"NegotiableQuote.Manage.confirmationModal.delete.errorHeading",confirmationModalDeleteErrorFallback:"NegotiableQuote.Manage.confirmationModal.delete.errorFallback",confirmationModalDeleteSuccessHeading:"NegotiableQuote.Manage.confirmationModal.delete.successHeading",confirmationModalDeleteSuccessDescription:"NegotiableQuote.Manage.confirmationModal.delete.successDescription"});P(()=>{const o=z.on("quote-management/quote-data",s=>{const{quote:i}=s;i&&(b(i),u(!1))},{eager:!0});return()=>o==null?void 0:o.off()},[]),P(()=>{const o=z.on("quote-management/shipping-address-set",s=>{const{quote:i}=s;i&&b(i)},{eager:!0});return()=>o==null?void 0:o.off()},[]),P(()=>{const o=z.on("quote-management/quote-sent-for-review",s=>{const{quote:i}=s;b(i),X(""),W(!1)},{eager:!0});return()=>o==null?void 0:o.off()},[]),P(()=>{const o=z.on("quote-management/quote-renamed",s=>{const{quote:i}=s;b(i),E(""),D(""),k(n.renameSuccessMessage),setTimeout(()=>{B(!1),F(""),H(""),k("")},2e3)},{eager:!0});return()=>o==null?void 0:o.off()},[n.renameSuccessMessage]);const K=Q(()=>{F((e==null?void 0:e.name)||""),H(""),E(""),D(""),k(""),B(!0)},[e]),le=Q(()=>{B(!1),F(""),H(""),E(""),D(""),k("")},[]),de=Q(o=>{F(o),o.trim()&&D("")},[]),ue=Q(async()=>{if(!I.trim()){D(n.renameQuoteNameRequired);return}try{E(""),D(""),await Pe({quoteUid:e.uid,quoteName:I,quoteComment:U.trim()||void 0})}catch(o){E(o.message||n.renameErrorDefault)}},[e,I,U,n.renameQuoteNameRequired,n.renameErrorDefault]),se=v(()=>{const o=e&&(e.lockedForEditing===!0||e.lockedForEditing===void 0&&(e.status==="SUBMITTED"||e.status==="PENDING"||e.status==="ORDERED"||e.status==="CLOSED"));return t(q,{name:"QuoteName",slot:a==null?void 0:a.QuoteName,context:{quoteName:e==null?void 0:e.name,quoteData:e},children:l("div",{className:"quote-management-manage-negotiable-quote__quote-name-wrapper",children:[t("h1",{"data-testid":"quote-name",className:"quote-management-manage-negotiable-quote__quote-name-title",children:e==null?void 0:e.name}),t("button",{onClick:K,disabled:o,"data-testid":"rename-quote-button",className:"quote-management-manage-negotiable-quote__rename-button","aria-label":"Rename quote",children:t(Ue,{})})]})})},[a==null?void 0:a.QuoteName,e,K]),ge=v(()=>t(q,{name:"QuoteStatus",slot:a==null?void 0:a.QuoteStatus,context:{quoteStatus:e==null?void 0:e.status,quoteData:e},children:t("div",{"data-testid":"quote-status",children:e==null?void 0:e.status})}),[a==null?void 0:a.QuoteStatus,e]),Y=Q(o=>{switch(o){case"SUBMITTED":return n.statusSubmitted;case"PENDING":return n.statusPending;case"EXPIRED":return n.statusExpired;default:return null}},[n])(e==null?void 0:e.status),Z=Y&&t(R,{type:"warning",variant:"secondary",icon:t($,{}),heading:n.bannerTitle,description:Y}),be=Z&&t(q,{name:"Banner","data-testid":"banner",slot:a==null?void 0:a.Banner,context:{quoteData:e},children:Z}),fe=v(()=>{if(!e)return null;const o=Ee()||"en-US",s=new Intl.DateTimeFormat(o,{year:"numeric",month:"long",day:"numeric"});let i;try{i=s.format(new Date(e.expirationDate))}catch{i=e.expirationDate}return l(q,{name:"Details",slot:a==null?void 0:a.Details,context:{quoteData:e},children:[l("div",{className:"quote-management-manage-negotiable-quote__detail",children:[t("span",{className:"quote-management-manage-negotiable-quote__detail-title","data-testid":"created-label",children:n.createdLabel}),l("span",{className:"quote-management-manage-negotiable-quote__detail-content","data-testid":"created-value",children:[s.format(new Date(e.createdAt))," (",e.buyer.firstname," ",e.buyer.lastname,")"]})]}),l("div",{className:"quote-management-manage-negotiable-quote__detail",children:[t("span",{className:"quote-management-manage-negotiable-quote__detail-title","data-testid":"sales-rep-label",children:n.salesRepLabel}),t("span",{className:"quote-management-manage-negotiable-quote__detail-content","data-testid":"sales-rep-value",children:e.salesRepName})]}),l("div",{className:"quote-management-manage-negotiable-quote__detail",children:[t("span",{className:"quote-management-manage-negotiable-quote__detail-title","data-testid":"expires-label",children:n.expiresLabel}),t("span",{className:"quote-management-manage-negotiable-quote__detail-content","data-testid":"expires-value",children:i})]})]})},[a==null?void 0:a.Details,n,e]),A=v(()=>[{label:n.close,value:"close"},{label:n.delete,value:"delete",disabled:!(e!=null&&e.canDelete)},{label:n.print,value:"print"},{label:n.createTemplate,value:"createTemplate"},{label:n.createCopy,value:"createCopy"}],[n,e==null?void 0:e.canDelete]),pe=v(()=>{const o=i=>{g==null||g(i)},s=i=>{switch(i){case"close":r==null||r(i);break;case"delete":N(!0),r==null||r(i);break;case"print":r==null||r(i);break;case"createTemplate":r==null||r(i);break;case"createCopy":r==null||r(i);break}};return t(q,{name:"ActionBar",slot:a==null?void 0:a.ActionBar,context:{quoteData:e},children:t(je,{dropdownPlaceholder:n.actionsLabel,dropdownOptions:[{label:n.remove,value:"remove"}],handleDropdownChange:o,buttons:A.map(i=>t(C,{variant:"tertiary",onClick:()=>s(i.value),"data-testid":`actions-bar-${i.value}-button`,"data-action":i.value,disabled:i.disabled,children:i.label},i.value))})})},[A,n,a==null?void 0:a.ActionBar,e,g,r]),he=v(()=>t(q,{name:"QuoteContent",slot:a==null?void 0:a.QuoteContent,context:{quoteData:e},children:t(Ve,{tabs:new Map([["items-quoted","Items Quoted"],["comments","Comments"],["history-log","History Log"]]),tabsContent:new Map([["items-quoted",t(q,{name:"ItemsQuotedTab",slot:a==null?void 0:a.ItemsQuotedTab,context:{quoteData:e},children:t(ke,{quoteData:e})},"items-quoted")],["comments",t(q,{name:"CommentsTab",slot:a==null?void 0:a.CommentsTab,context:{quoteData:e},children:t(Be,{quoteData:e})},"comments")],["history-log",t(q,{name:"HistoryLogTab",slot:a==null?void 0:a.HistoryLogTab,context:{quoteData:e},children:t(He,{quoteData:e})},"history-log")]])})}),[a==null?void 0:a.QuoteContent,a==null?void 0:a.HistoryLogTab,a==null?void 0:a.CommentsTab,a==null?void 0:a.ItemsQuotedTab,e]),Ne=v(()=>t(q,{name:"ShippingInformationTitle",slot:a==null?void 0:a.ShippingInformationTitle,context:{quoteData:e},children:t("h2",{children:n.shippingInformationTitle})}),[a==null?void 0:a.ShippingInformationTitle,e,n]),qe=v(()=>t(q,{name:"ShippingInformation",slot:a==null?void 0:a.ShippingInformation,context:{quoteData:e,loading:f,setLoading:u},children:t(Fe,{quoteData:e,loading:f,"data-testid":"manage-quote-shipping-address"})}),[a==null?void 0:a.ShippingInformation,e,f,u]),_e=v(()=>t(q,{name:"QuoteCommentsTitle",slot:a==null?void 0:a.QuoteCommentsTitle,context:{quoteData:e},children:t("h2",{children:n.quoteCommentsTitle})}),[a==null?void 0:a.QuoteCommentsTitle,n,e]),ve=v(()=>t(q,{name:"QuoteComments",slot:a==null?void 0:a.QuoteComments,context:{quoteData:e},children:t(me,{name:"quoteComments",placeholder:n.quoteCommentsPlaceholder,rows:3,value:T,onInput:o=>{X(o.target.value)},disabled:L})}),[a==null?void 0:a.QuoteComments,n,e,T,L]),ee=Q(async()=>{if(h){h({quoteData:e,comment:T.trim()||void 0});return}W(!0);try{await ze({quoteUid:e.uid,comment:T.trim()||void 0})}catch(o){console.error("Failed to send quote for review:",o),W(!1)}},[e,h,T]),Me=v(()=>t(q,{name:"Footer",slot:a==null?void 0:a.Footer,context:{quoteData:e,comment:T,isSubmitting:L},children:t(C,{variant:"primary",onClick:ee,"data-testid":"send-for-review-button",disabled:!(e!=null&&e.canSendForReview)||L||!e,children:n.sendForReview})}),[a==null?void 0:a.Footer,n,e,T,L,ee]),Qe=v(()=>j?t(R,{type:"error",variant:"primary",icon:t($,{color:"var(--color-error)"}),heading:n.renameErrorHeading,description:j}):void 0,[j,n.renameErrorHeading]),ye=v(()=>G?t(R,{type:"success",variant:"primary",icon:t(oe,{}),heading:n.renameSuccessHeading,description:G}):void 0,[G,n.renameSuccessHeading]),O=Q(o=>o.errors&&Array.isArray(o.errors)&&o.errors.length>0?o.errors[0].message||n.confirmationModalDeleteErrorFallback:(o==null?void 0:o.message)||n.confirmationModalDeleteErrorFallback,[n.confirmationModalDeleteErrorFallback]),Se=Q(()=>{N(!1),p(null),w(!1)},[]),Te=Q(async()=>{if(e!=null&&e.uid){p(null),w(!1);try{const{operationResults:o}=await We(e.uid),s=o.find(i=>i.__typename==="DeleteNegotiableQuoteOperationFailure");if(s){const i=O(s);p(i);return}w(!0)}catch(o){const s=O(o);p(s)}}},[e,O]),De=Q(()=>{p(null)},[]),xe=Q(()=>{w(!1)},[]),Ce=y?t(R,{type:"error",variant:"primary",icon:t($,{}),heading:n.confirmationModalDeleteErrorHeading,description:y,onDismiss:De,"data-testid":"confirmation-modal-error-banner"}):null,ae=(S?t(R,{type:"success",variant:"primary",icon:t(oe,{}),heading:n.confirmationModalDeleteSuccessHeading,description:n.confirmationModalDeleteSuccessDescription,onDismiss:xe,"data-testid":"confirmation-modal-success-banner"}):null)||Ce,Le={...d,loading:f,quoteName:se,quoteStatus:ge,banner:be||void 0,details:fe,actionBar:pe,quoteContent:he,shippingInformationTitle:Ne,shippingInformation:qe,quoteCommentsTitle:_e,quoteComments:ve,footer:Me};return l(re,{children:[t(Ge,{...Le}),J&&ne(t(Xe,{open:J,quoteName:I,renameReason:U,quoteNameError:ce,errorBanner:Qe,successBanner:ye,onQuoteNameChange:de,onRenameReasonChange:H,onSave:ue,onClose:le}),document.body),c&&ne(t($e,{open:c,title:n.confirmationModalDeleteTitle,message:n.confirmationModalDeleteMessage,cancelLabel:n.confirmationModalCancel,confirmLabel:n.confirmationModalDeleteConfirm,onCancel:Se,onConfirm:Te,showCloseButton:!ae,confirmationBanner:ae}),document.body)]})};export{_a as ManageNegotiableQuote,_a as default};
//# sourceMappingURL=ManageNegotiableQuote.js.map
