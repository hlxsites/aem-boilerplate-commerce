/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as n,jsxs as M,Fragment as Pa}from"@dropins/tools/preact-jsx-runtime.js";import{useState as l,useRef as _e,useEffect as h,useCallback as c,useMemo as u,createPortal as z}from"@dropins/tools/preact-compat.js";import{classes as d,VComponent as p,Slot as g}from"@dropins/tools/lib.js";import{f as oa}from"../chunks/dateUtils.js";/* empty css                              */import{Skeleton as Wa,SkeletonRow as O,InLineAlert as N,Button as ra,TextArea as Va,InputFile as $a}from"@dropins/tools/components.js";import{events as v}from"@dropins/tools/event-bus.js";import{S as ja,A as Ga,T as Ka,R as Xa}from"../chunks/RenameQuoteModal.js";import{v as Ja,f as Ya,a as Za,S as Aa,A as et}from"../chunks/AttachedFilesList.js";import"@dropins/tools/preact.js";import"@dropins/tools/preact-hooks.js";import{C as X}from"../chunks/ConfirmationModal.js";/* empty css                        *//* empty css                          */import{S as at}from"../chunks/ShippingAddressDisplay.js";import{Q as tt}from"../chunks/QuoteHistoryLog3.js";import{g as nt,r as ot,c as rt,a as it,s as lt,d as ct,b as st}from"../chunks/duplicateNegotiableQuote.js";import"../chunks/state.js";import{u as mt}from"../chunks/uploadFile.js";import{I as dt}from"../chunks/ItemsQuoted.js";import{Q as ut}from"../chunks/QuoteCommentsList3.js";import{a as P,S as J}from"../chunks/WarningFilled.js";import{useText as gt}from"@dropins/tools/i18n.js";import"../chunks/QuoteHistoryLog.js";import"../chunks/transform-quote.js";import"@dropins/tools/fetch-graphql.js";import"../chunks/NegotiableQuoteFragment.js";import"../chunks/transform-quote-template.js";import"../chunks/NegotiableQuoteTemplateFragment.js";import"../chunks/LineItemNoteModal.js";import"../chunks/setLineItemNote.js";import"../chunks/QuoteCommentsList.js";const ft=({className:D,loading:t,quoteName:s,quoteStatus:I,banner:T,details:C,actionBar:Q,quoteContent:w,shippingInformationTitle:x,shippingInformation:Y,quoteCommentsTitle:e,quoteComments:S,attachFilesField:y,attachedFilesList:R,footer:Z,...A})=>t?n(pt,{}):M("div",{...A,className:d(["quote-management-manage-negotiable-quote",D]),children:[M("div",{className:d(["quote-management-manage-negotiable-quote__header"]),children:[s&&n(p,{node:s,className:d(["quote-management-manage-negotiable-quote__quote-name"])}),I&&n(p,{node:I,className:d(["quote-management-manage-negotiable-quote__quote-status"])})]}),T&&n(p,{node:T,className:d(["quote-management-manage-negotiable-quote__banner"])}),C&&n(p,{node:C,className:d(["quote-management-manage-negotiable-quote__details"])}),Q&&n(p,{node:Q,className:d(["quote-management-manage-negotiable-quote__action-bar"])}),w&&n(p,{node:w,className:d(["quote-management-manage-negotiable-quote__quote-content"])}),M("div",{"data-testid":"quote-shipping-information-container",className:d(["quote-management-manage-negotiable-quote__shipping-information-container"]),children:[x&&n(p,{node:x,className:d(["quote-management-manage-negotiable-quote__shipping-information-title"])}),Y&&n(p,{node:Y,className:d(["quote-management-manage-negotiable-quote__shipping-information"])})]}),M("div",{"data-testid":"quote-comments-container",className:d(["quote-management-manage-negotiable-quote__quote-comments-container"]),children:[e&&n(p,{node:e,className:d(["quote-management-manage-negotiable-quote__quote-comments-title"])}),S&&n(p,{node:S,className:d(["quote-management-manage-negotiable-quote__quote-comments"])}),y&&n(p,{node:y,className:d(["quote-management-manage-negotiable-quote__attach-files-field"])}),R&&n(p,{node:R,className:d(["quote-management-manage-negotiable-quote__attached-files-list"])})]}),n(p,{node:Z,className:d(["quote-management-manage-negotiable-quote__footer"])})]}),pt=()=>M(Wa,{"data-testid":"manage-negotiable-quote-skeleton",children:[n(O,{variant:"heading",fullWidth:!0,size:"large"}),n(O,{variant:"row",fullWidth:!1,size:"small"}),n(O,{variant:"row",fullWidth:!1,size:"small"}),n(O,{variant:"row",fullWidth:!0}),n(O,{variant:"row",fullWidth:!0,size:"xlarge",lines:2}),n(O,{variant:"row",fullWidth:!1,size:"small"})]}),Yt=({onActionsDropdownChange:D,slots:t,onActionsButtonClick:s,onSendForReview:I,maxFiles:T,maxFileSize:C,acceptedFileTypes:Q,onDuplicateQuote:w,onCreateTemplate:x,...Y})=>{const[e,S]=l(void 0),[y,R]=l(!0),[Z,A]=l(!1),[Ee,W]=l(null),[ia,ee]=l(!1),[Fe,se]=l(!1),[De,_]=l(null),[la,L]=l(!1),[E,Ie]=l(""),[q,me]=l(!1),[we,de]=l(!1),[xe,ue]=l(!1),[Re,H]=l(""),[Le,V]=l(""),[He,ge]=l(!1),[Ue,ke]=l(!1),[Be,$]=l(""),[ze,ae]=l(""),[Oe,fe]=l(!1),[te,ne]=l(""),[pe,oe]=l(""),[Me,j]=l(""),[ca,U]=l(""),[be,re]=l(""),[b,G]=l([]),[ie,le]=l(void 0),[he,Pe]=l(new Set),We=_e(he),Ne=_e(null),[k,Qe]=l(""),ce=_e(k),[Ve,$e]=l(!1);h(()=>{We.current=he},[he]),h(()=>{ce.current=k},[k]);const o=gt({createdLabel:"NegotiableQuote.Manage.createdLabel",salesRepLabel:"NegotiableQuote.Manage.salesRepLabel",expiresLabel:"NegotiableQuote.Manage.expiresLabel",actionsLabel:"NegotiableQuote.Manage.actionsLabel",remove:"NegotiableQuote.Manage.actions.remove",close:"NegotiableQuote.Manage.actionButtons.close",delete:"NegotiableQuote.Manage.actionButtons.delete",print:"NegotiableQuote.Manage.actionButtons.print",createTemplate:"NegotiableQuote.Manage.actionButtons.createTemplate",createCopy:"NegotiableQuote.Manage.actionButtons.createCopy",shippingInformationTitle:"NegotiableQuote.Manage.shippingInformation.title",quoteCommentsTitle:"NegotiableQuote.Manage.quoteComments.title",quoteCommentsPlaceholder:"NegotiableQuote.Manage.quoteComments.placeholder",sendForReview:"NegotiableQuote.Manage.actionButtons.sendForReview",bannerTitle:"NegotiableQuote.Manage.bannerTitle",statusSubmitted:"NegotiableQuote.Manage.bannerStatusMessages.submitted",statusPending:"NegotiableQuote.Manage.bannerStatusMessages.pending",statusExpired:"NegotiableQuote.Manage.bannerStatusMessages.expired",errorFallback:"NegotiableQuote.Manage.confirmationModal.delete.errorFallback",closeSuccessMessage:"NegotiableQuote.Manage.confirmationModal.close.successDescription",closeModalTitle:"NegotiableQuote.Manage.actionButtons.close",closeModalMessage:"NegotiableQuote.Manage.confirmationModal.close.message",closeModalCancel:"NegotiableQuote.Manage.confirmationModal.cancel",closeModalConfirm:"NegotiableQuote.Manage.confirmationModal.close.confirm",closeModalConfirmLoading:"NegotiableQuote.Manage.confirmationModal.close.confirmLoading",closeModalSuccessHeading:"NegotiableQuote.Manage.confirmationModal.close.successHeading",createTemplateModalTitle:"NegotiableQuote.Manage.actionButtons.createTemplate",createTemplateModalMessage:"NegotiableQuote.Manage.confirmationModal.createTemplate.message",createTemplateModalCancel:"NegotiableQuote.Manage.confirmationModal.cancel",createTemplateModalConfirm:"NegotiableQuote.Manage.confirmationModal.createTemplate.confirm",createTemplateModalConfirmLoading:"NegotiableQuote.Manage.confirmationModal.createTemplate.confirmLoading",createTemplateModalSuccessHeading:"NegotiableQuote.Manage.confirmationModal.createTemplate.successHeading",createTemplateSuccessMessage:"NegotiableQuote.Manage.confirmationModal.createTemplate.successDescription",createTemplateModalErrorHeading:"NegotiableQuote.Manage.confirmationModal.createTemplate.errorHeading",createTemplateErrorFallback:"NegotiableQuote.Manage.confirmationModal.createTemplate.errorFallback",renameErrorHeading:"NegotiableQuote.Manage.rename.errorHeading",renameQuoteNameRequired:"NegotiableQuote.Manage.rename.quoteNameRequired",renameErrorDefault:"NegotiableQuote.Manage.rename.errorDefault",renameSuccessHeading:"NegotiableQuote.Manage.rename.successHeading",renameSuccessMessage:"NegotiableQuote.Manage.rename.successMessage",confirmationModalCancel:"NegotiableQuote.Manage.confirmationModal.cancel",confirmationModalDeleteTitle:"NegotiableQuote.Manage.confirmationModal.delete.title",confirmationModalDeleteMessage:"NegotiableQuote.Manage.confirmationModal.delete.message",confirmationModalDeleteConfirm:"NegotiableQuote.Manage.confirmationModal.delete.confirm",confirmationModalDeleteErrorHeading:"NegotiableQuote.Manage.confirmationModal.delete.errorHeading",confirmationModalDeleteErrorFallback:"NegotiableQuote.Manage.confirmationModal.delete.errorFallback",confirmationModalDeleteSuccessHeading:"NegotiableQuote.Manage.confirmationModal.delete.successHeading",confirmationModalDeleteSuccessDescription:"NegotiableQuote.Manage.confirmationModal.delete.successDescription",confirmationModalDuplicateTitle:"NegotiableQuote.Manage.confirmationModal.duplicate.title",confirmationModalDuplicateMessage:"NegotiableQuote.Manage.confirmationModal.duplicate.message",confirmationModalDuplicateConfirm:"NegotiableQuote.Manage.confirmationModal.duplicate.confirm",confirmationModalDuplicateErrorHeading:"NegotiableQuote.Manage.confirmationModal.duplicate.errorHeading",confirmationModalDuplicateErrorFallback:"NegotiableQuote.Manage.confirmationModal.duplicate.errorFallback",confirmationModalDuplicateSuccessHeading:"NegotiableQuote.Manage.confirmationModal.duplicate.successHeading",confirmationModalDuplicateSuccessDescription:"NegotiableQuote.Manage.confirmationModal.duplicate.successDescription",noItemsSelectedModalTitle:"NegotiableQuote.Manage.confirmationModal.noItemsSelected.title",noItemsSelectedModalMessage:"NegotiableQuote.Manage.confirmationModal.noItemsSelected.message",noItemsSelectedModalConfirm:"NegotiableQuote.Manage.confirmationModal.noItemsSelected.confirm",attachFiles:"NegotiableQuote.Manage.attachFiles",fileUploadError:"NegotiableQuote.Manage.fileUploadError",maxFilesExceeded:"NegotiableQuote.Manage.maxFilesExceeded",maxFileSizeExceeded:"NegotiableQuote.Manage.maxFileSizeExceeded",invalidFileType:"NegotiableQuote.Manage.invalidFileType"});h(()=>{const a=v.on("quote-management/quote-data",r=>{const{quote:i}=r;i&&(S(i),R(!1))},{eager:!0});return()=>a==null?void 0:a.off()},[]),h(()=>{const a=v.on("quote-management/shipping-address-set",r=>{const{quote:i}=r;i&&S(i)},{eager:!0});return()=>a==null?void 0:a.off()},[]),h(()=>{const a=v.on("quote-management/quote-sent-for-review",r=>{const{quote:i}=r;S(i),Ie(""),G([]),me(!1)},{eager:!0});return()=>a==null?void 0:a.off()},[]),h(()=>{const a=v.on("quote-management/quote-items-removed",r=>{const{quote:i,removedItemUids:m}=r;i&&S(i),m&&Pe(f=>{const B=new Set(f);return m.forEach(K=>B.delete(K)),B})},{eager:!0});return()=>a==null?void 0:a.off()},[]);const je=c((a,r)=>{Pe(i=>{const m=new Set(i);return r?m.add(a.uid):m.delete(a.uid),m})},[]),Ge=c(a=>{const r=a.target.value,i=We.current;if(r==="remove"){if(Qe(r),ce.current=r,i.size===0)$e(!0);else if(e&&Ne.current){const m=e.items.filter(f=>i.has(f.uid));Ne.current(m)}}D==null||D(a)},[D,e]),Ke=c(()=>{$e(!1),Qe(""),ce.current=""},[]);h(()=>{const a=v.on("quote-management/negotiable-quote-closed",async r=>{ue(!1),V(""),H(o.closeSuccessMessage),S(i=>{var m;return i!=null&&i.uid&&((m=r.closedQuoteUids)!=null&&m.includes(i.uid))&&nt(i.uid).then(f=>{S(f)}).catch(f=>{console.warn("Failed to refresh quote data after closure:",f)}),i}),setTimeout(()=>{de(!1),H("")},2e3)},{eager:!0});return()=>a==null?void 0:a.off()},[o.closeSuccessMessage]),h(()=>{const a=v.on("quote-management/negotiable-quote-close-error",r=>{console.log("Close error event received:",r),ue(!1),H("");const i=r.error.message||o.errorFallback;V(i)},{eager:!0});return()=>a==null?void 0:a.off()},[o.errorFallback]),h(()=>{const a=v.on("quote-management/quote-renamed",r=>{const{quote:i}=r;S(i),j(""),U(""),re(o.renameSuccessMessage),setTimeout(()=>{fe(!1),ne(""),oe(""),re("")},2e3)},{eager:!0});return()=>a==null?void 0:a.off()},[o.renameSuccessMessage]),h(()=>{const a=v.on("quote-management/quote-duplicated",r=>{const{quote:i}=r;e&&w&&w({quoteData:e,newQuote:i}),L(!0),_(null),setTimeout(()=>{se(!1),L(!1),_(null)},2e3)},{eager:!0});return()=>a==null?void 0:a.off()},[e,w]),h(()=>{const a=v.on("quote-management/quote-template-created",r=>{const{quoteTemplate:i}=r;e&&x&&x({quoteData:e,templateId:i.id}),setTimeout(()=>{ge(!1),$("")},2e3)},{eager:!0});return()=>a==null?void 0:a.off()},[e,x]);const Se=c(async a=>{if(T&&b.length+a.length>T){le(o.maxFilesExceeded.replace("{maxFiles}",String(T)));return}for(const i of a){if(C&&!Ja(i.size,C)){le(o.maxFileSizeExceeded.replace("{maxSize}",Ya(C)));return}if(Q&&!Za(i.type,Q)){le(o.invalidFileType);return}}le(void 0);const r=a.map(i=>({key:`temp-${Date.now()}-${Math.random()}-${i.name}`,name:i.name,size:i.size,status:"uploading"}));G(i=>[...i,...r]);for(let i=0;i<a.length;i++){const m=a[i],f=r[i].key;try{const B=await mt(m);G(K=>K.map(F=>F.key===f?{...F,key:B.key,status:"success"}:F))}catch(B){G(K=>K.map(F=>F.key===f?{...F,status:"error",error:B.message}:F))}}},[T,C,Q,b,o]),qe=c(a=>{G(r=>r.filter(i=>i.key!==a))},[]),Xe=c(()=>{ne((e==null?void 0:e.name)||""),oe(""),j(""),U(""),re(""),fe(!0)},[e]),sa=c(()=>{fe(!1),ne(""),oe(""),j(""),U(""),re("")},[]),ma=c(a=>{ne(a),a.trim()&&U("")},[]),Je=c(()=>{se(!0),_(null),L(!1)},[]),da=c(async()=>{if(!te.trim()){U(o.renameQuoteNameRequired);return}try{j(""),U(""),await ot({quoteUid:e.uid,quoteName:te,quoteComment:pe.trim()||void 0})}catch(a){j(a.message||o.renameErrorDefault)}},[e,te,pe,o.renameQuoteNameRequired,o.renameErrorDefault]),ua=u(()=>{const a=e&&(e.lockedForEditing===!0||e.lockedForEditing===void 0&&(e.status==="SUBMITTED"||e.status==="PENDING"||e.status==="ORDERED"||e.status==="CLOSED"));return n(g,{name:"QuoteName",slot:t==null?void 0:t.QuoteName,context:{quoteName:e==null?void 0:e.name,quoteData:e},children:M("div",{className:"quote-management-manage-negotiable-quote__quote-name-wrapper",children:[n("h1",{"data-testid":"quote-name",className:"quote-management-manage-negotiable-quote__quote-name-title",children:e==null?void 0:e.name}),n("button",{onClick:Xe,disabled:a,"data-testid":"rename-quote-button",className:"quote-management-manage-negotiable-quote__rename-button","aria-label":"Rename quote",children:n(ja,{})})]})})},[t==null?void 0:t.QuoteName,e,Xe]),ga=u(()=>n(g,{name:"QuoteStatus",slot:t==null?void 0:t.QuoteStatus,context:{quoteStatus:e==null?void 0:e.status,quoteData:e},children:n("div",{"data-testid":"quote-status",children:e==null?void 0:e.status})}),[t==null?void 0:t.QuoteStatus,e]),Ye=c(a=>{switch(a){case"SUBMITTED":return o.statusSubmitted;case"PENDING":return o.statusPending;case"EXPIRED":return o.statusExpired;default:return null}},[o])(e==null?void 0:e.status),Ze=Ye&&n(N,{type:"warning",variant:"secondary",icon:n(P,{}),heading:o.bannerTitle,description:Ye}),fa=Ze&&n(g,{name:"Banner","data-testid":"banner",slot:t==null?void 0:t.Banner,context:{quoteData:e},children:Ze}),pa=u(()=>{if(!e)return;const a=e.expirationDate?oa(e.expirationDate,"short"):void 0;return M(g,{name:"Details",slot:t==null?void 0:t.Details,context:{quoteData:e},children:[M("div",{className:"quote-management-manage-negotiable-quote__detail",children:[n("span",{className:"quote-management-manage-negotiable-quote__detail-title","data-testid":"created-label",children:o.createdLabel}),M("span",{className:"quote-management-manage-negotiable-quote__detail-content","data-testid":"created-value",children:[oa(e.createdAt,"short")," (",e.buyer.firstname," ",e.buyer.lastname,")"]})]}),M("div",{className:"quote-management-manage-negotiable-quote__detail",children:[n("span",{className:"quote-management-manage-negotiable-quote__detail-title","data-testid":"sales-rep-label",children:o.salesRepLabel}),n("span",{className:"quote-management-manage-negotiable-quote__detail-content","data-testid":"sales-rep-value",children:e.salesRepName})]}),M("div",{className:"quote-management-manage-negotiable-quote__detail",children:[n("span",{className:"quote-management-manage-negotiable-quote__detail-title","data-testid":"expires-label",children:o.expiresLabel}),n("span",{className:"quote-management-manage-negotiable-quote__detail-content","data-testid":"expires-value",children:a})]})]})},[t==null?void 0:t.Details,o,e]),Ae=u(()=>[{label:o.close,value:"close",disabled:!(e!=null&&e.canClose)},{label:o.delete,value:"delete",disabled:!(e!=null&&e.canDelete)},{label:o.print,value:"print"},{label:o.createTemplate,value:"createTemplate"},{label:o.createCopy,value:"createCopy"}],[o,e==null?void 0:e.canDelete,e==null?void 0:e.canClose]),Ma=u(()=>{const a=r=>{switch(r){case"close":de(!0),V(""),H(""),s==null||s(r);break;case"delete":A(!0),s==null||s(r);break;case"print":s==null||s(r);break;case"createTemplate":ge(!0),ae(""),$(""),s==null||s(r);break;case"createCopy":Je(),s==null||s(r);break}};return n(g,{name:"ActionBar",slot:t==null?void 0:t.ActionBar,context:{quoteData:e,actionsBarDropdownValue:k},children:n(Ga,{dropdownPlaceholder:o.actionsLabel,dropdownOptions:[{label:o.remove,value:"remove"}],dropdownValue:k,handleDropdownChange:Ge,buttons:Ae.map(r=>n(ra,{variant:"tertiary",onClick:()=>a(r.value),"data-testid":`actions-bar-${r.value}-button`,"data-action":r.value,disabled:r.disabled,children:r.label},r.value))})})},[Ae,o,t==null?void 0:t.ActionBar,e,Ge,s,Je,k]),ba=u(()=>n(g,{name:"QuoteContent",slot:t==null?void 0:t.QuoteContent,context:{quoteData:e},children:n(Ka,{tabs:new Map([["items-quoted","Items Quoted"],["comments","Comments"],["history-log","History Log"]]),tabsContent:new Map([["items-quoted",n(g,{name:"ItemsQuotedTab",slot:t==null?void 0:t.ItemsQuotedTab,context:{quoteData:e},children:n(dt,{quoteData:e,onItemCheckboxChange:je,onRemoveItemsRef:a=>{Ne.current=a},onRemoveModalStateChange:a=>{!a&&ce.current==="remove"&&Qe("")}})},"items-quoted")],["comments",n(g,{name:"CommentsTab",slot:t==null?void 0:t.CommentsTab,context:{quoteData:e},children:n(ut,{quoteData:e})},"comments")],["history-log",n(g,{name:"HistoryLogTab",slot:t==null?void 0:t.HistoryLogTab,context:{quoteData:e},children:n(tt,{quoteData:e})},"history-log")]])})}),[t==null?void 0:t.QuoteContent,t==null?void 0:t.HistoryLogTab,t==null?void 0:t.CommentsTab,t==null?void 0:t.ItemsQuotedTab,e,je]),ha=u(()=>n(g,{name:"ShippingInformationTitle",slot:t==null?void 0:t.ShippingInformationTitle,context:{quoteData:e},children:n("h2",{children:o.shippingInformationTitle})}),[t==null?void 0:t.ShippingInformationTitle,e,o]),Na=u(()=>{var a;return n(g,{name:"ShippingInformation",slot:t==null?void 0:t.ShippingInformation,context:{quoteData:e,loading:y,setLoading:R},children:n(at,{shippingAddress:(a=e==null?void 0:e.shippingAddresses)==null?void 0:a[0],loading:y,"data-testid":"manage-quote-shipping-address"})})},[t==null?void 0:t.ShippingInformation,e,y,R]),Qa=u(()=>n(g,{name:"QuoteCommentsTitle",slot:t==null?void 0:t.QuoteCommentsTitle,context:{quoteData:e},children:n("h2",{children:o.quoteCommentsTitle})}),[t==null?void 0:t.QuoteCommentsTitle,o,e]),Sa=u(()=>n(g,{name:"QuoteComments",slot:t==null?void 0:t.QuoteComments,context:{quoteData:e},children:n(Va,{name:"quoteComments",placeholder:o.quoteCommentsPlaceholder,rows:3,value:E,onInput:a=>{Ie(a.target.value)},disabled:!(e!=null&&e.canSendForReview)||q})}),[t==null?void 0:t.QuoteComments,o,e,E,q]),ea=u(()=>!(e!=null&&e.canSendForReview),[e]),qa=u(()=>{const a=q||ea;return n(g,{name:"AttachFilesField",slot:t==null?void 0:t.AttachFilesField,context:{onFileChange:Se,attachedFiles:b,fileUploadError:ie,disabled:a},children:M("div",{className:"quote-management-manage-negotiable-quote__attach-files",...a?{"data-disabled":!0}:{},"aria-disabled":a,children:[n($a,{multiple:!0,onChange:r=>{const i=r.target,m=i==null?void 0:i.files,f=m?Array.from(m):[];f.length>0&&Se(f)},icon:n(Aa,{}),disabled:a,"data-testid":"manage-quote-attach-files",accept:Q==null?void 0:Q.join(","),children:o.attachFiles}),ie&&n("div",{className:"quote-management-manage-negotiable-quote__file-error","data-testid":"file-upload-error",children:ie})]})})},[t==null?void 0:t.AttachFilesField,Se,q,ea,Q,ie,o,b]),va=u(()=>{if(b.length)return n(g,{name:"AttachedFilesList",slot:t==null?void 0:t.AttachedFilesList,context:{files:b,onRemove:qe,disabled:q},children:n(et,{files:b,onRemove:qe,disabled:q})})},[b,qe,q,t==null?void 0:t.AttachedFilesList]),Ta=c(async()=>{if(e!=null&&e.uid){ue(!0),V(""),H("");try{await rt({quoteUids:[e.uid]})}catch(a){console.error("Failed to close quote:",a)}}},[e]),Ca=c(()=>{de(!1),V(""),H("")},[]),ya=c(async()=>{if(e!=null&&e.uid){ke(!0),ae(""),$("");try{await it(e.uid),$(o.createTemplateSuccessMessage)}catch(a){console.error("Failed to create quote template:",a);const r=a instanceof Error?a.message:o.createTemplateErrorFallback;ae(r)}finally{ke(!1)}}},[e,o.createTemplateSuccessMessage,o.createTemplateErrorFallback]),_a=c(()=>{ge(!1),ae(""),$("")},[]),ve=c(async()=>{const a=b.filter(r=>r.status==="success");if(I){I({quoteData:e,comment:E.trim()||void 0,attachments:a.length?a:void 0});return}me(!0);try{await lt({quoteUid:e.uid,comment:E.trim()||void 0,attachments:a.length?a.map(r=>({key:r.key})):void 0})}catch(r){console.error("Failed to send quote for review:",r),me(!1)}},[e,I,E,b]),Ea=u(()=>n(g,{name:"Footer",slot:t==null?void 0:t.Footer,context:{quoteData:e,comment:E,isSubmitting:q,attachments:b,handleSendForReview:ve},children:n(ra,{variant:"primary",onClick:ve,"data-testid":"send-for-review-button",disabled:!(e!=null&&e.canSendForReview)||q,children:o.sendForReview})}),[t==null?void 0:t.Footer,o,e,E,q,b,ve]),Fa=u(()=>Me?n(N,{type:"error",variant:"primary",icon:n(P,{color:"var(--color-error)"}),heading:o.renameErrorHeading,description:Me}):void 0,[Me,o.renameErrorHeading]),Da=u(()=>be?n(N,{type:"success",variant:"primary",icon:n(J,{}),heading:o.renameSuccessHeading,description:be}):void 0,[be,o.renameSuccessHeading]),Te=c(a=>a.errors&&Array.isArray(a.errors)&&a.errors.length>0?a.errors[0].message||o.confirmationModalDeleteErrorFallback:(a==null?void 0:a.message)||o.confirmationModalDeleteErrorFallback,[o.confirmationModalDeleteErrorFallback]),Ia=c(()=>{A(!1),W(null),ee(!1)},[]),wa=c(async()=>{if(e!=null&&e.uid){W(null),ee(!1);try{const{operationResults:a}=await ct(e.uid),r=a.find(i=>i.__typename==="DeleteNegotiableQuoteOperationFailure");if(r){const i=Te(r);W(i);return}ee(!0)}catch(a){const r=Te(a);W(r)}}},[e,Te]),xa=c(()=>{W(null)},[]),Ra=c(()=>{ee(!1)},[]),aa=c(a=>(a==null?void 0:a.message)||o.confirmationModalDuplicateErrorFallback,[o.confirmationModalDuplicateErrorFallback]),La=c(()=>{se(!1),_(null),L(!1)},[]),Ha=c(async()=>{if(e!=null&&e.uid){_(null),L(!1);try{const r=(i=>{const m=i.slice(0,-8),f=crypto.randomUUID().slice(0,8);return m+f})(e.uid);await st({quoteUid:e.uid,duplicatedQuoteUid:r})}catch(a){const r=aa(a);_(r)}}},[e,aa]),Ua=c(()=>{_(null)},[]),ka=c(()=>{L(!1)},[]),Ba=Ee?n(N,{type:"error",variant:"primary",icon:n(P,{}),heading:o.confirmationModalDeleteErrorHeading,description:Ee,onDismiss:xa,"data-testid":"confirmation-modal-error-banner"}):null,ta=(ia?n(N,{type:"success",variant:"primary",icon:n(J,{}),heading:o.confirmationModalDeleteSuccessHeading,description:o.confirmationModalDeleteSuccessDescription,onDismiss:Ra,"data-testid":"confirmation-modal-success-banner"}):null)||Ba,za=De?n(N,{type:"error",variant:"primary",icon:n(P,{}),heading:o.confirmationModalDuplicateErrorHeading,description:De,onDismiss:Ua,"data-testid":"confirmation-modal-duplicate-error-banner"}):null,na=(la?n(N,{type:"success",variant:"primary",icon:n(J,{}),heading:o.confirmationModalDuplicateSuccessHeading,description:o.confirmationModalDuplicateSuccessDescription,onDismiss:ka,"data-testid":"confirmation-modal-duplicate-success-banner"}):null)||za,Oa={...Y,loading:y,quoteName:ua,quoteStatus:ga,banner:fa||void 0,details:pa,actionBar:Ma,quoteContent:ba,shippingInformationTitle:ha,shippingInformation:Na,quoteCommentsTitle:Qa,quoteComments:Sa,attachFilesField:qa,attachedFilesList:va,footer:Ea};let Ce=null;Re?Ce=n(N,{type:"success",variant:"primary",icon:n(J,{}),heading:o.closeModalSuccessHeading,description:Re,"data-testid":"close-quote-success-banner"}):Le&&(Ce=n(N,{type:"error",variant:"primary",icon:n(P,{}),heading:o.confirmationModalDeleteErrorHeading,description:Le,"data-testid":"close-quote-error-banner"}));let ye=null;return Be?ye=n(N,{type:"success",variant:"primary",icon:n(J,{}),heading:o.createTemplateModalSuccessHeading,description:Be,"data-testid":"create-template-success-banner"}):ze&&(ye=n(N,{type:"error",variant:"primary",icon:n(P,{}),heading:o.createTemplateModalErrorHeading,description:ze,"data-testid":"create-template-error-banner"})),M(Pa,{children:[n(ft,{...Oa}),Oe&&z(n(Xa,{open:Oe,quoteName:te,renameReason:pe,quoteNameError:ca,errorBanner:Fa,successBanner:Da,onQuoteNameChange:ma,onRenameReasonChange:oe,onSave:da,onClose:sa}),document.body),Z&&z(n(X,{open:Z,title:o.confirmationModalDeleteTitle,message:o.confirmationModalDeleteMessage,cancelLabel:o.confirmationModalCancel,confirmLabel:o.confirmationModalDeleteConfirm,onCancel:Ia,onConfirm:wa,showCloseButton:!ta,confirmationBanner:ta}),document.body),Fe&&z(n(X,{open:Fe,title:o.confirmationModalDuplicateTitle,message:o.confirmationModalDuplicateMessage,cancelLabel:o.confirmationModalCancel,confirmLabel:o.confirmationModalDuplicateConfirm,onCancel:La,onConfirm:Ha,showCloseButton:!na,confirmationBanner:na}),document.body),we&&z(n(X,{open:we,title:o.closeModalTitle,message:o.closeModalMessage,cancelLabel:o.closeModalCancel,confirmLabel:xe?o.closeModalConfirmLoading:o.closeModalConfirm,onCancel:Ca,onConfirm:xe?void 0:Ta,showCloseButton:!0,confirmationBanner:Ce,"data-testid":"close-quote-confirmation-modal"}),document.body),He&&z(n(X,{open:He,title:o.createTemplateModalTitle,message:o.createTemplateModalMessage,cancelLabel:o.createTemplateModalCancel,confirmLabel:Ue?o.createTemplateModalConfirmLoading:o.createTemplateModalConfirm,onCancel:_a,onConfirm:Ue?void 0:ya,showCloseButton:!0,confirmationBanner:ye,"data-testid":"create-template-confirmation-modal"}),document.body),Ve&&z(n(X,{open:Ve,title:o.noItemsSelectedModalTitle,message:o.noItemsSelectedModalMessage,confirmLabel:o.noItemsSelectedModalConfirm,onConfirm:Ke,onClose:Ke,showCloseButton:!0,"data-testid":"no-items-selected-modal"}),document.body)]})};export{Yt as ManageNegotiableQuote,Yt as default};
//# sourceMappingURL=ManageNegotiableQuote.js.map
