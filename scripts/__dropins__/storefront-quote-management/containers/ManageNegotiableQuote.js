/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as n,jsxs as p,Fragment as la}from"@dropins/tools/preact-jsx-runtime.js";import{useState as l,useRef as Ee,useEffect as N,useCallback as c,useMemo as f,createPortal as W}from"@dropins/tools/preact-compat.js";import{classes as u,VComponent as M,Slot as g}from"@dropins/tools/lib.js";import{f as ca}from"../chunks/dateUtils.js";/* empty css                              */import{Skeleton as Ga,SkeletonRow as z,InLineAlert as b,Button as sa,TextArea as Ka,InputFile as Xa}from"@dropins/tools/components.js";import{events as C}from"@dropins/tools/event-bus.js";import{S as Ja,A as Ya,T as Za,R as et}from"../chunks/RenameQuoteModal.js";import{v as at,f as tt,a as nt,S as ot,A as it}from"../chunks/AttachedFilesList.js";import"@dropins/tools/preact.js";import"@dropins/tools/preact-hooks.js";import{C as K}from"../chunks/ConfirmationModal.js";/* empty css                        *//* empty css                          */import{S as rt}from"../chunks/ShippingAddressDisplay.js";import{Q as lt}from"../chunks/QuoteHistoryLog3.js";import{g as ct,r as st,c as mt,a as dt,s as ut,d as gt,b as ft}from"../chunks/duplicateNegotiableQuote.js";import"../chunks/state.js";import{u as pt}from"../chunks/uploadFile.js";import{I as Mt}from"../chunks/ItemsQuoted.js";import{Q as bt}from"../chunks/QuoteCommentsList3.js";import{S as y}from"../chunks/WarningFilled.js";import{S as X}from"../chunks/CheckWithCircle.js";import{useText as ht}from"@dropins/tools/i18n.js";import"../chunks/QuoteHistoryLog.js";import"../chunks/transform-quote.js";import"@dropins/tools/fetch-graphql.js";import"../chunks/NegotiableQuoteFragment.js";import"../chunks/transform-quote-template.js";import"../chunks/NegotiableQuoteTemplateFragment.js";import"../chunks/LineItemNoteModal.js";import"../chunks/setLineItemNote.js";import"../chunks/QuoteCommentsList.js";const Nt=({className:x,loading:t,quoteName:m,quoteStatus:R,banner:E,details:_,actionBar:S,quoteContent:L,shippingInformationTitle:J,shippingInformation:e,quoteCommentsTitle:Q,quoteComments:D,attachFilesField:k,attachedFilesList:P,footer:Y,...Z})=>t?n(St,{}):p("div",{...Z,className:u(["quote-management-manage-negotiable-quote",x]),children:[p("div",{className:u(["quote-management-manage-negotiable-quote__header"]),children:[m&&n(M,{node:m,className:u(["quote-management-manage-negotiable-quote__quote-name"])}),R&&n(M,{node:R,className:u(["quote-management-manage-negotiable-quote__quote-status"])})]}),E&&n(M,{node:E,className:u(["quote-management-manage-negotiable-quote__banner"])}),_&&n(M,{node:_,className:u(["quote-management-manage-negotiable-quote__details"])}),S&&n(M,{node:S,className:u(["quote-management-manage-negotiable-quote__action-bar"])}),L&&n(M,{node:L,className:u(["quote-management-manage-negotiable-quote__quote-content"])}),p("div",{"data-testid":"quote-shipping-information-container",className:u(["quote-management-manage-negotiable-quote__shipping-information-container"]),children:[J&&n(M,{node:J,className:u(["quote-management-manage-negotiable-quote__shipping-information-title"])}),e&&n(M,{node:e,className:u(["quote-management-manage-negotiable-quote__shipping-information"])})]}),p("div",{"data-testid":"quote-comments-container",className:u(["quote-management-manage-negotiable-quote__quote-comments-container"]),children:[Q&&n(M,{node:Q,className:u(["quote-management-manage-negotiable-quote__quote-comments-title"])}),D&&n(M,{node:D,className:u(["quote-management-manage-negotiable-quote__quote-comments"])}),k&&n(M,{node:k,className:u(["quote-management-manage-negotiable-quote__attach-files-field"])}),P&&n(M,{node:P,className:u(["quote-management-manage-negotiable-quote__attached-files-list"])})]}),n(M,{node:Y,className:u(["quote-management-manage-negotiable-quote__footer"])})]}),St=()=>p(Ga,{"data-testid":"manage-negotiable-quote-skeleton",children:[n(z,{variant:"heading",fullWidth:!0,size:"large"}),n(z,{variant:"row",fullWidth:!1,size:"small"}),n(z,{variant:"row",fullWidth:!1,size:"small"}),n(z,{variant:"row",fullWidth:!0}),n(z,{variant:"row",fullWidth:!0,size:"xlarge",lines:2}),n(z,{variant:"row",fullWidth:!1,size:"small"})]}),nn=({onActionsDropdownChange:x,slots:t,onActionsButtonClick:m,onSendForReview:R,maxFiles:E,maxFileSize:_,acceptedFileTypes:S,onDuplicateQuote:L,...J})=>{const[e,Q]=l(void 0),[D,k]=l(!0),[P,Y]=l(!1),[Z,$]=l(null),[ma,ee]=l(!1),[_e,se]=l(!1),[De,F]=l(null),[da,H]=l(!1),[Fe,Ie]=l(!1),[I,we]=l(""),[q,me]=l(!1),[xe,de]=l(!1),[Re,ue]=l(!1),[Le,O]=l(""),[ke,V]=l(""),[He,ge]=l(!1),[Oe,Ue]=l(!1),[Be,A]=l(""),[We,ae]=l(""),[ze,fe]=l(!1),[te,ne]=l(""),[pe,oe]=l(""),[Me,j]=l(""),[ua,U]=l(""),[be,ie]=l(""),[h,G]=l([]),[re,le]=l(void 0),[he,Pe]=l(new Set),$e=Ee(he),Ne=Ee(null),[B,Se]=l(""),ce=Ee(B),[Ve,Ae]=l(!1),[ga,fa]=l(!0);N(()=>{$e.current=he},[he]),N(()=>{ce.current=B},[B]);const o=ht({createdLabel:"NegotiableQuote.Manage.createdLabel",salesRepLabel:"NegotiableQuote.Manage.salesRepLabel",expiresLabel:"NegotiableQuote.Manage.expiresLabel",actionsLabel:"NegotiableQuote.Manage.actionsLabel",remove:"NegotiableQuote.Manage.actions.remove",close:"NegotiableQuote.Manage.actionButtons.close",delete:"NegotiableQuote.Manage.actionButtons.delete",print:"NegotiableQuote.Manage.actionButtons.print",createTemplate:"NegotiableQuote.Manage.actionButtons.createTemplate",createCopy:"NegotiableQuote.Manage.actionButtons.createCopy",shippingInformationTitle:"NegotiableQuote.Manage.shippingInformation.title",quoteCommentsTitle:"NegotiableQuote.Manage.quoteComments.title",quoteCommentsPlaceholder:"NegotiableQuote.Manage.quoteComments.placeholder",sendForReview:"NegotiableQuote.Manage.actionButtons.sendForReview",bannerTitle:"NegotiableQuote.Manage.bannerTitle",statusSubmitted:"NegotiableQuote.Manage.bannerStatusMessages.submitted",statusPending:"NegotiableQuote.Manage.bannerStatusMessages.pending",statusExpired:"NegotiableQuote.Manage.bannerStatusMessages.expired",errorFallback:"NegotiableQuote.Manage.confirmationModal.delete.errorFallback",closeSuccessMessage:"NegotiableQuote.Manage.confirmationModal.close.successDescription",closeModalTitle:"NegotiableQuote.Manage.actionButtons.close",closeModalMessage:"NegotiableQuote.Manage.confirmationModal.close.message",closeModalCancel:"NegotiableQuote.Manage.confirmationModal.cancel",closeModalConfirm:"NegotiableQuote.Manage.confirmationModal.close.confirm",closeModalConfirmLoading:"NegotiableQuote.Manage.confirmationModal.close.confirmLoading",closeModalSuccessHeading:"NegotiableQuote.Manage.confirmationModal.close.successHeading",createTemplateModalTitle:"NegotiableQuote.Manage.actionButtons.createTemplate",createTemplateModalMessage:"NegotiableQuote.Manage.confirmationModal.createTemplate.message",createTemplateModalCancel:"NegotiableQuote.Manage.confirmationModal.cancel",createTemplateModalConfirm:"NegotiableQuote.Manage.confirmationModal.createTemplate.confirm",createTemplateModalConfirmLoading:"NegotiableQuote.Manage.confirmationModal.createTemplate.confirmLoading",createTemplateModalSuccessHeading:"NegotiableQuote.Manage.confirmationModal.createTemplate.successHeading",createTemplateSuccessMessage:"NegotiableQuote.Manage.confirmationModal.createTemplate.successDescription",createTemplateModalErrorHeading:"NegotiableQuote.Manage.confirmationModal.createTemplate.errorHeading",createTemplateErrorFallback:"NegotiableQuote.Manage.confirmationModal.createTemplate.errorFallback",renameErrorHeading:"NegotiableQuote.Manage.rename.errorHeading",renameQuoteNameRequired:"NegotiableQuote.Manage.rename.quoteNameRequired",renameErrorDefault:"NegotiableQuote.Manage.rename.errorDefault",renameSuccessHeading:"NegotiableQuote.Manage.rename.successHeading",renameSuccessMessage:"NegotiableQuote.Manage.rename.successMessage",confirmationModalCancel:"NegotiableQuote.Manage.confirmationModal.cancel",confirmationModalDeleteTitle:"NegotiableQuote.Manage.confirmationModal.delete.title",confirmationModalDeleteMessage:"NegotiableQuote.Manage.confirmationModal.delete.message",confirmationModalDeleteConfirm:"NegotiableQuote.Manage.confirmationModal.delete.confirm",confirmationModalDeleteErrorHeading:"NegotiableQuote.Manage.confirmationModal.delete.errorHeading",confirmationModalDeleteErrorFallback:"NegotiableQuote.Manage.confirmationModal.delete.errorFallback",confirmationModalDeleteSuccessHeading:"NegotiableQuote.Manage.confirmationModal.delete.successHeading",confirmationModalDeleteSuccessDescription:"NegotiableQuote.Manage.confirmationModal.delete.successDescription",confirmationModalDuplicateTitle:"NegotiableQuote.Manage.confirmationModal.duplicate.title",confirmationModalDuplicateMessage:"NegotiableQuote.Manage.confirmationModal.duplicate.message",confirmationModalDuplicateConfirm:"NegotiableQuote.Manage.confirmationModal.duplicate.confirm",confirmationModalDuplicateErrorHeading:"NegotiableQuote.Manage.confirmationModal.duplicate.errorHeading",confirmationModalDuplicateErrorFallback:"NegotiableQuote.Manage.confirmationModal.duplicate.errorFallback",confirmationModalDuplicateSuccessHeading:"NegotiableQuote.Manage.confirmationModal.duplicate.successHeading",confirmationModalDuplicateSuccessDescription:"NegotiableQuote.Manage.confirmationModal.duplicate.successDescription",duplicateOutOfStockWarningHeading:"NegotiableQuote.Manage.confirmationModal.duplicate.outOfStockWarningHeading",duplicateOutOfStockWarningMessage:"NegotiableQuote.Manage.confirmationModal.duplicate.outOfStockWarningMessage",noItemsSelectedModalTitle:"NegotiableQuote.Manage.confirmationModal.noItemsSelected.title",noItemsSelectedModalMessage:"NegotiableQuote.Manage.confirmationModal.noItemsSelected.message",noItemsSelectedModalConfirm:"NegotiableQuote.Manage.confirmationModal.noItemsSelected.confirm",attachFiles:"NegotiableQuote.Manage.attachFiles",fileUploadError:"NegotiableQuote.Manage.fileUploadError",maxFilesExceeded:"NegotiableQuote.Manage.maxFilesExceeded",maxFileSizeExceeded:"NegotiableQuote.Manage.maxFileSizeExceeded",invalidFileType:"NegotiableQuote.Manage.invalidFileType",noEditQuoteAccessTitle:"QuoteManagement.permissions.noEditQuoteAccessTitle",noEditQuoteAccessMessage:"QuoteManagement.permissions.noEditQuoteAccessMessage"});N(()=>{const a=C.on("quote-management/permissions",i=>{fa(!!i.editQuote)},{eager:!0});return()=>a==null?void 0:a.off()},[]),N(()=>{const a=C.on("quote-management/quote-data",i=>{const{quote:r}=i;if(r){Q(r),k(!1);const s=`duplicate-outOfStock-warning-${r.uid}`;sessionStorage.getItem(s)==="true"&&(Ie(!0),sessionStorage.removeItem(s))}},{eager:!0});return()=>a==null?void 0:a.off()},[]),N(()=>{const a=C.on("quote-management/shipping-address-set",i=>{const{quote:r}=i;r&&Q(r)},{eager:!0});return()=>a==null?void 0:a.off()},[]),N(()=>{const a=C.on("quote-management/quote-sent-for-review",i=>{const{quote:r}=i;Q(r),we(""),G([]),me(!1)},{eager:!0});return()=>a==null?void 0:a.off()},[]),N(()=>{const a=C.on("quote-management/quote-items-removed",i=>{const{quote:r,removedItemUids:s}=i;r&&Q(r),s&&Pe(d=>{const v=new Set(d);return s.forEach(w=>v.delete(w)),v})},{eager:!0});return()=>a==null?void 0:a.off()},[]);const je=c((a,i)=>{Pe(r=>{const s=new Set(r);return i?s.add(a.uid):s.delete(a.uid),s})},[]),Ge=c(a=>{const i=a.target.value,r=$e.current;if(i==="remove"){if(Se(i),ce.current=i,r.size===0)Ae(!0);else if(e&&Ne.current){const s=e.items.filter(d=>r.has(d.uid));Ne.current(s)}}x==null||x(a)},[x,e]),Ke=c(()=>{Ae(!1),Se(""),ce.current=""},[]);N(()=>{const a=C.on("quote-management/negotiable-quote-closed",async i=>{ue(!1),V(""),O(o.closeSuccessMessage),Q(r=>{var s;return r!=null&&r.uid&&((s=i.closedQuoteUids)!=null&&s.includes(r.uid))&&ct(r.uid).then(d=>{Q(d)}).catch(d=>{console.warn("Failed to refresh quote data after closure:",d)}),r}),setTimeout(()=>{de(!1),O("")},2e3)},{eager:!0});return()=>a==null?void 0:a.off()},[o.closeSuccessMessage]),N(()=>{const a=C.on("quote-management/negotiable-quote-close-error",i=>{console.log("Close error event received:",i),ue(!1),O("");const r=i.error.message||o.errorFallback;V(r)},{eager:!0});return()=>a==null?void 0:a.off()},[o.errorFallback]),N(()=>{const a=C.on("quote-management/quote-renamed",i=>{const{quote:r}=i;Q(r),j(""),U(""),ie(o.renameSuccessMessage),setTimeout(()=>{fe(!1),ne(""),oe(""),ie("")},2e3)},{eager:!0});return()=>a==null?void 0:a.off()},[o.renameSuccessMessage]),N(()=>{const a=C.on("quote-management/quote-duplicated",i=>{const{quote:r}=i;e&&L&&L({quoteData:e,newQuote:r}),H(!0),F(null),setTimeout(()=>{se(!1),H(!1),F(null)},2e3)},{eager:!0});return()=>a==null?void 0:a.off()},[e,L]);const Qe=c(async a=>{if(E&&h.length+a.length>E){le(o.maxFilesExceeded.replace("{maxFiles}",String(E)));return}for(const r of a){if(_&&!at(r.size,_)){le(o.maxFileSizeExceeded.replace("{maxSize}",tt(_)));return}if(S&&!nt(r.type,S)){le(o.invalidFileType);return}}le(void 0);const i=a.map(r=>({key:`temp-${Date.now()}-${Math.random()}-${r.name}`,name:r.name,size:r.size,status:"uploading"}));G(r=>[...r,...i]);for(let r=0;r<a.length;r++){const s=a[r],d=i[r].key;try{const v=await pt(s);G(w=>w.map(T=>T.key===d?{...T,key:v.key,status:"success"}:T))}catch(v){G(w=>w.map(T=>T.key===d?{...T,status:"error",error:v.message}:T))}}},[E,_,S,h,o]),qe=c(a=>{G(i=>i.filter(r=>r.key!==a))},[]),Xe=c(()=>{ne((e==null?void 0:e.name)||""),oe(""),j(""),U(""),ie(""),fe(!0)},[e]),pa=c(()=>{fe(!1),ne(""),oe(""),j(""),U(""),ie("")},[]),Ma=c(a=>{ne(a),a.trim()&&U("")},[]),Je=c(()=>{se(!0),F(null),H(!1)},[]),ba=c(async()=>{if(!te.trim()){U(o.renameQuoteNameRequired);return}try{j(""),U(""),await st({quoteUid:e.uid,quoteName:te,quoteComment:pe.trim()||void 0})}catch(a){j(a.message||o.renameErrorDefault)}},[e,te,pe,o.renameQuoteNameRequired,o.renameErrorDefault]),ha=f(()=>{const a=e&&(e.lockedForEditing===!0||e.lockedForEditing===void 0&&(e.status==="SUBMITTED"||e.status==="PENDING"||e.status==="ORDERED"||e.status==="CLOSED"));return n(g,{name:"QuoteName",slot:t==null?void 0:t.QuoteName,context:{quoteName:e==null?void 0:e.name,quoteData:e},children:p("div",{className:"quote-management-manage-negotiable-quote__quote-name-wrapper",children:[n("h1",{"data-testid":"quote-name",className:"quote-management-manage-negotiable-quote__quote-name-title",children:e==null?void 0:e.name}),n("button",{onClick:Xe,disabled:a,"data-testid":"rename-quote-button",className:"quote-management-manage-negotiable-quote__rename-button","aria-label":"Rename quote",children:n(Ja,{})})]})})},[t==null?void 0:t.QuoteName,e,Xe]),Na=f(()=>n(g,{name:"QuoteStatus",slot:t==null?void 0:t.QuoteStatus,context:{quoteStatus:e==null?void 0:e.status,quoteData:e},children:n("div",{"data-testid":"quote-status",children:e==null?void 0:e.status})}),[t==null?void 0:t.QuoteStatus,e]),Ye=c(a=>{switch(a){case"SUBMITTED":return o.statusSubmitted;case"PENDING":return o.statusPending;case"EXPIRED":return o.statusExpired;default:return null}},[o])(e==null?void 0:e.status),Ze=!ga&&e?n(b,{type:"warning",variant:"primary",icon:n(y,{}),heading:o.noEditQuoteAccessTitle,description:o.noEditQuoteAccessMessage,"data-testid":"quote-permission-warning-banner"}):Ye?n(b,{type:"warning",variant:"secondary",icon:n(y,{}),heading:o.bannerTitle,description:Ye}):null,ea=Ze&&n(g,{name:"Banner","data-testid":"banner",slot:t==null?void 0:t.Banner,context:{quoteData:e},children:Ze}),Sa=c(()=>{Ie(!1)},[]),aa=Fe&&n(g,{name:"DuplicateQuoteWarningBanner","data-testid":"duplicate-outOfStock-warning-banner",slot:t==null?void 0:t.DuplicateQuoteWarningBanner,context:{outOfStockWarning:Fe},children:n(b,{type:"warning",variant:"primary",icon:n(y,{}),heading:o.duplicateOutOfStockWarningHeading,description:o.duplicateOutOfStockWarningMessage,onDismiss:Sa,"data-testid":"duplicate-outOfStock-warning-alert"})}),Qa=f(()=>{if(!e)return;const a=e.expirationDate?ca(e.expirationDate,"short"):void 0;return p(g,{name:"Details",slot:t==null?void 0:t.Details,context:{quoteData:e},children:[p("div",{className:"quote-management-manage-negotiable-quote__detail",children:[n("span",{className:"quote-management-manage-negotiable-quote__detail-title","data-testid":"created-label",children:o.createdLabel}),p("span",{className:"quote-management-manage-negotiable-quote__detail-content","data-testid":"created-value",children:[ca(e.createdAt,"short")," (",e.buyer.firstname," ",e.buyer.lastname,")"]})]}),p("div",{className:"quote-management-manage-negotiable-quote__detail",children:[n("span",{className:"quote-management-manage-negotiable-quote__detail-title","data-testid":"sales-rep-label",children:o.salesRepLabel}),n("span",{className:"quote-management-manage-negotiable-quote__detail-content","data-testid":"sales-rep-value",children:e.salesRepName})]}),p("div",{className:"quote-management-manage-negotiable-quote__detail",children:[n("span",{className:"quote-management-manage-negotiable-quote__detail-title","data-testid":"expires-label",children:o.expiresLabel}),n("span",{className:"quote-management-manage-negotiable-quote__detail-content","data-testid":"expires-value",children:a})]})]})},[t==null?void 0:t.Details,o,e]),ta=f(()=>[{label:o.close,value:"close",disabled:!(e!=null&&e.canClose)},{label:o.delete,value:"delete",disabled:!(e!=null&&e.canDelete)},{label:o.print,value:"print"},{label:o.createTemplate,value:"createTemplate"},{label:o.createCopy,value:"createCopy"}],[o,e==null?void 0:e.canDelete,e==null?void 0:e.canClose]),qa=f(()=>{const a=i=>{switch(i){case"close":de(!0),V(""),O(""),m==null||m(i);break;case"delete":Y(!0),m==null||m(i);break;case"print":m==null||m(i);break;case"createTemplate":ge(!0),ae(""),A(""),m==null||m(i);break;case"createCopy":Je(),m==null||m(i);break}};return n(g,{name:"ActionBar",slot:t==null?void 0:t.ActionBar,context:{quoteData:e,actionsBarDropdownValue:B},children:n(Ya,{dropdownPlaceholder:o.actionsLabel,dropdownOptions:[{label:o.remove,value:"remove"}],dropdownValue:B,handleDropdownChange:Ge,buttons:ta.map(i=>n(sa,{variant:"tertiary",onClick:()=>a(i.value),"data-testid":`actions-bar-${i.value}-button`,"data-action":i.value,disabled:i.disabled,children:i.label},i.value))})})},[ta,o,t==null?void 0:t.ActionBar,e,Ge,m,Je,B]),va=f(()=>n(g,{name:"QuoteContent",slot:t==null?void 0:t.QuoteContent,context:{quoteData:e},children:n(Za,{tabs:new Map([["items-quoted","Items Quoted"],["comments","Comments"],["history-log","History Log"]]),tabsContent:new Map([["items-quoted",n(g,{name:"ItemsQuotedTab",slot:t==null?void 0:t.ItemsQuotedTab,context:{quoteData:e},children:n(Mt,{quoteData:e,onItemCheckboxChange:je,onRemoveItemsRef:a=>{Ne.current=a},onRemoveModalStateChange:a=>{!a&&ce.current==="remove"&&Se("")}})},"items-quoted")],["comments",n(g,{name:"CommentsTab",slot:t==null?void 0:t.CommentsTab,context:{quoteData:e},children:n(bt,{quoteData:e})},"comments")],["history-log",n(g,{name:"HistoryLogTab",slot:t==null?void 0:t.HistoryLogTab,context:{quoteData:e},children:n(lt,{quoteData:e})},"history-log")]])})}),[t==null?void 0:t.QuoteContent,t==null?void 0:t.HistoryLogTab,t==null?void 0:t.CommentsTab,t==null?void 0:t.ItemsQuotedTab,e,je]),Ta=f(()=>n(g,{name:"ShippingInformationTitle",slot:t==null?void 0:t.ShippingInformationTitle,context:{quoteData:e},children:n("h2",{children:o.shippingInformationTitle})}),[t==null?void 0:t.ShippingInformationTitle,e,o]),Ca=f(()=>{var a;return n(g,{name:"ShippingInformation",slot:t==null?void 0:t.ShippingInformation,context:{quoteData:e,loading:D,setLoading:k},children:n(rt,{shippingAddress:(a=e==null?void 0:e.shippingAddresses)==null?void 0:a[0],loading:D,"data-testid":"manage-quote-shipping-address"})})},[t==null?void 0:t.ShippingInformation,e,D,k]),ya=f(()=>n(g,{name:"QuoteCommentsTitle",slot:t==null?void 0:t.QuoteCommentsTitle,context:{quoteData:e},children:n("h2",{children:o.quoteCommentsTitle})}),[t==null?void 0:t.QuoteCommentsTitle,o,e]),Ea=f(()=>n(g,{name:"QuoteComments",slot:t==null?void 0:t.QuoteComments,context:{quoteData:e},children:n(Ka,{name:"quoteComments",placeholder:o.quoteCommentsPlaceholder,rows:3,value:I,onInput:a=>{we(a.target.value)},disabled:!(e!=null&&e.canSendForReview)||q})}),[t==null?void 0:t.QuoteComments,o,e,I,q]),na=f(()=>!(e!=null&&e.canSendForReview),[e]),_a=f(()=>{const a=q||na;return n(g,{name:"AttachFilesField",slot:t==null?void 0:t.AttachFilesField,context:{onFileChange:Qe,attachedFiles:h,fileUploadError:re,disabled:a},children:p("div",{className:"quote-management-manage-negotiable-quote__attach-files",...a?{"data-disabled":!0}:{},"aria-disabled":a,children:[n(Xa,{id:"manage-quote-attach-files",multiple:!0,onChange:i=>{const r=i.target,s=r==null?void 0:r.files,d=s?Array.from(s):[];d.length>0&&Qe(d)},icon:n(ot,{}),disabled:a,"data-testid":"manage-quote-attach-files",accept:S==null?void 0:S.join(","),children:o.attachFiles}),re&&n("div",{className:"quote-management-manage-negotiable-quote__file-error","data-testid":"file-upload-error",children:re})]})})},[t==null?void 0:t.AttachFilesField,Qe,q,na,S,re,o,h]),Da=f(()=>{if(h.length)return n(g,{name:"AttachedFilesList",slot:t==null?void 0:t.AttachedFilesList,context:{files:h,onRemove:qe,disabled:q},children:n(it,{files:h,onRemove:qe,disabled:q})})},[h,qe,q,t==null?void 0:t.AttachedFilesList]),Fa=c(async()=>{if(e!=null&&e.uid){ue(!0),V(""),O("");try{await mt({quoteUids:[e.uid]})}catch(a){console.error("Failed to close quote:",a)}}},[e]),Ia=c(()=>{de(!1),V(""),O("")},[]),wa=c(async()=>{if(e!=null&&e.uid){Ue(!0),ae(""),A("");try{await dt(e.uid),A(o.createTemplateSuccessMessage),setTimeout(()=>{ge(!1),A("")},2e3)}catch(a){console.error("Failed to create quote template:",a);const i=a instanceof Error?a.message:o.createTemplateErrorFallback;ae(i)}finally{Ue(!1)}}},[e,o.createTemplateSuccessMessage,o.createTemplateErrorFallback]),xa=c(()=>{ge(!1),ae(""),A("")},[]),ve=c(async()=>{const a=h.filter(i=>i.status==="success");if(R){R({quoteData:e,comment:I.trim()||void 0,attachments:a.length?a:void 0});return}me(!0);try{await ut({quoteUid:e.uid,comment:I.trim()||void 0,attachments:a.length?a.map(i=>({key:i.key})):void 0})}catch(i){console.error("Failed to send quote for review:",i),me(!1)}},[e,R,I,h]),Ra=f(()=>n(g,{name:"Footer",slot:t==null?void 0:t.Footer,context:{quoteData:e,comment:I,isSubmitting:q,attachments:h,handleSendForReview:ve},children:n(sa,{variant:"primary",onClick:ve,"data-testid":"send-for-review-button",disabled:!(e!=null&&e.canSendForReview)||q,children:o.sendForReview})}),[t==null?void 0:t.Footer,o,e,I,q,h,ve]),La=f(()=>Me?n(b,{type:"error",variant:"primary",icon:n(y,{color:"var(--color-error)"}),heading:o.renameErrorHeading,description:Me}):void 0,[Me,o.renameErrorHeading]),ka=f(()=>be?n(b,{type:"success",variant:"primary",icon:n(X,{}),heading:o.renameSuccessHeading,description:be}):void 0,[be,o.renameSuccessHeading]),Te=c(a=>a.errors&&Array.isArray(a.errors)&&a.errors.length>0?a.errors[0].message||o.confirmationModalDeleteErrorFallback:(a==null?void 0:a.message)||o.confirmationModalDeleteErrorFallback,[o.confirmationModalDeleteErrorFallback]),Ha=c(()=>{Y(!1),$(null),ee(!1)},[]),Oa=c(async()=>{if(e!=null&&e.uid){$(null),ee(!1);try{const{operationResults:a}=await gt(e.uid),i=a.find(r=>r.__typename==="DeleteNegotiableQuoteOperationFailure");if(i){const r=Te(i);$(r);return}ee(!0)}catch(a){const i=Te(a);$(i)}}},[e,Te]),Ua=c(()=>{$(null)},[]),Ba=c(()=>{ee(!1)},[]),oa=c(a=>(a==null?void 0:a.message)||o.confirmationModalDuplicateErrorFallback,[o.confirmationModalDuplicateErrorFallback]),Wa=c(()=>{se(!1),F(null),H(!1)},[]),za=c(async()=>{var a;if(e!=null&&e.uid){F(null),H(!1);try{const i=((a=e.items)==null?void 0:a.filter(v=>v.outOfStock))||[],s=(v=>{const w=v.slice(0,-8),T=crypto.randomUUID().slice(0,8);return w+T})(e.uid),d=i.length>0;d&&sessionStorage.setItem(`duplicate-outOfStock-warning-${s}`,"true"),await ft({quoteUid:e.uid,duplicatedQuoteUid:s,hasOutOfStockItems:d})}catch(i){const r=oa(i);F(r)}}},[e,oa]),Pa=c(()=>{F(null)},[]),$a=c(()=>{H(!1)},[]),Va=Z?n(b,{type:"error",variant:"primary",icon:n(y,{}),heading:o.confirmationModalDeleteErrorHeading,description:Z,onDismiss:Ua,"data-testid":"confirmation-modal-error-banner"}):null,ia=(ma?n(b,{type:"success",variant:"primary",icon:n(X,{}),heading:o.confirmationModalDeleteSuccessHeading,description:o.confirmationModalDeleteSuccessDescription,onDismiss:Ba,"data-testid":"confirmation-modal-success-banner"}):null)||Va,Aa=De?n(b,{type:"error",variant:"primary",icon:n(y,{}),heading:o.confirmationModalDuplicateErrorHeading,description:De,onDismiss:Pa,"data-testid":"confirmation-modal-duplicate-error-banner"}):null,ra=(da?n(b,{type:"success",variant:"primary",icon:n(X,{}),heading:o.confirmationModalDuplicateSuccessHeading,description:o.confirmationModalDuplicateSuccessDescription,onDismiss:$a,"data-testid":"confirmation-modal-duplicate-success-banner"}):null)||Aa,ja={...J,loading:D,quoteName:ha,quoteStatus:Na,banner:aa||ea?p(la,{children:[aa,ea]}):void 0,details:Qa,actionBar:qa,quoteContent:va,shippingInformationTitle:Ta,shippingInformation:Ca,quoteCommentsTitle:ya,quoteComments:Ea,attachFilesField:_a,attachedFilesList:Da,footer:Ra};let Ce=null;Le?Ce=n(b,{type:"success",variant:"primary",icon:n(X,{}),heading:o.closeModalSuccessHeading,description:Le,"data-testid":"close-quote-success-banner"}):ke&&(Ce=n(b,{type:"error",variant:"primary",icon:n(y,{}),heading:o.confirmationModalDeleteErrorHeading,description:ke,"data-testid":"close-quote-error-banner"}));let ye=null;return Be?ye=n(b,{type:"success",variant:"primary",icon:n(X,{}),heading:o.createTemplateModalSuccessHeading,description:Be,"data-testid":"create-template-success-banner"}):We&&(ye=n(b,{type:"error",variant:"primary",icon:n(y,{}),heading:o.createTemplateModalErrorHeading,description:We,"data-testid":"create-template-error-banner"})),p(la,{children:[n(Nt,{...ja}),ze&&W(n(et,{open:ze,quoteName:te,renameReason:pe,quoteNameError:ua,errorBanner:La,successBanner:ka,onQuoteNameChange:Ma,onRenameReasonChange:oe,onSave:ba,onClose:pa}),document.body),P&&W(n(K,{open:P,title:o.confirmationModalDeleteTitle,message:o.confirmationModalDeleteMessage,cancelLabel:o.confirmationModalCancel,confirmLabel:o.confirmationModalDeleteConfirm,onCancel:Ha,onConfirm:Oa,showCloseButton:!ia,confirmationBanner:ia}),document.body),_e&&W(n(K,{open:_e,title:o.confirmationModalDuplicateTitle,message:o.confirmationModalDuplicateMessage,cancelLabel:o.confirmationModalCancel,confirmLabel:o.confirmationModalDuplicateConfirm,onCancel:Wa,onConfirm:za,showCloseButton:!ra,confirmationBanner:ra}),document.body),xe&&W(n(K,{open:xe,title:o.closeModalTitle,message:o.closeModalMessage,cancelLabel:o.closeModalCancel,confirmLabel:Re?o.closeModalConfirmLoading:o.closeModalConfirm,onCancel:Ia,onConfirm:Re?void 0:Fa,showCloseButton:!0,confirmationBanner:Ce,"data-testid":"close-quote-confirmation-modal"}),document.body),He&&W(n(K,{open:He,title:o.createTemplateModalTitle,message:o.createTemplateModalMessage,cancelLabel:o.createTemplateModalCancel,confirmLabel:Oe?o.createTemplateModalConfirmLoading:o.createTemplateModalConfirm,onCancel:xa,onConfirm:Oe?void 0:wa,showCloseButton:!0,confirmationBanner:ye,"data-testid":"create-template-confirmation-modal"}),document.body),Ve&&W(n(K,{open:Ve,title:o.noItemsSelectedModalTitle,message:o.noItemsSelectedModalMessage,confirmLabel:o.noItemsSelectedModalConfirm,onConfirm:Ke,onClose:Ke,showCloseButton:!0,"data-testid":"no-items-selected-modal"}),document.body)]})};export{nn as ManageNegotiableQuote,nn as default};
//# sourceMappingURL=ManageNegotiableQuote.js.map
