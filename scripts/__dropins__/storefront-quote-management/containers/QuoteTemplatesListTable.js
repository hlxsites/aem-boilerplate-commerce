/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsxs as g,jsx as t}from"@dropins/tools/preact-jsx-runtime.js";import{useState as d,useRef as le,useEffect as j,createPortal as se}from"@dropins/tools/preact-compat.js";import{classes as ce,Slot as s}from"@dropins/tools/lib.js";import{Table as de,IllustratedMessage as ue,Picker as me,Pagination as ge,InLineAlert as pe,Button as F,Price as he}from"@dropins/tools/components.js";import{events as $}from"@dropins/tools/event-bus.js";/* empty css                              */import"@dropins/tools/preact.js";import"@dropins/tools/preact-hooks.js";import{f as D}from"../chunks/dateUtils.js";import{useText as W}from"@dropins/tools/i18n.js";import{C as fe}from"../chunks/ConfirmationModal.js";/* empty css                        *//* empty css                          */import{g as H}from"../chunks/transform-quote.js";import"../chunks/state.js";import{g as Qe}from"../chunks/getQuoteTemplates.js";import{g as Te}from"../chunks/generateQuoteFromTemplate.js";import"@dropins/tools/fetch-graphql.js";import"../chunks/transform-quote-template.js";const Me=({rowData:p=[],loading:h=!1,className:L,emptyStateMessage:M,showItemRange:N=!0,itemRangeMessage:u,showPageSizePicker:f=!0,pageSizePickerMessage:m,showPagination:l=!0,paginationMessage:Q,...c})=>{const o=W({name:"QuoteManagement.QuoteTemplatesListTable.name",state:"QuoteManagement.QuoteTemplatesListTable.state",status:"QuoteManagement.QuoteTemplatesListTable.status",validUntil:"QuoteManagement.QuoteTemplatesListTable.validUntil",minQuoteTotal:"QuoteManagement.QuoteTemplatesListTable.minQuoteTotal",ordersPlaced:"QuoteManagement.QuoteTemplatesListTable.ordersPlaced",lastOrdered:"QuoteManagement.QuoteTemplatesListTable.lastOrdered",actions:"QuoteManagement.QuoteTemplatesListTable.actions"}),b=[{key:"name",label:o.name},{key:"state",label:o.state},{key:"status",label:o.status},{key:"validUntil",label:o.validUntil},{key:"minQuoteTotal",label:o.minQuoteTotal},{key:"ordersPlaced",label:o.ordersPlaced},{key:"lastOrdered",label:o.lastOrdered},{key:"actions",label:o.actions}],S=h||p.length>0,T=!h&&p.length===0&&M,P=N&&u,v=f&&m,y=l&&Q,x=P||v||y;return g("div",{...c,className:ce(["quote-management-quote-templates-list-table",L]),children:[S&&t(de,{columns:b,rowData:p,loading:h,mobileLayout:"none",className:"quote-management-quote-templates-list-table__table"}),T&&t("div",{className:"quote-templates-list-table__empty-state",children:M}),x&&g("div",{className:"quote-templates-list-table__footer",children:[t("div",{className:"quote-templates-list-table__item-range",children:P&&u}),t("div",{className:"quote-templates-list-table__pagination",children:y&&Q}),t("div",{className:"quote-templates-list-table__page-size-picker",children:v&&m})]})]})},Ge=({pageSize:p,showItemRange:h=!0,showPageSizePicker:L=!0,showPagination:M=!0,onViewQuoteTemplate:N,onGenerateQuoteFromTemplate:u,onPageSizeChange:f,onPageChange:m,slots:l,...Q})=>{const c=W({view:"QuoteManagement.QuoteTemplatesListTable.view",generateQuote:"NegotiableQuoteTemplate.Manage.actionButtons.generateQuote",generateQuoteModalMessage:"NegotiableQuoteTemplate.Manage.confirmationModal.generateQuote.message",generateQuoteModalCancel:"NegotiableQuoteTemplate.Manage.confirmationModal.cancel",generateQuoteModalConfirm:"NegotiableQuoteTemplate.Manage.confirmationModal.generateQuote.confirm",generateQuoteModalConfirmLoading:"NegotiableQuoteTemplate.Manage.confirmationModal.generateQuote.confirmLoading",noQuoteTemplatesAccessTitle:"QuoteManagement.permissions.noQuoteTemplatesAccessTitle",noQuoteTemplatesAccessMessage:"QuoteManagement.permissions.noQuoteTemplatesAccessMessage"}),[o,b]=d(null),[S,T]=d(!0),[P,v]=d(!1),[y,x]=d(!1),w=le(!1),[I,z]=d(!1),[O,C]=d(!1),[_,q]=d(null),J=H()[0],[A,K]=d(p||J),[R,U]=d(1);j(()=>{const n=async()=>{try{T(!0);const r=await Qe({pageSize:A,currentPage:R});b(r)}catch(r){console.error("Failed to fetch quote templates:",r)}finally{T(!1)}},e=$.on("authenticated",r=>{x(r),r&&w.current?n():(b(null),T(!1))},{eager:!0});return()=>{e==null||e.off()}},[A,R]),j(()=>{const n=$.on("quote-management/permissions",e=>{const r=e.viewQuoteTemplates||e.manageQuoteTemplates;w.current=r,v(r)},{eager:!0});return()=>{n==null||n.off()}},[]);const G=n=>{K(n),U(1),f==null||f(n)},B=n=>{U(n),m==null||m(n)},X=n=>{const e=n.target,r=e==null?void 0:e.value;r&&G(Number(r))},Y=(n,e)=>{q({id:n,name:e}),z(!0)},Z=async n=>{C(!0);try{const e=await Te({templateId:n.id});u==null||u(n.id,n.name,e.quoteId),z(!1),q(null)}catch(e){console.error("Failed to generate quote from template:",e)}finally{C(!1)}},V=()=>{z(!1),q(null)},ee=(n,e,r)=>n.filter(a=>a==null?void 0:a.uid).map(a=>{var E;return{id:a.id,name:t(s,{name:"Name",slot:e==null?void 0:e.Name,context:{template:a},children:t("span",{children:a.name})}),state:t(s,{name:"State",slot:e==null?void 0:e.State,context:{template:a},children:t("span",{style:{textTransform:"capitalize"},children:((E=a.state)==null?void 0:E.replace(/_/g," "))||"-"})}),status:t(s,{name:"Status",slot:e==null?void 0:e.Status,context:{template:a},children:t("span",{children:a.status})}),validUntil:t(s,{name:"ValidUntil",slot:e==null?void 0:e.ValidUntil,context:{template:a},children:t("span",{children:D(a.expirationDate,"short")})}),minQuoteTotal:t(s,{name:"MinQuoteTotal",slot:e==null?void 0:e.MinQuoteTotal,context:{template:a},children:t(he,{amount:a.prices.minNegotiatedGrandTotal.value,currency:a.prices.minNegotiatedGrandTotal.currency})}),ordersPlaced:t(s,{name:"OrdersPlaced",slot:e==null?void 0:e.OrdersPlaced,context:{template:a},children:t("span",{children:a.ordersPlaced})}),lastOrdered:t(s,{name:"LastOrdered",slot:e==null?void 0:e.LastOrdered,context:{template:a},children:t("span",{children:D(a.lastOrderedAt,"short")})}),actions:g(s,{name:"Actions",slot:e==null?void 0:e.Actions,context:{template:a,onViewQuoteTemplate:r},className:"quote-management-quote-templates-list-table__actions-cell",children:[t(F,{variant:"tertiary",size:"medium",onClick:()=>r==null?void 0:r(a.id,a.name,a.status),children:c.view}),a.canGenerateQuoteFromTemplate&&t(F,{variant:"primary",size:"medium",onClick:()=>Y(a.id,a.name),"data-testid":`generate-quote-button-${a.id}`,children:c.generateQuote})]})}}),te=o!=null&&o.items?ee(o.items,l,N):[],i=o!=null&&o.paginationInfo?{...o.paginationInfo,pageSizeOptions:H()}:void 0,k=!!i,ae=t(s,{name:"EmptyTemplates",slot:l==null?void 0:l.EmptyTemplates,context:{templatesData:o},children:t(ue,{heading:"No Quote Templates Found"})}),ne=i?t(s,{name:"ItemRange",slot:l==null?void 0:l.ItemRange,context:i,children:g("span",{children:["Items ",i.startItem," to ",i.endItem," of"," ",i.totalCount," total"]})}):void 0,oe=i&&i.pageSizeOptions?g(s,{name:"PageSizePicker",slot:l==null?void 0:l.PageSizePicker,context:{pageSize:i.pageSize,pageSizeOptions:i.pageSizeOptions,onPageSizeChange:G},children:[t("span",{children:"Show "}),t(me,{variant:"primary",size:"medium",value:String(i.pageSize),options:i.pageSizeOptions.map(n=>({value:String(n),text:String(n)})),handleSelect:X}),t("span",{children:" per page"})]}):void 0,ie=i?t(s,{name:"Pagination",slot:l==null?void 0:l.Pagination,context:{currentPage:i.currentPage,totalPages:i.totalPages,onChange:B},children:t(ge,{currentPage:i.currentPage,totalPages:i.totalPages,onChange:B})}):void 0,re=y&&!P&&!S?t(pe,{type:"warning",variant:"primary",heading:c.noQuoteTemplatesAccessTitle,"data-testid":"quote-templates-permission-warning",children:c.noQuoteTemplatesAccessMessage}):null;return g("div",{...Q,className:Q.className,children:[re,t(Me,{rowData:te,loading:S,emptyStateMessage:ae,showItemRange:h&&k,itemRangeMessage:ne,showPageSizePicker:L&&k,pageSizePickerMessage:oe,showPagination:M&&k,paginationMessage:ie}),I&&se(t(fe,{open:I,title:c.generateQuote,message:c.generateQuoteModalMessage,cancelLabel:c.generateQuoteModalCancel,confirmLabel:O?c.generateQuoteModalConfirmLoading:c.generateQuoteModalConfirm,onCancel:V,onConfirm:O||!_?void 0:()=>Z(_),showCloseButton:!0,"data-testid":"generate-quote-confirmation-modal"}),document.body)]})};export{Ge as QuoteTemplatesListTable,Ge as default};
//# sourceMappingURL=QuoteTemplatesListTable.js.map
