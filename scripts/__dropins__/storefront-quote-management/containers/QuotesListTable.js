/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsxs as Q,jsx as t}from"@dropins/tools/preact-jsx-runtime.js";import{useState as d,useRef as ee,useEffect as I}from"@dropins/tools/preact-compat.js";import{classes as te,Slot as s}from"@dropins/tools/lib.js";import{Table as ae,IllustratedMessage as ne,Picker as re,Pagination as ie,InLineAlert as oe,Button as ce,Price as se}from"@dropins/tools/components.js";import{events as _}from"@dropins/tools/event-bus.js";/* empty css                              */import"@dropins/tools/preact.js";import"@dropins/tools/preact-hooks.js";import{f as F}from"../chunks/dateUtils.js";import{useText as j}from"@dropins/tools/i18n.js";/* empty css                        *//* empty css                          */import{g as me}from"../chunks/transform-quote.js";import"../chunks/state.js";import{n as $}from"../chunks/negotiableQuotes.js";import"@dropins/tools/fetch-graphql.js";const le=({rowData:u=[],loading:p=!1,className:A,emptyStateMessage:y,showItemRange:k=!0,itemRangeMessage:l,showPageSizePicker:g=!0,pageSizePickerMessage:o,showPagination:S=!0,paginationMessage:h,...m})=>{const c=j({quoteName:"QuoteManagement.QuotesListTable.quoteName",created:"QuoteManagement.QuotesListTable.created",createdBy:"QuoteManagement.QuotesListTable.createdBy",status:"QuoteManagement.QuotesListTable.status",lastUpdated:"QuoteManagement.QuotesListTable.lastUpdated",quoteTemplate:"QuoteManagement.QuotesListTable.quoteTemplate",quoteTotal:"QuoteManagement.QuotesListTable.quoteTotal",actions:"QuoteManagement.QuotesListTable.actions"}),T=[{key:"quoteName",label:c.quoteName},{key:"created",label:c.created},{key:"createdBy",label:c.createdBy},{key:"status",label:c.status},{key:"lastUpdated",label:c.lastUpdated},{key:"quoteTemplate",label:c.quoteTemplate},{key:"quoteTotal",label:c.quoteTotal},{key:"actions",label:c.actions}],f=p||u.length>0,L=!p&&u.length===0&&y,b=k&&l,P=g&&o,N=S&&h,v=b||P||N;return Q("div",{...m,className:te(["quote-management-quotes-list-table",A]),children:[f&&t(ae,{columns:T,rowData:u,loading:p,mobileLayout:"none",className:"quote-management-quotes-list-table__table"}),L&&t("div",{className:"quotes-list-table__empty-state",children:y}),v&&Q("div",{className:"quotes-list-table__footer",children:[t("div",{className:"quotes-list-table__item-range",children:b&&l}),t("div",{className:"quotes-list-table__pagination",children:N&&h}),t("div",{className:"quotes-list-table__page-size-picker",children:P&&o})]})]})},Ae=({pageSize:u,showItemRange:p=!0,showPageSizePicker:A=!0,showPagination:y=!0,onViewQuote:k,onPageSizeChange:l,onPageChange:g,slots:o,...S})=>{const h=j({noQuotesAccessTitle:"QuoteManagement.permissions.noQuotesAccessTitle",noQuotesAccessMessage:"QuoteManagement.permissions.noQuotesAccessMessage"}),[m,c]=d(null),[T,f]=d(!0),[L,b]=d(!1),[P,N]=d(!1),v=ee(!1),q=me()[0],[x,H]=d(u||q),[z,w]=d(1);I(()=>{const r=async()=>{try{f(!0);const n=await $({pageSize:x,currentPage:z});c(n)}catch(n){console.error("Failed to fetch quotes:",n)}finally{f(!1)}},e=_.on("authenticated",n=>{N(n),n&&v.current?r():(c(null),f(!1))},{eager:!0});return()=>{e==null||e.off()}},[x,z]),I(()=>{const r=_.on("quote-management/permissions",e=>{const n=e.editQuote||e.requestQuote;v.current=n,b(n)},{eager:!0});return()=>{r==null||r.off()}},[]),I(()=>{const r=async()=>{try{const n=await $({pageSize:x,currentPage:z});c(n)}catch(n){console.error("Failed to fetch quotes:",n)}},e=_.on("quote-management/quote-renamed",()=>{r()},{eager:!0});return()=>{e==null||e.off()}},[x,z]);const B=r=>{H(r),w(1),l==null||l(r)},R=r=>{w(r),g==null||g(r)},W=r=>{const e=r.target,n=e==null?void 0:e.value;n&&B(Number(n))},D=(r,e,n)=>r.filter(a=>a==null?void 0:a.uid).map(a=>{var U,C,O,E;const V=`${a.buyer.firstname} ${a.buyer.lastname}`;return{id:a.uid,quoteName:t(s,{name:"QuoteName",slot:e==null?void 0:e.QuoteName,context:{quote:a},children:t("span",{children:a.name})}),created:t(s,{name:"Created",slot:e==null?void 0:e.Created,context:{quote:a},children:t("span",{children:a.createdAt?F(a.createdAt,"short"):"N/A"})}),createdBy:t(s,{name:"CreatedBy",slot:e==null?void 0:e.CreatedBy,context:{quote:a},children:t("span",{children:V})}),status:t(s,{name:"Status",slot:e==null?void 0:e.Status,context:{quote:a},children:t("span",{children:a.status})}),lastUpdated:t(s,{name:"LastUpdated",slot:e==null?void 0:e.LastUpdated,context:{quote:a},children:t("span",{children:a.updatedAt?F(a.updatedAt,"short"):"N/A"})}),quoteTemplate:t(s,{name:"QuoteTemplate",slot:e==null?void 0:e.QuoteTemplate,context:{quote:a},children:t("span",{children:a.templateName})}),quoteTotal:t(s,{name:"QuoteTotal",slot:e==null?void 0:e.QuoteTotal,context:{quote:a},children:t(se,{amount:(C=(U=a.prices)==null?void 0:U.grandTotal)==null?void 0:C.value,currency:(E=(O=a.prices)==null?void 0:O.grandTotal)==null?void 0:E.currency})}),actions:t(s,{name:"Actions",slot:e==null?void 0:e.Actions,context:{quote:a,onViewQuote:n},children:t(ce,{variant:"tertiary",size:"medium",onClick:()=>n==null?void 0:n(a.uid,a.name,a.status),children:"View"})})}}),G=m!=null&&m.items?D(m.items,o,k):[],i=m==null?void 0:m.paginationInfo,M=!!i,J=t(s,{name:"EmptyQuotes",slot:o==null?void 0:o.EmptyQuotes,context:{quotesData:m},children:t(ne,{heading:"No Quotes Found"})}),K=i?t(s,{name:"ItemRange",slot:o==null?void 0:o.ItemRange,context:i,children:Q("span",{children:["Items ",i.startItem," to ",i.endItem," of"," ",i.totalCount," total"]})}):void 0,X=i&&i.pageSizeOptions?Q(s,{name:"PageSizePicker",slot:o==null?void 0:o.PageSizePicker,context:{pageSize:i.pageSize,pageSizeOptions:i.pageSizeOptions,onPageSizeChange:B},children:[t("span",{children:"Show "}),t(re,{variant:"primary",size:"medium",value:String(i.pageSize),options:i.pageSizeOptions.map(r=>({value:String(r),text:String(r)})),handleSelect:W}),t("span",{children:" per page"})]}):void 0,Y=i?t(s,{name:"Pagination",slot:o==null?void 0:o.Pagination,context:{currentPage:i.currentPage,totalPages:i.totalPages,onChange:R},children:t(ie,{currentPage:i.currentPage,totalPages:i.totalPages,onChange:R})}):void 0,Z=P&&!L&&!T?t(oe,{type:"warning",variant:"primary",heading:h.noQuotesAccessTitle,"data-testid":"quotes-permission-warning",children:h.noQuotesAccessMessage}):null;return Q("div",{...S,className:S.className,children:[Z,t(le,{rowData:G,loading:T,emptyStateMessage:J,showItemRange:p&&M,itemRangeMessage:K,showPageSizePicker:A&&M,pageSizePickerMessage:X,showPagination:y&&M,paginationMessage:Y})]})};export{Ae as QuotesListTable,Ae as default};
//# sourceMappingURL=QuotesListTable.js.map
