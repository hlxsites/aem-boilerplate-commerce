/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsxs as j,jsx as a}from"@dropins/tools/preact-jsx-runtime.js";import*as u from"@dropins/tools/preact-compat.js";import{useState as q,useEffect as y,useCallback as re}from"@dropins/tools/preact-compat.js";import{classes as m,VComponent as h,Slot as N,getFormErrors as z,getFormValues as oe}from"@dropins/tools/lib.js";import{TextArea as ne,Field as ie,Input as se,InputFile as ce,Button as I,InLineAlert as me}from"@dropins/tools/components.js";/* empty css                                  */import{events as T}from"@dropins/tools/event-bus.js";import"../chunks/fetch-graphql.js";import{u as ue,r as B}from"../chunks/uploadFile.js";import{S as de}from"../chunks/WarningFilled.js";import{useText as le}from"@dropins/tools/i18n.js";import"@dropins/tools/fetch-graphql.js";import"../chunks/NegotiableQuoteFragment.js";const fe=i=>u.createElement("svg",{id:"Icon_Add_Base","data-name":"Icon \\u2013 Add \\u2013 Base",xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",...i},u.createElement("g",{id:"Large"},u.createElement("rect",{id:"Placement_area","data-name":"Placement area",width:24,height:24,fill:"#fff",opacity:0}),u.createElement("g",{id:"Add_icon","data-name":"Add icon",transform:"translate(9.734 9.737)"},u.createElement("line",{vectorEffect:"non-scaling-stroke",id:"Line_579","data-name":"Line 579",y2:12.7,transform:"translate(2.216 -4.087)",fill:"none",stroke:"currentColor"}),u.createElement("line",{vectorEffect:"non-scaling-stroke",id:"Line_580","data-name":"Line 580",x2:12.7,transform:"translate(-4.079 2.263)",fill:"none",stroke:"currentColor"})))),ge=i=>u.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...i},u.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M0.75 12C0.75 5.78421 5.78421 0.75 12 0.75C18.2158 0.75 23.25 5.78421 23.25 12C23.25 18.2158 18.2158 23.25 12 23.25C5.78421 23.25 0.75 18.2158 0.75 12Z",stroke:"currentColor"}),u.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M6.75 12.762L10.2385 15.75L17.25 9",stroke:"currentColor"})),qe=({className:i,title:e,banner:F,commentField:_,quoteNameField:b,attachFile:s,requestButton:l,saveButton:Q,onSubmit:x,...E})=>j("form",{...E,className:m(["request-negotiable-quote-form",i]),onSubmit:x,children:[F&&a(h,{node:F,className:m(["request-negotiable-quote-form__banner"])}),e&&a(h,{node:e,className:m(["request-negotiable-quote-form__title"])}),_&&a(h,{node:_,className:m(["request-negotiable-quote-form__comment-field"])}),b&&a(h,{node:b,className:m(["request-negotiable-quote-form__quote-name-field"])}),s&&a(h,{node:s,className:m(["request-negotiable-quote-form__attach-file-field"])}),j("div",{className:m(["request-negotiable-quote-form__actions"]),children:[l&&a(h,{node:l,className:m(["request-negotiable-quote-form__request-button"])}),Q&&a(h,{node:Q,className:m(["request-negotiable-quote-form__save-button"])})]})]}),Be=({cartId:i,slots:e,onRequestNegotiableQuote:F,onSaveNegotiableQuote:_,onAttachFiles:b,onSubmitErrors:s,onError:l,className:Q})=>{const[x,E]=q(void 0),[L,V]=q(void 0),[K,O]=q([]),[p,v]=q(void 0),[d,f]=q({}),[w,W]=q(void 0),[n,g]=q(!1),o=le({title:"NegotiableQuote.Request.title",comment:"NegotiableQuote.Request.comment",commentError:"NegotiableQuote.Request.commentError",quoteName:"NegotiableQuote.Request.quoteName",quoteNameError:"NegotiableQuote.Request.quoteNameError",attachmentsError:"NegotiableQuote.Request.attachmentsError",requestCta:"NegotiableQuote.Request.requestCta",saveDraftCta:"NegotiableQuote.Request.saveDraftCta",errorHeader:"NegotiableQuote.Request.error.header",unauthenticated:"NegotiableQuote.Request.error.unauthenticated",unauthorized:"NegotiableQuote.Request.error.unauthorized",missingCart:"NegotiableQuote.Request.error.missingCart",successHeader:"NegotiableQuote.Request.success.header",submitSuccess:"NegotiableQuote.Request.success.submitted",draftSuccess:"NegotiableQuote.Request.success.draftSaved"});y(()=>{const t=T.on("quote-management/permissions",r=>{v(void 0),r.requestQuote||(v(o.unauthorized),g(!0))},{eager:!0});return()=>t==null?void 0:t.off()},[o.unauthorized]),y(()=>{const t=T.on("authenticated",r=>{v(void 0),r||(v(o.unauthenticated),g(!0))},{eager:!0});return()=>t==null?void 0:t.off()},[o.unauthenticated]),y(()=>{i||(v(o.missingCart),g(!0))},[i,o.missingCart]),y(()=>{p&&(l==null||l({error:p,isFormDisabled:n,setIsFormDisabled:g}))},[p,l,n]);const S=re(async t=>{if(t!=null&&t.length){if(f(r=>({...r,attachments:""})),b){try{await b(t)}catch{f(r=>({...r,attachments:o.attachmentsError}))}return}try{const r=await Promise.all(t.map(ue));O(r.map(({key:c})=>({key:c})))}catch{f(r=>({...r,attachments:o.attachmentsError}))}}},[b,o]),Z=()=>{let t,r;if(w?(r={name:"SuccessBanner",slot:e==null?void 0:e.SuccessBanner,context:{message:w},"data-testid":"form-success-banner"},t={type:"success",variant:"primary",icon:a(ge,{}),heading:o.successHeader,description:w,className:"request-negotiable-quote-form__success-banner"}):p&&(r={name:"ErrorBanner",slot:e==null?void 0:e.ErrorBanner,context:{message:p},"data-testid":"form-error-banner"},t={type:"error",variant:"primary",icon:a(de,{}),heading:o.errorHeader,description:p,className:"request-negotiable-quote-form__error-banner"}),r&&t)return a(N,{...r,children:a(me,{...t})})},H=t=>{f({});const r=t.target.closest("form"),c=z(r);Object.keys(c).length>0&&(f(c),s==null||s(c))},$=t=>{var P;t.preventDefault(),g(!0);const r=t.target,C={...z(r),...d};if(Object.keys(C).length>0){s==null||s(C);return}const k=t.submitter,R=oe(r);E(R.comment),V(R.quoteName);const M=((P=k==null?void 0:k.dataset)==null?void 0:P.draft)==="true"||!1,te={cartId:i,quoteName:R.quoteName,comment:R.comment,attachments:K,isDraft:M};let A,D;M?(A=_??B,D=o.draftSuccess):(A=F??B,D=o.submitSuccess),A(te).then(()=>{W(D)}).catch(ae=>{v(ae.message)})},G=a(N,{name:"Title",slot:e==null?void 0:e.Title,context:{text:o.title},children:a("span",{"data-testid":"form-title",children:o.title})}),J=a(N,{name:"CommentField",slot:e==null?void 0:e.CommentField,context:{value:x,required:!0,errorMessage:d.comment,setFormErrors:f,isFormDisabled:n},children:a(ne,{name:"comment",value:x,label:o.comment,required:!0,autoComplete:"off","data-testid":"form-comment-field",errorMessage:d.comment,disabled:n})}),U=a(N,{name:"QuoteNameField",slot:e==null?void 0:e.QuoteNameField,context:{value:L,required:!0,errorMessage:d.quoteName,setFormErrors:f,isFormDisabled:n},children:a(ie,{error:d.quoteName,disabled:n,children:a(se,{value:L,name:"quoteName",floatingLabel:o.quoteName,required:!0,autoComplete:"off","data-testid":"form-quote-name-field"})})}),X=a(N,{name:"AttachFileField",slot:e==null?void 0:e.AttachFileField,context:{onChange:S,formErrors:d,isFormDisabled:n},children:a(ce,{onChange:t=>{const r=t.target,c=r==null?void 0:r.files,C=c?Array.from(c):[];C.length>0&&S(C)},icon:a(fe,{}),disabled:n,"data-testid":"form-attach-file-field"})}),Y=a(N,{name:"RequestButton",slot:e==null?void 0:e.RequestButton,context:{requestNegotiableQuote:B,formErrors:d,isFormDisabled:n,setIsFormDisabled:g},children:a(I,{type:"submit","data-testid":"form-request-button",onClick:H,disabled:n,children:o.requestCta})}),ee=a(N,{name:"SaveDraftButton",slot:e==null?void 0:e.SaveDraftButton,context:{requestNegotiableQuote:B,formErrors:d,isFormDisabled:n,setIsFormDisabled:g},children:a(I,{type:"submit","data-draft":"true",variant:"secondary","data-testid":"form-save-draft-button",onClick:H,disabled:n,children:o.saveDraftCta})});return a(qe,{title:G,banner:Z(),commentField:J,quoteNameField:U,attachFile:X,requestButton:Y,saveButton:ee,onSubmit:$,className:Q,disabled:n,"data-testid":"form-container"})};export{Be as RequestNegotiableQuoteForm,Be as default};
//# sourceMappingURL=RequestNegotiableQuoteForm.js.map
