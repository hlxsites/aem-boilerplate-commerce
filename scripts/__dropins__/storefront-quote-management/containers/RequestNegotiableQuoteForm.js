/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsxs as P,jsx as a}from"@dropins/tools/preact-jsx-runtime.js";import*as c from"@dropins/tools/preact-compat.js";import{useState as g,useEffect as R,useCallback as oe}from"@dropins/tools/preact-compat.js";import{classes as u,VComponent as h,Slot as q,getFormErrors as j,getFormValues as ne}from"@dropins/tools/lib.js";import{TextArea as ie,Field as ce,Input as se,InputFile as ue,Button as z,InLineAlert as me}from"@dropins/tools/components.js";import{events as I}from"@dropins/tools/event-bus.js";import{u as de,r as w}from"../chunks/requestNegotiableQuote.js";import{useText as le}from"@dropins/tools/i18n.js";import"@dropins/tools/fetch-graphql.js";const fe=i=>c.createElement("svg",{id:"Icon_Add_Base","data-name":"Icon \\u2013 Add \\u2013 Base",xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",...i},c.createElement("g",{id:"Large"},c.createElement("rect",{id:"Placement_area","data-name":"Placement area",width:24,height:24,fill:"#fff",opacity:0}),c.createElement("g",{id:"Add_icon","data-name":"Add icon",transform:"translate(9.734 9.737)"},c.createElement("line",{vectorEffect:"non-scaling-stroke",id:"Line_579","data-name":"Line 579",y2:12.7,transform:"translate(2.216 -4.087)",fill:"none",stroke:"currentColor"}),c.createElement("line",{vectorEffect:"non-scaling-stroke",id:"Line_580","data-name":"Line 580",x2:12.7,transform:"translate(-4.079 2.263)",fill:"none",stroke:"currentColor"})))),ge=i=>c.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...i},c.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M0.75 12C0.75 5.78421 5.78421 0.75 12 0.75C18.2158 0.75 23.25 5.78421 23.25 12C23.25 18.2158 18.2158 23.25 12 23.25C5.78421 23.25 0.75 18.2158 0.75 12Z",stroke:"currentColor"}),c.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M6.75 12.762L10.2385 15.75L17.25 9",stroke:"currentColor"})),he=i=>c.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...i},c.createElement("path",{vectorEffect:"non-scaling-stroke",fillRule:"evenodd",clipRule:"evenodd",d:"M1 20.8953L12.1922 1.5L23.395 20.8953H1ZM13.0278 13.9638L13.25 10.0377V9H11.25V10.0377L11.4722 13.9638H13.0278ZM11.2994 16V17.7509H13.2253V16H11.2994Z",fill:"currentColor"})),qe=({className:i,title:C,banner:e,commentField:_,quoteNameField:F,attachFile:N,requestButton:s,saveButton:d,onSubmit:E,...x})=>P("form",{...x,className:u(["request-negotiable-quote-form",i]),onSubmit:E,children:[e&&a(h,{node:e,className:u(["request-negotiable-quote-form__banner"])}),C&&a(h,{node:C,className:u(["request-negotiable-quote-form__title"])}),_&&a(h,{node:_,className:u(["request-negotiable-quote-form__comment-field"])}),F&&a(h,{node:F,className:u(["request-negotiable-quote-form__quote-name-field"])}),N&&a(h,{node:N,className:u(["request-negotiable-quote-form__attach-file-field"])}),P("div",{className:u(["request-negotiable-quote-form__actions"]),children:[s&&a(h,{node:s,className:u(["request-negotiable-quote-form__request-button"])}),d&&a(h,{node:d,className:u(["request-negotiable-quote-form__save-button"])})]})]}),Qe=({cartId:i,enableFileUpload:C=!0,slots:e,onRequestNegotiableQuote:_,onSaveNegotiableQuote:F,onAttachFiles:N,onSubmitErrors:s,onError:d,className:E})=>{const[x,Z]=g(void 0),[A,T]=g(void 0),[K,O]=g([]),[b,v]=g(void 0),[m,l]=g({}),[y,W]=g(void 0),[n,f]=g(!1),o=le({title:"NegotiableQuote.Request.title",comment:"NegotiableQuote.Request.comment",commentError:"NegotiableQuote.Request.commentError",quoteName:"NegotiableQuote.Request.quoteName",quoteNameError:"NegotiableQuote.Request.quoteNameError",attachmentsError:"NegotiableQuote.Request.attachmentsError",requestCta:"NegotiableQuote.Request.requestCta",saveDraftCta:"NegotiableQuote.Request.saveDraftCta",errorHeader:"NegotiableQuote.Request.error.header",unauthenticated:"NegotiableQuote.Request.error.unauthenticated",unauthorized:"NegotiableQuote.Request.error.unauthorized",missingCart:"NegotiableQuote.Request.error.missingCart",successHeader:"NegotiableQuote.Request.success.header",submitSuccess:"NegotiableQuote.Request.success.submitted",draftSuccess:"NegotiableQuote.Request.success.draftSaved"});R(()=>{const t=I.on("quote-management/permissions",r=>{v(void 0),r.requestQuote||(v(o.unauthorized),f(!0))},{eager:!0});return()=>t==null?void 0:t.off()},[o.unauthorized]),R(()=>{const t=I.on("authenticated",r=>{v(void 0),r||(v(o.unauthenticated),f(!0))},{eager:!0});return()=>t==null?void 0:t.off()},[o.unauthenticated]),R(()=>{i||(v(o.missingCart),f(!0))},[i,o.missingCart]),R(()=>{b&&(d==null||d({error:b,isFormDisabled:n,setIsFormDisabled:f}))},[b,d,n]);const H=oe(async t=>{if(t!=null&&t.length){if(l(r=>({...r,attachments:""})),N){try{await N(t)}catch{l(r=>({...r,attachments:o.attachmentsError}))}return}try{const r=await Promise.all(t.map(de));O(r.map(({key:p})=>({key:p})))}catch{l(r=>({...r,attachments:o.attachmentsError}))}}},[N,o]),$=()=>{let t,r;if(y?(r={name:"SuccessBanner",slot:e==null?void 0:e.SuccessBanner,context:{message:y},"data-testid":"form-success-banner"},t={type:"success",variant:"primary",icon:a(ge,{}),heading:o.successHeader,description:y,className:"request-negotiable-quote-form__success-banner"}):b&&(r={name:"ErrorBanner",slot:e==null?void 0:e.ErrorBanner,context:{message:b},"data-testid":"form-error-banner"},t={type:"error",variant:"primary",icon:a(he,{}),heading:o.errorHeader,description:b,className:"request-negotiable-quote-form__error-banner"}),r&&t)return a(q,{...r,children:a(me,{...t})})},D=t=>{l({});const r=t.target.closest("form"),p=j(r);Object.keys(p).length>0&&(l(p),s==null||s(p))},G=t=>{var V;t.preventDefault(),f(!0);const r=t.target,M={...j(r),...m};if(Object.keys(M).length>0){s==null||s(M);return}const B=t.submitter,Q=ne(r);Z(Q.comment),T(Q.quoteName);const S=((V=B==null?void 0:B.dataset)==null?void 0:V.draft)==="true"||!1,ae={cartId:i,quoteName:Q.quoteName,comment:Q.comment,attachments:C?K:void 0,isDraft:S};let k,L;S?(k=F??w,L=o.draftSuccess):(k=_??w,L=o.submitSuccess),k(ae).then(()=>{W(L)}).catch(re=>{v(re.message)})},J=a(q,{name:"Title",slot:e==null?void 0:e.Title,context:{text:o.title},children:a("span",{"data-testid":"form-title",children:o.title})}),X=a(q,{name:"CommentField",slot:e==null?void 0:e.CommentField,context:{value:x,required:!0,errorMessage:m.comment,setFormErrors:l,isFormDisabled:n},children:a(ie,{name:"comment",value:x,label:o.comment,required:!0,autoComplete:"off","data-testid":"form-comment-field",errorMessage:m.comment,disabled:n})}),Y=a(q,{name:"QuoteNameField",slot:e==null?void 0:e.QuoteNameField,context:{value:A,required:!0,errorMessage:m.quoteName,setFormErrors:l,isFormDisabled:n},children:a(ce,{error:m.quoteName,disabled:n,children:a(se,{value:A,name:"quoteName",floatingLabel:o.quoteName,required:!0,autoComplete:"off","data-testid":"form-quote-name-field"})})}),U=C?a(q,{name:"AttachFileField",slot:e==null?void 0:e.AttachFileField,context:{onChange:H,formErrors:m,isFormDisabled:n},children:a(ue,{onChange:t=>{const r=Array.from(t.target.files);r.length>0&&H(r)},icon:a(fe,{}),disabled:n,"data-testid":"form-attach-file-field"})}):void 0,ee=a(q,{name:"RequestButton",slot:e==null?void 0:e.RequestButton,context:{requestNegotiableQuote:w,formErrors:m,isFormDisabled:n,setIsFormDisabled:f},children:a(z,{type:"submit","data-testid":"form-request-button",onClick:D,disabled:n,children:o.requestCta})}),te=a(q,{name:"SaveDraftButton",slot:e==null?void 0:e.SaveDraftButton,context:{requestNegotiableQuote:w,formErrors:m,isFormDisabled:n,setIsFormDisabled:f},children:a(z,{type:"submit","data-draft":"true",variant:"secondary","data-testid":"form-save-draft-button",onClick:D,disabled:n,children:o.saveDraftCta})});return a(qe,{title:J,banner:$(),commentField:X,quoteNameField:Y,attachFile:U,requestButton:ee,saveButton:te,onSubmit:G,className:E,disabled:n,"data-testid":"form-container"})};export{Qe as RequestNegotiableQuoteForm,Qe as default};
//# sourceMappingURL=RequestNegotiableQuoteForm.js.map
