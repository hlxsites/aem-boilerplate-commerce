/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as o}from"@dropins/tools/preact-jsx-runtime.js";import{useState as O,useEffect as v,useRef as g}from"@dropins/tools/preact-compat.js";import{events as A}from"@dropins/tools/event-bus.js";import{s as P,p as U}from"../chunks/signals.js";import{P as l}from"../chunks/location.js";import{useText as D}from"@dropins/tools/i18n.js";import"../chunks/state.js";import"@dropins/tools/signals.js";const L="en_US";function M(){const[t,e]=O(A.lastPayload("locale")||L);return v(()=>{const a=A.on("locale",e);return()=>a==null?void 0:a.off()},[t]),t}const c="payment-services_apple-pay-container";function S(t){const e=U.value;switch(t){case l.CHECKOUT:return e==null?void 0:e.checkout;case l.PRODUCT_DETAIL:return e==null?void 0:e.productDetail;default:throw new Error(`Unsupported location: ${t}`)}}const j=({location:t,getCartId:e,createCart:a,onButtonClick:p,onSuccess:u,onError:f,...m})=>{if(!e&&!a||e&&a)throw new Error("Either getCartId or createCart must be provided and not both.");t||(console.warn("No location provided for Apple Pay button. Please add a location. Defaulting to CHECKOUT."),t=l.CHECKOUT);const r=S(t),d=g(null),s=g(null),h=M(),{methodNotAvailableMessage:_,methodNotLoadedMessage:w,methodLoadingMessage:E}=D({methodNotAvailableMessage:"PaymentServices.messages.methodNotAvailable",methodNotLoadedMessage:"PaymentServices.messages.methodNotLoaded",methodLoadingMessage:"PaymentServices.messages.methodLoading"});return v(()=>{let i=null;if(!(r!=null&&r.Payment.ApplePay.isAvailable())||!s.current)return;const y=`apple-pay-${Math.random().toString(36).slice(2,11)}`;s.current.id=y;const T=async()=>{if(e)return e();const n=a.getCartItems();if(!n)throw new Error("No items found to be added to the cart.");return i=r._Utils.addProductsToNewCart($(n)),(await i).cartId},b=()=>{i!==null&&i.then(async({cartId:n})=>{await r._Utils.setCartAsInactive(n)}).catch(console.error)},N={getCartId:T,useApplePayShippingAddress:t===l.PRODUCT_DETAIL,useApplePayBillingAddress:t===l.PRODUCT_DETAIL,onSuccess:u,onError:f,buttonLanguage:{locale:C(h)},container:`#${y}`,onButtonClick:p,onCancel:b};return r.Payment.ApplePay.render(N).then(n=>{d.current=n}).catch(n=>{console.error("Apple Pay render failed:",n)}),()=>{d.current&&d.current.teardown()}},[r,t,e,a,u,f,p,h]),r&&!r.Payment.ApplePay.isAvailable()?o("div",{ref:s,class:c,children:o("div",{class:"apple-pay-error",children:_})}):P.value==="error"?o("div",{ref:s,class:c,children:o("div",{class:"apple-pay-error",children:w})}):P.value==="initializing"?o("div",{ref:s,class:c,...m,children:o("div",{class:"apple-pay-loading",children:E})}):o("div",{ref:s,class:c,...m})};function $(t){return t.map(e=>({sku:e.sku,quantity:e.quantity,parent_sku:e.parentSku,selected_options:e.selectedOptions,entered_options:e.enteredOptions}))}function C(t){const e=t.split("_");if(e.length<2){const a=C(L);return console.warn(`Cannot map elsie locale "${t}" to apple pay button locale. Falling back to "${a}".`),a}return`${e[0]}-${e[1]}`}export{j as ApplePay,j as default};
//# sourceMappingURL=ApplePay.js.map
