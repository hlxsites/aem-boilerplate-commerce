/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as o}from"@dropins/tools/preact-jsx-runtime.js";import{useState as I,useEffect as P,useRef as A}from"@dropins/tools/preact-compat.js";import{events as v}from"@dropins/tools/event-bus.js";import{p as O,s as L}from"../chunks/signals.js";import{useText as $}from"@dropins/tools/i18n.js";import"../chunks/state.js";import"@dropins/tools/signals.js";const C="en_US";function R(){const[t,e]=I(v.lastPayload("locale")||C);return P(()=>{const a=v.on("locale",e);return()=>a==null?void 0:a.off()},[t]),t}const i="payment-services_apple-pay-container",k=({location:t,getCartId:e,createCart:a,isVirtualCart:d,onButtonClick:p,onSuccess:u,onError:m,...f})=>{const s=O.value,r=t==="CHECKOUT"?s==null?void 0:s.checkout:s==null?void 0:s.productDetail,c=A(null),l=A(null),h=R(),{methodNotAvailableMessage:w,methodNotLoadedMessage:N,methodLoadingMessage:b}=$({methodNotAvailableMessage:"PaymentServices.messages.methodNotAvailable",methodNotLoadedMessage:"PaymentServices.messages.methodNotLoaded",methodLoadingMessage:"PaymentServices.messages.methodLoading"});if(!e&&!a||e&&a)throw new Error("Either getCartId or createCart must be provided and not both.");return P(()=>{let y=null;if(!(r!=null&&r.Payment.ApplePay.isAvailable())||!l.current)return;const g=`apple-pay-${Math.random().toString(36).slice(2,11)}`;l.current.id=g;const E=async()=>{if(e)return e();const n=a.getCartItems();if(!n)throw new Error("No items.");return y=(await r._Utils.addProductsToNewCart(n)).cartId,y},T=({cartIdPromise:n})=>{n!==null&&n.then(async U=>{await r._Utils.setCartAsInactive(U)}).catch(console.error)},M={getCartId:E,useApplePayShippingAddress:t==="PRODUCT_DETAIL",useApplePayBillingAddress:t==="PRODUCT_DETAIL",onSuccess:u,onError:m,buttonLanguage:{locale:_(h)},container:`#${g}`,isVirtualCart:async()=>d,onButtonClick:p,onCancel:T};return r.Payment.ApplePay.render(M).then(n=>{c.current=n}).catch(n=>{console.error("Apple Pay render failed:",n)}),()=>{c.current&&c.current.teardown()}},[r,t,e,u,m,d,p,h]),r&&!r.Payment.ApplePay.isAvailable()?o("div",{ref:l,class:i,children:o("div",{class:"apple-pay-error",children:w})}):L.value==="error"?o("div",{ref:l,class:i,children:o("div",{class:"apple-pay-error",children:N})}):L.value==="initializing"?o("div",{ref:l,class:i,...f,children:o("div",{class:"apple-pay-loading",children:b})}):o("div",{ref:l,class:i,...f})};function _(t){const e=t.split("_");if(e.length<2){const a=_(C);return console.warn(`Cannot map elsie locale "${t}" to apple pay button locale. Falling back to "${a}".`),a}return`${e[0]}-${e[1]}`}export{k as ApplePay,k as default};
//# sourceMappingURL=ApplePay.js.map
