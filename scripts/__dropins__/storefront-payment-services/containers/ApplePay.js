/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as s}from"@dropins/tools/preact-jsx-runtime.js";import{useRef as g,useEffect as v}from"@dropins/tools/preact-compat.js";import{u as I,s as C,p as M,D as S,f as $}from"../chunks/localizedError.js";import{a as l}from"../chunks/location.js";import{useState as R}from"@dropins/tools/preact-hooks.js";import{useText as k}from"@dropins/tools/i18n.js";import"@dropins/tools/signals.js";import"../chunks/en_US.js";import"@dropins/tools/event-bus.js";import"@dropins/tools/lib.js";const c="payment-services_apple-pay-container";function x(t){const e=M.value;switch(t){case l.CHECKOUT:return e==null?void 0:e.checkout;case l.PRODUCT_DETAIL:return e==null?void 0:e.productDetail;default:throw new Error(`Unsupported location: ${t}`)}}const W=({location:t,getCartId:e,createCart:r,onButtonClick:y,onSuccess:h,onError:u,hidden:w,disabled:f})=>{if(!e&&!r||e&&r)throw new Error("Either getCartId or createCart must be provided and not both.");t||(console.warn("No location provided for Apple Pay button. Please add a location. Defaulting to CHECKOUT."),t=l.CHECKOUT);const o=x(t),[m,b]=R(null),n=g(null),A=I(),E=g(!!f),{methodNotAvailableMessage:_,methodNotLoadedMessage:T,methodLoadingMessage:D}=k({methodNotAvailableMessage:"PaymentServices.messages.methodNotAvailable",methodNotLoadedMessage:"PaymentServices.messages.methodNotLoaded",methodLoadingMessage:"PaymentServices.messages.methodLoading"});v(()=>{let p=null;if(!(o!=null&&o.Payment.ApplePay.isAvailable())||!n.current)return;const P=`apple-pay-${Math.random().toString(36).slice(2,11)}`;n.current.id=P;const N=async()=>{if(e)return e();const a=r.getCartItems();if(!a)throw new Error("No items found to be added to the cart.");return p=o._Utils.addProductsToNewCart(F(a)),(await p).cartId},O=()=>{p!==null&&p.then(async({cartId:a})=>{await o._Utils.setCartAsInactive(a)}).catch(console.error)},U={getCartId:N,useApplePayShippingAddress:t===l.PRODUCT_DETAIL,useApplePayBillingAddress:t===l.PRODUCT_DETAIL,onSuccess:h,onError:a=>{u===void 0?console.error(a):u($("ApplePay",a))},buttonLanguage:{locale:L(A)},container:`#${P}`,onButtonClick:y,onCancel:O,disabled:E.current};let d=null;return o.Payment.ApplePay.render(U).then(a=>{d=a,b(d)}).catch(a=>{console.error("Apple Pay render failed:",a)}),()=>{d&&d.teardown()}},[o,t,e,r,h,u,y,A]),v(()=>{m&&m.setDisabled(!!f)},[m,f]);const i={display:w?"none":"block"};return o&&!o.Payment.ApplePay.isAvailable()?s("div",{ref:n,class:c,style:i,children:s("div",{class:"apple-pay-error",children:_})}):C.value==="error"?s("div",{ref:n,class:c,style:i,children:s("div",{class:"apple-pay-error",children:T})}):C.value==="initializing"?s("div",{ref:n,class:c,style:i,children:s("div",{class:"apple-pay-loading",children:D})}):s("div",{ref:n,class:c,style:i})};function F(t){return t.map(e=>({sku:e.sku,quantity:e.quantity,parent_sku:e.parentSku,selected_options:e.selectedOptions,entered_options:e.enteredOptions}))}function L(t){const e=t.split("_");if(e.length<2){const r=L(S);return console.warn(`Cannot map elsie locale "${t}" to apple pay button locale. Falling back to "${r}".`),r}return`${e[0]}-${e[1]}`}export{W as ApplePay,W as default};
//# sourceMappingURL=ApplePay.js.map
